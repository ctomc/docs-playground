<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="WildFly developer team">
<title>Developer Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Developer Guide</h1>
<div class="details">
<span id="author" class="author">WildFly developer team</span><br>
<span id="revnumber">version {version},</span>
<span id="revdate">2017-09-12</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">WildFly Developer guide</div>
<ul class="sectlevel3">
<li><a href="#target-audience">1. Target Audience</a></li>
<li><a href="#_class_loading_in_wildfly">1. Class Loading in WildFly</a>
<ul class="sectlevel2">
<li><a href="#deployment-module-names">1.1. Deployment Module Names</a></li>
<li><a href="#automatic-dependencies">1.2. Automatic Dependencies</a></li>
<li><a href="#class-loading-precedence">1.3. Class Loading Precedence</a></li>
<li><a href="#war-class-loading">1.4. WAR Class Loading</a></li>
<li><a href="#ear-class-loading">1.5. EAR Class Loading</a></li>
<li><a href="#global-modules">1.6. Global Modules</a></li>
<li><a href="#jboss-deployment-structure-file">1.7. JBoss Deployment Structure File</a></li>
<li><a href="#accessing-jdk-classes">1.8. Accessing JDK classes</a></li>
<li><a href="#the-jboss.api-property-and-application-use-of-modules-shipped-with-wildfly">1.9. The "jboss.api" property and application use of modules shipped with</a></li>
</ul>
</li>
<li><a href="#_implicit_module_dependencies_for_deployments">2. Implicit module dependencies for deployments</a>
<ul class="sectlevel2">
<li><a href="#whats-an-implicit-module-dependency">2.1. What&#8217;s an implicit module dependency?</a></li>
<li><a href="#how-and-when-is-an-implicit-module-dependency-added">2.2. How and when is an implicit module dependency added?</a></li>
<li><a href="#which-are-the-implicit-module-dependencies">2.3. Which are the implicit module dependencies?</a></li>
</ul>
</li>
<li><a href="#_deployment_descriptors_used_in_wildfly">3. Deployment Descriptors used In WildFly</a></li>
<li><a href="#_development_guidelines_and_recommended_practices">4. Development Guidelines and Recommended Practices</a></li>
<li><a href="#_application_client_reference">5. Application Client Reference</a>
<ul class="sectlevel2">
<li><a href="#getting-started">5.1. Getting Started</a></li>
<li><a href="#connecting-to-more-than-one-host">5.2. Connecting to more than one host</a></li>
<li><a href="#example">5.3. Example</a></li>
</ul>
</li>
<li><a href="#_cdi_reference">6. CDI Reference</a>
<ul class="sectlevel2">
<li><a href="#using-cdi-beans-from-outside-the-deployment">6.1. Using CDI Beans from outside the deployment</a></li>
<li><a href="#suppressing-implicit-bean-archives">6.2. Suppressing implicit bean archives</a></li>
<li><a href="#development-mode">6.3. Development mode</a></li>
<li><a href="#non-portable-mode">6.4. Non-portable mode</a></li>
</ul>
</li>
<li><a href="#_ee_concurrency_utilities">7. EE Concurrency Utilities</a>
<ul class="sectlevel2">
<li><a href="#overview">7.1. Overview</a></li>
<li><a href="#context-service">7.2. Context Service</a></li>
<li><a href="#managed-thread-factory">7.3. Managed Thread Factory</a></li>
<li><a href="#managed-executor-service">7.4. Managed Executor Service</a></li>
<li><a href="#managed-scheduled-executor-service">7.5. Managed Scheduled Executor Service</a></li>
</ul>
</li>
<li><a href="#_ejb_3_reference_guide">8. EJB 3 Reference Guide</a>
<ul class="sectlevel2">
<li><a href="#resource-adapter-for-message-driven-beans">8.1. Resource Adapter for Message Driven Beans</a></li>
<li><a href="#run-as-principal">8.2. Run-as Principal</a></li>
<li><a href="#security-domain">8.3. Security Domain</a></li>
<li><a href="#transaction-timeout">8.4. Transaction Timeout</a></li>
<li><a href="#timer-service">8.5. Timer service</a></li>
</ul>
</li>
<li><a href="#_container_interceptors">9. Container interceptors</a>
<ul class="sectlevel2">
<li><a href="#overview">9.1. Overview</a></li>
<li><a href="#typical-ejb-invocation-call-path-on-the-server">9.2. Typical EJB invocation call path on the server</a></li>
<li><a href="#configuring-container-interceptors">9.3. Configuring container interceptors</a></li>
<li><a href="#container-interceptor-positioning-in-the-interceptor-chain">9.4. Container interceptor positioning in the interceptor chain</a></li>
<li><a href="#semantic-difference-between-container-interceptors-and-java-ee-interceptors-api">9.5. Semantic difference between container interceptor(s) and Java EE</a></li>
<li><a href="#testcase">9.6. Testcase</a></li>
</ul>
</li>
<li><a href="#_ejb3_clustered_database_timers">10. EJB3 Clustered Database Timers</a>
<ul class="sectlevel2">
<li><a href="#overview">10.1. Overview</a></li>
<li><a href="#setup">10.2. Setup</a></li>
<li><a href="#using-clustered-timers-in-a-deployment">10.3. Using clustered timers in a deployment</a></li>
<li><a href="#technical-details">10.4. Technical details</a></li>
</ul>
</li>
<li><a href="#_ejb3_subsystem_configuration_guide">11. EJB3 subsystem configuration guide</a>
<ul class="sectlevel2">
<li><a href="#session-bean">11.1. &lt;session-bean&gt;</a></li>
<li><a href="#mdb">11.2. &lt;mdb&gt;</a></li>
<li><a href="#entity-bean">11.3. &lt;entity-bean&gt;</a></li>
<li><a href="#pools">11.4. &lt;pools&gt;</a></li>
<li><a href="#caches">11.5. &lt;caches&gt;</a></li>
<li><a href="#passivation-stores">11.6. &lt;passivation-stores&gt;</a></li>
<li><a href="#async">11.7. &lt;async&gt;</a></li>
<li><a href="#timer-service">11.8. &lt;timer-service&gt;</a></li>
<li><a href="#remote">11.9. &lt;remote&gt;</a></li>
<li><a href="#thread-pools">11.10. &lt;thread-pools&gt;</a></li>
<li><a href="#iiop">11.11. &lt;iiop&gt;</a></li>
<li><a href="#in-vm-remote-interface-invocation">11.12. &lt;in-vm-remote-interface-invocation&gt;</a></li>
</ul>
</li>
<li><a href="#_ejb_iiop_guide">12. EJB IIOP Guide</a>
<ul class="sectlevel2">
<li><a href="#enabling-iiop">12.1. Enabling IIOP</a></li>
<li><a href="#enabling-jts">12.2. Enabling JTS</a></li>
<li><a href="#dynamic-stubs">12.3. Dynamic Stub&#8217;s</a></li>
<li><a href="#configuring-ejb-iiop-settings-via-jboss-ejb3.xml">12.4. Configuring EJB IIOP settings via jboss-ejb3.xml</a></li>
</ul>
</li>
<li><a href="#_ejb_over_http">13. EJB over HTTP</a>
<ul class="sectlevel2">
<li><a href="#server-configuration">13.1. Server Configuration</a></li>
<li><a href="#performing-invocations">13.2. Performing Invocations</a></li>
<li><a href="#implementation-details">13.3. Implementation details</a></li>
</ul>
</li>
<li><a href="#_jboss_ejb3_xml_reference">14. jboss-ejb3.xml Reference</a>
<ul class="sectlevel2">
<li><a href="#example-file">14.1. Example File</a></li>
</ul>
</li>
<li><a href="#_message_driven_beans_controlled_delivery">15. Message Driven Beans Controlled Delivery</a>
<ul class="sectlevel2">
<li><a href="#delivery-active">15.1. Delivery Active</a></li>
<li><a href="#delivery-groups">15.2. Delivery Groups</a></li>
<li><a href="#clustered-singleton-delivery">15.3. Clustered Singleton Delivery</a></li>
<li><a href="#using-multiple-mdb-delivery-control-mechanisms">15.4. Using Multiple MDB Delivery Control Mechanisms</a></li>
</ul>
</li>
<li><a href="#_securing_ejbs">16. Securing EJBs</a>
<ul class="sectlevel2">
<li><a href="#overview">16.1. Overview</a></li>
<li><a href="#security-domain">16.2. Security Domain</a></li>
<li><a href="#absence-of-security-domain-configuration-but-presence-of-other-security-metadata">16.3. Absence of security domain configuration but presence of other</a></li>
<li><a href="#access-to-methods-without-explicit-security-metadata-on-a-secured-bean">16.4. Access to methods without explicit security metadata, on a secured</a></li>
</ul>
</li>
<li><a href="#_jpa_reference_guide">17. JPA Reference Guide</a>
<ul class="sectlevel2">
<li><a href="#introduction">17.1. Introduction</a></li>
<li><a href="#update-your-persistence.xml-for-hibernate-5.1">17.2. Update your Persistence.xml for Hibernate 5.1</a></li>
<li><a href="#entity-manager">17.3. Entity manager</a></li>
<li><a href="#container-managed-entity-manager">17.4. Container-managed entity manager</a></li>
<li><a href="#application-managed-entity-manager">17.5. Application-managed entity manager</a></li>
<li><a href="#persistence-context">17.6. Persistence Context</a></li>
<li><a href="#transaction-scoped-persistence-context">17.7. Transaction-scoped Persistence Context</a></li>
<li><a href="#extended-persistence-context">17.8. Extended Persistence Context</a></li>
<li><a href="#entities">17.9. Entities</a></li>
<li><a href="#deployment">17.10. Deployment</a></li>
<li><a href="#troubleshooting">17.11. Troubleshooting</a></li>
<li><a href="#using-the-infinispan-second-level-cache">17.12. Using the Infinispan second level cache</a></li>
<li><a href="#replacing-the-current-hibernate-5.x-jars-with-a-newer-version">17.13. Replacing the current Hibernate 5.x jars with a newer version</a></li>
<li><a href="#using-hibernate-search">17.14. Using Hibernate Search</a></li>
<li><a href="#packaging-the-hibernate-jpa-persistence-provider-with-your-application">17.15. Packaging the Hibernate JPA persistence provider with your application</a></li>
<li><a href="#migrating-from-openjpa">17.16. Migrating from OpenJPA</a></li>
<li><a href="#migrating-from-eclipselink">17.17. Migrating from EclipseLink</a></li>
<li><a href="#migrating-from-datanucleus">17.18. Migrating from DataNucleus</a></li>
<li><a href="#native-hibernate-use">17.19. Native Hibernate use</a></li>
<li><a href="#injection-of-hibernate-session-and-sessionfactoryinjection-of-hibernate-session-and-sessionfactory">17.20. Injection of Hibernate Session and SessionFactoryInjection of</a></li>
<li><a href="#hibernate-properties">17.21. Hibernate properties</a></li>
<li><a href="#persistence-unit-properties">17.22. Persistence unit properties</a></li>
<li><a href="#determine-the-persistence-provider-module">17.23. Determine the persistence provider module</a></li>
<li><a href="#binding-entitymanagerfactoryentitymanager-to-jndi">17.24. Binding EntityManagerFactory/EntityManager to JNDI</a></li>
<li><a href="#community">17.25. Community</a></li>
</ul>
</li>
<li><a href="#_jndi_reference">18. JNDI Reference</a>
<ul class="sectlevel2">
<li><a href="#overview">18.1. Overview</a></li>
</ul>
</li>
<li><a href="#_local_jndi">19. Local JNDI</a>
<ul class="sectlevel2">
<li><a href="#binding-entries-to-jndi">19.1. Binding entries to JNDI</a></li>
<li><a href="#retrieving-entries-from-jndi">19.2. Retrieving entries from JNDI</a></li>
</ul>
</li>
<li><a href="#_remote_jndi_access">20. Remote JNDI Access</a>
<ul class="sectlevel2">
<li><a href="#http-remoting">20.1. http-remoting:</a></li>
<li><a href="#ejb">20.2. ejb:</a></li>
</ul>
</li>
<li><a href="#_jax_rs_reference_guide">21. JAX-RS Reference Guide</a>
<ul class="sectlevel2">
<li><a href="#subclassing-javax.ws.rs.core.application-and-using-applicationpath">21.1. Subclassing javax.ws.rs.core.Application and using @ApplicationPath</a></li>
<li><a href="#subclassing-javax.ws.rs.core.application-and-using-web.xml">21.2. Subclassing javax.ws.rs.core.Application and using web.xml</a></li>
<li><a href="#using-web.xml">21.3. Using web.xml</a></li>
</ul>
</li>
<li><a href="#_sharing_sessions_between_wars_in_an_ear">22. Sharing sessions between wars in an ear</a></li>
<li><a href="#_webservices_reference_guide">23. Webservices reference guide</a></li>
<li><a href="#_jax_ws_user_guide">24. JAX-WS User Guide</a>
<ul class="sectlevel2">
<li><a href="#web-service-endpoints">24.1. Web Service Endpoints</a></li>
<li><a href="#web-service-clients">24.2. Web Service Clients</a></li>
<li><a href="#common-api">24.3. Common API</a></li>
<li><a href="#jax-ws-annotations">24.4. JAX-WS Annotations</a></li>
<li><a href="#jsr-181-annotations">24.5. JSR-181 Annotations</a></li>
</ul>
</li>
<li><a href="#_jax_ws_tools">25. JAX-WS Tools</a>
<ul class="sectlevel2">
<li><a href="#server-side">25.1. Server side</a></li>
<li><a href="#client-side">25.2. Client Side</a></li>
</ul>
</li>
<li><a href="#_advanced_user_guide">26. Advanced User Guide</a>
<ul class="sectlevel2">
<li><a href="#logging">26.1. Logging</a></li>
<li><a href="#ws--support">26.2. WS-* support</a></li>
<li><a href="#address-rewrite">26.3. Address rewrite</a></li>
<li><a href="#configuration-through-deployment-descriptor">26.4. Configuration through deployment descriptor</a></li>
<li><a href="#schema-validation-of-soap-messages">26.5. Schema validation of SOAP messages</a></li>
<li><a href="#jaxb-introductions">26.6. JAXB Introductions</a></li>
<li><a href="#wsdl-system-properties-expansion">26.7. WSDL system properties expansion</a></li>
</ul>
</li>
<li><a href="#_jboss_modules_and_ws_applications">27. JBoss Modules and WS applications</a>
<ul class="sectlevel2">
<li><a href="#setting-module-dependencies">27.1. Setting module dependencies</a></li>
</ul>
</li>
<li><a href="#_scoped_ejb_client_contexts">28. Scoped EJB client contexts</a>
<ul class="sectlevel2">
<li><a href="#overview">28.1. Overview</a></li>
<li><a href="#potential-shortcomings-of-a-single-ejb-client-context">28.2. Potential shortcomings of a single EJB client context</a></li>
<li><a href="#scoped-ejb-client-contexts">28.3. Scoped EJB client contexts</a></li>
<li><a href="#lifecycle-management-of-scoped-ejb-client-contexts">28.4. Lifecycle management of scoped EJB client contexts</a></li>
</ul>
</li>
<li><a href="#_ejb_invocations_from_a_remote_client_using_jndi">29. EJB invocations from a remote client using JNDI</a>
<ul class="sectlevel2">
<li><a href="#deploying-your-ejbs-on-the-server-side">29.1. Deploying your EJBs on the server side:</a></li>
<li><a href="#writing-a-remote-client-application-for-accessing-and-invoking-the-ejbs-deployed-on-the-server">29.2. Writing a remote client application for accessing and invoking the</a></li>
<li><a href="#setting-up-ejb-client-context-properties">29.3. Setting up EJB client context properties</a></li>
<li><a href="#summary">29.4. Summary</a></li>
</ul>
</li>
<li><a href="#_ejb_invocations_from_a_remote_server_instance">30. EJB invocations from a remote server instance</a>
<ul class="sectlevel2">
<li><a href="#application-packaging">30.1. Application packaging</a></li>
<li><a href="#beans">30.2. Beans</a></li>
<li><a href="#security">30.3. Security</a></li>
<li><a href="#configuring-a-user-on-the-destination-server">30.4. Configuring a user on the "Destination Server"</a></li>
<li><a href="#start-the-destination-server">30.5. Start the "Destination Server"</a></li>
<li><a href="#deploying-the-application">30.6. Deploying the application</a></li>
<li><a href="#configuring-the-client-server-to-point-to-the-ejb-remoting-connector-on-the-destination-server">30.7. Configuring the "Client Server" to point to the EJB remoting connector</a></li>
<li><a href="#start-the-client-server">30.8. Start the "Client Server"</a></li>
<li><a href="#create-a-security-realm-on-the-client-server">30.9. Create a security realm on the client server</a></li>
<li><a href="#create-a-outbound-socket-binding-on-the-client-server">30.10. Create a outbound-socket-binding on the "Client Server"</a></li>
<li><a href="#create-a-remote-outbound-connection-which-uses-this-newly-created-outbound-socket-binding">30.11. Create a "remote-outbound-connection" which uses this newly created</a></li>
<li><a href="#packaging-the-client-application-on-the-client-server">30.12. Packaging the client application on the "Client Server"</a></li>
<li><a href="#contents-on-jboss-ejb-client.xml">30.13. Contents on jboss-ejb-client.xml</a></li>
<li><a href="#deploy-the-client-application">30.14. Deploy the client application</a></li>
<li><a href="#client-code-invoking-the-bean">30.15. Client code invoking the bean</a></li>
</ul>
</li>
<li><a href="#_remote_ejb_invocations_via_jndi_ejb_client_api_or_remote_naming_project">31. Remote EJB invocations via JNDI - EJB client API or remote-naming project</a>
<ul class="sectlevel2">
<li><a href="#purpose">31.1. Purpose</a></li>
<li><a href="#history">31.2. History</a></li>
<li><a href="#overview">31.3. Overview</a></li>
<li><a href="#summary">31.4. Summary</a></li>
<li><a href="#remote-ejb-invocations-backed-by-the-remote-naming-project">31.5. Remote EJB invocations backed by the remote-naming project</a></li>
<li><a href="#why-use-the-ejb-client-api-approach-then">31.6. Why use the EJB client API approach then?</a></li>
</ul>
</li>
<li><a href="#_example_applications_migrated_to_wildfly">32. Example Applications - Migrated to WildFly</a>
<ul class="sectlevel2">
<li><a href="#example-applications-migrated-from-previous-releases">32.1. Example Applications Migrated from Previous Releases</a></li>
<li><a href="#example-applications-based-on-ee6">32.2. Example Applications Based on EE6</a></li>
</ul>
</li>
<li><a href="#_porting_the_order_application_from_eap_5_1_to_wildfly_11">33. Porting the Order Application from EAP 5.1 to WildFly 11</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-application">33.1. Overview of the application</a></li>
<li><a href="#summary-of-changes">33.2. Summary of changes</a></li>
</ul>
</li>
<li><a href="#_seam_2_booking_application_migration_of_binaries_from_eap5_1_to">34. Seam 2 Booking Application - Migration of Binaries from EAP5.1 to</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2017 The original authors.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="target-audience">1. Target Audience</h4>
<div class="paragraph">
<p>Java Developers</p>
</div>
</div>
<div class="sect1">
<h2 id="_class_loading_in_wildfly">1. Class Loading in WildFly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since JBoss AS 7, Class loading is considerably different to previous
versions of JBoss AS. Class loading is based on the
<a href="#src-557206">MODULES</a> project. Instead of the more familiar
hierarchical class loading environment, WildFly&#8217;s class loading is based
on modules that have to define explicit dependencies on other modules.
Deployments in WildFly are also modules, and do not have access to
classes that are defined in jars in the application server unless an
explicit dependency on those classes is defined.</p>
</div>
<div class="sect2">
<h3 id="deployment-module-names">1.1. Deployment Module Names</h3>
<div class="paragraph">
<p>Module names for top level deployments follow the format
<code>deployment.myarchive.war</code> while sub deployments are named like
<code>deployment.myear.ear.mywar.war</code>.</p>
</div>
<div class="paragraph">
<p>This means that it is possible for a deployment to import classes from
another deployment using the other deployments module name, the details
of how to add an explicit module dependency are explained below.</p>
</div>
</div>
<div class="sect2">
<h3 id="automatic-dependencies">1.2. Automatic Dependencies</h3>
<div class="paragraph">
<p>Even though in WildFly modules are isolated by default, as part of the
deployment process some dependencies on modules defined by the
application server are set up for you automatically. For instance, if
you are deploying a Java EE application a dependency on the Java EE
API&#8217;s will be added to your module automatically. Similarly if your
module contains a beans.xml file a dependency on
<a href="http://seamframework.org/Weld">Weld</a>will be added automatically, along
with any supporting modules that weld needs to operate.</p>
</div>
<div class="paragraph">
<p>For a complete list of the automatic dependencies that are added, please
see <a href="#src-557206">Implicit module dependencies for deployments</a>.</p>
</div>
<div class="paragraph">
<p>Automatic dependencies can be excluded through the use of
<code>jboss-deployment-structure.xml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="class-loading-precedence">1.3. Class Loading Precedence</h3>
<div class="paragraph">
<p>A common source of errors in Java applications is including API classes
in a deployment that are also provided by the container. This can result
in multiple versions of the class being created and the deployment
failing to deploy properly. To prevent this in WildFly, module
dependencies are added in a specific order that should prevent this
situation from occurring.</p>
</div>
<div class="paragraph">
<p>In order of highest priority to lowest priority</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>System Dependencies - These are dependencies that are added to the
module automatically by the container, including the Java EE api&#8217;s.</p>
</li>
<li>
<p>User Dependencies - These are dependencies that are added through
<code>jboss-deployment-structure.xml</code> or through the <code>Dependencies:</code> manifest
entry.</p>
</li>
<li>
<p>Local Resource - Class files packaged up inside the deployment
itself, e.g. class files from <code>WEB-INF/classes</code> or <code>WEB-INF/lib</code> of a
war.</p>
</li>
<li>
<p>Inter deployment dependencies - These are dependencies on other
deployments in an ear deployment. This can include classes in an ear&#8217;s
lib directory, or classes defined in other ejb jars.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="war-class-loading">1.4. WAR Class Loading</h3>
<div class="paragraph">
<p>The war is considered to be a single module, so classes defined in
<code>WEB-INF/lib</code> are treated the same as classes in <code>WEB-INF/classes</code>. All
classes packaged in the war will be loaded with the same class loader.</p>
</div>
</div>
<div class="sect2">
<h3 id="ear-class-loading">1.5. EAR Class Loading</h3>
<div class="paragraph">
<p>Ear deployments are multi-module deployments. This means that not all
classes inside an ear will necessarily have access to all other classes
in the ear, unless explicit dependencies have been defined. By default
the <code>EAR/lib</code> directory is a single module, and every WAR or EJB jar
deployment is also a separate module. Sub deployments (wars and
ejb-jars) always have a dependency on the parent module, which gives
them access to classes in <code>EAR/lib</code>, however they do not always have an
automatic dependency on each other. This behaviour is controlled via the
<code>ear-subdeployments-isolated</code> setting in the ee subsystem configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:ee:1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>            
  <span class="tag">&lt;ear-subdeployments-isolated&gt;</span>false<span class="tag">&lt;/ear-subdeployments-isolated&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default this is set to false, which allows the sub-deployments to see
classes belonging to other sub-deployments within the .ear.</p>
</div>
<div class="paragraph">
<p>For example, consider the following .ear deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>myapp.ear
 |
 |--- web.war
 |
 |--- ejb1.jar
 |
 |--- ejb2.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the ear-subdeployments-isolated is set to false, then the classes in
web.war can access classes belonging to ejb1.jar and ejb2.jar.
Similarly, classes from ejb1.jar can access classes from ejb2.jar (and
vice-versa).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The ear-subdeployments-isolated element value has no effect on the
isolated classloader of the .war file(s). i.e. irrespective of whether
this flag is set to true or false, the .war within a .ear will have a
isolated classloader and other sub-deployments within that .ear will not
be able to access classes from that .war. This is as per spec.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the ear-subdeployments-isolated is set to true then no automatic
module dependencies between the sub-deployments are set up. User must
manually setup the dependency with <code>Class-Path</code> entries, or by setting
up explicit module dependencies.</p>
</div>
<div class="paragraph">
<p>Portability</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Java EE specification says that portable applications should not
rely on sub deployments having access to other sub deployments unless an
explicit Class-Path entry is set in the MANIFEST.MF. So portable
applications should always use Class-Path entry to explicitly state
their dependencies.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is also possible to override the ear-subdeployments-isolated element
value at a per deployment level. See the section on
jboss-deployment-structure.xml below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Dependencies:</code> <strong>Manifest Entries</strong></p>
</div>
<div class="paragraph">
<p>Deployments (or more correctly modules within a deployment) may set up
dependencies on other modules by adding a <code>Dependencies:</code> manifest
entry. This entry consists of a comma separated list of module names
that the deployment requires. The available modules can be seen under
the <code>modules</code> directory in the application server distribution. For
example to add a dependency on javassist and apache velocity you can add
a manifest entry as follows:</p>
</div>
<div class="paragraph">
<p><code>Dependencies: org.javassist export,org.apache.velocity export services,org.antlr</code></p>
</div>
<div class="paragraph">
<p>Each dependency entry may also specify some of the following parameters
by adding them after the module name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>export</code> This means that the dependencies will be exported, so any
module that depends on this module will also get access to the
dependency.</p>
</li>
<li>
<p><code>services</code> By default items in META-INF of a dependency are not
accessible, this makes items from <code>META-INF/services</code> accessible so
<a href="http://download.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">services</a>in
the modules can be loaded.</p>
</li>
<li>
<p><code>optional</code> If this is specified the deployment will not fail if the
module is not available.</p>
</li>
<li>
<p><code>meta-inf</code> This will make the contents of the <code>META-INF</code> directory
available (unlike <code>services</code>, which just makes <code>META-INF/services</code>
available). In general this will not cause any deployment descriptors in
META-INF to be processed, with the exception of <code>beans.xml</code>. If a
<code>beans.xml</code> file is present this module will be scanned by Weld and any
resulting beans will be available to the application.</p>
</li>
<li>
<p><code>annotations</code> If a jandex index has be created for the module these
annotations will be merged into the deployments annotation index. The
<a href="https://github.com/jbossas/jandex">Jandex</a> index can be generated using
the
<a href="https://github.com/jbossas/jandex/blob/master/src/main/java/org/jboss/jandex/JandexAntTask.java">Jandex
ant task</a>, and must be named <code>META-INF/jandex.idx</code>. Note that it is not
necessary to break open the jar being indexed to add this to the modules
class path, a better approach is to create a jar containing just this
index, and adding it as an additional resource root in the <code>module.xml</code>
file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adding a dependency to all modules in an EAR</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using the <code>export</code> parameter it is possible to add a dependency to all
sub deployments in an ear. If a module is exported from a
<code>Dependencies:</code> entry in the top level of the ear (or by a jar in the
<code>ear/lib</code> directory) it will be available to all sub deployments as
well.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To generate a MANIFEST.MF entry when using maven put the following in
your pom.xml:
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>pom.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
   ...
   <span class="tag">&lt;plugins&gt;</span>
     <span class="tag">&lt;plugin&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;archive&gt;</span>
             <span class="tag">&lt;manifestEntries&gt;</span>
                <span class="tag">&lt;Dependencies&gt;</span>org.slf4j<span class="tag">&lt;/Dependencies&gt;</span>
             <span class="tag">&lt;/manifestEntries&gt;</span>
          <span class="tag">&lt;/archive&gt;</span>
       <span class="tag">&lt;/configuration&gt;</span>
     <span class="tag">&lt;/plugin&gt;</span>
   <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your deployment is a jar you must use the <code>maven-jar-plugin</code> rather
than the <code>maven-war-plugin</code>.</p>
</div>
<div class="sect3">
<h4 id="class-path-entries">1.5.1. Class Path Entries</h4>
<div class="paragraph">
<p>It is also possible to add module dependencies on other modules inside
the deployment using the <code>Class-Path</code> manifest entry. This can be used
within an ear to set up dependencies between sub deployments, and also
to allow modules access to additional jars deployed in an ear that are
not sub deployments and are not in the <code>EAR/lib</code> directory. If a jar in
the <code>EAR/lib</code> directory references a jar via <code>Class-Path:</code> then this
additional jar is merged into the parent ear&#8217;s module, and is accessible
to all sub deployments in the ear.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="global-modules">1.6. Global Modules</h3>
<div class="paragraph">
<p>It is also possible to set up global modules, that are accessible to all
deployments. This is done by modifying the configuration file
(standalone/domain.xml).</p>
</div>
<div class="paragraph">
<p>For example, to add javassist to all deployments you can use the
following XML:</p>
</div>
<div class="paragraph">
<p>standalone.xml/domain.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:ee:1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>            
  <span class="tag">&lt;global-modules&gt;</span>
    <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.javassist</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">slot</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>            
  <span class="tag">&lt;/global-modules&gt;</span> 
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>slot</code> field is optional and defaults to <code>main</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jboss-deployment-structure-file">1.7. JBoss Deployment Structure File</h3>
<div class="paragraph">
<p><code>jboss-deployment-structure.xml</code> is a JBoss specific deployment
descriptor that can be used to control class loading in a fine grained
manner. It should be placed in the top level deployment, in <code>META-INF</code>
(or <code>WEB-INF</code> for web deployments). It can do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prevent automatic dependencies from being added</p>
</li>
<li>
<p>Add additional dependencies</p>
</li>
<li>
<p>Define additional modules</p>
</li>
<li>
<p>Change an EAR deployments isolated class loading behaviour</p>
</li>
<li>
<p>Add additional resource roots to a module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a complete <code>jboss-deployment-structure.xml</code> file for an
ear deployment is as follows:</p>
</div>
<div class="paragraph">
<p>jboss-deployment-structure.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-deployment-structure&gt;</span>
  <span class="comment">&lt;!-- Make sub deployments isolated by default, so they cannot see each others classes without a Class-Path entry --&gt;</span>
  <span class="tag">&lt;ear-subdeployments-isolated&gt;</span>true<span class="tag">&lt;/ear-subdeployments-isolated&gt;</span>
  <span class="comment">&lt;!-- This corresponds to the top level deployment. For a war this is the war's module, for an ear --&gt;</span>
  <span class="comment">&lt;!-- This is the top level ear module, which contains all the classes in the EAR's lib folder     --&gt;</span>
  <span class="tag">&lt;deployment&gt;</span>
     <span class="comment">&lt;!-- exclude-subsystem prevents a subsystems deployment unit processors running on a deployment --&gt;</span>
     <span class="comment">&lt;!-- which gives basically the same effect as removing the subsystem, but it only affects single deployment --&gt;</span>
     <span class="tag">&lt;exclude-subsystems&gt;</span>
        <span class="tag">&lt;subsystem</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resteasy</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/exclude-subsystems&gt;</span>
    <span class="comment">&lt;!-- Exclusions allow you to prevent the server from automatically adding some dependencies     --&gt;</span>
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.javassist</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
    <span class="comment">&lt;!-- This allows you to define additional dependencies, it is the same as using the Dependencies: manifest attribute --&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
      <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.javassist.proxy</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.myjavassist</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="comment">&lt;!-- Import META-INF/services for ServiceLoader impls as well --&gt;</span>
      <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myservicemodule</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">services</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">import</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
    <span class="comment">&lt;!-- These add additional classes to the module. In this case it is the same as including the jar in the EAR's lib directory --&gt;</span>
    <span class="tag">&lt;resources&gt;</span>
      <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-library.jar</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/resources&gt;</span>
  <span class="tag">&lt;/deployment&gt;</span>
  <span class="tag">&lt;sub-deployment</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myapp.war</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- This corresponds to the module for a web deployment --&gt;</span>
    <span class="comment">&lt;!-- it can use all the same tags as the &lt;deployment&gt; entry above --&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
      <span class="comment">&lt;!-- Adds a dependency on a ejb jar. This could also be done with a Class-Path entry --&gt;</span>
      <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.myear.ear.myejbjar.jar</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
    <span class="comment">&lt;!-- Set's local resources to have the lowest priority --&gt;</span>
    <span class="comment">&lt;!-- If the same class is both in the sub deployment and in another sub deployment that --&gt;</span>
    <span class="comment">&lt;!-- is visible to the war, then the Class from the other deployment will be loaded,  --&gt;</span>
    <span class="comment">&lt;!-- rather than the class actually packaged in the war. --&gt;</span>
    <span class="comment">&lt;!-- This can be used to resolve ClassCastExceptions  if the same class is in multiple sub deployments--&gt;</span>
    <span class="tag">&lt;local-last</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;/sub-deployment&gt;</span>
  <span class="comment">&lt;!-- Now we are going to define two additional modules --&gt;</span>
  <span class="comment">&lt;!-- This one is a different version of javassist that we have packaged --&gt;</span>
  <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.myjavassist</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    <span class="tag">&lt;resources&gt;</span>
     <span class="tag">&lt;resource-root</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javassist.jar</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
       <span class="comment">&lt;!-- We want to use the servers version of javassist.util.proxy.* so we filter it out--&gt;</span>
       <span class="tag">&lt;filter&gt;</span>
         <span class="tag">&lt;exclude</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javassist/util/proxy</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
       <span class="tag">&lt;/filter&gt;</span>
     <span class="tag">&lt;/resource-root&gt;</span>
    <span class="tag">&lt;/resources&gt;</span>
  <span class="tag">&lt;/module&gt;</span>
  <span class="comment">&lt;!-- This is a module that re-exports the containers version of javassist.util.proxy --&gt;</span>
  <span class="comment">&lt;!-- This means that there is only one version of the Proxy classes defined          --&gt;</span>
  <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.javassist.proxy</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
      <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.javassist</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;imports&gt;</span>
          <span class="tag">&lt;include</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javassist/util/proxy</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
          <span class="tag">&lt;exclude</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/**</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/imports&gt;</span>
      <span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
  <span class="tag">&lt;/module&gt;</span>
<span class="tag">&lt;/jboss-deployment-structure&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The xsd for jboss-deployment-structure.xml is available at
<a href="https://github.com/wildfly/wildfly-core/blob/master/server/src/main/resources/schema/jboss-deployment-structure-1_2.xsd">https://github.com/wildfly/wildfly/blob/master/build/src/main/resources/docs/schema/jboss-deployment-structure-1_2.xsd</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="accessing-jdk-classes">1.8. Accessing JDK classes</h3>
<div class="paragraph">
<p>Not all JDK classes are exposed to a deployment by default. If your
deployment uses JDK classes that are not exposed you can get access to
them using jboss-deployment-structure.xml with system dependencies:</p>
</div>
<div class="paragraph">
<p>Using jboss-deployment-structure.xml to access JDK classes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-deployment-structure</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;deployment&gt;</span>
        <span class="tag">&lt;dependencies&gt;</span>
            <span class="tag">&lt;system</span> <span class="attribute-name">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;paths&gt;</span>
                    <span class="tag">&lt;path</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com/sun/corba/se/spi/legacy/connection</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/paths&gt;</span>
            <span class="tag">&lt;/system&gt;</span>
        <span class="tag">&lt;/dependencies&gt;</span>
    <span class="tag">&lt;/deployment&gt;</span>
<span class="tag">&lt;/jboss-deployment-structure&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-jboss.api-property-and-application-use-of-modules-shipped-with-wildfly">1.9. The "jboss.api" property and application use of modules shipped with</h3>
<div class="paragraph">
<p>WildFly</p>
</div>
<div class="paragraph">
<p>The WildFly distribution includes a large number of modules, a great
many of which are included for use by WildFly internals, with no testing
of the appropriateness of their direct use by applications or any
commitment to continue to ship those modules in future releases if they
are no longer needed by the internals. So how can a user know whether it
is advisable for their application to specify an explicit dependency on
a module WildFly ships? The "jboss.api" property specified in the
module&#8217;s module.xml file can tell you:</p>
</div>
<div class="paragraph">
<p>Example declaration of the jboss.api property</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;module</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:module:1.5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.google.guava</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.api</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">private</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a module does not have a property element like the above, then it&#8217;s
equivalent to one with a value of "public".</p>
</div>
<div class="paragraph">
<p>Following are the meanings of the various values you may see for the
jboss.api property:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May be explicitly depended upon by end user applications. Will
continue to be available in future releases within the same major series
and should not have incompatible API changes in future releases within
the same minor series, and ideally not within the same major series.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intended for internal use only. Only tested according to
internal usage. May not be safe for end user applications to use
directly.Could change significantly or be removed in a future release
without notice.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsupported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you see this value in a module.xml in a WildFly
release, please file a bug report, as it is not applicable in WildFly.
In EAP it has a meaning equivalent to "private" but that does not mean
the module is "private" in WildFly; it could very easily be "public".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May be explicitly depended upon by end user applications, but
there are no guarantees of continued availability in future releases or
that there will not be incompatible API changes. This is not a common
classification in WildFly. It is not used in WildFly 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May be explicitly depended upon by end user applications.
Stable and reliable but an alternative should be sought. Will be removed
in a future major release.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that these definitions are only applicable to WildFly. In EAP and
other Red Hat products based on WildFly the same classifiers are used,
with generally similar meaning, but the precise meaning is per the
definitions on the Red Hat customer support portal.</p>
</div>
<div class="paragraph">
<p>If an application declares a direct dependency on a module marked
"private", "unsupported" or "deprecated", during deployment a WARN
message will be logged. The logging will be in log categories
"org.jboss.as.dependency.private", "org.jboss.as.dependency.unsupported"
and "org.jboss.as.dependency.deprecated" respectively. These categories
are not used for other purposes, so once you feel sufficiently warned
the logging can be safely suppressed by turning the log level for the
relevant category to ERROR or higher.</p>
</div>
<div class="paragraph">
<p>Other than the WARN messages noted above, declaring a direct dependency
on a non-public module has no impact on how WildFly processes the
deployment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implicit_module_dependencies_for_deployments">2. Implicit module dependencies for deployments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained in the <a href="#src-557203">Class Loading in WildFly</a> article,
WildFly 11 is based on module classloading. A class within a module B
isn&#8217;t visible to a class within a module A, unless module B adds a
dependency on module A. Module dependencies can be explicitly (as
explained in that classloading article) or can be "implicit". This
article will explain what implicit module dependencies mean and how,
when and which modules are added as implicit dependencies.</p>
</div>
<div class="sect2">
<h3 id="whats-an-implicit-module-dependency">2.1. What&#8217;s an implicit module dependency?</h3>
<div class="paragraph">
<p>Consider an application deployment which contains EJBs. EJBs typically
need access to classes from the javax.ejb.* package and other Java EE
API packages. The jars containing these packages are already shipped in
WildFly and are available as "modules". The module which contains the
javax.ejb.* classes has a specific name and so does the module which
contains all the Java EE API classes. For an application to be able to
use these classes, it has to add a dependency on the relevant modules.
Forcing the application developers to add module dependencies like these
(i.e. dependencies which can be "inferred") isn&#8217;t a productive approach.
Hence, whenever an application is being deployed, the deployers within
the server, which are processing this deployment "implicitly" add these
module dependencies to the deployment so that these classes are visible
to the deployment at runtime. This way the application developer doesn&#8217;t
have to worry about adding them explicitly. How and when these implicit
dependencies are added is explained in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-and-when-is-an-implicit-module-dependency-added">2.2. How and when is an implicit module dependency added?</h3>
<div class="paragraph">
<p>When a deployment is being processed by the server, it goes through a
chain of "deployment processors". Each of these processors will have a
way to check if the deployment meets a certain criteria and if it does,
the deployment processor adds a implicit module dependency to that
deployment. Let&#8217;s take an example - Consider (again) an EJB3 deployment
which has the following class:</p>
</div>
<div class="paragraph">
<p>MySuperDuperBean.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySuperDuperBean</span> {
<span class="error"> </span>
...
<span class="error"> </span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, we have a simple @Stateless EJB. When the deployment
containing this class is being processed, the EJB deployment processor
will see that the deployment contains a class with the @Stateless
annotation and thus identifies this as a EJB deployment. <strong>This is just
one of the several ways, various deployment processors can identify a
deployment of some specific type.</strong> The EJB deployment processor will
then add an implicit dependency on the Java EE API module, so that all
the Java EE API classes are visible to the deployment.</p>
</div>
<div class="paragraph">
<p>Some subsystems will always add a API classes, even if the trigger
condition is not met. These are listed separately below.</p>
</div>
<div class="paragraph">
<p>In the next section, we&#8217;ll list down the implicit module dependencies
that are added to a deployment, by various deployers within WildFly.</p>
</div>
</div>
<div class="sect2">
<h3 id="which-are-the-implicit-module-dependencies">2.3. Which are the implicit module dependencies?</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subsystem responsible for adding the implicit dependency</th>
<th class="tableblock halign-left valign-top">Dependencies
that are always added</th>
<th class="tableblock halign-left valign-top">Dependencies that are added if a trigger
condition is met</th>
<th class="tableblock halign-left valign-top">Trigger which leads to the implicit module dependency
being added</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.api sun.jdk org.jboss.vfs</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch Subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.batch.api</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EE Subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javaee.api</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EJB3 subsystem</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javaee.api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The presence of ejb-jar.xml (in valid
locations in the deployment, as specified by spec) or the presence of
annotation based EJBs (ex: @Stateless, @Stateful, @MessageDriven etc)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAX-RS (Resteasy) subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.xml.bind.api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.resteasy.resteasy-atom-provider
org.jboss.resteasy.resteasy-cdi org.jboss.resteasy.resteasy-jaxrs
org.jboss.resteasy.resteasy-jaxb-provider
org.jboss.resteasy.resteasy-jackson-provider
org.jboss.resteasy.resteasy-jsapi
org.jboss.resteasy.resteasy-multipart-provider
org.jboss.resteasy.async-http-servlet-30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The presence of JAX-RS
annotations in the deployment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JCA subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.resource.api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.jms.api javax.validation.api
org.jboss.logging org.jboss.ironjacamar.api org.jboss.ironjacamar.impl
org.hibernate.validator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the deployment is a resource adaptor (RAR)
deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA (Hibernate) subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.persistence.api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javaee.api
org.jboss.as.jpa org.hibernate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The presence of an @PersistenceUnit or
@PersistenceContext annotation, or a &lt;persistence-unit-ref&gt; or
&lt;persistence-context-ref&gt; in a deployment descriptor..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging Subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.logging org.apache.commons.logging
org.apache.log4j org.slf4j org.jboss.logging.jul-to-slf4j-stub</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAR Subsystem</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.logging org.jboss.modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The deployment
is a SAR archive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security Subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.picketbox</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Subsystem</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javaee.api com.sun.jsf-impl org.hibernate.validator
org.jboss.as.web org.jboss.logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The deployment is a WAR archive. JSF
is only added if used. Multiple version options exist for mojarra.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Services Subsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.ws.api org.jboss.ws.spi</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Weld (CDI) Subsystem</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.persistence.api javaee.api org.javassist
org.jboss.interceptor org.jboss.as.weld org.jboss.logging
org.jboss.weld.core org.jboss.weld.api org.jboss.weld.spi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a
beans.xml file is detected in the deployment</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment_descriptors_used_in_wildfly">3. Deployment Descriptors used In WildFly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page gives a list and a description of all the valid deployment
descriptors that a WildFly deployment can use. This document is a work
in progress.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Descriptor</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Specification</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Info</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-deployment-structure.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF or WEB-INF of the top level
deployment</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This file can be used to control class loading for the
deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class Loading in WildFly</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">beans.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-INF or META-INF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The presence of this descriptor
(even if empty) activates CDI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Weld Reference Guide</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">web.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-INF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web deployment descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-web.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-INF</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JBoss Web deployment descriptor. This can be
use to override settings from web.xml, and to set WildFly specific
options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-INF of a war, or META-INF of an EJB jar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EJB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The EJB
spec deployment descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ejb-jar.xml schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-ejb3.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-INF of a war, or META-INF of an EJB jar</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The
JBoss EJB deployment descriptor, this can be used to override settings
from ejb-jar.xml, and to set WildFly specific settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of an EAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java EE Platform Specification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application.xml schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-app.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of an EAR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JBoss application deployment
descriptor, can be used to override settings application.xml, and to set
WildFly specific settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistence.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA descriptor used for defining
persistence units</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hibernate Reference Guide</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-ejb-client.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-INF of a war, or META-INF of an EJB jar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote EJB settings. This file is used to setup the EJB client context
for a deployment that is used for remote EJB invocations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EJB
invocations from a remote server instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jbosscmp-jdbc.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of an EJB jar</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CMP deployment
descriptor. Used to map CMP entity beans to a database. The format is
largely unchanged from previous versions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of a rar archive</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spec deployment descriptor for
resource adaptor deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IronJacamar Reference Guide Schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ironjacamar.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of a rar archive</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JBoss deployment
descriptor for resource adaptor deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IronJacamar Reference Guide</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*-jms.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF or WEB-INF</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS message destination deployment
descriptor, used to deploy message destinations with a deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*-ds.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF or WEB-INF</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datasource deployment descriptor, use
to bundle datasources with a deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataSource Configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application-client.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of an application client jar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java EE6
Platform Specification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The spec deployment descriptor for application
client deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application-client.xml schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-client.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF of an application client jar</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The WildFly
specific deployment descriptor for application client deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss-webservices.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">META-INF for EJB webservice deployments or
WEB-INF for POJO webservice deployments/EJB webservice endpoints bundled
in .war</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JBossWS 4.0.x specific deployment descriptor for
webservice endpoints</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_development_guidelines_and_recommended_practices">4. Development Guidelines and Recommended Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The purpose of this page is to document tips and techniques that will
assist developers in creating fast, secure, and reliable applications.
It is also a place to note what you should <strong>avoid</strong> doing when developing
applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_client_reference">5. Application Client Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a Java EE6 compliant server, WildFly 11 contains an application
client. An application client is essentially a cut down server instance,
that allow you to use EE features such as injection in a client side
program.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This article is not a tutorial on application client development, rather
it covers the specifics of the WildFly application client. There are
tutorials available elsewhere that cover application client basics, such
as
<a href="http://blogs.steeplesoft.com/2011/02/java-ees-buried-treasure-the-application-client-container/">this
one</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that the application client is different to the EJB client
libraries, it is perfectly possible to write client application that do
not use the application client, but instead use the jboss-ejb-client
library directly.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="getting-started">5.1. Getting Started</h3>
<div class="paragraph">
<p>To launch the application client use the <code>appclient.sh</code> or
<code>appclient.bat</code> script in the bin directory. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./appclient.sh --host=<span class="float">10.0</span><span class="float">.0</span><span class="float">.1</span> myear.ear<span class="error">#</span>appClient.jar arg1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--host</code> argument tells the appclient the server to connect to. The
next argument is the application client deployment to use, application
clients can only run a single deployment, and this deployment must also
be deployed on the full server instance that the client is connecting
too.</p>
</div>
<div class="paragraph">
<p>Any arguments after the deployment to use are passed directly through to
the application clients <code>main</code> function.</p>
</div>
</div>
<div class="sect2">
<h3 id="connecting-to-more-than-one-host">5.2. Connecting to more than one host</h3>
<div class="paragraph">
<p>If you want to connect to more than one host or make use of the
clustering functionality then you need to specify a
jboss-ejb-client.properties file rather than a host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./appclient.sh --ejb-client-properties=my-jboss-ejb-client.properties myear.ear<span class="error">#</span>appClient.jar arg1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example">5.3. Example</h3>
<div class="paragraph">
<p>A simple example how to package an application client and use it with
WildFly can be within the quickstart
<a href="https://github.com/wildfly/quickstart/tree/master/app-client">appclient</a>
which is located on Github .</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cdi_reference">6. CDI Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly uses <a href="http://weld.cdi-spec.org/">Weld</a>, the CDI reference
implementation as its CDI provider. To activate CDI for a deployment
simply add a <code>beans.xml</code> file in any archive in the deployment.</p>
</div>
<div class="paragraph">
<p>This document is not intended to be a CDI tutorial, it only covers CDI
usage that is specific to WildFly. For some general information on CDI
see the below links:</p>
</div>
<div class="paragraph">
<p><a href="http://docs.jboss.org/cdi/spec/1.2/cdi-spec.html">CDI Specification</a><br>
<a href="http://docs.jboss.org/weld/reference/latest/en-US/html/">Weld Reference
Guide</a><br>
<a href="https://github.com/wildfly/quickstart/">The WildFly Quickstarts</a></p>
</div>
<div class="sect2">
<h3 id="using-cdi-beans-from-outside-the-deployment">6.1. Using CDI Beans from outside the deployment</h3>
<div class="paragraph">
<p>For WildFly 11 onwards, it is now possible have classes outside the
deployment be picked up as CDI beans. In order for this to work you must
add a dependency on the external deployment that your beans are coming
from, and make sure the META-INF directory of this deployment is
imported, so that your deployment has visibility to the <code>beans.xml</code> file
(To import beans from outside the deployment they must be in an archive
with a <code>beans.xml</code> file).</p>
</div>
<div class="paragraph">
<p>There are two ways to do this, either using the <code>MANIFEST.MF</code> or using
<code>jboss-deployment-structure.xml</code>.</p>
</div>
<div class="paragraph">
<p>Using <code>MANIFEST.MF</code> you need to add a <code>Dependencies</code> entry, with
meta-inf specified after the entry, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Dependencies: com.my-cdi-module meta-inf, com.my-other-cdi-module meta-inf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>jboss-deployment-structure.xml</code> you need to add a dependency
entry with <code>meta-inf="import"</code>, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-deployment-structure</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;deployment&gt;</span>
        <span class="tag">&lt;dependencies&gt;</span>
            <span class="tag">&lt;module</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.d1.jar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">meta-inf</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">import</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/dependencies&gt;</span>
    <span class="tag">&lt;/deployment&gt;</span>
<span class="tag">&lt;/jboss-deployment-structure&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this can be used to create beans from both modules in the
<code>modules</code> directory, and from other deployments.</p>
</div>
<div class="paragraph">
<p>For more information on class loading and adding dependencies to your
deployment please see the <a href="Class_Loading_in_WildFly.html">Class
Loading Guide</a></p>
</div>
</div>
<div class="sect2">
<h3 id="suppressing-implicit-bean-archives">6.2. Suppressing implicit bean archives</h3>
<div class="paragraph">
<p>CDI 1.1 brings new options to packaging of CDI-enabled applications. In
addition to well-known explicit bean archives (basically any archive
containing the <strong>beans.xml</strong> file) the specification introduces <strong>implicit
bean archives</strong>.</p>
</div>
<div class="paragraph">
<p>An implicit bean archive is any archive that contains one or more
classes annotated with a bean defining annotation (scope annotation) or
one or more session beans. As a result, the beans.xml file is no longer
required for CDI to work in your application.</p>
</div>
<div class="paragraph">
<p>In an implicit bean archive <strong>only those classes</strong> that are either
annotated with bean defining annotations or are session beans are
recognized by CDI as beans (other classes cannot be injected).</p>
</div>
<div class="paragraph">
<p>This has a side-effect, though. Libraries exist that make use of scope
annotation (bean defining annotations) for their own convenience but are
not designed to run with CDI support. Guava would be an example of such
library. If your application bundles such library it will be recognized
as a CDI archive and may
<a href="https://code.google.com/p/guava-libraries/issues/detail?id=1433">fail the
deployment</a>.</p>
</div>
<div class="paragraph">
<p>Fortunately, WildFly makes it possible to suppress implicit bean
archives and only enable CDI in archives that bundle the beans.xml file.
There are two ways to achieve this:</p>
</div>
<div class="sect3">
<h4 id="per-deployment-configuration">6.2.1. Per-deployment configuration</h4>
<div class="paragraph">
<p>You can either set this up for your deployment only by adding the
following content to the <strong>META-INF/jboss-all.xml</strong> file of your
application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:1.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;weld xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:weld:1.0</span><span class="delimiter">&quot;</span></span> require-bean-descriptor=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/jboss&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="global-configuration">6.2.2. Global configuration</h4>
<div class="paragraph">
<p>Alternatively, you may configure this for all deployments in your
WildFly instance by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=weld:write-attribute(name=require-bean-descriptor,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="development-mode">6.3. Development mode</h3>
<div class="paragraph">
<p>WildFly 10 introduces a special mode for application development which
allows you to inspect and monitor your CDI deployments. This mode is
turned off by default and note that some features of the <strong>development
mode may have negative impact on the performance and/or functionality of
the application</strong>.</p>
</div>
<div class="sect3">
<h4 id="per-deployment-configuration-1">6.3.1. Per-deployment configuration</h4>
<div class="paragraph">
<p>You can enable it locally in your application <code>web.xml</code> by setting the
Servlet initialization parameter <code>org.jboss.weld.development</code> to <code>true:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> &lt;context-param&gt;
   &lt;param-name&gt;org.jboss.weld.development&lt;/param-name&gt;
   &lt;param-value&gt;<span class="predefined-constant">true</span>&lt;/param-value&gt;
 &lt;/context-param&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="global-configuration-1">6.3.2. Global configuration</h4>
<div class="paragraph">
<p>Alternatively, you can enable it globally in Weld subsystem by setting
<code>development-mode</code> attribute to <code>true:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=weld:write-attribute(name=development-mode,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details and example you can check
<a href="http://docs.jboss.org/weld/reference/latest/en-US/html_single/#devmode">Weld
development mode</a>.</p>
</div>
<div class="paragraph">
<p>Once the development mode is enabled you can check your applications CDI
information using Weld Probe -
<a href="http://docs.jboss.org/weld/reference/latest/en-US/html_single/#probe">Weld
Probe</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="non-portable-mode">6.4. Non-portable mode</h3>
<div class="paragraph">
<p>CDI 1.1 clarifies some aspects of how CDI protable extensions work. As a
result, some extensions that do not use the API properly (but were
tolerated in CDI 1.0 environment) may stop working with CDI 1.1.If this
is the case of your application you will see an exception like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>org.jboss.weld.exceptions.IllegalStateException: WELD-001332: BeanManager method getBeans() is not available during application initialization</pre>
</div>
</div>
<div class="paragraph">
<p>Fortunatelly, there is a non-portable mode available in WildFly which
skips some of the API usage checks and therefore allows the legacy
extensions to work as before.</p>
</div>
<div class="paragraph">
<p>Again, there are two ways to enable the non-portable mode:</p>
</div>
<div class="sect3">
<h4 id="per-deployment-configuration-2">6.4.1. Per-deployment configuration</h4>
<div class="paragraph">
<p>You can either set this up for your deployment only by adding the
following content to the <strong>META-INF/jboss-all.xml</strong> file of your
application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:1.0</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;weld xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:weld:1.0</span><span class="delimiter">&quot;</span></span> non-portable-mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;/jboss&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="global-configuration-2">6.4.2. Global configuration</h4>
<div class="paragraph">
<p>Alternatively, you may configure this for all deployments in your
WildFly instance by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=weld:write-attribute(name=non-portable-mode,value=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that new portable extensions should always use the</strong>
<strong><a href="http://docs.jboss.org/cdi/api/1.1/javax/enterprise/inject/spi/BeanManager.html">BeanManager
API</a></strong> <strong>properly and thus never required the non-portable mode. The
non-portable mode only exists to preserve compatibility with legacy
extensions!</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ee_concurrency_utilities">7. EE Concurrency Utilities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview">7.1. Overview</h3>
<div class="paragraph">
<p>EE Concurrency Utilities (JSR 236) is a technology introduced with Java
EE 7, which adapts well known Java SE concurrency utilities to the Java
EE application environment specifics. The Java EE application server is
responsible for the creation (and shutdown) of every instance of the EE
Concurrency Utilities, and provide these to the applications, ready to
use.</p>
</div>
<div class="paragraph">
<p>The EE Concurrency Utilities support the propagation of the invocation
context, capturing the existent context in the application threads to
use in their own threads, the same way a logged-in user principal is
propagated when a servlet invokes an EJB asynchronously. The propagation
of the invocation context includes, by default, the class loading, JNDI
and security contexts.</p>
</div>
<div class="paragraph">
<p>WildFly creates a single default instance of each EE Concurrency Utility
type in all configurations within the distribution, as mandated by the
specification, but additional instances, perhaps customised to better
serve a specific usage, may be created through WildFly&#8217;s EE Subsystem
Configuration. To learn how to configure EE Concurrency Utilities please
refer to <a href="EE_Concurrency_Utilities_Configuration.html">EE Concurrency
Utilities Configuration</a>. Additionally, the EE subsystem configuration
also includes the configuration of which instance should be considered
the default instance mandated by the Java EE specification, and such
configuration is covered by
<a href="Default_EE_Bindings_Configuration.html">Default EE Bindings
Configuration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="context-service">7.2. Context Service</h3>
<div class="paragraph">
<p>The Context Service ( <code>javax.enterprise.concurrent.ContextService</code>) is a
brand new concurrency utility, which applications may use to build
contextual proxies from existing objects.</p>
</div>
<div class="paragraph">
<p>A contextual proxy is an object that sets a invocation context, captured
when created, whenever is invoked, before delegating the invocation to
the original object.</p>
</div>
<div class="paragraph">
<p>Usage example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onGet(...) {
  <span class="predefined-type">Runnable</span> task = ...;
  <span class="predefined-type">Runnable</span> contextualTask = contextService.createContextualProxy(task, <span class="predefined-type">Runnable</span>.class);
  <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>WildFly default configurations creates a single default instance of a
Context Service, which may be retrieved through <code>@Resource</code> injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
<span class="directive">private</span> ContextService contextService;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To retrieve instead a non default Context Service instance,
<code>@Resource&#8217;s `lookup</code> attribute needs to specify the JNDI name used in
the wanted instance configuration. WildFly will always inject the
default instance, no matter what&#8217;s the <code>name</code> attribute value, if the
<code>lookup</code> attribute is not defined.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Applications may alternatively use instead the standard JNDI API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ContextService contextService = <span class="predefined-type">InitialContext</span>.doLookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultContextService</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As mandated by the Java EE specification, the default Context Service
instance&#8217;s JNDI name is <code>java:comp/DefaultContextService</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="managed-thread-factory">7.3. Managed Thread Factory</h3>
<div class="paragraph">
<p>The Managed Thread Factory (
<code>javax.enterprise.concurrent.ManagedThreadFactory</code>) allows Java EE
applications to create Java threads. It is an extension of Java SE&#8217;s
Thread Factory ( <code>java.util.concurrent.ThreadFactory</code>) adapted to the
Java EE platform specifics.</p>
</div>
<div class="paragraph">
<p>Managed Thread Factory instances are managed by the application server,
thus Java EE applications are forbidden to invoke any lifecycle related
method.</p>
</div>
<div class="paragraph">
<p>In case the Managed Thread Factory is configured to use a Context
Service, the application&#8217;s thread context is captured when a thread
creation is requested, and such context is propagated to the thread&#8217;s
Runnable execution.</p>
</div>
<div class="paragraph">
<p>Managed Thread Factory threads implement
<code>javax.enterprise.concurrent.ManageableThread</code>, which allows an
application to learn about termination status.</p>
</div>
<div class="paragraph">
<p>Usage example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onGet(...) {
  <span class="predefined-type">Runnable</span> task = ...;
  <span class="predefined-type">Thread</span> thread = managedThreadFactory.newThread(task);
  thread.start();
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>WildFly default configurations creates a single default instance of a
Managed Thread Factory, which may be retrieved through <code>@Resource</code>
injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
<span class="directive">private</span> ManagedThreadFactory managedThreadFactory;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To retrieve instead a non default Managed Thread Factory instance,
<code>@Resource&#8217;s `lookup</code> attribute needs to specify the JNDI name used in
the wanted instance configuration. WildFly will always inject the
default instance, no matter what&#8217;s the <code>name</code> attribute value, in case
the <code>lookup</code> attribute is not defined.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Applications may alternatively use instead the standard JNDI API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ManagedThreadFactory managedThreadFactory = <span class="predefined-type">InitialContext</span>.doLookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultManagedThreadFactory</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As mandated by the Java EE specification, the default Managed Thread
Factory instance&#8217;s JNDI name is <code>java:comp/DefaultManagedThreadFactory</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="managed-executor-service">7.4. Managed Executor Service</h3>
<div class="paragraph">
<p>The Managed Executor Service (
<code>javax.enterprise.concurrent.ManagedExecutorService</code>) allows Java EE
applications to submit tasks for asynchronous execution. It is an
extension of Java SE&#8217;s Executor Service (
<code>java.util.concurrent.ExecutorService</code>) adapted to the Java EE platform
requirements.</p>
</div>
<div class="paragraph">
<p>Managed Executor Service instances are managed by the application
server, thus Java EE applications are forbidden to invoke any lifecycle
related method.</p>
</div>
<div class="paragraph">
<p>In case the Managed Executor Service is configured to use a Context
Service, the application&#8217;s thread context is captured when the task is
submitted, and propagated to the executor thread responsible for the
task execution.</p>
</div>
<div class="paragraph">
<p>Usage example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onGet(...) {
    <span class="predefined-type">Runnable</span> task = ...;
    <span class="predefined-type">Future</span> future = managedExecutorService.submit(task);
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>WildFly default configurations creates a single default instance of a
Managed Executor Service, which may be retrieved through <code>@Resource</code>
injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
<span class="directive">private</span> ManagedExecutorService managedExecutorService;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To retrieve instead a non default Managed Executor Service instance,
<code>@Resource&#8217;s `lookup</code> attribute needs to specify the JNDI name used in
the wanted instance configuration. WildFly will always inject the
default instance, no matter what&#8217;s the <code>name</code> attribute value, in case
the <code>lookup</code> attribute is not defined.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Applications may alternatively use instead the standard JNDI API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ManagedExecutorService managedExecutorService = <span class="predefined-type">InitialContext</span>.doLookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultManagedExecutorService</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As mandated by the Java EE specification, the default Managed Executor
Service instance&#8217;s JNDI name is
<code>java:comp/DefaultManagedExecutorService</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="managed-scheduled-executor-service">7.5. Managed Scheduled Executor Service</h3>
<div class="paragraph">
<p>The Managed Scheduled Executor Service (
<code>javax.enterprise.concurrent.ManagedScheduledExecutorService</code>) allows
Java EE applications to schedule tasks for asynchronous execution. It is
an extension of Java SE&#8217;s Executor Service (
<code>java.util.concurrent.ScheduledExecutorService</code>) adapted to the Java EE
platform requirements.</p>
</div>
<div class="paragraph">
<p>Managed Scheduled Executor Service instances are managed by the
application server, thus Java EE applications are forbidden to invoke
any lifecycle related method.</p>
</div>
<div class="paragraph">
<p>In case the Managed Scheduled Executor Service is configured to use a
Context Service, the application&#8217;s thread context is captured when the
task is scheduled, and propagated to the executor thread responsible for
the task execution.</p>
</div>
<div class="paragraph">
<p>Usage example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onGet(...) {
    <span class="predefined-type">Runnable</span> task = ...;
    <span class="predefined-type">ScheduledFuture</span> future = managedScheduledExecutorService.schedule(task, <span class="integer">60</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>WildFly default configurations creates a single default instance of a
Managed Scheduled Executor Service, which may be retrieved through
<code>@Resource</code> injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
<span class="directive">private</span> ManagedScheduledExecutorService managedScheduledExecutorService;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To retrieve instead a non default Managed Scheduled Executor Service
instance, <code>@Resource&#8217;s `lookup</code> attribute needs to specify the JNDI
name used in the wanted instance configuration. WildFly will always
inject the default instance, no matter what&#8217;s the <code>name</code> attribute
value, in case the <code>lookup</code> attribute is not defined.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Applications may alternatively use instead the standard JNDI API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ManagedScheduledExecutorService managedScheduledExecutorService = <span class="predefined-type">InitialContext</span>.doLookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultManagedScheduledExecutorService</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As mandated by the Java EE specification, the default Managed Scheduled
Executor Service instance&#8217;s JNDI name is
<code>java:comp/DefaultManagedScheduledExecutorService</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb_3_reference_guide">8. EJB 3 Reference Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details the extensions that are available when developing
Enterprise Java Beans <sup>tm</sup> on WildFly 11.</p>
</div>
<div class="paragraph">
<p>Currently there is no support for configuring the extensions using an
implementation specific descriptor file.</p>
</div>
<div class="sect2">
<h3 id="resource-adapter-for-message-driven-beans">8.1. Resource Adapter for Message Driven Beans</h3>
<div class="paragraph">
<p>Each Message Driven Bean must be connected to a resource adapter.</p>
</div>
<div class="sect3">
<h4 id="specification-of-resource-adapter-using-metadata-annotations">8.1.1. Specification of Resource Adapter using Metadata Annotations</h4>
<div class="paragraph">
<p>The <code>ResourceAdapter</code> annotation is used to specify the resource adapter
with which the MDB should connect.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> of the annotation is the name of the deployment unit
containing the resource adapter. For example <code>jms-ra.rar</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(messageListenerInterface = PostmanPat.class)
<span class="annotation">@ResourceAdapter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb3-rar.rar</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run-as-principal">8.2. Run-as Principal</h3>
<div class="paragraph">
<p>Whenever a run-as role is specified for a given method invocation the
default anonymous principal is used as the caller principal. This
principal can be overridden by specifying a run-as principal.</p>
</div>
<div class="sect3">
<h4 id="specification-of-run-as-principal-using-metadata-annotations">8.2.1. Specification of Run-as Principal using Metadata Annotations</h4>
<div class="paragraph">
<p>The <code>RunAsPrincipal</code> annotation is used to specify the run-as principal
to use for a given method invocation.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> of the annotation specifies the name of the principal to
use. The actual type of the principal is undefined and should not be
relied upon.</p>
</div>
<div class="paragraph">
<p>Using this annotation without specifying a run-as role is considered an
error.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunAs</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RunAsPrincipal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyBean</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-domain">8.3. Security Domain</h3>
<div class="paragraph">
<p>Each Enterprise Java Bean <sup>tm</sup> can be associated with a security domain.
Only when an EJB is associated with a security domain will
authentication and authorization be enforced.</p>
</div>
<div class="sect3">
<h4 id="specification-of-security-domain-using-metadata-annotations">8.3.1. Specification of Security Domain using Metadata Annotations</h4>
<div class="paragraph">
<p>The <code>SecurityDomain</code> annotation is used to specify the security domain
to associate with the EJB.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> of the annotation is the name of the security domain to be
used.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SecurityDomain</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">other</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transaction-timeout">8.4. Transaction Timeout</h3>
<div class="paragraph">
<p>For any newly started transaction a transaction timeout can be specified
in seconds.</p>
</div>
<div class="paragraph">
<p>When a transaction timeout of <code>0</code> is used, then the actual transaction
timeout will default to the domain configured default.<br>
<em>TODO: add link to tx subsystem</em></p>
</div>
<div class="paragraph">
<p>Although this is only applicable when using transaction attribute
<code>REQUIRED</code> or <code>REQUIRES_NEW</code> the application server will not detect
invalid setups.</p>
</div>
<div class="paragraph">
<p>New Transactions</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Take care that even when transaction attribute <code>REQUIRED</code> is specified,
the timeout will only be applicable if a <strong>new</strong> transaction is started.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="specification-of-transaction-timeout-with-metadata-annotations">8.4.1. Specification of Transaction Timeout with Metadata Annotations</h4>
<div class="paragraph">
<p>The <code>TransactionTimeout</code> annotation is used to specify the transaction
timeout for a given method.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> of the annotation is the timeout used in the given <code>unit</code>
granularity. It must be a positive integer or 0. Whenever 0 is specified
the default domain configured timeout is used.</p>
</div>
<div class="paragraph">
<p>The <code>unit</code> specifies the granularity of the <code>value</code>. The actual value
used is converted to seconds. Specifying a granularity lower than
<code>SECONDS</code> is considered an error, even when the computed value will
result in an even amount of seconds.</p>
</div>
<div class="paragraph">
<p>For example:@TransactionTimeout(value = 10, unit = TimeUnit.SECONDS)</p>
</div>
</div>
<div class="sect3">
<h4 id="specification-of-transaction-timeout-in-the-deployment-descriptor">8.4.2. Specification of Transaction Timeout in the Deployment Descriptor</h4>
<div class="paragraph">
<p>The <code>trans-timeout</code> element is used to define the transaction timeout
for business, home, component, and message-listener interface methods;
no-interface view methods; web service endpoint methods; and timeout
callback methods.</p>
</div>
<div class="paragraph">
<p>The <code>trans-timeout</code> element resides in the <code>urn:trans-timeout</code> namespace
and is part of the standard <code>container-transaction</code> element as defined
in the jboss namespace.</p>
</div>
<div class="paragraph">
<p>For the rules when a <code>container-transaction</code> is applicable please refer
to EJB 3.1 FR 13.3.7.2.1.</p>
</div>
<div class="sect4">
<h5 id="example-of-trans-timeout">Example of trans-timeout</h5>
<div class="paragraph">
<p>jboss-ejb3.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss:ejb-jar</span> <span class="attribute-name">xmlns:jboss</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns:tx</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:trans-timeout</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd</span>
<span class="content">http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span>
<span class="content">urn:trans-timeout http://www.jboss.org/j2ee/schema/trans-timeout-1_0.xsd</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">impl-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;assembly-descriptor&gt;</span>
        <span class="tag">&lt;container-transaction&gt;</span>
            <span class="tag">&lt;method&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>BeanWithTimeoutValue<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;method-name&gt;</span>*<span class="tag">&lt;/method-name&gt;</span>
                <span class="tag">&lt;method-intf&gt;</span>Local<span class="tag">&lt;/method-intf&gt;</span>
            <span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;tx:trans-timeout&gt;</span>
                <span class="tag">&lt;tx:timeout&gt;</span>10<span class="tag">&lt;/tx:timeout&gt;</span>
                <span class="tag">&lt;tx:unit&gt;</span>Seconds<span class="tag">&lt;/tx:unit&gt;</span>
            <span class="tag">&lt;/tx:trans-timeout&gt;</span>
        <span class="tag">&lt;/container-transaction&gt;</span>
    <span class="tag">&lt;/assembly-descriptor&gt;</span>
<span class="tag">&lt;/jboss:ejb-jar&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="timer-service">8.5. Timer service</h3>
<div class="paragraph">
<p>The service is responsible to call the registered timeout methods of the
different session beans.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A persistent timer will be identified by the name of the EAR, the name
of the sub-deployment JAR and the Bean&#8217;s name.<br>
If one of those names are changed (e.g. EAR name contain a version) the
timer entry became orphaned and the timer event will not longer be
fired.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="single-event-timer">8.5.1. Single event timer</h4>
<div class="paragraph">
<p>The timer is will be started once at the specified time.</p>
</div>
<div class="paragraph">
<p>In case of a server restart the timeout method of a persistent timer
will only be called directly if the specified time is elapsed.<br>
If the timer is not persistent (since EJB3.1 see 18.2.3) it will be not
longer available if JBoss is restarted or the application is redeployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="recurring-timer">8.5.2. Recurring timer</h4>
<div class="paragraph">
<p>The timer will be started at the specified first occurrence and after
that point at each time if the interval is elapsed.<br>
If the timer will be started during the last execution is not finished
the execution will be suppressed with a warning to avoid concurrent
execution.</p>
</div>
<div class="paragraph">
<p>In case of server downtime for a persistent timer, the timeout method
will be called only once if one, or more than one, interval is
elapsed.<br>
If the timer is not persistent (since EJB3.1 see 18.2.3) it will not
longer be active after the server is restarted or the application is
redeployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="calendar-timer">8.5.3. Calendar timer</h4>
<div class="paragraph">
<p>The timer will be started if the schedule expression match. It will be
automatically deactivated and removed if there will be no next
expiration possible, i.e. If you set a specific year.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedule</span>( ... dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, month=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, year=<span class="string"><span class="delimiter">&quot;</span><span class="content">2012</span><span class="delimiter">&quot;</span></span>) +
<span class="comment">// start once at 01-01-2012 00:00:00</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="programmatic-calendar-timer">Programmatic calendar timer</h5>
<div class="paragraph">
<p>If the timer is persistent it will be fetched at server start and the
missed timeouts are called concurrent.<br>
If a persistent timer contains an end date it will be executed once
nevertheless how many times the execution was missed. Also a retry will
be suppressed if the timeout method throw an Exception.<br>
In case of such expired timer access to the given Timer object might
throw a NoMoreTimeoutExcption or NoSuchObjectException.</p>
</div>
<div class="paragraph">
<p>If the timer is non persistent it will not longer be active after the
server is restarted or the application is redeployed.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong>: clarify whether this should happen concurrently/blocked or even
fired only once like a recurring timer!</p>
</div>
</div>
<div class="sect4">
<h5 id="annotated-calendar-timer">Annotated calendar timer</h5>
<div class="paragraph">
<p>If the timer is non persistent it will not activated for missed events
during the server is down. In case of server start the timer is
scheduled based on the @Schedule annotation.</p>
</div>
<div class="paragraph">
<p>If the timer is persistent (default if not deactivated by annotation)
all missed events are fetched at server start and the annotated timeout
method is called concurrent.</p>
</div>
<div class="paragraph">
<p><strong>TODO</strong>: clarify whether this should happen concurrently/blocked or even
fired only once like a recurring timer!</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_container_interceptors">9. Container interceptors</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview">9.1. Overview</h3>
<div class="paragraph">
<p>JBoss AS versions prior to WildFly8 allowed a JBoss specific way to
plug-in user application specific interceptors on the server side so
that those interceptors get invoked during an EJB invocation. Such
interceptors differed from the typical (portable) spec provided Java EE
interceptors. The Java EE interceptors are expected to run after the
container has done necessary invocation processing which involves
security context propagation, transaction management and other such
duties. As a result, these Java EE interceptors come too late into the
picture, if the user applications have to intercept the call before
certain container specific interceptor(s) are run.</p>
</div>
</div>
<div class="sect2">
<h3 id="typical-ejb-invocation-call-path-on-the-server">9.2. Typical EJB invocation call path on the server</h3>
<div class="paragraph">
<p>A typical EJB invocation looks like this:</p>
</div>
<div class="paragraph">
<p>Client application</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MyBeanInterface bean = lookupBean();
<span class="error"> </span>
bean.doSomething();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The invocation on the bean.doSomething() triggers the following (only
relevant portion of the flow shown below):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>WildFly specific interceptor (a.k.a container interceptor) 1</p>
</li>
<li>
<p>WildFly specific interceptor (a.k.a container interceptor) 2</p>
</li>
<li>
<p>&#8230;&#8203;.</p>
</li>
<li>
<p>WildFly specific interceptor (a.k.a container interceptor) N</p>
</li>
<li>
<p>User application specific Java EE interceptor(s) (if any)</p>
</li>
<li>
<p>Invocation on the EJB instance&#8217;s method</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The WildFly specific interceptors include the security context
propagation, transaction management and other container provided
services. In some cases, the " `container interceptors`" (let&#8217;s call
them that) might even decide break the invocation flow and not let the
invocation proceed (for example: due to the invoking caller not being
among the allowed user roles who can invoke the method on the bean).</p>
</div>
<div class="paragraph">
<p>Previous versions of JBoss AS allowed a way to plug-in the user
application specific interceptors (which relied on JBoss AS specific
libraries) into this invocation flow so that they do run some
application specific logic before the control reaches step#5 above. For
example, AS5 allowed the use of JBoss AOP interceptors to do this.</p>
</div>
<div class="paragraph">
<p>As of WildFly 8, this feature was implemented.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-container-interceptors">9.3. Configuring container interceptors</h3>
<div class="paragraph">
<p>As you can see from the JIRA <a href="https://issues.jboss.org/browse/AS7-5897" class="bare">https://issues.jboss.org/browse/AS7-5897</a>,
one of the goals of this feature implementation was to make sure that we
don&#8217;t introduce any new WildFly specific library dependencies for the
container interceptors. So we decided to allow the Java EE interceptors
(which are just POJO classes with lifecycle callback annotations) to be
used as container interceptors. As such you won&#8217;t need any dependency on
any WildFly specific libraries. That will allow us to support this
feature for a longer time in future versions of WildFly.</p>
</div>
<div class="paragraph">
<p>Furthermore, configuring these container interceptors is similar to
configuring the Java EE interceptors for EJBs. In fact, it uses the same
xsd elements that are allowed in ejb-jar.xml for 3.1 version of ejb-jar
deployment descriptor.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Container interceptors can only be configured via deployment
descriptors. There&#8217;s no annotation based way to configure container
interceptors. This was an intentional decision, taken to avoid
introducing any WildFly specific library dependency for the annotation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuring the container interceptors can be done in jboss-ejb3.xml
file, which then gets placed under the META-INF folder of the EJB
deployment, just like the ejb-jar.xml. Here&#8217;s an example of how the
container interceptor(s) can be configured in jboss-ejb3.xml:</p>
</div>
<div class="paragraph">
<p>jboss-ejb3.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:jee</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:ci</span> =<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:container-interceptors:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 
    <span class="tag">&lt;jee:assembly-descriptor&gt;</span>
        <span class="tag">&lt;ci:container-interceptors&gt;</span>
            <span class="comment">&lt;!-- Default interceptor --&gt;</span>
            <span class="tag">&lt;jee:interceptor-binding&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>*<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ContainerInterceptorOne<span class="tag">&lt;/interceptor-class&gt;</span>
            <span class="tag">&lt;/jee:interceptor-binding&gt;</span>
            <span class="comment">&lt;!-- Class level container-interceptor --&gt;</span>
            <span class="tag">&lt;jee:interceptor-binding&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>AnotherFlowTrackingBean<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ClassLevelContainerInterceptor<span class="tag">&lt;/interceptor-class&gt;</span>
            <span class="tag">&lt;/jee:interceptor-binding&gt;</span>
            <span class="comment">&lt;!-- Method specific container-interceptor --&gt;</span>
            <span class="tag">&lt;jee:interceptor-binding&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>AnotherFlowTrackingBean<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.MethodSpecificContainerInterceptor<span class="tag">&lt;/interceptor-class&gt;</span>
                <span class="tag">&lt;method&gt;</span>
                    <span class="tag">&lt;method-name&gt;</span>echoWithMethodSpecificContainerInterceptor<span class="tag">&lt;/method-name&gt;</span>
                <span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;/jee:interceptor-binding&gt;</span>
            <span class="comment">&lt;!-- container interceptors in a specific order --&gt;</span>
            <span class="tag">&lt;jee:interceptor-binding&gt;</span>
                <span class="tag">&lt;ejb-name&gt;</span>AnotherFlowTrackingBean<span class="tag">&lt;/ejb-name&gt;</span>
                <span class="tag">&lt;interceptor-order&gt;</span>
                    <span class="tag">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ClassLevelContainerInterceptor<span class="tag">&lt;/interceptor-class&gt;</span>
                    <span class="tag">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.MethodSpecificContainerInterceptor<span class="tag">&lt;/interceptor-class&gt;</span>
                    <span class="tag">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ContainerInterceptorOne<span class="tag">&lt;/interceptor-class&gt;</span>
                <span class="tag">&lt;/interceptor-order&gt;</span>
                <span class="tag">&lt;method&gt;</span>
                    <span class="tag">&lt;method-name&gt;</span>echoInSpecificOrderOfContainerInterceptors<span class="tag">&lt;/method-name&gt;</span>
                <span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;/jee:interceptor-binding&gt;</span>
        <span class="tag">&lt;/ci:container-interceptors&gt;</span>
    <span class="tag">&lt;/jee:assembly-descriptor&gt;</span>
<span class="tag">&lt;/jboss&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The usage of urn:container-interceptors:1.0 namespace which allows the
container-interceptors elements to be configured</p>
</li>
<li>
<p>The container-interceptors element which contain the interceptor
bindings</p>
</li>
<li>
<p>The interceptor bindings themselves are the same elements as what the
EJB3.1 xsd allows for standard Java EE interceptors</p>
</li>
<li>
<p>The interceptors can be bound either to all EJBs in the deployment
(using the the * wildcard) or individual bean level (using the specific
EJB name) or at specific method level for the EJBs.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The xsd for the urn:container-interceptors:1.0 namespace is available
here
<a href="https://github.com/jbossas/jboss-as/blob/master/ejb3/src/main/resources/jboss-ejb-container-interceptors_1_0.xsd" class="bare">https://github.com/jbossas/jboss-as/blob/master/ejb3/src/main/resources/jboss-ejb-container-interceptors_1_0.xsd</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The interceptor classes themselves are simple POJOs and use the
<code>@javax.annotation.AroundInvoke</code> to mark the around invoke method which
will get invoked during the invocation on the bean. Here&#8217;s an example of
the interceptor:</p>
</div>
<div class="paragraph">
<p>Example of container interceptor</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ClassLevelContainerInterceptor</span> {
    <span class="annotation">@AroundInvoke</span>
    <span class="directive">private</span> <span class="predefined-type">Object</span> iAmAround(<span class="directive">final</span> InvocationContext invocationContext) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="local-variable">this</span>.getClass().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + invocationContext.proceed();
    }
<span class="error"> </span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="container-interceptor-positioning-in-the-interceptor-chain">9.4. Container interceptor positioning in the interceptor chain</h3>
<div class="paragraph">
<p>The container interceptors configured for a EJB are guaranteed to be run
before the WildFly provided security interceptors, transaction
management interceptors and other such interceptors thus allowing the
user application specific container interceptors to setup any relevant
context data before the invocation proceeds.</p>
</div>
</div>
<div class="sect2">
<h3 id="semantic-difference-between-container-interceptors-and-java-ee-interceptors-api">9.5. Semantic difference between container interceptor(s) and Java EE</h3>
<div class="paragraph">
<p>interceptor(s) API</p>
</div>
<div class="paragraph">
<p>Although the container interceptors are modeled to be similar to the
Java EE interceptors, there are some differences in the API semantics.
One such difference is that invoking on
javax.interceptor.InvocationContext.getTarget() method is illegal for
container interceptors since these interceptors are invoked way before
the EJB components are setup or instantiated.</p>
</div>
</div>
<div class="sect2">
<h3 id="testcase">9.6. Testcase</h3>
<div class="paragraph">
<p>This testcase in the WildFly codebase can be used for reference for
implementing container interceptors in user applications
<a href="https://github.com/wildfly/wildfly/blob/master/testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/ejb/container/interceptor/ContainerInterceptorsTestCase.java" class="bare">https://github.com/wildfly/wildfly/blob/master/testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/ejb/container/interceptor/ContainerInterceptorsTestCase.java</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb3_clustered_database_timers">10. EJB3 Clustered Database Timers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview">10.1. Overview</h3>
<div class="paragraph">
<p>Wildfly now supports clustered database backed timers. The clustering
support is provided through the database, and as a result it is not
intended to be a super high performance solution that supports thousands
of timers going off a second, however properly tuned it should provide
sufficient performance for most use cases.</p>
</div>
<div class="paragraph">
<p>Note that database timers can also be used in non-clustered mode.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that for this to work correctly the underlying database must
support the READ_COMMITTED or SERIALIZABLE isolation mode and the
datasource must be configured accordingly
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="setup">10.2. Setup</h3>
<div class="paragraph">
<p>In order to use clustered timers it is necessary to add a database
backed timer store. This can be done from the CLI with the following
command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=ejb3/service=timer-service/database-data-store=my-clustered-store:add(allow-execution=<span class="predefined-constant">true</span>, datasource-jndi-name=<span class="string"><span class="delimiter">'</span><span class="content">java:/MyDatasource</span><span class="delimiter">'</span></span>, refresh-interval=<span class="integer">60000</span>, database=<span class="string"><span class="delimiter">'</span><span class="content">postgresql</span><span class="delimiter">'</span></span>, partition=<span class="string"><span class="delimiter">'</span><span class="content">mypartition</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An explanation of the parameters is below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>allow-execution</strong> - If this node is allowed to execute timers. If this
is false then timers added on this node will be added to the database
for another node to execute. This allows you to limit timer execution to
a few nodes in a cluster, which can greatly reduce database load for
large clusters.</p>
</li>
<li>
<p><strong>datasource-jndi-name</strong> - The datasource to use</p>
</li>
<li>
<p><strong>refresh-interval</strong> - The refresh interval in milliseconds. This is the
period of time that must elapse before this node will check the database
for new timers added by other nodes. A smaller value means that timers
will be picked up more quickly, however it will result in more load on
the database. This is most important to tune if you are adding timers
that will expire quickly. If the node that added the timer cannot
execute it (e.g. because it has failed or because allow-execution is
false), this timer may not be executed until a node has refreshed.</p>
</li>
<li>
<p><strong>database</strong> - Define the type of database that is in use. Some SQL
statements are customised by database, and this tells the data store
which version of the SQL to use.<br>
Without this attribute the server try to detected the type
automatically, current supported types are <em>postgresql, mysql, oracle,
db2, hsql</em> and <em>h2</em>.<br>
Note that this SQL resides in the file
<em>modules/system/layers/base/org/jboss/as/ejb3/main/timers/timer-sql.properties</em><br>
And as such is it possible to modify the SQL that is executed or add
support for new databases by adding new DB specific SQL to this file (if
you do add support for a new database it would be greatly appreciated if
you could contribute the SQL back to the project).</p>
</li>
<li>
<p><strong>partition</strong> - A node will only see timers from other nodes that have
the same partition name. This allows you to break a large cluster up
into several smaller clusters, which should improve performance. e.g.
instead of having a cluster of 100 nodes, where all hundred are trying
to execute and refresh the same timers, you can create 20 clusters of 5
nodes by giving ever group of 5 a different partition name.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="non-clustered-timers">10.2.1. Non clustered timers</h4>
<div class="paragraph">
<p>Note that you can still use the database data store for non-clustered
timers, in which case set the refresh interval to zero and make sure
that every node has a unique partition name (or uses a different
database).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-clustered-timers-in-a-deployment">10.3. Using clustered timers in a deployment</h3>
<div class="paragraph">
<p>It is possible to use the data store as default for all applications by
changing the default-data-store within the ejb3 subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    &lt;timer-service thread-pool-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">timer</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-data-store=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered-store</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;data-stores&gt;
            &lt;database-data-store name=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered-store</span><span class="delimiter">&quot;</span></span> datasource-jndi-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/ExampleDS</span><span class="delimiter">&quot;</span></span> partition=<span class="string"><span class="delimiter">&quot;</span><span class="content">timer</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/data-stores&gt;
    &lt;/timer-service&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another option is to use a separate data store for specific
applications, all that is required is to set the timer data store name
in jboss-ejb3.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;jboss:ejb-jar xmlns:jboss=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
               xmlns:timer=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:timer-service:1.0</span><span class="delimiter">&quot;</span></span>
               xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                     http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>
               version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
               impl-version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;assembly-descriptor&gt;
            &lt;timer:timer&gt;
                &lt;ejb-name&gt;*&lt;/ejb-name&gt;
                &lt;timer:persistence-store-name&gt;my-clustered-store&lt;/timer:persistence-store-name&gt;
            &lt;/timer:timer&gt;
        &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="technical-details">10.4. Technical details</h3>
<div class="paragraph">
<p>Internally every node that is allowed to execute timers schedules a
timeout for every timer is knows about. When this timeout expires then
this node attempts to 'lock' the timer, by updating its state to
running. The query this executes looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UPDATE JBOSS_EJB_TIMER SET TIMER_STATE=? WHERE ID=? AND TIMER_STATE&lt;&gt;? AND NEXT_DATE=?;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Due to the use of a transaction and READ_COMMITTED or SERIALIZABLE
isolation mode only one node will succeed in updating the row, and this
is the node that the timer will run on.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb3_subsystem_configuration_guide">11. EJB3 subsystem configuration guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page lists the options that are available for configuring the EJB
subsystem.</p>
</div>
<div class="paragraph">
<p>A complete example of the config is shown below, with a full explanation
of each</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:ejb3:1.2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;session-bean&gt;</span>
    <span class="tag">&lt;stateless&gt;</span>
      <span class="tag">&lt;bean-instance-pool-ref</span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">slsb-strict-max-pool</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/stateless&gt;</span>
    <span class="tag">&lt;stateful</span> <span class="attribute-name">default-access-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">clustered-cache-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;singleton</span> <span class="attribute-name">default-access-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/session-bean&gt;</span>
  <span class="tag">&lt;mdb&gt;</span>
    <span class="tag">&lt;resource-adapter-ref</span> <span class="attribute-name">resource-adapter-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hornetq-ra</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;bean-instance-pool-ref</span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mdb-strict-max-pool</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/mdb&gt;</span>
  <span class="tag">&lt;entity-bean&gt;</span>
    <span class="tag">&lt;bean-instance-pool-ref</span> <span class="attribute-name">pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-strict-max-pool</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/entity-bean&gt;</span>
  <span class="tag">&lt;pools&gt;</span>
    <span class="tag">&lt;bean-instance-pools&gt;</span>
      <span class="tag">&lt;strict-max-pool</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">slsb-strict-max-pool</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">instance-acquisition-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">instance-acquisition-timeout-unit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MINUTES</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;strict-max-pool</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mdb-strict-max-pool</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">instance-acquisition-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">instance-acquisition-timeout-unit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MINUTES</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;strict-max-pool</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity-strict-max-pool</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">instance-acquisition-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">instance-acquisition-timeout-unit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MINUTES</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean-instance-pools&gt;</span>
  <span class="tag">&lt;/pools&gt;</span>
  <span class="tag">&lt;caches&gt;</span>
    <span class="tag">&lt;cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">aliases</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NoPassivationCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">passivating</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">passivation-store-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">aliases</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleStatefulCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clustered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">passivation-store-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">aliases</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">StatefulTreeCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/caches&gt;</span>
  <span class="tag">&lt;passivation-stores&gt;</span>
    <span class="tag">&lt;file-passivation-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;cluster-passivation-store</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/passivation-stores&gt;</span>
  <span class="tag">&lt;async</span> <span class="attribute-name">thread-pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;timer-service</span> <span class="attribute-name">thread-pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data-store</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timer-service-data</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relative-to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.data.dir</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/timer-service&gt;</span>
  <span class="tag">&lt;remote</span> <span class="attribute-name">connector-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">remoting-connector</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">thread-pool-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;thread-pools&gt;</span>
    <span class="tag">&lt;thread-pool</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;max-threads</span> <span class="attribute-name">count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;keepalive-time</span> <span class="attribute-name">time</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">unit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">milliseconds</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/thread-pool&gt;</span>
  <span class="tag">&lt;/thread-pools&gt;</span>
  <span class="tag">&lt;iiop</span> <span class="attribute-name">enable-by-default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use-qualified-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;in-vm-remote-interface-invocation</span> <span class="attribute-name">pass-by-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- Warning see notes below about possible issues --&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="session-bean">11.1. &lt;session-bean&gt;</h3>
<div class="sect3">
<h4 id="stateless">11.1.1. &lt;stateless&gt;</h4>
<div class="paragraph">
<p>This element is used to configure the instance pool that is used by
default for stateless session beans. If it is not present stateless
session beans are not pooled, but are instead created on demand for
every invocation. The instance pool can be overridden on a per
deployment or per bean level using <code>jboss-ejb3.xml</code> or the
<code>org.jboss.ejb3.annotation.Pool</code> annotation. The instance pools
themselves are configured in the <code>&lt;pools&gt;</code> element.</p>
</div>
</div>
<div class="sect3">
<h4 id="stateful">11.1.2. &lt;stateful&gt;</h4>
<div class="paragraph">
<p>This element is used to configure Stateful Session Beans.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default-access-timeout</code> This attribute specifies the default time
concurrent invocations on the same bean instance will wait to acquire
the instance lock. It can be overridden via the deployment descriptor or
via the <code>javax.ejb.AccessTimeout</code> annotation.</p>
</li>
<li>
<p><code>cache-ref</code> This attribute is used to set the default cache for
non-clustered beans. It can be overridden by <code>jboss-ejb3.xml</code>, or via
the <code>org.jboss.ejb3.annotation.Cache</code> annotation.</p>
</li>
<li>
<p><code>clustered-cache-ref</code> This attribute is used to set the default cache
for clustered beans.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="singleton">11.1.3. &lt;singleton&gt;</h4>
<div class="paragraph">
<p>This element is used to configure Singleton Session Beans.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default-access-timeout</code> This attribute specifies the default time
concurrent invocations will wait to acquire the instance lock. It can be
overridden via the deployment descriptor or via the
<code>javax.ejb.AccessTimeout</code> annotation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mdb">11.2. &lt;mdb&gt;</h3>
<div class="sect3">
<h4 id="resource-adaptor-ref">11.2.1. &lt;resource-adaptor-ref&gt;</h4>
<div class="paragraph">
<p>This element sets the default resource adaptor for Message Driven Beans.</p>
</div>
</div>
<div class="sect3">
<h4 id="bean-instance-pool-ref">11.2.2. &lt;bean-instance-pool-ref&gt;</h4>
<div class="paragraph">
<p>This element is used to configure the instance pool that is used by
default for Message Driven Beans. If it is not present they are not
pooled, but are instead created on demand for every invocation. The
instance pool can be overridden on a per deployment or per bean level
using <code>jboss-ejb3.xml</code> or the <code>org.jboss.ejb3.annotation.Pool</code>
annotation. The instance pools themselves are configured in the
<code>&lt;pools&gt;</code> element.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity-bean">11.3. &lt;entity-bean&gt;</h3>
<div class="paragraph">
<p>This element is used to configure the behavior for EJB2 EntityBeans.</p>
</div>
<div class="sect3">
<h4 id="bean-instance-pool-ref-1">11.3.1. &lt;bean-instance-pool-ref&gt;</h4>
<div class="paragraph">
<p>This element is used to configure the instance pool that is used by
default for Entity Beans. If it is not present they are not pooled, but
are instead created on demand for every invocation. The instance pool
can be overridden on a per deployment or per bean level using
<code>jboss-ejb3.xml</code> or the <code>org.jboss.ejb3.annotation.Pool</code> annotation. The
instance pools themselves are configured in the <code>&lt;pools&gt;</code> element.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pools">11.4. &lt;pools&gt;</h3>

</div>
<div class="sect2">
<h3 id="caches">11.5. &lt;caches&gt;</h3>

</div>
<div class="sect2">
<h3 id="passivation-stores">11.6. &lt;passivation-stores&gt;</h3>

</div>
<div class="sect2">
<h3 id="async">11.7. &lt;async&gt;</h3>
<div class="paragraph">
<p>This element enables async EJB invocations. It is also used to specify
the thread pool that these invocations will use.</p>
</div>
</div>
<div class="sect2">
<h3 id="timer-service">11.8. &lt;timer-service&gt;</h3>
<div class="paragraph">
<p>This element enables the EJB timer service. It is also used to specify
the thread pool that these invocations will use.</p>
</div>
<div class="sect3">
<h4 id="data-store">11.8.1. &lt;data-store&gt;</h4>
<div class="paragraph">
<p>This is used to configure the directory that persistent timer
information is saved to.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remote">11.9. &lt;remote&gt;</h3>
<div class="paragraph">
<p>This is used to enable remote EJB invocations. It specifies the remoting
connector to use (as defined in the remoting subsystem configuration),
and the thread pool to use for remote invocations.</p>
</div>
</div>
<div class="sect2">
<h3 id="thread-pools">11.10. &lt;thread-pools&gt;</h3>
<div class="paragraph">
<p>This is used to configure the thread pools used by async, timer and
remote invocations.</p>
</div>
</div>
<div class="sect2">
<h3 id="iiop">11.11. &lt;iiop&gt;</h3>
<div class="paragraph">
<p>This is used to enable IIOP (i.e. CORBA) invocation of EJB&#8217;s. If this
element is present then the JacORB subsystem must also be installed. It
supports the following two attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enable-by-default</code> If this is true then all EJB&#8217;s with EJB2.x home
interfaces are exposed via IIOP, otherwise they must be explicitly
enabled via <code>jboss-ejb3.xml</code>.</p>
</li>
<li>
<p><code>use-qualified-name</code> If this is true then EJB&#8217;s are bound to the corba
naming context with a binding name that contains the application and
modules name of the deployment (e.g. myear/myejbjar/MyBean), if this is
false the default binding name is simply the bean name.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="in-vm-remote-interface-invocation">11.12. &lt;in-vm-remote-interface-invocation&gt;</h3>
<div class="paragraph">
<p>By default remote interface invocations use pass by value, as required
by the EJB spec. This element can use used to enable pass by reference,
which can give you a performance boost. Note WildFly will do a shallow
check to see if the caller and the EJB have access to the same class
definitions, which means if you are passing something such as a
List&lt;MyObject&gt;, WildFly only checks the List to see if it is the same
class definition on the call &amp; EJB side. If the top level class
definition is the same, JBoss will make the call using pass by
reference, which means that if MyObject or any objects beneath it are
loaded from different classloaders, you would get a ClassCastException.
If the top level class definitions are loaded from different
classloaders, JBoss will use pass by value. JBoss cannot do a deep check
of all of the classes to ensure no ClassCastExceptions will occur
because doing a deep check would eliminate any performance boost you
would have received by using call by reference. It is recommended that
you configure pass by reference only on callers that you are sure will
use the same class definitions and not globally. This can be done via a
configuration in the jboss-ejb-client.xml as shown below.</p>
</div>
<div class="paragraph">
<p>To configure a caller/client use pass by reference, you configure your
top level deployment with a META-INF/jboss-ejb-client.xml containing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss-ejb-client</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:ejb-client:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;client-context&gt;</span>
        <span class="tag">&lt;ejb-receivers</span> <span class="attribute-name">local-receiver-pass-by-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/client-context&gt;</span>
<span class="tag">&lt;/jboss-ejb-client&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb_iiop_guide">12. EJB IIOP Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enabling-iiop">12.1. Enabling IIOP</h3>
<div class="paragraph">
<p>To enable IIOP you must have the JacORB subsystem installed, and the
<code>&lt;iiop/&gt;</code> element present in the ejb3 subsystem configuration. The
<code>standalone-full.xml</code> configuration that comes with the distribution has
both of these enabled.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;iiop/&gt;</code> element takes two attributes that control the default
behaviour of the server, for full details see <a href="#src-557221">EJB3
subsystem configuration guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="enabling-jts">12.2. Enabling JTS</h3>
<div class="paragraph">
<p>To enable JTS simply add a <code>&lt;jts/&gt;</code> element to the transactions
subsystem configuration.</p>
</div>
<div class="paragraph">
<p>It is also necessary to enable the JacORB transactions interceptor as
shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:jacorb:1.1</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;orb&gt;
    &lt;initializers transactions=<span class="string"><span class="delimiter">&quot;</span><span class="content">on</span><span class="delimiter">&quot;</span></span>/&gt;
  &lt;/orb&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-stubs">12.3. Dynamic Stub&#8217;s</h3>
<div class="paragraph">
<p>Downloading stubs directly from the server is no longer supported. If
you do not wish to pre-generate your stub classes JDK Dynamic stubs can
be used instead. The enable JDK dynamic stubs simply set the
<code>com.sun.CORBA.ORBUseDynamicStub</code> system property to <code>true</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-ejb-iiop-settings-via-jboss-ejb3.xml">12.4. Configuring EJB IIOP settings via jboss-ejb3.xml</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb_over_http">13. EJB over HTTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beginning with Wildfly 11 it is now possible to use HTTP as the
transport (instead of remoting) for remote EJB and JNDI invocations.</p>
</div>
<div class="paragraph">
<p>Everything mentioned below is applicable for both JNDI and EJB
functionality.</p>
</div>
<div class="sect2">
<h3 id="server-configuration">13.1. Server Configuration</h3>
<div class="paragraph">
<p>In order to configure the server the http-invoker needs to be enabled on
each virtual host you wish to use in the Undertow subsystem. This is
enabled by default in standard configs, but if it has been removed it
can be added via:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/subsystem=undertow/server=default-server/host=default-host/setting=http-invoker:add(http-authentication-factory=myfactory, path='/wildfly-services')</pre>
</div>
</div>
<div class="paragraph">
<p>The Hhttp-invoker takes two parameters, a path (which defaults to
/wildfly-services) and a http-authentication-factory which must be a
reference to an Elytron http-authentication-factory.</p>
</div>
<div class="paragraph">
<p>Note that any deployment that wishes to use this must use Elytron
security with the same security domain that corresponds to the HTTP
authentication factory.</p>
</div>
</div>
<div class="sect2">
<h3 id="performing-invocations">13.2. Performing Invocations</h3>
<div class="paragraph">
<p>The mechanism for performing invocations is exactly the same as for the
remoting based EJB client, the only difference is that instead of a
'remote+http' URI you use a 'http' URI (which must include the path that
was configured in the invoker). For example if you are currently using
'remote+ <a href="http://localhost:8080'" class="bare">http://localhost:8080'</a> as the target URI, you would change this
to 'http://localhost:8080/wildfly-services'.</p>
</div>
</div>
<div class="sect2">
<h3 id="implementation-details">13.3. Implementation details</h3>
<div class="paragraph">
<p>The wire protocol is detailed at
<a href="https://github.com/wildfly/wildfly-http-client/blob/master/docs/src/main/asciidoc/wire-spec-v1.asciidoc" class="bare">https://github.com/wildfly/wildfly-http-client/blob/master/docs/src/main/asciidoc/wire-spec-v1.asciidoc</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jboss_ejb3_xml_reference">14. jboss-ejb3.xml Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>jboss-ejb3.xml</code> is a custom deployment descriptor that can be placed in
either ejb-jar or war archives. If it is placed in an ejb-jar then it
must be placed in the <code>META-INF</code> folder, in a web archive it must be
placed in the <code>WEB-INF</code> folder.</p>
</div>
<div class="paragraph">
<p>The contents of <code>jboss-ejb3.xml</code> are merged with the contents of
<code>ejb-jar.xml</code>, with the <code>jboss-ejb3.xml</code> items taking precedence.</p>
</div>
<div class="sect2">
<h3 id="example-file">14.1. Example File</h3>
<div class="paragraph">
<p>A simple example is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;jboss:ejb-jar xmlns:jboss=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
               xmlns:s=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:security:1.1</span><span class="delimiter">&quot;</span></span>
               xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>
               version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
               impl-version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;enterprise-beans&gt;
        &lt;message-driven&gt;
            &lt;ejb-name&gt;ReplyingMDB&lt;/ejb-name&gt;
            &lt;ejb-<span class="type">class</span>&gt;<span class="class">org</span>.jboss.as.test.integration.ejb.mdb.messagedestination.ReplyingMDB&lt;/ejb-<span class="type">class</span>&gt;
            &lt;<span class="class">activation</span>-config&gt;
                &lt;activation-config-property&gt;
                    &lt;activation-config-property-name&gt;destination&lt;/activation-config-property-name&gt;
                    &lt;activation-config-property-value&gt;java:jboss/mdbtest/messageDestinationQueue
                    &lt;/activation-config-property-value&gt;
                &lt;/activation-config-property&gt;
            &lt;/activation-config&gt;
        &lt;/message-driven&gt;
    &lt;/enterprise-beans&gt;
    &lt;assembly-descriptor&gt;
        &lt;s:security&gt;
            &lt;ejb-name&gt;DDMyDomainSFSB&lt;/ejb-name&gt;
            &lt;s:security-domain&gt;myDomain&lt;/s:security-domain&gt;
            &lt;s:run-as-principal&gt;myPrincipal&lt;/s:run-as-principal&gt;
        &lt;/s:security&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the format is largely similar to <code>ejb-jar.xml</code>, in fact
they even use the same namespaces, however <code>jboss-ejb3.xml</code> adds some
additional namespaces of its own to allow for configuring non-spec info.
The format of the standard <code><a href="http://java.sun.com/xml/ns/javaee" class="bare">http://java.sun.com/xml/ns/javaee</a></code> is well
documented elsewhere, this document will cover the non-standard
namespaces.</p>
</div>
<div class="sect3">
<h4 id="the-root-namespace-httpwww.jboss.comxmlnsjavaee">14.1.1. The root namespace <a href="http://www.jboss.com/xml/ns/javaee" class="bare">http://www.jboss.com/xml/ns/javaee</a></h4>

</div>
<div class="sect3">
<h4 id="assembly-descriptor-namespaces">14.1.2. Assembly descriptor namespaces</h4>
<div class="paragraph">
<p>The following namespaces can all be used in the <code>&lt;assembly-descriptor&gt;</code>
element. They can be used to apply their configuration to a single bean,
or to all beans in the deployment by using <code>*</code> as the <code>ejb-name</code>.</p>
</div>
<div class="sect4">
<h5 id="the-security-namespace-urnsecurity">The security namespace urn:security</h5>
<div class="paragraph">
<p>This allows you to set the security domain and the run-as principal for
an EJB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;s:security&gt;
  &lt;ejb-name&gt;*&lt;/ejb-name&gt;
  &lt;s:security-domain&gt;myDomain&lt;/s:security-domain&gt;
  &lt;s:run-as-principal&gt;myPrincipal&lt;/s:run-as-principal&gt;
&lt;/s:security&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-resource-adaptor-namespace-urnresource-adapter-binding">The resource adaptor namespace urn:resource-adapter-binding</h5>
<div class="paragraph">
<p>This allows you to set the resource adaptor for an MDB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;r:resource-adapter-binding&gt;
  &lt;ejb-name&gt;*&lt;/ejb-name&gt;
  &lt;r:resource-adapter-name&gt;myResourceAdaptor&lt;/r:resource-adapter-name&gt;
&lt;/r:resource-adapter-binding&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-iiop-namespace-urniiop">The IIOP namespace urn:iiop</h5>
<div class="paragraph">
<p>The IIOP namespace is where IIOP settings are configured. As there are
quite a large number of options these are covered in the
<a href="#src-557220">IIOP guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-pool-namespace-urnejb-pool1.0">The pool namespace urn:ejb-pool:1.0</h5>
<div class="paragraph">
<p>This allows you to select the pool that is used by the SLSB or MDB.
Pools are defined in the server configuration (i.e. <code>standalone.xml</code> or
<code>domain.xml</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;p:pool&gt;
  &lt;ejb-name&gt;*&lt;/ejb-name&gt;
  &lt;p:bean-instance-pool-ref&gt;my-pool&lt;/p:bean-instance-pool-ref&gt;
&lt;/p:pool&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-cache-namespace-urnejb-cache1.0">The cache namespace urn:ejb-cache:1.0</h5>
<div class="paragraph">
<p>This allows you to select the cache that is used by the SFSB. Caches are
defined in the server configuration (i.e. <code>standalone.xml</code> or
<code>domain.xml</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;c:cache&gt;
  &lt;ejb-name&gt;*&lt;/ejb-name&gt;
  &lt;c:cache-ref&gt;my-cache&lt;/c:cache-ref&gt;
&lt;/c:cache&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-clustering-namespace-urnclustering1.0">The clustering namespace urn:clustering:1.0</h5>
<div class="paragraph">
<p>This namespace is deprecated and as of WildFly 11 its use has no effect.
The clustering behavior of EJBs is determined by the profile in use on
the server.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_message_driven_beans_controlled_delivery">15. Message Driven Beans Controlled Delivery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three mechanisms in Wildfly that allow controlling if a
specific MDB is actively receiving or not messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>delivery active</p>
</li>
<li>
<p>delivery groups</p>
</li>
<li>
<p>clustered singleton</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will see each one of them in the following sections.</p>
</div>
<div class="sect2">
<h3 id="delivery-active">15.1. Delivery Active</h3>
<div class="paragraph">
<p>Delivery active is simply an attribute associated with the MDB that
indicates if the MDB is receiving messages or not. If an MDB is not
currently receiving messages, the messages will be saved in the queue or
topic for later, according to the rules of the topic/queue.</p>
</div>
<div class="paragraph">
<p>You can configure delivery active using xml or annotations, and you can
change its value after deployment using the cli.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jboss-ejb3.xml:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the jboss-ejb3 xml file, configure the value of active as false to
mark that the MDB will not be receiving messages as soon as it is
deployed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;jboss:ejb-jar</span> <span class="attribute-name">xmlns:jboss</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">xmlns:d</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:delivery-active:1.1</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>                <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
 <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">impl-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;assembly-descriptor&gt;</span>
        <span class="tag">&lt;d:delivery&gt;</span>
            <span class="tag">&lt;ejb-name&gt;</span>HelloWorldQueueMDB<span class="tag">&lt;/ejb-name&gt;</span>
            <span class="tag">&lt;d:active&gt;</span>false<span class="tag">&lt;/d:active&gt;</span>
        <span class="tag">&lt;/d:delivery&gt;</span>
    <span class="tag">&lt;/assembly-descriptor&gt;</span>
<span class="tag">&lt;/jboss:ejb-jar&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a wildcard "*" in the place of ejb-name if you want to apply
that active value to all MDBs in your application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, you can use the org.jboss.ejb3.annotation.DeliveryActive
annotation, as in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorldMDB</span><span class="delimiter">&quot;</span></span>, activationConfig = {
<span class="error"> </span>
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.jms.Queue</span><span class="delimiter">&quot;</span></span>),
<span class="error"> </span>
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">queue/HELLOWORLDMDBQueue</span><span class="delimiter">&quot;</span></span>),
<span class="error"> </span>
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">acknowledgeMode</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">Auto-acknowledge</span><span class="delimiter">&quot;</span></span>) })
<span class="error"> </span>
<span class="annotation">@DeliveryActive</span>(<span class="predefined-constant">false</span>)
<span class="error"> </span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldMDB</span> <span class="directive">implements</span> MessageListener {
    <span class="directive">public</span> <span class="type">void</span> onMessage(Message rcvMessage) {
      <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="start-delivery-and-stop-delivery">15.1.1. Start-delivery and Stop-Delivery</h4>
<div class="paragraph">
<p>These management operations dynamically change the value of the active
attribute, enabling or disabling delivery for the MDB. at runtime To use
them, connect to the Wildfly instance you want to manage, then enter the
path of the MDB you want to manage delivery for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] cd deployment=jboss-helloworld-mdb.war/subsystem=ejb3/message-driven-bean=HelloWorldMDB
<span class="error"> </span>
[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> message-driven-bean=HelloWorldMDB] :stop-delivery
{<span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>}
<span class="error"> </span>
[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> message-driven-bean=HelloWorldMDB] :start-delivery
{<span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delivery-groups">15.2. Delivery Groups</h3>
<div class="paragraph">
<p>Delivery groups provide a straightforward way to manage delivery for a
group of MDBs. Every MDB belonging to a delivery group has delivery
active if and only if that group is active, and has delivery inactive
whenever the group is not active.</p>
</div>
<div class="paragraph">
<p>You can add a delivery group to the ejb3 subsystem using either the
subsystem xml or cli. Next, we will see examples of each case. In those
examples we will add only a single delivery group, but keep in mind that
you can add as many delivery groups as you need to a Wildfly instance.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the ejb3 subsystem xml (located in your configuration xml, such as
standalone.xml)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:ejb3:4.0</span><span class="delimiter">&quot;</span></span>&gt;
    ...
   <span class="error"> </span>&lt;mdb&gt;
        ...
        &lt;delivery-groups&gt;
            &lt;delivery-group name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mdb-group-name</span><span class="delimiter">&quot;</span></span> active=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/delivery-groups&gt;
    &lt;/mdb&gt;
    ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above adds a delivery group named "mdb-group-name" (you can
use whatever name suits you best as the group name). The "true" active
attribute indicates that all MDBs belonging to that group will have
delivery active right after deployment. If you mark that attribute as
false, you are indicating that every MDB belonging to the group will not
start receiving messages after deployment, a condition that will remain
until the group becomes active.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jboss-cli</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can add a mdb-delivery-group using the add command as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=ejb3/mdb-delivery-group=mdb-group-name:add
{<span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="reading-and-writing-the-delivery-state-of-a-delivery-group">15.2.1. Reading and Writing the Delivery State of a Delivery Group</h4>
<div class="paragraph">
<p>You can check whether delivery is active for a group by reading the
active attribute, which defaults to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=ejb3/mdb-delivery-group=mdb-group-name:read-attribute(name=active)
{ <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the the delivery-group inactive, just write the active attribute
with a false value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=ejb3/mdb-delivery-group=mdb-group-name:write-attribute(name=active,value=<span class="predefined-constant">false</span>)
{<span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>}
<span class="error"> </span>
[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=ejb3/mdb-delivery-group=mdb-group-name:read-attribute(name=active)
{ <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">false</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make it active again, write the attribute with a true value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=ejb3/mdb-delivery-group=mdb-group-name:write-attribute(name=active,value=<span class="predefined-constant">true</span>)
{<span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>}
<span class="error"> </span>
[standalone<span class="annotation">@localhost</span>:<span class="integer">9990</span> /] ./subsystem=ejb3/mdb-delivery-group=mdb-group-name:read-attribute(name=active)
{ <span class="string"><span class="delimiter">&quot;</span><span class="content">outcome</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> =&gt; <span class="predefined-constant">true</span> }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-delivery-groups">15.2.2. Using Delivery Groups</h4>
<div class="paragraph">
<p>To mark that an MDB belongs to a delivery-group, declare so in the
jboss-ejb3.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
<span class="error"> </span>
&lt;jboss:ejb-jar xmlns:jboss=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
               xmlns:d=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:delivery-active:1.1</span><span class="delimiter">&quot;</span></span>
               xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>
               version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
               impl-version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;assembly-descriptor&gt;
        &lt;d:delivery&gt;
            &lt;ejb-name&gt;HelloWorldMDB&lt;/ejb-name&gt;
            &lt;d:group&gt;mdb-delivery-group&lt;/d:group&gt;
        &lt;/d:delivery&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a wildcard to mark that all MDBs in your application
belong to a delivery-group. In the following example, we add all MDBs in
the application to group1, except for HelloWorldMDB, that is added to
group2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;jboss:ejb-jar xmlns:jboss=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
               xmlns:d=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:delivery-active:1.1</span><span class="delimiter">&quot;</span></span>
               xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>
               version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
               impl-version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;assembly-descriptor&gt;
        &lt;d:delivery&gt;
            &lt;ejb-name&gt;*&lt;/ejb-name&gt;
            &lt;d:group&gt;group1&lt;/d:group&gt;
        &lt;/d:delivery&gt;
        &lt;d:delivery&gt;
            &lt;ejb-name&gt;HelloWorldMDB&lt;/ejb-name&gt;
            &lt;d:group&gt;group2&lt;/d:group&gt;
        &lt;/d:delivery&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another option is to use org.jboss.ejb3.annotation.DeliveryGroup
annotation on each MDB class belonging to a group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorldQueueMDB</span><span class="delimiter">&quot;</span></span>, activationConfig = {
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.jms.Queue</span><span class="delimiter">&quot;</span></span>),
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">queue/HELLOWORLDMDBQueue</span><span class="delimiter">&quot;</span></span>),
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">acknowledgeMode</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">Auto-acknowledge</span><span class="delimiter">&quot;</span></span>) })
<span class="error"> </span>
<span class="annotation">@DeliveryGroup</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">group2</span><span class="delimiter">&quot;</span></span>)
<span class="error"> </span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldMDB</span> <span class="directive">implements</span> MessageListener {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A MDB cannot belong to more than one delivery group. Also, all the
delivery-groups used by an application must be installed in the Wildfly
server upon deployment, or the deployment will fail with a message
stating that the delivery-group is missing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clustered-singleton-delivery">15.3. Clustered Singleton Delivery</h3>
<div class="paragraph">
<p>Delivery can be marked as singleton in a clustered environment. In this
case, only one node in the cluster will have delivery active for that
MDB, whereas in all other nodes, delivery will be inactive. This option
can be used for applications that are deployed in all nodes of the
cluster. Such applications will be active in all nodes of the cluster,
except for the MDBs that are marked as clustered singleton. For those
MDBs, only one cluster node will be processing their messages. In case
that node stops, another node will have delivery activated, guaranteeing
that there is always one node processing the messages. This node is what
we call the MDB clustered singleton master node.</p>
</div>
<div class="paragraph">
<p>Notice that applications using clustered singleton delivery can only be
deployed in clustered Wildfly servers (i.e., servers that are using the
ha configuration).</p>
</div>
<div class="paragraph">
<p>To mark delivery as clustered singleton, you can use the jboss-ejb3.xml
or the @ClusteredSingleton annotation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jboss-ejb3.xml:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;jboss:ejb-jar xmlns:jboss=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
               xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
               xmlns:c=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:clustering:1.1</span><span class="delimiter">&quot;</span></span>
               xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>
               version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>
               impl-version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;assembly-descriptor&gt;
        &lt;c:clustering&gt;
            &lt;ejb-name&gt;HelloWorldMDB&lt;/ejb-name&gt;
            &lt;c:clustered-singleton&gt;<span class="predefined-constant">true</span>&lt;/c:clustered-singleton&gt;
        &lt;/c:clustering&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the previous jboss-ejb3.xml examples, a wildcard can be used in
the place of the ejb-name to indicate that all MDBs in the application
are singleton clustered.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the org.jboss.ejb3.annotation.ClusteredSingleton annotation
to mark an MDB as clustered singleton:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorldQueueMDB</span><span class="delimiter">&quot;</span></span>, activationConfig = {
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.jms.Queue</span><span class="delimiter">&quot;</span></span>),
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">queue/HELLOWORLDMDBQueue</span><span class="delimiter">&quot;</span></span>),
 <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">acknowledgeMode</span><span class="delimiter">&quot;</span></span>, propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">Auto-acknowledge</span><span class="delimiter">&quot;</span></span>) })
<span class="error"> </span>
<span class="annotation">@ClusteredSingleton</span>
<span class="error"> </span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldMDB</span> <span class="directive">implements</span> MessageListener { ... }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-multiple-mdb-delivery-control-mechanisms">15.4. Using Multiple MDB Delivery Control Mechanisms</h3>
<div class="paragraph">
<p>The previous d eliver y control mechanisms can be used together in a
single MDB. In this case, they work as a set of restrictions for
delivery to be active in a MDB.</p>
</div>
<div class="paragraph">
<p>For example, if an MDB belongs to a delivery group and is also a
clustered singleton MDB, the delivery will be active for that MDB only
if the delivery group is active in the cluster node that was elected as
the singleton master.</p>
</div>
<div class="paragraph">
<p>Also, if you use jboss-cli to stopDelivery on a MDB that belongs to a
delivery group, the MDB will stop receiving messages in case that group
was active. If that group was not active, the MDB will continue in the
same, inactive state. But, once that group is active, the MDB will not
receive messages, unless a startDelivery operation is executed to revert
the previously exectued stopDelivery operation.</p>
</div>
<div class="paragraph">
<p>Invoking stopDelivery on an MDB that is marked as clustered singleton
will work in a similar way: no visible effect if the current node is not
the clustered singleton master; but it will stop delivery of messages
for that MDB if the current node is the clustered singleton master. If
the current node is not the master, but eventually becomes so, the
delivery of messages will not be active for that MDB, unless a
startDelivery operation is invoked.</p>
</div>
<div class="paragraph">
<p>In other words, when more than one delivery control mechanism is used in
conjunction, they act as a set of restrictions that need all to be true
in order for the MDB to receive messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>delivery-group + stop-delivery</strong>: the delivery group needs to be
active and the delivery needs to be started in order for that MDB to
start receiving messages;</p>
</li>
<li>
<p><strong>delivery-group + clustered singleton</strong>: the delivery group needs to be
active and the current node needs to be the clustered singleton master
node in order for that MDB to start receiving messages;</p>
</li>
<li>
<p><strong>delivery-group + clustered singleton + stop-delivery</strong>: as above,
delivery-group active, current node equals the clustered singleton
master node, plus, start-delivery needs to be invoked on that MDB, only
with these three factors being true the MDB will start receiving
messages.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_securing_ejbs">16. Securing EJBs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview">16.1. Overview</h3>
<div class="paragraph">
<p>The Java EE spec specifies certain annotations (like @RolesAllowed,
@PermitAll, @DenyAll) which can be used on EJB implementation classes
and/or the business method implementations of the beans. Like with all
other configurations, these security related configurations can also be
done via the deployment descriptor (ejb-jar.xml). We <em>won&#8217;t</em> be going
into the details of Java EE specific annotations/deployment descriptor
configurations in this chapter but instead will be looking at the vendor
specific extensions to the security configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-domain">16.2. Security Domain</h3>
<div class="paragraph">
<p>The Java EE spec doesn&#8217;t mandate a specific way to configure security
domain for a bean. It leaves it to the vendor implementations to allow
such configurations, the way they wish. In WildFly 11, the use of
<code>@org.jboss.ejb3.annotation.SecurityDomain</code> annotation allows the
developer to configure the security domain for a bean. Here&#8217;s an
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.jboss.ejb3.annotation.SecurityDomain</span>;
<span class="error"> </span>
<span class="keyword">import</span> <span class="include">javax.ejb.Stateless</span>;
<span class="error"> </span>
<span class="annotation">@Stateless</span>
<span class="error"> </span>
<span class="annotation">@SecurityDomain</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">other</span><span class="delimiter">&quot;</span></span>)
<span class="error"> </span>
<span class="error">﻿</span><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> ...
<span class="error"> </span>
{
<span class="error"> </span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The use of @SecurityDomain annotation lets the developer to point the
container to the name of the security domain which is configured in the
EJB3 subsystem in the standalone/domain configuration. The configuration
of the security domain in the EJB3 subsystem is out of the scope of this
chapter.</p>
</div>
<div class="paragraph">
<p>An alternate way of configuring a security domain, instead of using
annotation, is to use jboss-ejb3.xml deployment descriptor. Here&#8217;s an
example of how the configuration will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;jboss:jboss</span>
        <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:jboss</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:s</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:security:1.1</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">impl-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 
    <span class="tag">&lt;assembly-descriptor&gt;</span>
        <span class="tag">&lt;s:security&gt;</span>
   <span class="comment">&lt;!-- Even wildcard * is supported --&gt;</span>
            <span class="tag">&lt;ejb-name&gt;</span>MyBean<span class="tag">&lt;/ejb-name&gt;</span>
            <span class="comment">&lt;!-- Name of the security domain which is configured in the EJB3 subsystem --&gt;</span>
            <span class="tag">&lt;s:security-domain&gt;</span>other<span class="tag">&lt;/s:security-domain&gt;</span>
        <span class="tag">&lt;/s:security&gt;</span>
    <span class="tag">&lt;/assembly-descriptor&gt;</span>
<span class="tag">&lt;/jboss:jboss&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we use the security-domain element to configure the
security domain.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The jboss-ejb3.xml is expected to be placed in the .jar/META-INF folder
of a .jar deployment or .war/WEB-INF folder of a .war deployment.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="absence-of-security-domain-configuration-but-presence-of-other-security-metadata">16.3. Absence of security domain configuration but presence of other</h3>
<div class="paragraph">
<p>security metadata</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FooBean</span> {
<span class="error"> </span>
 <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
 <span class="directive">public</span> <span class="type">void</span> doSomething() {
  ..
 }
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the <code>doSomething</code> method is configured to be accessible
for users with role "bar". However, the bean isn&#8217;t configured for any
specific security domain. Prior to WildFly 11, the absence of an
explicitly configured security domain on the bean would leave the bean
unsecured, which meant that even if the <code>doSomething</code> method was
configured with <code>@RolesAllowed("bar")</code> anyone even without the "bar"
role could invoke on the bean.</p>
</div>
<div class="paragraph">
<p>In WildFly 11, the presence of any security metadata (like @RolesAllowed,
@PermitAll, @DenyAll, @RunAs, @RunAsPrincipal) on the bean or any
business method of the bean, makes the bean secure, even in the absence
of an explicitly configured security domain. In such cases, the security
domain name is default to "other". Users can explicitly configure an
security domain for the bean if they want to using either the annotation
or deployment descriptor approach explained earlier.</p>
</div>
</div>
<div class="sect2">
<h3 id="access-to-methods-without-explicit-security-metadata-on-a-secured-bean">16.4. Access to methods without explicit security metadata, on a secured</h3>
<div class="paragraph">
<p>bean</p>
</div>
<div class="paragraph">
<p>Consider this example bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FooBean</span> {
<span class="error"> </span>
 <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
 <span class="directive">public</span> <span class="type">void</span> doSomething() {
  ..
 }
<span class="error"> </span>
<span class="error"> </span>
 <span class="directive">public</span> <span class="type">void</span> helloWorld() {
  ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the <code>doSomething</code> method is marked for access for only
users with role "bar". That enables security on the bean (with security
domain defaulted to "other"). However, notice that the method
<code>helloWorld</code> doesn&#8217;t have any specific security configurations.</p>
</div>
<div class="paragraph">
<p>In WildFly 11, such methods which have no explicit security
configurations, in a secured bean, will be treated similar to a method
with <code>@DenyAll</code> configuration. What that means is, no one is allowed
access to the <code>helloWorld</code> method. This behaviour can be controlled via
the jboss-ejb3.xml deployment descriptor at a per bean level or a per
deployment level as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;jboss:jboss</span>
        <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:jboss</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.jboss.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:s</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:security:1.1</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">impl-version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 
    <span class="tag">&lt;assembly-descriptor&gt;</span>
        <span class="tag">&lt;s:security&gt;</span>
   <span class="comment">&lt;!-- Even wildcard * is supported where * is equivalent to all EJBs in the deployment --&gt;</span>
            <span class="tag">&lt;ejb-name&gt;</span>FooBean<span class="tag">&lt;/ejb-name&gt;</span>
            <span class="tag">&lt;s:missing-method-permissions-deny-access&gt;</span>false<span class="tag">&lt;/s:missing-method-permissions-deny-access&gt;</span>
        <span class="tag">&lt;/s:security&gt;</span>
    <span class="tag">&lt;/assembly-descriptor&gt;</span>
<span class="tag">&lt;/jboss:jboss&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the use of <code>&lt;missing-method-permissions-deny-access&gt;</code> element.
The value for this element can either be true or false. If this element
isn&#8217;t configured then it is equivalent to a value of true i.e. no one is
allowed access to methods, which have no explicit security
configurations, on secured beans. Setting this to false allows access to
such methods for all users i.e. the behaviour will be switched to be
similar to <code>@PermitAll</code>.</p>
</div>
<div class="paragraph">
<p>This behaviour can also be configured at the EJB3 subsystem level so
that it applies to all EJB3 deployments on the server, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:ejb3:1.4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
            <span class="tag">&lt;default-missing-method-permissions-deny-access</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
...
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the <code>default-missing-method-permissions-deny-access</code> element
accepts either a true or false value. A value of true makes the
behaviour similar to <code>@DenyAll</code> and a value of false makes it behave
like <code>@PermitAll</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jpa_reference_guide">17. JPA Reference Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction">17.1. Introduction</h3>
<div class="paragraph">
<p>The WildFly JPA subsystem implements the JPA 2.1 container-managed
requirements. Deploys the persistence unit definitions, the persistence
unit/context annotations and persistence unit/context references in the
deployment descriptor. JPA Applications use the Hibernate (version 5.1)
persistence provider, which is included with WildFly. The JPA subsystem
uses the standard SPI (javax.persistence.spi.PersistenceProvider) to
access the Hibernate persistence provider and some additional extensions
as well.</p>
</div>
<div class="paragraph">
<p>During application deployment, JPA use is detected (e.g. persistence.xml
or @PersistenceContext/Unit annotations) and injects Hibernate
dependencies into the application deployment. This makes it easy to
deploy JPA applications.</p>
</div>
<div class="paragraph">
<p>In the remainder of this documentation, "entity manager" refers to an
instance of the <em>javax.persistence.EntityManager</em> class.
<a href="http://download.oracle.com/javaee/7/api/javax/persistence/package-summary.html">Javadoc
for the JPA interfaces</a>and <a href="https://jcp.org/en/jsr/detail?id=338">JPA 2.1
specification</a>.</p>
</div>
<div class="paragraph">
<p>The index of the Hibernate documentation is at
<a href="http://hibernate.org/orm/documentation/5.1/" class="bare">http://hibernate.org/orm/documentation/5.1/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="update-your-persistence.xml-for-hibernate-5.1">17.2. Update your Persistence.xml for Hibernate 5.1</h3>
<div class="paragraph">
<p>The persistence provider class name in Hibernate 4.3.0 (and greater) is
<strong>org.hibernate.jpa.HibernatePersistenceProvider</strong>.</p>
</div>
<div class="paragraph">
<p>Instead of specifying:</p>
</div>
<div class="paragraph">
<p><strong>&lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;</strong></p>
</div>
<div class="paragraph">
<p>Switch to:</p>
</div>
<div class="paragraph">
<p><strong>&lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;</strong></p>
</div>
<div class="paragraph">
<p>Or remove the persistence provider class name from your persistence.xml
(so the default provider will be used).</p>
</div>
</div>
<div class="sect2">
<h3 id="entity-manager">17.3. Entity manager</h3>
<div class="paragraph">
<p>The entity manager (javax.persistence.EntityManager class) is similar to
the Hibernate Session class; applications use it to
create/read/update/delete data (and related operations). Applications
can use application-managed or container-managed entity managers. Keep
in mind that the entity manager is not thread safe, don&#8217;t share the same
entity manager instance with multiple threads.</p>
</div>
<div class="paragraph">
<p>Internally, the entity manager, has a persistence context for managing
entities. You can think of the persistence context as being closely
associated with the entity manager.</p>
</div>
</div>
<div class="sect2">
<h3 id="container-managed-entity-manager">17.4. Container-managed entity manager</h3>
<div class="paragraph">
<p>When you inject a container-managed entity managers into an application
variable, it is treated like an (EE container controlled) Java proxy
object, that will be associated with an underlying EntityManager
instance, for each started JTA transaction and is flushed/closed when
the JTA transaction commits. Such that when your application code
invokes EntityManager.anyMethod(), the current JTA transaction is
searched (using persistence unit name as key) for the underlying
EntityManager instance, if not found, a new EntityManager instance is
created and associated with the current JTA transaction, to be reused
for the next EntityManager invocation. Use the @PersistenceContext
annotation, to inject a container-managed entity manager into a
javax.persistence.EntityManager variable.</p>
</div>
</div>
<div class="sect2">
<h3 id="application-managed-entity-manager">17.5. Application-managed entity manager</h3>
<div class="paragraph">
<p>An application-managed entity manager is kept around until the
application closes it. The scope of the application-managed entity
manager is from when the application creates it and lasts until the
application closes it. Use the <em>@PersistenceUnit</em> annotation, to inject
a persistence unit into a <em>javax.persistence.EntityManagerFactory
variable</em>. The EntityManagerFactory can return an application-managed
entity manager.</p>
</div>
</div>
<div class="sect2">
<h3 id="persistence-context">17.6. Persistence Context</h3>
<div class="paragraph">
<p>The JPA persistence context contains the entities managed by the entity
manager (via the JPA persistence provider). The underlying entity
manager maintains the persistence context. The persistence context acts
like a first level (transactional) cache for interacting with the
datasource. Loaded entities are placed into the persistence context
before being returned to the application. Entities changes are also
placed into the persistence context (to be saved in the database when
the transaction commits).</p>
</div>
</div>
<div class="sect2">
<h3 id="transaction-scoped-persistence-context">17.7. Transaction-scoped Persistence Context</h3>
<div class="paragraph">
<p>The transaction-scoped persistence context coordinates with the (active)
JTA transaction. When the transaction commits, the persistence context
is flushed to the datasource (entity objects are detached but may still
be referenced by application code). All entity changes that are expected
to be saved to the datasource, must be made during a transaction.
Entities read outside of a transaction will be detached when the entity
manager invocation completes. Example transaction-scoped persistence
context is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateful</span>  <span class="comment">// will use container managed transactions</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerManager</span> {
  <span class="annotation">@PersistenceContext</span>(unitName = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerPU</span><span class="delimiter">&quot;</span></span>) <span class="comment">// default type is PersistenceContextType.TRANSACTION</span>
  EntityManager em;
  <span class="directive">public</span> customer createCustomer(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> address) {
    Customer customer = <span class="keyword">new</span> Customer(name, address);
    em.persist(customer);  <span class="comment">// persist new Customer when JTA transaction completes (when method ends).</span>
                           <span class="comment">// internally:</span>
                           <span class="comment">//    1. Look for existing &quot;customerPU&quot; persistence context in active JTA transaction and use if found.</span>
                           <span class="comment">//    2. Else create new &quot;customerPU&quot; persistence context (e.g. instance of org.hibernate.ejb.HibernatePersistence)</span>
                           <span class="comment">//       and put in current active JTA transaction.</span>
    <span class="keyword">return</span> customer;       <span class="comment">// return Customer entity (will be detached from the persistence context when caller gets control)</span>
  }  <span class="comment">// Transaction.commit will be called, Customer entity will be persisted to the database and &quot;customerPU&quot; persistence context closed</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extended-persistence-context">17.8. Extended Persistence Context</h3>
<div class="paragraph">
<p>The (ee container managed) extended persistence context can span
multiple transactions and allows data modifications to be queued up
(like a shopping cart), without an active JTA transaction (to be applied
during the next JTA TX). The Container-managed extended persistence
context can only be injected into a stateful session bean. You can also
think of the extended persistence context, as being an entity manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>(type = PersistenceContextType.EXTENDED, unitName = <span class="string"><span class="delimiter">&quot;</span><span class="content">inventoryPU</span><span class="delimiter">&quot;</span></span>)
EntityManager em;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="extended-persistence-context-inheritance">17.8.1. Extended Persistence Context Inheritance</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JPA <span class="float">2.0</span> specification section <span class="float">7.6</span><span class="float">.2</span><span class="float">.1</span>
<span class="error"> </span>
If a stateful session bean instantiates a stateful session bean (executing in the same EJB container instance) which also has such an extended persistence context, the extended persistence context of the first stateful session bean is inherited by the second stateful session bean and bound to it, and <span class="local-variable">this</span> rule recursively applies<span class="error">—</span>independently of whether transactions are active or not at the point of the creation of the stateful session beans.</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the current stateful session bean being created, will (
<strong>deeply</strong>) inherit the extended persistence context from any stateful
session bean executing in the current Java thread. The <strong>deep</strong>
inheritance of extended persistence context includes walking multiple
levels up the stateful bean call stack (inheriting from parent beans).
The <strong>deep</strong> inheritance of extended persistence context includes sibling
beans. For example, parentA references child beans beanBwithXPC &amp;
beanCwithXPC. Even though parentA doesn&#8217;t have an extended persistence
context, beanBwithXPC &amp; beanCwithXPC will share the same extended
persistence context.</p>
</div>
<div class="paragraph">
<p>Some other EE application servers, use <strong>shallow</strong> inheritance, where
stateful session bean only inherit from the parent stateful session bean
(if there is a parent bean). Sibling beans do not share the same
extended persistence context unless their (common) parent bean also has
the same extended persistence context.</p>
</div>
<div class="paragraph">
<p>Applications can include a (top-level) <strong>jboss-all.xml</strong> deployment
descriptor that specifies either the (default) <strong>DEEP</strong> extended
persistence context inheritance or <strong>SHALLOW</strong>.</p>
</div>
<div class="paragraph">
<p>The WF/docs/schema/jboss-jpa_1_0.xsd describes the <strong>jboss-jpa</strong>
deployment descriptor that may be included in the <strong>jboss-all.xml</strong>. Below
is an example of using <strong>SHALLOW</strong> extended persistence context
inheritance:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>&lt;jboss&gt;<br>
&lt;jboss-jpa xmlns="http://www.jboss.com/xml/ns/javaee"&gt;<br>
&lt;extended-persistence inheritance="SHALLOW"/&gt;<br>
&lt;/jboss-jpa&gt;<br>
&lt;/jboss&gt;</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Below is an example of using <strong>DEEP</strong> extended persistence inheritance:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>&lt;jboss&gt;<br>
&lt;jboss-jpa xmlns="http://www.jboss.com/xml/ns/javaee"&gt;<br>
&lt;extended-persistence inheritance="DEEP"/&gt;<br>
&lt;/jboss-jpa&gt;<br>
&lt;/jboss&gt;</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AS console/cli can change the <strong>default</strong> extended persistence context
setting (DEEP or SHALLOW). The following cli commands will read the
current JPA settings and enable SHALLOW extended persistence context
inheritance for applications that do not include the <strong>jboss-jpa</strong>
deployment descriptor:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<div class="title">/jboss-cli.sh<br></div>
<p>cd subsystem=jpa<br>
:read-resource<br>
:write-attribute(name=default-extended-persistence-inheritance,value="SHALLOW")</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entities">17.9. Entities</h3>
<div class="paragraph">
<p>JPA allows use of your (pojo) plain old Java class to represent a
database table row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span> EntityManager em;
<span class="predefined-type">Integer</span> bomPk = getIndexKeyValue();
BillOfMaterials bom = em.find(BillOfMaterials.class, bomPk); <span class="comment">// read existing table row into BillOfMaterials class</span>
<span class="error"> </span>
BillOfMaterials createdBom = <span class="keyword">new</span> BillOfMaterials(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);     <span class="comment">// create new entity</span>
em.persist(createdBom);  <span class="comment">// createdBom is now managed and will be saved to database when the current JTA transaction completes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The entity lifecycle is managed by the underlying persistence provider.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New (transient): an entity is new if it has just been instantiated
using the new operator, and it is not associated with a persistence
context. It has no persistent representation in the database and no
identifier value has been assigned.</p>
</li>
<li>
<p>Managed (persistent): a managed entity instance is an instance with a
persistent identity that is currently associated with a persistence
context.</p>
</li>
<li>
<p>Detached: the entity instance is an instance with a persistent
identity that is no longer associated with a persistence context,
usually because the persistence context was closed or the instance was
evicted from the context.</p>
</li>
<li>
<p>Removed: a removed entity instance is an instance with a persistent
identity, associated with a persistence context, but scheduled for
removal from the database.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deployment">17.10. Deployment</h3>
<div class="paragraph">
<p>The persistence.xml contains the persistence unit configuration (e.g.
datasource name) and as described in the JPA 2.0 spec (section 8.2), the
jar file or directory whose META-INF directory contains the
persistence.xml file is termed the root of the persistence unit. In Java
EE environments, the root of a persistence unit must be one of the
following (quoted directly from the JPA 2.0 specification):</p>
</div>
<div class="paragraph">
<p>"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an EJB-JAR file</p>
</li>
<li>
<p>the WEB-INF/classes directory of a WAR file</p>
</li>
<li>
<p>a jar file in the WEB-INF/lib directory of a WAR file</p>
</li>
<li>
<p>a jar file in the EAR library directory</p>
</li>
<li>
<p>an application client jar file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The persistence.xml can specify either a JTA datasource or a non-JTA
datasource. The JTA datasource is expected to be used within the EE
environment (even when reading data without an active transaction). If a
datasource is not specified, the default-datasource will instead be used
(must be configured).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java Persistence 1.0 supported use of a jar file in the root of
the EAR as the root of a persistence unit. This use is no longer
supported. Portable applications should use the EAR library directory
for this case instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>"</p>
</div>
<div class="paragraph">
<p>Question: Can you have a EAR/META-INF/persistence.xml?</p>
</div>
<div class="paragraph">
<p>Answer: No, the above may deploy but it could include other archives
also in the EAR, so you may have deployment issues for other reasons.
Better to put the persistence.xml in an EAR/lib/somePuJar.jar.</p>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting">17.11. Troubleshooting</h3>
<div class="paragraph">
<p>The <strong>org.jboss.as.jpa</strong> logging can be enabled to get the following
information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>INFO - when persistence.xml has been parsed, starting of persistence
unit service (per deployed persistence.xml), stopping of persistence
unit service</p>
</li>
<li>
<p>DEBUG - informs about entity managers being injected, creating/reusing
transaction scoped entity manager for active transaction</p>
</li>
<li>
<p>TRACE - shows how long each entity manager operation took in
milliseconds, application searches for a persistence unit, parsing of
persistence.xml</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable TRACE, open the as/standalone/configuration/standalone.xml (or
as/domain/configuration/domain.xml) file. Search for <strong>&lt;subsystem
xmlns="urn:jboss:domain:logging:1.0"&gt;</strong> and add the <strong>org.jboss.as.jpa</strong>
category. You need to change the console-handler level from <strong>INFO</strong> to
<strong>TRACE</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:logging:1.0</span><span class="delimiter">&quot;</span></span>&gt;
     &lt;console-handler name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CONSOLE</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span> /&gt;
    <span class="error"> </span> ...
     &lt;/console-handler&gt;
<span class="error"> </span>
     &lt;/periodic-rotating-file-handler&gt;
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.arjuna</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>    &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">WARN</span><span class="delimiter">&quot;</span></span> /&gt;
 <span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
<span class="error"> </span>
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.jpa</span><span class="delimiter">&quot;</span></span>&gt;
   <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
<span class="error"> </span>
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.tomcat.util.modeler</span><span class="delimiter">&quot;</span></span>&gt;
   <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">WARN</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
     ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To see what is going on at the JDBC level, enable <strong>jboss.jdbc.spy</strong> TRACE
and add spy="true" to the datasource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;datasource jndi-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/...</span><span class="delimiter">&quot;</span></span> pool-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> spy=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
&lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.jdbc.spy</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To troubleshoot issues with the Hibernate second level cache, try
enabling trace for <strong>org.hibernate.SQL + org.hibernate.cache.infinispan<br>
org.infinispan:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:logging:1.0</span><span class="delimiter">&quot;</span></span>&gt;
     &lt;console-handler name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CONSOLE</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span> /&gt;
    <span class="error"> </span> ...
     &lt;/console-handler&gt;
<span class="error"> </span>
     &lt;/periodic-rotating-file-handler&gt;
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.arjuna</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>    &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">WARN</span><span class="delimiter">&quot;</span></span> /&gt;
 <span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
<span class="error"> </span>
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.SQL</span><span class="delimiter">&quot;</span></span>&gt;
   <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
<span class="error"> </span>
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate</span><span class="delimiter">&quot;</span></span>&gt;
   <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
<span class="error"> </span>     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan</span><span class="delimiter">&quot;</span></span>&gt;
   <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
<span class="error"> </span>
     &lt;logger category=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.tomcat.util.modeler</span><span class="delimiter">&quot;</span></span>&gt;
   <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;level name=<span class="string"><span class="delimiter">&quot;</span><span class="content">WARN</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/logger&gt;
     ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-infinispan-second-level-cache">17.12. Using the Infinispan second level cache</h3>
<div class="paragraph">
<p>To enable the second level cache with Hibernate 5.1, just set the
<strong>hibernate.cache.use_second_level_cache</strong> property to true, as is done in
the following example (also set the
<a href="http://docs.oracle.com/javaee/6/api/javax/persistence/SharedCacheMode.html">shared-cache-mode</a>
accordingly). By default the application server uses Infinispan as the
cache provider for <strong>JPA applications</strong>, so you don&#8217;t need specify
anything on top of that. The Infinispan version that is included in
WildFly is expected to work with the Hibernate version that is included
with WildFly. Example persistence.xml settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;&lt;persistence xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span> version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>&gt;
&lt;persistence-unit name=<span class="string"><span class="delimiter">&quot;</span><span class="content">2lc_example_pu</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;description&gt;example of enabling the second level cache.&lt;/description&gt;
   &lt;jta-data-source&gt;java:jboss/datasources/mydatasource&lt;/jta-data-source&gt;
   &lt;shared-cache-mode&gt;ENABLE_SELECTIVE&lt;/shared-cache-mode&gt;
   &lt;properties&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_second_level_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
   &lt;/properties&gt;
&lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of enabling the second level cache for a Hibernate
native API hibernate.cfg.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.jpa.hibernate5.infinispan.InfinispanRegionFactory</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.cachemanager</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/infinispan/container/hibernate</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.transaction.manager_lookup_class</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.transaction.JBossTransactionManagerLookup</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_second_level_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Hibernate native API application will also need a MANIFEST.MF:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Dependencies: org.infinispan,org.hibernate</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://infinispan.org/docs/8.0.x/user_guide/user_guide.html#_using_infinispan_as_jpa_hibernate_second_level_cache_provider">Infinispan
Hibernate/JPA second level cache provider documentation</a> contains
advanced configuration information but you should bear in mind that when
Hibernate runs within WildFly 11, some of those configuration options,
such as region factory, are not needed. Moreover, the application server
providers you with option of selecting a different cache container for
Infinispan via <strong>hibernate.cache.infinispan.container</strong> persistence
property. To reiterate, this property is not mandatory and a default
container is already deployed for by the application server to host the
second level cache.</p>
</div>
<div class="paragraph">
<p>Here is an example of what the Hibernate cache settings may currently be
in your standalone.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> &lt;cache-container name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-cache=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-query</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.infinispan</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;transaction mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">NON_XA</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction strategy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> max-entries=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;expiration max-idle=<span class="string"><span class="delimiter">&quot;</span><span class="content">100000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-query</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction strategy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> max-entries=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;expiration max-idle=<span class="string"><span class="delimiter">&quot;</span><span class="content">100000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">timestamps</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is an example of customizing the "entity", "immutable-entity",
"local-query", "pending-puts", "timestamps" cache configuration may look
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> &lt;cache-container name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.infinispan</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-cache=<span class="string"><span class="delimiter">&quot;</span><span class="content">immutable-entity</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">entity</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;transaction mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction max-entries=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;expiration max-idle=<span class="string"><span class="delimiter">&quot;</span><span class="content">120000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">immutable-entity</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;transaction mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction max-entries=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;expiration max-idle=<span class="string"><span class="delimiter">&quot;</span><span class="content">120000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">local-query</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction max-entries=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;expiration max-idle=<span class="string"><span class="delimiter">&quot;</span><span class="content">300000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">pending-puts</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;transaction mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction strategy=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;expiration max-idle=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;local-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">timestamps</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;transaction mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;eviction strategy=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/local-cache&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Persistence.xml to use the above custom settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;properties&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_second_level_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_query_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.immutable-entity.cfg</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">immutable-entity</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.timestamps.cfg</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">timestamps</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.infinispan.pending-puts.cfg</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">pending-puts</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replacing-the-current-hibernate-5.x-jars-with-a-newer-version">17.13. Replacing the current Hibernate 5.x jars with a newer version</h3>
<div class="paragraph">
<p>Just update the current
wildfly/modules/system/layers/base/org/hibernate/main folder to contain
the newer version (after stopping your WildFly server instance).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete *.index files in
wildfly/modules/system/layers/base/org/hibernate/main and
wildfly/modules/system/layers/base/org/hibernate/envers/main folders.</p>
</li>
<li>
<p>Backup the current contents of
wildfly/modules/system/layers/base/org/hibernate in case you make a
mistake.</p>
</li>
<li>
<p>Remove the older jars and copy new Hibernate jars into
wildfly/modules/system/layers/base/org/hibernate/main<br>
wildfly/modules/system/layers/base/org/hibernate/envers/main.</p>
</li>
<li>
<p>Update the
wildfly/modules/system/layers/base/org/hibernate/main/module.xml<br>
wildfly/modules/system/layers/base/org/hibernate/envers/main/module.xml
to name the jars that you copied in.</p>
</li>
<li>
<p>Also update the hibernate-infinispan jars in
wildfly/modules/system/layers/base/org/hibernate/infinispan.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-hibernate-search">17.14. Using Hibernate Search</h3>
<div class="paragraph">
<p>WildFly includes Hibernate Search. If you want to use the bundled
version of Hibernate Search - which requires to use the default
Hibernate ORM 5.1 persistence provider - this will be automatically
enabled.<br>
Having this enabled means that, provided your application includes any
entity which is annotated with
<strong>org.hibernate.search.annotations.Indexed</strong>, the module
<strong>org.hibernate.search.orm:main</strong> will be made available to your
deployment; this will also include the required version of Apache
Lucene.</p>
</div>
<div class="paragraph">
<p>If you do not want this module to be exposed to your deployment, set the
persistence property <strong>wildfly.jpa.hibernate.search.module</strong> to either
<strong>none</strong> to not automatically inject any Hibernate Search module, or to
any other module identifier to inject a different module.<br>
For example you could set
<strong>wildfly.jpa.hibernate.search.module=org.hibernate.search.orm:5.4.0.Alpha1</strong>
to use the experimental version 5.4.0.Alpha1 instead of the provided
module; in this case you&#8217;ll have to download and add the custom modules
to the application server as other versions are not included.<br>
When setting <strong>wildfly.jpa.hibernate.search.module=none</strong> you might also
opt to include Hibernate Search and its dependencies within your
application but we highly recommend the modules approach.</p>
</div>
</div>
<div class="sect2">
<h3 id="packaging-the-hibernate-jpa-persistence-provider-with-your-application">17.15. Packaging the Hibernate JPA persistence provider with your application</h3>
<div class="paragraph">
<p>WildFly allows the packaging of Hibernate persistence provider jars with
the application. The JPA deployer will detect the presence of a
persistence provider in the application and
<strong>jboss.as.jpa.providerModule</strong> needs to be set to <strong>application</strong>.&lt;?xml
version="1.0" encoding="UTF-8"?&gt;<br>
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
version="1.0"&gt;<br>
&lt;persistence-unit name="myOwnORMVersion_pu"&gt;<br>
&lt;description&gt;Hibernate Persistence Unit.&lt;/description&gt;<br>
&lt;jta-data-source&gt;java:jboss/datasources/PlannerDS&lt;/jta-data-source&gt;<br>
&lt;properties&gt;<br>
&lt;property name="jboss.as.jpa.providerModule" value="application" /&gt;<br>
&lt;/properties&gt;<br>
&lt;/persistence-unit&gt;<br>
&lt;/persistence&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-openjpa">17.16. Migrating from OpenJPA</h3>
<div class="paragraph">
<p>You need to copy the OpenJPA jars (e.g. openjpa-all.jar serp.jar) into
the WildFly modules/org/apache/openjpa/main folder and update
modules/org/apache/openjpa/main/module.xml to include the same jar file
names that you copied in. This will help you get your application that
depends on OpenJPA, to deploy on WildFly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> &lt;module xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:module:1.1</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.openjpa</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;resources&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;resource-root path=<span class="string"><span class="delimiter">&quot;</span><span class="content">jipijapa-openjpa-1.0.1.Final.jar</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;resource-root path=<span class="string"><span class="delimiter">&quot;</span><span class="content">openjpa-all.jar</span><span class="delimiter">&quot;</span></span>&gt;
           &lt;filter&gt;
              &lt;exclude path=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax/**</span><span class="delimiter">&quot;</span></span> /&gt;
           &lt;/filter&gt;
        &lt;/resource-root&gt;
        &lt;resource-root path=<span class="string"><span class="delimiter">&quot;</span><span class="content">serp.jar</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/resources&gt;
<span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;dependencies&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.annotation.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.enterprise.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.transaction.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.validation.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.xml.bind.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.collections</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.lang</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.jpa.spi</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.logging</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.vfs</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.jandex</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-eclipselink">17.17. Migrating from EclipseLink</h3>
<div class="paragraph">
<p>You need to copy the EclipseLink jar (e.g. eclipselink-2.6.0.jar or
eclipselink.jar as in the example below) into the WildFly
modules/org/eclipse/persistence/main folder and update
modules/org/eclipse/persistence/main/module.xml to include the
EclipseLink jar (take care to use the jar name that you copied in). If
you happen to leave the EclipseLink version number in the jar name, the
module.xml should reflect that. This will help you get your application
that depends on EclipseLink, to deploy on WildFly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> &lt;module xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:module:1.1</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.eclipse.persistence</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;resources&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;resource-root path=<span class="string"><span class="delimiter">&quot;</span><span class="content">jipijapa-eclipselink-10.0.0.Final.jar</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;resource-root path=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.jar</span><span class="delimiter">&quot;</span></span>&gt;           &lt;filter&gt;
              &lt;exclude path=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax/**</span><span class="delimiter">&quot;</span></span> /&gt;
           &lt;/filter&gt;
        &lt;/resource-root&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/resources&gt;
<span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;dependencies&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">asm.asm</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.annotation.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.enterprise.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.transaction.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.validation.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.xml.bind.api</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.antlr</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.collections</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.dom4j</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.jpa.spi</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.logging</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.vfs</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a workaround for issue
<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=414974">id=414974</a>, set
(WildFly) system property "eclipselink.archive.factory" to value
"org.jipijapa.eclipselink.JBossArchiveFactoryImpl" via jboss-cli.sh
command (WildFly server needs to be running when this command is
issued):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jboss-cli.sh --connect <span class="string"><span class="delimiter">'</span><span class="content">/system-property=eclipselink.archive.factory:add(value=org.jipijapa.eclipselink.JBossArchiveFactoryImpl)</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The following shows what the standalone.xml (or your WildFly
configuration you are using) file might look like after updating the
system properties:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;system-properties&gt;
   ...
   &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.archive.factory</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jipijapa.eclipselink.JBossArchiveFactoryImpl</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should then be able to deploy applications with persistence.xml that
include;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also refer to page
<a href="https://community.jboss.org/wiki/HowToUseEclipseLinkWithAS7">how to use
EclipseLink with WildFly guide here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrating-from-datanucleus">17.18. Migrating from DataNucleus</h3>
<div class="paragraph">
<p>Read the
<a href="http://www.datanucleus.org/products/accessplatform_5_0/jpa/javaee.html">how
to use DataNucleus with WildFly guide here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="native-hibernate-use">17.19. Native Hibernate use</h3>
<div class="paragraph">
<p>Applications that use the Hibernate API directly, are referred to here
as native Hibernate applications. Native Hibernate applications, can
choose to use the Hibernate jars included with WildFly or they can
package their own copy of the Hibernate jars. Applications that utilize
JPA will automatically have the Hibernate classes injected onto the
application deployment classpath. Meaning that JPA applications, should
expect to use the Hibernate jars included in WildFly.</p>
</div>
<div class="paragraph">
<p>Example MANIFEST.MF entry to add dependency for Hibernate native
applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Manifest</span>-Version: <span class="float">1.0</span>
...
Dependencies: org.hibernate</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use the Hibernate native api in your application and also use the
JPA api to access the same entities (from the same Hibernate
session/EntityManager), you could get surprising results (e.g.
HibernateSession.saveOrUpdate(entity) is different than
EntityManager.merge(entity). Each entity should be managed by either
Hibernate native API or JPA code.</p>
</div>
</div>
<div class="sect2">
<h3 id="injection-of-hibernate-session-and-sessionfactoryinjection-of-hibernate-session-and-sessionfactory">17.20. Injection of Hibernate Session and SessionFactoryInjection of</h3>
<div class="paragraph">
<p>Hibernate Session and SessionFactory</p>
</div>
<div class="paragraph">
<p>You can inject a org.hibernate.Session and org.hibernate.SessionFactory
directly, just as you can do with EntityManagers and
EntityManagerFactorys.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.hibernate.Session</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.SessionFactory</span>;
<span class="annotation">@Stateful</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">MyStatefulBean</span> ... {
<span class="error"> </span><span class="error"> </span> <span class="annotation">@PersistenceContext</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">crm</span><span class="delimiter">&quot;</span></span>) Session session1;
<span class="error"> </span><span class="error"> </span> <span class="annotation">@PersistenceContext</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">crm2</span><span class="delimiter">&quot;</span></span>, type=EXTENDED) Session extendedpc;
<span class="error"> </span><span class="error"> </span> <span class="annotation">@PersistenceUnit</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">crm</span><span class="delimiter">&quot;</span></span>) SessionFactory factory;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hibernate-properties">17.21. Hibernate properties</h3>
<div class="paragraph">
<p>WildFly automatically sets the following Hibernate (5.x) properties (if
not already set in persistence unit definition):</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.id.new_generator_mappings =true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New applications should let
this default to true, older applications with existing data might need
to set to false (see note below). It really depends on whether your
application uses the @GeneratedValue(AUTO) which will generates new key
values for newly created entities. The application can override this
value (in the persistence.xml).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.transaction.jta.platform= instance of
org.hibernate.service.jta.platform.spi.JtaPlatform interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The
transaction manager, user transaction and transaction synchronization
registry is passed into Hibernate via this class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.ejb.resource_scanner = instance of
org.hibernate.ejb.packaging.Scanner interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of entity
scanning class is passed in that knows how to use the AS annotation
indexer (for faster deployment).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.transaction.manager_lookup_class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property is removed if
found in the persistence.xml (could conflict with JtaPlatform)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.session_factory_name = qualified persistence unit name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is
set to the application name + persistence unit name (application can
specify a different value but it needs to be unique across all
application deployments on the AS instance).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.session_factory_name_is_jndi = false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only set if the
application didn&#8217;t specify a value for hibernate.session_factory_name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.ejb.entitymanager_factory_name = qualified persistence unit
name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is set to the application name + persistence unit name
(application can specify a different value but it needs to be unique
across all application deployments on the AS instance).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.query.jpaql_strict_compliance=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.auto_quote_keyword=false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.implicit_naming_strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In Hibernate 4.x (and greater), if <strong>new_generator_mappings</strong> is <strong>true</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@GeneratedValue(AUTO) maps to
org.hibernate.id.enhanced.SequenceStyleGenerator</p>
</li>
<li>
<p>@GeneratedValue(TABLE) maps to
org.hibernate.id.enhanced.TableGenerator</p>
</li>
<li>
<p>@GeneratedValue(SEQUENCE) maps to
org.hibernate.id.enhanced.SequenceStyleGenerator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Hibernate 4.x (and greater), if <strong>new_generator_mappings</strong> is <strong>false</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@GeneratedValue(AUTO) maps to Hibernate "native"</p>
</li>
<li>
<p>@GeneratedValue(TABLE) maps to
org.hibernate.id.MultipleHiLoPerTableGenerator</p>
</li>
<li>
<p>@GeneratedValue(SEQUENCE) to Hibernate "seqhilo"</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="persistence-unit-properties">17.22. Persistence unit properties</h3>
<div class="paragraph">
<p>The following properties are supported in the persistence unit
definition (in the persistence.xml file):</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.providerModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of the persistence provider module
(default is org.hibernate). Should be application, if a persistence
provider is packaged with the application. See note below about some
module names that are built in (based on the provider).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.adapterModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of the integration classes that help
WildFly to work with the persistence provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.adapterClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">class name of the integration adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.managed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to false to disable container managed JPA
access to the persistence unit. The default is true, which enables
container managed JPA access to the persistence unit. This is typically
set to false for Spring applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.classtransformer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to false to disable class
transformers for the persistence unit. Set to true, to allow entity
class enhancing/rewriting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wildfly.jpa.default-unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to true to choose the default persistence
unit in an application. This is useful if you inject a persistence
context without specifying the unitName (@PersistenceContext
EntityManager em) but have multiple persistence units specified in your
persistence.xml.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wildfly.jpa.twophasebootstrap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistence providers (like Hibernate
ORM 4.3+ via EntityManagerFactoryBuilder), allow a two phase persistence
unit bootstrap, which improves JPA integration with CDI. Setting the
wildfly.jpa.twophasebootstrap hint to false, disables the two phase
bootstrap (for the persistence unit that contains the hint).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wildfly.jpa.allowdefaultdatasourceuse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to false to prevent
persistence unit from using the default data source. Defaults to true.
This is only important for persistence units that do not specify a
datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.deferdetach</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether transaction scoped
persistence context used in non-JTA transaction thread, will detach
loaded entities after each EntityManager invocation or when the
persistence context is closed (e.g. business method ends). Defaults to
false (entities are cleared after EntityManager invocation) and if set
to true, the detach is deferred until the context is closed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wildfly.jpa.hibernate.search.module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls which version of
Hibernate Search to include on classpath. Only makes sense when using
Hibernate as JPA implementation. The default is auto; other valid values
are none or a full module identifier to use an alternative version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss.as.jpa.scopedname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the qualified (application scoped)
persistence unit name to be used. By default, this is internally set to
the application name + persistence unit name. The
hibernate.cache.region_prefix will default to whatever you set
jboss.as.jpa.scopedname to. Make sure you set the
jboss.as.jpa.scopedname value to a value not already in use by other
applications deployed on the same application server instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wildfly.jpa.allowjoinedunsync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, allows an
SynchronizationType.UNSYNCHRONIZED persistence context that has been
joined to the active JTA transaction, to be propagated into a
SynchronizationType.SYNCHRONIZED persistence context. Otherwise, an
IllegalStateException exception would of been thrown that complains that
an unsychronized persistence context cannot be propagated into a
synchronized persistence context. Defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wildfly.jpa.skipmixedsynctypechecking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true to disable the
throwing of an IllegalStateException exception when propagating an
SynchronizationType.UNSYNCHRONIZED persistence context into a
SynchronizationType.SYNCHRONIZED persistence context. This is a
workaround intended to allow applications that used to incorrectly not
get IllegalStateException exception with extended persistence contexts,
to avoid the IllegalStateException, so they don&#8217;t have to change their
application right away (for compatibility purposes). This hint may be
deprecated in a future release. See WFLY-7108 for more details. Defaults
to false.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="determine-the-persistence-provider-module">17.23. Determine the persistence provider module</h3>
<div class="paragraph">
<p>As mentioned above, if the <strong>jboss.as.jpa.providerModule</strong> property is not
specified, the provider module name is determined by the <strong>provider</strong> name
specified in the persistence.xml. The mapping is:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Provider Name</th>
<th class="tableblock halign-left valign-top">Module name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.hibernate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.hibernate.ejb.HibernatePersistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.hibernate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.hibernate.ogm.jpa.HibernateOgmPersistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.hibernate.ogm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle.toplink.essentials.PersistenceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle.toplink</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle.toplink</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.persistence.jpa.PersistenceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.persistence</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.datanucleus.api.jpa.PersistenceProviderImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.datanucleus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.datanucleus.store.appengine.jpa.DatastorePersistenceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.datanucleus:appengine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.openjpa.persistence.PersistenceProviderImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.openjpa</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="binding-entitymanagerfactoryentitymanager-to-jndi">17.24. Binding EntityManagerFactory/EntityManager to JNDI</h3>
<div class="paragraph">
<p>By default WildFly does <strong>not</strong> bind the entity manager factory to JNDI.
However, you can explicitly configure this in the persistence.xml of
your application by setting the <code>jboss.entity.manager.factory.jndi.name</code>
<code>hint. The value of that property should be the JNDI name to which the entity manager factory should be bound.</code></p>
</div>
<div class="paragraph">
<p><code>You can also bind a container managed (transaction scoped) entity manager to JNDI as well, }}via hint</code>
<code>jboss.entity.manager.jndi.name</code>\{
<code>}{{. As a reminder, a transaction scoped entity manager (persistence context), acts as a proxy that always gets an unique underlying entity manager (at the persistence provider level).</code></p>
</div>
<div class="paragraph">
<p><code>Here&#8217;s an example:</code></p>
</div>
<div class="paragraph">
<p>persistence.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;persistence version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span> xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">
        http://java.sun.com/xml/ns/persistence
        http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span> &lt;persistence-unit name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myPU</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;!-- If you are running in a production environment, add a managed
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> data source, the example data source is just <span class="keyword">for</span> proofs of concept! --&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;properties&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;!-- Bind entity manager factory to JNDI at java:jboss/myEntityManagerFactory --&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.entity.manager.factory.jndi.name</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/myEntityManagerFactory</span><span class="delimiter">&quot;</span></span> /&gt;
         &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.entity.manager.jndi.name</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:/myEntityManager</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/properties&gt;
<span class="error"> </span><span class="error"> </span> &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateful</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleSFSB</span> {
  <span class="directive">public</span> <span class="type">void</span> createSomeEntityWithTransactionScopedEM(<span class="predefined-type">String</span> name) {
    <span class="predefined-type">Context</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
    javax.persistence.EntityManager entityManager = (javax.persistence.EntityManager) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:/myEntityManager</span><span class="delimiter">&quot;</span></span>);
    SomeEntity someEntity = <span class="keyword">new</span> SomeEntity();
   <span class="error"> </span>someEntity.setName(name);    entityManager.persist(name);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="community">17.25. Community</h3>
<div class="paragraph">
<p>Many thanks to the community, for reporting issues, solutions and code
changes. A number of people have been answering Wildfly forum questions
related to JPA usage. I would like to thank them for this, as well as
those reporting issues. For those of you that haven&#8217;t downloaded the AS
source code and started hacking patches together. I would like to
encourage you to start by reading
<a href="https://community.jboss.org/wiki/HackingOnWildFly">Hacking on WildFly</a>.
You will find that it easy very easy to find your way around the
WildFly/JPA/* source tree and make changes. Also, new for WildFly, is
the JipiJapa project that contains additional integration code that
makes EE JPA application deployments work better. The following list of
contributors should grow over time, I hope to see more of you listed
here.</p>
</div>
<div class="sect3">
<h4 id="people-who-have-contributed-to-the-wildfly-jpa-layer">17.25.1. People who have contributed to the WildFly JPA layer:</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://community.jboss.org/people/wolfc">Carlo de Wolf</a> (lead of the
EJB3 project)</p>
</li>
<li>
<p><strong><a href="http://in.relation.to/Bloggers/Steve">Steve Ebersole</a></strong> (lead of the
Hibernate ORM project)</p>
</li>
<li>
<p><strong><a href="https://community.jboss.org/people/swd847">Stuart Douglas</a></strong> (lead of
the Seam Persistence project, WildFly project team member/committer)</p>
</li>
<li>
<p><a href="https://community.jboss.org/people/jaikiran">Jaikiran Pai</a> (Active
member of JBoss forums and JBoss EJB3 project team member)</p>
</li>
<li>
<p><a href="http://relation.to/Bloggers/StrongLiu">Strong Liu</a> (leads the
productization effort of Hibernate in the EAP product)</p>
</li>
<li>
<p><strong><a href="https://community.jboss.org/people/smarlow">Scott Marlow</a></strong> (lead of
the WildFly container JPA sub-project)</p>
</li>
<li>
<p><strong><a href="https://community.jboss.org/people/alaisi">Antti Laisi</a></strong> <strong>(OpenJPA
integration changes)</strong></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/~galder.zamarreno">Galder
Zamarreño</a> (Infinispan 2lc documentation)</p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/~sannegrinovero">Sanne Grinovero</a>
(lead of the Hibernate Search project)</p>
</li>
<li>
<p><a href="https://issues.jboss.org/secure/ViewProfile.jspa?name=pferraro">Paul
Ferraro</a> (Infinispan 2lc integration)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jndi_reference">18. JNDI Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview">18.1. Overview</h3>
<div class="paragraph">
<p>WildFly offers several mechanisms to retrieve components by name. Every
WildFly instance has it&#8217;s own local JNDI namespace ( <code>java:</code>) which is
unique per JVM. The layout of this namespace is primarily governed by
the Java EE specification. Applications which share the same WildFly
instance can use this namespace to intercommunicate. In addition to
local JNDI, a variety of mechanisms exist to access remote components.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client JNDI - This is a mechanism by which remote components can be
accessed using the JNDI APIs, but <strong><em>without network round-trips</em></strong> . This
approach is the most efficient, and <strong><em>removes a potential single point
of failure</em></strong> . For this reason, it is highly recommended to use Client
JNDI over traditional remote JNDI access. However, to make this
possible, it does require that all names follow a strict layout, so user
customizations are not possible. Currently only access to remote EJBs is
supported via the <code>ejb:</code> namespace. Future revisions will likely add a
JMS client JNDI namespace.</p>
</li>
<li>
<p>Traditional Remote JNDI - This is a more familiar approach to EE
application developers, where the client performs a remote component
name lookup against a server, and a proxy/stub to the component is
serialized as part of the name lookup and returned to the client. The
client then invokes a method on the proxy which results in another
remote network call to the underlying service. In a nutshell,
traditional remote JNDI involves two calls to invoke an EE component,
whereas Client JNDI requires one. It does however allow for customized
names, and for a centralised directory for multiple application servers.
This centralized directory is, however, <em>a single point of failure</em>.</p>
</li>
<li>
<p>EE Application Client / Server-To-Server Delegation - This approach is
where local names are bound as an <em>alias</em> to a remote name using one of
the above mechanisms. This is useful in that it allows applications to
only ever reference standard portable Java EE names in both code and
deployment descriptors. It also allows for the application to be unaware
of network topology details/ This can even work with Java SE clients by
using the little known EE Application Client feature. This feature
allows you to run an extremely minimal AS server around your
application, so that you can take advantage of certain core services
such as naming and injection.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_jndi">19. Local JNDI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java EE platform specification defines the following JNDI contexts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java:comp</code> - The namespace is scoped to the current component (i.e.
EJB)</p>
</li>
<li>
<p><code>java:module</code> - Scoped to the current module</p>
</li>
<li>
<p><code>java:app</code> - Scoped to the current application</p>
</li>
<li>
<p><code>java:global</code> - Scoped to the application server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to the standard namespaces, WildFly also provides the
following two global namespaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java:jboss</p>
</li>
<li>
<p>java:/</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Only entries within the <code>java:jboss/exported</code> context are accessible
over remote JNDI.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For web deployments <code>java:comp</code> is aliased to <code>java:module</code>, so EJB&#8217;s
deployed in a war do not have their own comp namespace.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="binding-entries-to-jndi">19.1. Binding entries to JNDI</h3>
<div class="paragraph">
<p>There are several methods that can be used to bind entries into JNDI in
WildFly.</p>
</div>
<div class="sect3">
<h4 id="using-a-deployment-descriptor">19.1.1. Using a deployment descriptor</h4>
<div class="paragraph">
<p>For Java EE applications the recommended way is to use a
<a href="#src-557268">deployment descriptor</a> to create the binding. For
example the following <code>web.xml</code> binds the string <code>"Hello World"</code> to
<code>java:global/mystring</code> and the string <code>"Hello Module"</code> to
<code>java:comp/env/hello</code> (any non absolute JNDI name is relative to
<code>java:comp/env</code> context).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;web-app xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
         xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd</span><span class="delimiter">&quot;</span></span>
         version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;env-entry&gt;
        &lt;env-entry-name&gt;java:global/mystring&lt;/env-entry-name&gt;
        &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
        &lt;env-entry-value&gt;Hello World&lt;/env-entry-value&gt;
    &lt;/env-entry&gt;
    &lt;env-entry&gt;
        &lt;env-entry-name&gt;hello&lt;/env-entry-name&gt;
        &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
        &lt;env-entry-value&gt;Hello Module&lt;/env-entry-value&gt;
    &lt;/env-entry&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details, see the <a href="http://jcp.org/en/jsr/detail?id=342">Java EE
Platform Specification</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="programatically">19.1.2. Programatically</h4>
<div class="sect4">
<h5 id="java-ee-applications">Java EE Applications</h5>
<div class="paragraph">
<p>Standard Java EE applications may use the standard JNDI API, included
with Java SE, to bind entries in the global namespaces (the standard
<code>java:comp</code>, <code>java:module</code> and <code>java:app</code> namespaces are read-only, as
mandated by the Java EE Platform Specification).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="predefined-type">InitialContext</span> initialContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
  initialContext.bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/a</span><span class="delimiter">&quot;</span></span>, <span class="integer">100</span>);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
There is no need to unbind entries created programatically, since
WildFly tracks which bindings belong to a deployment, and the bindings
are automatically removed when the deployment is undeployed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="wildfly-modules-and-extensions">WildFly Modules and Extensions</h5>
<div class="paragraph">
<p>With respect to code in WildFly Modules/Extensions, which is executed
out of a Java EE application context, using the standard JNDI API may
result in a UnsupportedOperationException if the target namespace uses a
WritableServiceBasedNamingStore. To work around that, the bind()
invocation needs to be wrapped using WildFly proprietary APIs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="predefined-type">InitialContext</span> initialContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
  WritableServiceBasedNamingStore.pushOwner(serviceTarget);
  <span class="keyword">try</span> {
    initialContext.bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/a</span><span class="delimiter">&quot;</span></span>, <span class="integer">100</span>);
  } <span class="keyword">finally</span> {
    WritableServiceBasedNamingStore.popOwner();
  }</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The ServiceTarget removes the bind when uninstalled, thus using one out
of the module/extension domain usage should be avoided, unless entries
are removed using unbind().
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="naming-subsystem-configuration">19.1.3. Naming Subsystem Configuration</h4>
<div class="paragraph">
<p>It is also possible to bind to one of the three global namespaces using
configuration in the naming subsystem. This can be done by either
editing the <code>standalone.xml/domain.xml</code> file directly, or through the
management API.</p>
</div>
<div class="paragraph">
<p>Four different types of bindings are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simple - A primitive or java.net.URL entry (default is
<code>java.lang.String</code>).</p>
</li>
<li>
<p>Object Factory - This allows to to specify the
<code>javax.naming.spi.ObjectFactory</code> that is used to create the looked up
value.</p>
</li>
<li>
<p>External Context - An external context to federate, such as an LDAP
Directory Service</p>
</li>
<li>
<p>Lookup - The allows to create JNDI aliases, when this entry is looked
up it will lookup the target and return the result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example standalone.xml might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:naming:2.0</span><span class="delimiter">&quot;</span></span> &gt;
  &lt;bindings&gt;
    &lt;simple name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/a</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> type=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;simple name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/jbossDocs</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://docs.jboss.org</span><span class="delimiter">&quot;</span></span> type=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.net.URL</span><span class="delimiter">&quot;</span></span> /&gt;
<span class="error"> </span>   &lt;object-factory name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/b</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.acme.MyObjectFactory</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="class">external</span>-context name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/federation/ldap/example</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.naming.directory.InitialDirContext</span><span class="delimiter">&quot;</span></span> <span class="class">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;environment&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.factory.initial</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jndi.ldap.LdapCtxFactory</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.provider.url</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">ldap://ldap.example.com:389</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.security.authentication</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.security.principal</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">uid=admin,ou=system</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.security.credentials</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span> /&gt;
      &lt;/environment&gt;
    &lt;/external-context&gt;
    &lt;lookup name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/c</span><span class="delimiter">&quot;</span></span> lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/b</span><span class="delimiter">&quot;</span></span> /&gt;
 &lt;/bindings&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CLI may also be used to bind an entry. As an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=naming/binding=java<span class="error">\</span>:global<span class="error">\</span>/mybinding:add(binding-type=simple, type=<span class="type">long</span>, value=<span class="integer">1000</span>)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
WildFly&#8217;s Administrator Guide includes a section describing in detail
the Naming subsystem configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-entries-from-jndi">19.2. Retrieving entries from JNDI</h3>
<div class="sect3">
<h4 id="resource-injection">19.2.1. Resource Injection</h4>
<div class="paragraph">
<p>For Java EE applications the recommended way to lookup a JNDI entry is
to use <code>@Resource</code> injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/mystring</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> myString;
<span class="error"> </span>
  <span class="annotation">@Resource</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> hello;
<span class="error"> </span>
  <span class="annotation">@Resource</span>
  ManagedExecutorService executor;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>@Resource</code> is more than a JNDI lookup, it also binds an entry
in the component&#8217;s JNDI environment. The new bind JNDI name is defined
by <code>@Resource&#8217;s `name</code> attribute, which value, if unspecified, is the
Java type concatenated with <code>/</code> and the field&#8217;s name, for instance
<code>java.lang.String/myString</code>. More, similar to when using deployment
descriptors to bind JNDI entries. unless the name is an absolute JNDI
name, it is considered relative to <code>java:comp/env</code>. For instance, with
respect to the field named <code>myString</code> above, the <code>@Resource&#8217;s `lookup</code>
attribute instructs WildFly to lookup the value in
<code>java:global/mystring</code>, bind it in
<code>java:comp/env/java.lang.String/myString</code>, and then inject such value
into the field.</p>
</div>
<div class="paragraph">
<p>With respect to the field named <code>hello</code>, there is no <code>lookup</code> attribute
value defined, so the responsibility to provide the entry&#8217;s value is
delegated to the deployment descriptor. Considering that the deployment
descriptor was the <code>web.xml</code> previously shown, which defines an
environment entry with same <code>hello</code> name, then WildFly inject the valued
defined in the deployment descriptor into the field.</p>
</div>
<div class="paragraph">
<p>The <code>executor</code> field has no attributes specified, so the bind&#8217;s name
would default to
<code>java:comp/env/javax.enterprise.concurrent.ManagedExecutorService/executor</code>,
but there is no such entry in the deployment descriptor, and when that
happens it&#8217;s up to WildFly to provide a default value or null, depending
on the field&#8217;s Java type. In this particular case WildFly would inject
the default instance of a managed executor service, the value in
<code>java:comp/DefaultManagedExecutorService</code>, as mandated by the EE
Concurrency Utilities 1.0 Specification (JSR 236).</p>
</div>
</div>
<div class="sect3">
<h4 id="standard-java-se-jndi-api">19.2.2. Standard Java SE JNDI API</h4>
<div class="paragraph">
<p>Java EE applications may use, without any additional configuration
needed, the standard JNDI API to lookup an entry from JNDI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="predefined-type">String</span> myString = (<span class="predefined-type">String</span>) <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>().lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/mystring</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or simply</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="predefined-type">String</span> myString = <span class="predefined-type">InitialContext</span>.doLookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/mystring</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remote_jndi_access">20. Remote JNDI Access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly supports two different types of remote JNDI.</p>
</div>
<div class="sect2">
<h3 id="http-remoting">20.1. http-remoting:</h3>
<div class="paragraph">
<p>The <code>http-remoting:</code> protocol implementation is provided by JBoss Remote
Naming project, and uses http upgrade to lookup items from the servers
local JNDI. To use it, you must have the appropriate jars on the class
path, if you are maven user can be done simply by adding the following
to your <code>pom.xml</code> dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.wildfly<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>wildfly-ejb-client-bom<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>11.0.0.Final<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are not using maven a shaded jar that contains all required
classes<br>
can be found in the <code>bin/client</code> directory of WildFly&#8217;s distribution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Properties</span> env = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
env.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.naming.remote.client.InitialContextFactory</span><span class="delimiter">&quot;</span></span>);
env.put(<span class="predefined-type">Context</span>.PROVIDER_URL, <span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting://localhost:8080</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// the property below is required ONLY if there is no ejb client configuration loaded (such as a</span>
<span class="comment">// jboss-ejb-client.properties in the class path) and the context will be used to lookup EJBs</span>
env.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.naming.client.ejb.context</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
<span class="predefined-type">InitialContext</span> remoteContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(env);
RemoteCalculator ejb = (RemoteCalculator) remoteContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">wildfly-http-remoting-ejb/CalculatorBean!</span><span class="delimiter">&quot;</span></span>
                + RemoteCalculator.class.getName());</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The http-remoting client assumes JNDI names in remote lookups are
relative to java:jboss/exported namespace, a lookup of an absolute JNDI
name will fail.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ejb">20.2. ejb:</h3>
<div class="paragraph">
<p>The ejb: namespace implementation is provided by the jboss-ejb-client
library, and allows the lookup of EJB&#8217;s using their application name,
module name, ejb name and interface type. To use it, you must have the
appropriate jars on the class path, if you are maven user can be done
simply by adding the following to your <code>pom.xml</code> dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.wildfly<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>wildfly-ejb-client-bom<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>11.0.0.Final<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are not using maven a shaded jar that contains all required
classes<br>
can be found in the <code>bin/client</code> directory of WildFly&#8217;s distribution.</p>
</div>
<div class="paragraph">
<p>This is a client side JNDI implementation. Instead of looking up an EJB
on the server the lookup name contains enough information for the client
side library to generate a proxy with the EJB information. When you
invoke a method on this proxy it will use the current EJB client context
to perform the invocation. If the current context does not have a
connection to a server with the specified EJB deployed then an error
will occur. Using this protocol it is possible to look up EJB&#8217;s that do
not actually exist, and no error will be thrown until the proxy is
actually used. The exception to this is stateful session beans, which
need to connect to a server when they are created in order to create the
session bean instance on the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Properties</span> env = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
env.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">InitialContext</span> remoteContext = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(env);
MyRemoteInterface myRemote = (MyRemoteInterface) remoteContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:myapp/myejbjar/MyEjbName</span><span class="content">\!</span><span class="content">com.test.MyRemoteInterface</span><span class="delimiter">&quot;</span></span>);
MyStatefulRemoteInterface myStatefulRemote = (MyStatefulRemoteInterface) remoteContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:myapp/myejbjar/MyStatefulName</span><span class="content">\!</span><span class="content">comp.test.MyStatefulRemoteInterface?stateful</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first example is a lookup of a singleton, stateless or EJB 2.x home
interface. This lookup will not hit the server, instead a proxy will be
generated for the remote interface specified in the name. The second
example is for a stateful session bean, in this case the JNDI lookup
will hit the server, in order to tell the server to create the SFSB
session.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For more details on how the server connections are configured, including
the <strong>required</strong> jboss ejb client setup, please see
<a href="EJB_invocations_from_a_remote_client_using_JNDI.adoc">EJB invocations from a remote client using JNDI</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jax_rs_reference_guide">21. JAX-RS Reference Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page outlines the three options you have for deploying JAX-RS
applications in WildFly 11. These three methods are specified in the
JAX-RS 2.0 specification in section 2.3.2.</p>
</div>
<div class="sect2">
<h3 id="subclassing-javax.ws.rs.core.application-and-using-applicationpath">21.1. Subclassing javax.ws.rs.core.Application and using @ApplicationPath</h3>
<div class="paragraph">
<p>This is the easiest way and does not require any xml configuration.
Simply include a subclass of <code>javax.ws.rs.core.Application</code> in your
application, and annotate it with the path that you want your JAX-RS
classes to be available. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/mypath</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span> <span class="directive">extends</span> Application {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will make your JAX-RS resources available under <code>/</code>
<code>mywebappcontext</code> <code>/mypath</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that that the path is <code>/mypath</code> not <code>/mypath/*</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="subclassing-javax.ws.rs.core.application-and-using-web.xml">21.2. Subclassing javax.ws.rs.core.Application and using web.xml</h3>
<div class="paragraph">
<p>If you do not wish to use <code>@ApplicationPath</code> but still need to subclass
<code>Application</code> you can set up the JAX-RS mapping in web.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span> <span class="directive">extends</span> Application {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>com.acme.MyApplication<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;url-pattern&gt;</span>/hello/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will make your JAX-RS resources available under <code>/</code>
<code>mywebappcontext</code> <code>/hello</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can also use this approach to override an application path set with
the <code>@ApplicationPath</code> annotation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-web.xml">21.3. Using web.xml</h3>
<div class="paragraph">
<p>If you don&#8217;t wan&#8217;t to subclass <code>Application</code> you can set the JAX-RS
mapping in web.xml as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>javax.ws.rs.core.Application<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;url-pattern&gt;</span>/hello/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will make your JAX-RS resources available under <code>/</code>
<code>mywebappcontext</code> <code>/hello</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note that you only have to add the mapping, not the corresponding
servlet. The server is responsible for adding the corresponding servlet
automatically.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sharing_sessions_between_wars_in_an_ear">22. Sharing sessions between wars in an ear</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Undertow allows you to share sessions between wars in an ear, if it is
explicitly configured to do so. Note that if you use this feature your
applications may not be portable, as this is not a standard servlet
feature.</p>
</div>
<div class="paragraph">
<p>In order to enable this you must include a <code>shared-session-config</code>
element in the <code>jboss-all.xml</code> file in the META-INF directory of the
ear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jboss</span> <span class="attribute-name">umlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;shared-session-config</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:shared-session-config:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;session-config&gt;</span>
            <span class="tag">&lt;cookie-config&gt;</span>
                <span class="tag">&lt;path&gt;</span>/<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/cookie-config&gt;</span>
        <span class="tag">&lt;/session-config&gt;</span>
    <span class="tag">&lt;/shared-session-config&gt;</span>
<span class="tag">&lt;/jboss&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This element is used to configure the shared session manager that will
be used by all wars in the ear. For full details of all the options
provided by this file please see the schema at
<a href="https://github.com/wildfly/wildfly/blob/master/undertow/src/main/resources/schema/shared-session-config_1_0.xsd" class="bare">https://github.com/wildfly/wildfly/blob/master/undertow/src/main/resources/schema/shared-session-config_1_0.xsd</a>,
however in general it mimics the options that are available in
jboss-web.xml for configuring the session.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_webservices_reference_guide">23. Webservices reference guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Web Services functionalities of WildFly are provided by the JBossWS
project integration.</p>
</div>
<div class="paragraph">
<p>The latest project documentation is available
<a href="https://docs.jboss.org/author/display/JBWS">here</a>.</p>
</div>
<div class="paragraph">
<p>This section covers the most relevant topics for the JBossWS version
available on WildFly 11.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jax_ws_user_guide">24. JAX-WS User Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="http://www.jcp.org/en/jsr/detail?id=224">Java API for XML-Based Web
Services (JAX-WS / JSR-224)</a> defines the mapping between WSDL and Java
as well as the classes to be used for accessing webservices and
publishing them. JBossWS implements the latest JAX-WS specification,
hence users can reference it for any vendor agnostic webservice usage
need. Below is a brief overview of the most basic functionalities.</p>
</div>
<div class="sect2">
<h3 id="web-service-endpoints">24.1. Web Service Endpoints</h3>
<div class="paragraph">
<p>JAX-WS simplifies the development model for a web service endpoint a
great deal. In short, an endpoint implementation bean is annotated with
JAX-WS annotations and deployed to the server. The server automatically
generates and publishes the abstract contract (i.e. wsdl+schema) for
client consumption. All marshalling/unmarshalling is delegated to
<a href="http://www.jcp.org/en/jsr/summary?id=jaxb">JAXB</a>.</p>
</div>
<div class="sect3">
<h4 id="plain-old-java-object-pojo">24.1.1. Plain old Java Object (POJO)</h4>
<div class="paragraph">
<p>Let&#8217;s take a look at simple POJO endpoint implementation. All endpoint
associated metadata is provided via
<a href="http://www.jcp.org/en/jsr/summary?id=181">JSR-181</a> annotations</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@WebService
@SOAPBinding(style = SOAPBinding.Style.RPC)
public class JSEBean01
{
   @WebMethod
   public String echo(String input)
   {
      ...
   }
}</pre>
</div>
</div>
<div class="sect4">
<h5 id="the-endpoint-as-a-web-application">The endpoint as a web application</h5>
<div class="paragraph">
<p>A JAX-WS java service endpoint (JSE) is deployed as a web application.
Here is a sample <em>web.xml</em> descriptor:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;web-app ...&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;TestService&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.jboss.test.ws.jaxws.samples.jsr181pojo.JSEBean01&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;TestService&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packaging-the-endpoint">Packaging the endpoint</h5>
<div class="paragraph">
<p>A JSR-181 java service endpoint (JSE) is packaged as a web application
in a <em>war</em> file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;war warfile="${build.dir}/libs/jbossws-samples-jsr181pojo.war" webxml="${build.resources.dir}/samples/jsr181pojo/WEB-INF/web.xml"&gt;
  &lt;classes dir="${build.dir}/classes"&gt;
    &lt;include name="org/jboss/test/ws/samples/jsr181pojo/JSEBean01.class"/&gt;
  &lt;/classes&gt;
&lt;/war&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note, only the endpoint implementation bean and web.xml are required.</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing-the-generated-wsdl">Accessing the generated WSDL</h5>
<div class="paragraph">
<p>A successfully deployed service endpoint will show up in the WildFly
managent console. You can get the deployed endpoint wsdl address there
too.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note, it is also possible to generate the abstract contract off line
using JBossWS tools. For details of that please see Bottom-Up (Java to
WSDL).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ejb3-stateless-session-bean-slsb">24.1.2. EJB3 Stateless Session Bean (SLSB)</h4>
<div class="paragraph">
<p>The JAX-WS programming model supports the same set of annotations on
EJB3 stateless session beans as on POJO endpoints.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Stateless
@Remote(EJB3RemoteInterface.class)
@RemoteBinding(jndiBinding = "/ejb3/EJB3EndpointInterface")

@WebService
@SOAPBinding(style = SOAPBinding.Style.RPC)
public class EJB3Bean01 implements EJB3RemoteInterface
{
   @WebMethod
   public String echo(String input)
   {
      ...
   }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Above you see an EJB-3.0 stateless session bean that exposes one method
both on the remote interface and as an endpoint operation.</p>
</div>
<div class="sect4">
<h5 id="packaging-the-endpoint-1">Packaging the endpoint</h5>
<div class="paragraph">
<p>A JSR-181 EJB service endpoint is packaged as an ordinary ejb
deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;jar jarfile="${build.dir}/libs/jbossws-samples-jsr181ejb.jar"&gt;
  &lt;fileset dir="${build.dir}/classes"&gt;
    &lt;include name="org/jboss/test/ws/samples/jsr181ejb/EJB3Bean01.class"/&gt;
    &lt;include name="org/jboss/test/ws/samples/jsr181ejb/EJB3RemoteInterface.class"/&gt;
  &lt;/fileset&gt;
&lt;/jar&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing-the-generated-wsdl-1">Accessing the generated WSDL</h5>
<div class="paragraph">
<p>A successfully deployed service endpoint will show up in the WildFly
managent console. You can get the deployed endpoint wsdl address there
too.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note, it is also possible to generate the abstract contract off line
using JBossWS tools. For details of that please see Bottom-Up (Java to
WSDL).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="endpoint-provider">24.1.3. Endpoint Provider</h4>
<div class="paragraph">
<p>JAX-WS services typically implement a native Java service endpoint
interface (SEI), perhaps mapped from a WSDL port type, either directly
or via the use of annotations.</p>
</div>
<div class="paragraph">
<p>Java SEIs provide a high level Java-centric abstraction that hides the
details of converting between Java objects and their XML representations
for use in XML-based messages. However, in some cases it is desirable
for services to be able to operate at the XML message level. The
Provider interface offers an alternative to SEIs and may be implemented
by services wishing to work at the XML message level.</p>
</div>
<div class="paragraph">
<p>A Provider based service instances invoke method is called for each
message received for the service.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@WebServiceProvider(wsdlLocation = "WEB-INF/wsdl/Provider.wsdl")
@ServiceMode(value = Service.Mode.PAYLOAD)
public class ProviderBeanPayload implements Provider&lt;Source&gt;
{
   public Source invoke(Source req)
   {
      // Access the entire request PAYLOAD and return the response PAYLOAD
   }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note, <code>Service.Mode.PAYLOAD</code> is the default and does not have to be
declared explicitly. You can also use <code>Service.Mode.MESSAGE</code> to access
the entire SOAP message (i.e. with <code>MESSAGE</code> the Provider can also see
SOAP Headers)</p>
</div>
<div class="paragraph">
<p>The abstract contract for a provider endpoint cannot be
derived/generated automatically. Therefore it is necessary to specify
the <em>wsdlLocation</em> with the <code>@</code> <code>WebServiceProvider</code> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="web-service-clients">24.2. Web Service Clients</h3>
<div class="sect3">
<h4 id="service">24.2.1. Service</h4>
<div class="paragraph">
<p><code>Service</code> is an abstraction that represents a WSDL service. A WSDL
service is a collection of related ports, each of which consists of a
port type bound to a particular protocol and available at a particular
endpoint address.</p>
</div>
<div class="paragraph">
<p>For most clients, you will start with a set of stubs generated from the
WSDL. One of these will be the service, and you will create objects of
that class in order to work with the service (see "static case" below).</p>
</div>
<div class="sect4">
<h5 id="service-usage">Service Usage</h5>
<div class="sect5">
<h6 id="static-case">Static case</h6>
<div class="paragraph">
<p>Most clients will start with a WSDL file, and generate some stubs using
JBossWS tools like <em>wsconsume</em>. This usually gives a mass of files, one
of which is the top of the tree. This is the service implementation
class.</p>
</div>
<div class="paragraph">
<p>The generated implementation class can be recognised as it will have two
public constructors, one with no arguments and one with two arguments,
representing the wsdl location (a <code>java.net.URL</code>) and the service name
(a <code>javax.xml.namespace.QName</code>) respectively.</p>
</div>
<div class="paragraph">
<p>Usually you will use the no-argument constructor. In this case the WSDL
location and service name are those found in the WSDL. These are set
implicitly from the <code>@WebServiceClient</code> annotation that decorates the
generated class.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the generated constructors from the
generated class:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// Generated Service Class

@WebServiceClient(name="StockQuoteService", targetNamespace="http://example.com/stocks", wsdlLocation="http://example.com/stocks.wsdl")
public class StockQuoteService extends javax.xml.ws.Service
{
   public StockQuoteService()
   {
      super(new URL("http://example.com/stocks.wsdl"), new QName("http://example.com/stocks", "StockQuoteService"));
   }

   public StockQuoteService(String wsdlLocation, QName serviceName)
   {
      super(wsdlLocation, serviceName);
   }

   ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>Section Dynamic Proxy explains how to obtain a port from the service and
how to invoke an operation on the port. If you need to work with the XML
payload directly or with the XML representation of the entire SOAP
message, have a look at <code>Dispatch</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="dynamic-case">Dynamic case</h6>
<div class="paragraph">
<p>In the dynamic case, when nothing is generated, a web service client
uses <code>Service.create</code> to create Service instances, the following code
illustrates this process.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>URL wsdlLocation = new URL("http://example.org/my.wsdl");
QName serviceName = new QName("http://example.org/sample", "MyService");
Service service = Service.create(wsdlLocation, serviceName);</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="handler-resolver">Handler Resolver</h5>
<div class="paragraph">
<p>JAX-WS provides a flexible plug-in framework for message processing
modules, known as handlers, that may be used to extend the capabilities
of a JAX-WS runtime system. Handler Framework describes the handler
framework in detail. A Service instance provides access to a
<code>HandlerResolver</code> via a pair of <code>getHandlerResolver</code> /
<code>setHandlerResolver</code> methods that may be used to configure a set of
handlers on a per-service, per-port or per-protocol binding basis.</p>
</div>
<div class="paragraph">
<p>When a Service instance is used to create a proxy or a Dispatch instance
then the handler resolver currently registered with the service is used
to create the required handler chain. Subsequent changes to the handler
resolver configured for a Service instance do not affect the handlers on
previously created proxies, or Dispatch instances.</p>
</div>
</div>
<div class="sect4">
<h5 id="executor">Executor</h5>
<div class="paragraph">
<p>Service instances can be configured with a
<code>java.util.concurrent.Executor</code>. The executor will then be used to
invoke any asynchronous callbacks requested by the application. The
<code>setExecutor</code> and <code>getExecutor</code> methods of <code>Service</code> can be used to
modify and retrieve the executor configured for a service.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-proxy">24.2.2. Dynamic Proxy</h4>
<div class="paragraph">
<p>You can create an instance of a client proxy using one of <code>getPort</code>
methods on the <code>Service</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/**
 * The getPort method returns a proxy. A service client
 * uses this proxy to invoke operations on the target
 * service endpoint. The &lt;code&gt;serviceEndpointInterface&lt;/code&gt;
 * specifies the service endpoint interface that is supported by
 * the created dynamic proxy instance.
 **/
public &lt;T&gt; T getPort(QName portName, Class&lt;T&gt; serviceEndpointInterface)
{
   ...
}

/**
 * The getPort method returns a proxy. The parameter
 * &lt;code&gt;serviceEndpointInterface&lt;/code&gt; specifies the service
 * endpoint interface that is supported by the returned proxy.
 * In the implementation of this method, the JAX-WS
 * runtime system takes the responsibility of selecting a protocol
 * binding (and a port) and configuring the proxy accordingly.
 * The returned proxy should not be reconfigured by the client.
 *
 **/
public &lt;T&gt; T getPort(Class&lt;T&gt; serviceEndpointInterface)
{
   ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>The service endpoint interface (SEI) is usually generated using tools.
For details see Top Down (WSDL to Java)</p>
</div>
<div class="paragraph">
<p>A generated static Service usually also offers typed methods to get
ports. These methods also return dynamic proxies that implement the SEI.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@WebServiceClient(name = "TestEndpointService", targetNamespace = "http://org.jboss.ws/wsref",
   wsdlLocation = "http://localhost.localdomain:8080/jaxws-samples-webserviceref?wsdl")

public class TestEndpointService extends Service
{
    ...

    public TestEndpointService(URL wsdlLocation, QName serviceName) {
        super(wsdlLocation, serviceName);
    }

    @WebEndpoint(name = "TestEndpointPort")
    public TestEndpoint getTestEndpointPort()
    {
        return (TestEndpoint)super.getPort(TESTENDPOINTPORT, TestEndpoint.class);
    }
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webserviceref">24.2.3. WebServiceRef</h4>
<div class="paragraph">
<p>The <code>@WebServiceRef</code> annotation is used to declare a reference to a Web
service. It follows the resource pattern exemplified by the
<code>javax.annotation.Resource</code> annotation in
<a href="http://www.jcp.org/en/jsr/summary?id=250">JSR-250</a>.</p>
</div>
<div class="paragraph">
<p>There are two uses to the WebServiceRef annotation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To define a reference whose type is a generated service class. In
this case, the type and value element will both refer to the generated
service class type. Moreover, if the reference type can be inferred by
the field/method declaration the annotation is applied to, the type and
value elements MAY have the default value (Object.class, that is). If
the type cannot be inferred, then at least the type element MUST be
present with a non-default value.</p>
</li>
<li>
<p>To define a reference whose type is a SEI. In this case, the type
element MAY be present with its default value if the type of the
reference can be inferred from the annotated field/method declaration,
but the value element MUST always be present and refer to a generated
service class type (a subtype of javax.xml.ws.Service). The wsdlLocation
element, if present, overrides theWSDL location information specified in
the WebService annotation of the referenced generated service class.</p>
<div class="literalblock">
<div class="content">
<pre>public class EJB3Client implements EJB3Remote
{
   @WebServiceRef
   public TestEndpointService service4;

   @WebServiceRef
   public TestEndpoint port3;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="dispatch">24.2.4. Dispatch</h4>
<div class="paragraph">
<p>XMLWeb Services use XML messages for communication between services and
service clients. The higher level JAX-WS APIs are designed to hide the
details of converting between Java method invocations and the
corresponding XML messages, but in some cases operating at the XML
message level is desirable. The Dispatch interface provides support for
this mode of interaction.</p>
</div>
<div class="paragraph">
<p><code>Dispatch</code> supports two usage modes, identified by the constants
<code>javax.xml.ws.Service.Mode.MESSAGE</code> and
<code>javax.xml.ws.Service.Mode.PAYLOAD</code> respectively:</p>
</div>
<div class="paragraph">
<p><strong><em>Message</em></strong> In this mode, client applications work directly with
protocol-specific message structures. E.g., when used with a SOAP
protocol binding, a client application would work directly with a SOAP
message.</p>
</div>
<div class="paragraph">
<p><strong><em>Message Payload</em></strong> In this mode, client applications work with the
payload of messages rather than the messages themselves. E.g., when used
with a SOAP protocol binding, a client application would work with the
contents of the SOAP Body rather than the SOAP message as a whole.</p>
</div>
<div class="paragraph">
<p>Dispatch is a low level API that requires clients to construct messages
or message payloads as XML and requires an intimate knowledge of the
desired message or payload structure. Dispatch is a generic class that
supports input and output of messages or message payloads of any type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Service service = Service.create(wsdlURL, serviceName);
Dispatch dispatch = service.createDispatch(portName, StreamSource.class, Mode.PAYLOAD);

String payload = "&lt;ns1:ping xmlns:ns1='http://oneway.samples.jaxws.ws.test.jboss.org/'/&gt;";
dispatch.invokeOneWay(new StreamSource(new StringReader(payload)));

payload = "&lt;ns1:feedback xmlns:ns1='http://oneway.samples.jaxws.ws.test.jboss.org/'/&gt;";
Source retObj = (Source)dispatch.invoke(new StreamSource(new StringReader(payload)));</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="asynchronous-invocations">24.2.5. Asynchronous Invocations</h4>
<div class="paragraph">
<p>The <code>BindingProvider</code> interface represents a component that provides a
protocol binding for use by clients, it is implemented by proxies and is
extended by the <code>Dispatch</code> interface.</p>
</div>
<div class="paragraph">
<p><code>BindingProvider</code> instances may provide asynchronous operation
capabilities. When used, asynchronous operation invocations are
decoupled from the <code>BindingProvider</code> instance at invocation time such
that the response context is not updated when the operation completes.
Instead a separate response context is made available using the
<code>Response</code> interface.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void testInvokeAsync() throws Exception
{
   URL wsdlURL = new URL("http://" + getServerHost() + ":8080/jaxws-samples-asynchronous?wsdl");
   QName serviceName = new QName(targetNS, "TestEndpointService");
   Service service = Service.create(wsdlURL, serviceName);
   TestEndpoint port = service.getPort(TestEndpoint.class);
   Response response = port.echoAsync("Async");
   // access future
   String retStr = (String) response.get();
   assertEquals("Async", retStr);
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="oneway-invocations">24.2.6. Oneway Invocations</h4>
<div class="paragraph">
<p><code>@Oneway</code> indicates that the given web method has only an input message
and no output. Typically, a oneway method returns the thread of control
to the calling application prior to executing the actual business
method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@WebService (name="PingEndpoint")
@SOAPBinding(style = SOAPBinding.Style.RPC)
public class PingEndpointImpl
{
   private static String feedback;

   @WebMethod
   @Oneway
   publicvoid ping()
   {
      log.info("ping");
      feedback = "ok";
   }

   @WebMethod
   public String feedback()
   {
      log.info("feedback");
      return feedback;
   }
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="timeout-configuration">24.2.7. Timeout Configuration</h4>
<div class="paragraph">
<p>There are two properties to configure the http connection timeout and
client receive time out:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void testConfigureTimeout() throws Exception
{
   //Set timeout until a connection is established
   ((BindingProvider)port).getRequestContext().put("javax.xml.ws.client.connectionTimeout", "6000");

   //Set timeout until the response is received
   ((BindingProvider) port).getRequestContext().put("javax.xml.ws.client.receiveTimeout", "1000");

   port.echo("testTimeout");
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-api">24.3. Common API</h3>
<div class="paragraph">
<p>This sections describes concepts that apply equally to Web Service
Endpoints and Web Service Clients.</p>
</div>
<div class="sect3">
<h4 id="handler-framework">24.3.1. Handler Framework</h4>
<div class="paragraph">
<p>The handler framework is implemented by a JAX-WS protocol binding in
both client and server side runtimes. Proxies, and Dispatch instances,
known collectively as binding providers, each use protocol bindings to
bind their abstract functionality to specific protocols.</p>
</div>
<div class="paragraph">
<p>Client and server-side handlers are organized into an ordered list known
as a handler chain. The handlers within a handler chain are invoked each
time a message is sent or received. Inbound messages are processed by
handlers prior to binding provider processing. Outbound messages are
processed by handlers after any binding provider processing.</p>
</div>
<div class="paragraph">
<p>Handlers are invoked with a message context that provides methods to
access and modify inbound and outbound messages and to manage a set of
properties. Message context properties may be used to facilitate
communication between individual handlers and between handlers and
client and service implementations. Different types of handlers are
invoked with different types of message context.</p>
</div>
<div class="sect4">
<h5 id="logical-handler">Logical Handler</h5>
<div class="paragraph">
<p>Handlers that only operate on message context properties and message
payloads. Logical handlers are protocol agnostic and are unable to
affect protocol specific parts of a message. Logical handlers are
handlers that implement <code>javax.xml.ws.handler.LogicalHandler</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="protocol-handler">Protocol Handler</h5>
<div class="paragraph">
<p>Handlers that operate on message context properties and protocol
specific messages. Protocol handlers are specific to a particular
protocol and may access and change protocol specific aspects of a
message. Protocol handlers are handlers that implement any interface
derived from <code>javax.xml.ws.handler.Handler</code> except
<code>javax.xml.ws.handler.LogicalHandler</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="service-endpoint-handlers">Service endpoint handlers</h5>
<div class="paragraph">
<p>On the service endpoint, handlers are defined using the <code>@HandlerChain</code>
annotation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@WebService
@HandlerChain(file = "jaxws-server-source-handlers.xml")
public class SOAPEndpointSourceImpl
{
   ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>The location of the handler chain file supports 2 formats</p>
</div>
<div class="paragraph">
<p>\1. An absolute java.net.URL in externalForm. (ex:
<a href="http://myhandlers.foo.com/handlerfile1.xml" class="bare">http://myhandlers.foo.com/handlerfile1.xml</a>)</p>
</div>
<div class="paragraph">
<p>\2. A relative path from the source file or class file. (ex:
bar/handlerfile1.xml)</p>
</div>
</div>
<div class="sect4">
<h5 id="service-client-handlers">Service client handlers</h5>
<div class="paragraph">
<p>On the client side, handler can be configured using the <code>@HandlerChain</code>
annotation on the SEI or dynamically using the API.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Service service = Service.create(wsdlURL, serviceName);
Endpoint port = (Endpoint)service.getPort(Endpoint.class);

BindingProvider bindingProvider = (BindingProvider)port;
List&lt;Handler&gt; handlerChain = new ArrayList&lt;Handler&gt;();
handlerChain.add(new LogHandler());
handlerChain.add(new AuthorizationHandler());
handlerChain.add(new RoutingHandler());
bindingProvider.getBinding().setHandlerChain(handlerChain); // important!</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="message-context">24.3.2. Message Context</h4>
<div class="paragraph">
<p><code>MessageContext</code> is the super interface for all JAX-WS message contexts.
It extends <code>Map&lt;String,Object&gt;</code> with additional methods and constants to
manage a set of properties that enable handlers in a handler chain to
share processing related state. For example, a handler may use the put
method to insert a property in the message context that one or more
other handlers in the handler chain may subsequently obtain via the get
method.</p>
</div>
<div class="paragraph">
<p>Properties are scoped as either APPLICATION or HANDLER. All properties
are available to all handlers for an instance of an MEP on a particular
endpoint. E.g., if a logical handler puts a property in the message
context, that property will also be available to any protocol handlers
in the chain during the execution of an MEP instance. APPLICATION scoped
properties are also made available to client applications (see section
4.2.1) and service endpoint implementations. The defaultscope for a
property is HANDLER.</p>
</div>
<div class="sect4">
<h5 id="logical-message-context">Logical Message Context</h5>
<div class="paragraph">
<p>Logical Handlers are passed a message context of type
<code>LogicalMessageContext</code> when invoked. <code>LogicalMessageContext</code> extends
<code>MessageContext</code> with methods to obtain and modify the message payload,
it does not provide access to the protocol specific aspects of amessage.
A protocol binding defines what component of a message are available via
a logical message context. The SOAP binding defines that a logical
handler deployed in a SOAP binding can access the contents of the SOAP
body but not the SOAP headers whereas the XML/HTTP binding defines that
a logical handler can access the entire XML payload of a message.</p>
</div>
</div>
<div class="sect4">
<h5 id="soap-message-context">SOAP Message Context</h5>
<div class="paragraph">
<p>SOAP handlers are passed a <code>SOAPMessageContext</code> when invoked.
<code>SOAPMessageContext</code> extends <code>MessageContext</code> with methods to obtain and
modify the SOAP message payload.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fault-handling">24.3.3. Fault Handling</h4>
<div class="paragraph">
<p>An implementation may thow a <code>SOAPFaultException</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void throwSoapFaultException()
{
   SOAPFactory factory = SOAPFactory.newInstance();
   SOAPFault fault = factory.createFault("this is a fault string!", new QName("http://foo", "FooCode"));
   fault.setFaultActor("mr.actor");
   fault.addDetail().addChildElement("test");
   thrownew SOAPFaultException(fault);
}</pre>
</div>
</div>
<div class="paragraph">
<p>or an application specific user exception</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void throwApplicationException() throws UserException
{
   thrownew UserException("validation", 123, "Some validation error");
}</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In case of the latter, JBossWS generates the required fault wrapper
beans at runtime if they are not part of the deployment
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jax-ws-annotations">24.4. JAX-WS Annotations</h3>
<div class="paragraph">
<p>For details, see <a href="http://www.jcp.org/en/jsr/detail?id=224">JSR-224 - Java
API for XML-Based Web Services (JAX-WS) 2.2</a></p>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.servicemode">24.4.1. javax.xml.ws.ServiceMode</h4>
<div class="paragraph">
<p>The <code>ServiceMode</code> annotation is used to specify the mode for a provider
class, i.e. whether a provider wants to have access to protocol message
payloads (e.g. a SOAP body) or the entire protocol messages (e.g. a SOAP
envelope).</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.webfault">24.4.2. javax.xml.ws.WebFault</h4>
<div class="paragraph">
<p>The <code>WebFault</code> annotation is used when mapping WSDL faults to Java
exceptions, see section 2.5. It is used to capture the name of the fault
element used when marshalling the JAXB type generated from the global
element referenced by the WSDL fault message. It can also be used to
customize the mapping of service specific exceptions to WSDL faults.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.requestwrapper">24.4.3. javax.xml.ws.RequestWrapper</h4>
<div class="paragraph">
<p>The <code>RequestWrapper</code> annotation is applied to the methods of an SEI. It
is used to capture the JAXB generated request wrapper bean and the
element name and namespace for marshalling / unmarshalling the bean. The
default value of localName element is the operationName as defined in
<code>WebMethod</code> annotation and the default value for the targetNamespace
element is the target namespace of the SEI.When starting from Java, this
annotation is used to resolve overloading conflicts in document literal
mode. Only the className element is required in this case.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.responsewrapper">24.4.4. javax.xml.ws.ResponseWrapper</h4>
<div class="paragraph">
<p>The <code>ResponseWrapper</code> annotation is applied to the methods of an SEI. It
is used to capture the JAXB generated response wrapper bean and the
element name and namespace for marshalling / unmarshalling the bean. The
default value of the localName element is the operationName as defined
in the <code>WebMethod</code> appended with "Response" and the default value of the
targetNamespace element is the target namespace of the SEI. When
starting from Java, this annotation is used to resolve overloading
conflicts in document literal mode. Only the className element is
required in this case.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.webserviceclient">24.4.5. javax.xml.ws.WebServiceClient</h4>
<div class="paragraph">
<p>The <code>WebServiceClient</code> annotation is specified on a generated service
class (see 2.7). It is used to associate a class with a specific Web
service, identify by a URL to a WSDL document and the qualified name of
a wsdl:service element.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.webendpoint">24.4.6. javax.xml.ws.WebEndpoint</h4>
<div class="paragraph">
<p>The <code>WebEndpoint</code> annotation is specified on the getPortName() methods
of a generated service class (see 2.7). It is used to associate a get
method with a specific wsdl:port, identified by its local name (a
NCName).</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.webserviceprovider">24.4.7. javax.xml.ws.WebServiceProvider</h4>
<div class="paragraph">
<p>The <code>WebServiceProvider</code> annotation is specified on classes that
implement a strongly typed <code>javax.xml.ws.Provider</code>. It is used to
declare that a class that satisfies the requirements for a provider (see
5.1) does indeed define a Web service endpoint, much like the
<code>WebService</code> annotation does for SEI-based endpoints.</p>
</div>
<div class="paragraph">
<p>The <code>WebServiceProvider</code> and <code>WebService</code> annotations are mutually
exclusive.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.bindingtype">24.4.8. javax.xml.ws.BindingType</h4>
<div class="paragraph">
<p>The <code>BindingType</code> annotation is applied to an endpoint implementation
class. It specifies the binding to use when publishing an endpoint of
this type.</p>
</div>
<div class="paragraph">
<p>The default binding for an endpoint is the SOAP 1.1/HTTP one.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.webserviceref">24.4.9. javax.xml.ws.WebServiceRef</h4>
<div class="paragraph">
<p>The <code>WebServiceRef</code> annotation is used to declare a reference to a Web
service. It follows the resource pattern exemplified by the
<code>javax.annotation.Resource</code> annotation in JSR-250 [JBWS:32]. The
<code>WebServiceRef</code> annotation is required to be honored when running on the
Java EE 5 platform, where it is subject to the common resource injection
rules described by the platform specification [JBWS:33].</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.webservicerefs">24.4.10. javax.xml.ws.WebServiceRefs</h4>
<div class="paragraph">
<p>The <code>WebServiceRefs</code> annotation is used to declare multiple references
to Web services on a single class. It is necessary to work around the
limition against specifying repeated annotations of the same type on any
given class, which prevents listing multiple <code>javax.ws.WebServiceRef</code>
annotations one after the other. This annotation follows the resource
pattern exemplified by the <code>javax.annotation.Resources</code> annotation in
JSR-250.</p>
</div>
<div class="paragraph">
<p>Since no name and type can be inferred in this case, each
<code>WebServiceRef</code> annotation inside a WebServiceRefs MUST contain name and
type elements with non-default values. The <code>WebServiceRef</code> annotation is
required to be honored when running on the Java EE 5 platform, where it
is subject to the common resource injection rules described by the
platform specification.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.action">24.4.11. javax.xml.ws.Action</h4>
<div class="paragraph">
<p>The <code>Action</code> annotation is applied to the methods of a SEI. It used to
generate the wsa:Action on wsdl:input and wsdl:output of each
wsdl:operation mapped from the annotated methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.xml.ws.faultaction">24.4.12. javax.xml.ws.FaultAction</h4>
<div class="paragraph">
<p>The <code>FaultAction</code> annotation is used within the <code>Action</code> annotation to
generate the wsa:Action element on the wsdl:fault element of each
wsdl:operation mapped from the annotated methods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jsr-181-annotations">24.5. JSR-181 Annotations</h3>
<div class="paragraph">
<p>JSR-181 defines the syntax and semantics of Java Web Service (JWS)
metadata and default values.</p>
</div>
<div class="paragraph">
<p>For details, see <a href="http://www.jcp.org/en/jsr/detail?id=181">JSR 181 - Web
Services Metadata for the Java Platform</a>.</p>
</div>
<div class="sect3">
<h4 id="javax.jws.webservice">24.5.1. javax.jws.WebService</h4>
<div class="paragraph">
<p>Marks a Java class as implementing a Web Service, or a Java interface as
defining a Web Service interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.jws.webmethod">24.5.2. javax.jws.WebMethod</h4>
<div class="paragraph">
<p>Customizes a method that is exposed as a Web Service operation.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.jws.oneway">24.5.3. javax.jws.OneWay</h4>
<div class="paragraph">
<p>Indicates that the given web method has only an input message and no
output. Typically, a oneway method returns the thread of control to the
calling application prior to executing the actual business method. A
JSR-181 processor is REQUIRED to report an error if an operation marked
<code>@Oneway</code> has a return value, declares any checked exceptions or has any
INOUT or OUT parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.jws.webparam">24.5.4. javax.jws.WebParam</h4>
<div class="paragraph">
<p>Customizes the mapping of an individual parameter to a Web Service
message part and XML element.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.jws.webresult">24.5.5. javax.jws.WebResult</h4>
<div class="paragraph">
<p>Customizes the mapping of the return value to a WSDL part and XML
element.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.jws.soapbinding">24.5.6. javax.jws.SOAPBinding</h4>
<div class="paragraph">
<p>Specifies the mapping of the Web Service onto the SOAP message protocol.</p>
</div>
<div class="paragraph">
<p>The <code>SOAPBinding</code> annotation has a target of <code>TYPE</code> and <code>METHOD</code>. The
annotation may be placed on a method if and only if the
<code>SOAPBinding.style</code> is <code>DOCUMENT</code>. Implementations MUST report an error
if the <code>SOAPBinding</code> annotation is placed on a method with a
<code>SOAPBinding.style</code> of <code>RPC</code>. Methods that do not have a <code>SOAPBinding</code>
annotation accept the <code>SOAPBinding</code> behavior defined on the type.</p>
</div>
</div>
<div class="sect3">
<h4 id="javax.jws.handlerchain">24.5.7. javax.jws.HandlerChain</h4>
<div class="paragraph">
<p>The <code>@HandlerChain</code> annotation associates the Web Service with an
externally defined handler chain.</p>
</div>
<div class="paragraph">
<p>It is an error to combine this annotation with the
<code>@SOAPMessageHandlers</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@HandlerChain</code> annotation MAY be present on the endpoint interface
and service implementation bean. The service implementation bean&#8217;s
<code>@HandlerChain</code> is used if <code>@HandlerChain</code> is present on both.</p>
</div>
<div class="paragraph">
<p>The <code>@HandlerChain</code> annotation MAY be specified on the type only. The
annotation target includes <code>METHOD</code> and <code>FIELD</code> for use by JAX-WS-2.x.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jax_ws_tools">25. JAX-WS Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JAX-WS tools provided by JBossWS can be used in a variety of ways.
First we will look at server-side development strategies, and then
proceed to the client.</p>
</div>
<div class="sect2">
<h3 id="server-side">25.1. Server side</h3>
<div class="paragraph">
<p>When developing a Web Service Endpoint (the server-side) you have the
option of starting from Java ( <em>bottom-up development</em>), or from the
abstact contract (WSDL) that defines your service ( <em>top-down
development</em>). If this is a new service (no existing contract), the
bottom-up approach is the fastest route; you only need to add a few
annotations to your classes to get a service up and running. However, if
you are developing a service with an already defined contract, it is far
simpler to use the top-down approach, since the provided tool will
generate the annotated code for you.</p>
</div>
<div class="paragraph">
<p>Bottom-up use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exposing an already existing EJB3 bean as a Web Service</p>
</li>
<li>
<p>Providing a new service, and you want the contract to be generated for
you</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Top-down use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replacing the implementation of an existing Web Service, and you can&#8217;t
break compatibility with older clients</p>
</li>
<li>
<p>Exposing a service that conforms to a contract specified by a third
party (e.g. a vender that calls you back using an already defined
protocol).</p>
</li>
<li>
<p>Creating a service that adheres to the XML Schema and WSDL you
developed by hand up front</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following JAX-WS command line tools are included in JBossWS:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wsprovide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates JAX-WS portable artifacts, and provides the
abstract contract. Used for bottom-up development.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wsconsume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumes the abstract contract (WSDL and Schema files), and
produces artifacts for both a server and client. Used for top-down and
client development</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="bottom-up-using-wsprovide">25.1.1. Bottom-Up (Using wsprovide)</h4>
<div class="paragraph">
<p>The bottom-up strategy involves developing the Java code for your
service, and then annotating it using JAX-WS annotations. These
annotations can be used to customize the contract that is generated for
your service. For example, you can change the operation name to map to
anything you like. However, all of the annotations have sensible
defaults, so only the @WebService annotation is required.</p>
</div>
<div class="paragraph">
<p>This can be as simple as creating a single class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">echo</span>;
<span class="error"> </span>
<span class="annotation">@javax</span>.jws.WebService
<span class="directive">public</span> <span class="type">class</span> <span class="class">Echo</span>
{
   <span class="directive">public</span> <span class="predefined-type">String</span> echo(<span class="predefined-type">String</span> input)
   {
      <span class="keyword">return</span> input;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A JSE or EJB3 deployment can be built using this class, and it is the
only Java code needed to deploy on JBossWS. The WSDL, and all other Java
artifacts called "wrapper classes" will be generated for you at deploy
time. This actually goes beyond the JAX-WS specification, which requires
that wrapper classes be generated using an offline tool. The reason for
this requirement is purely a vender implementation problem, and since we
do not believe in burdening a developer with a bunch of additional
steps, we generate these as well. However, if you want your deployment
to be portable to other application servers, you will unfortunately need
to use a tool and add the generated classes to your deployment.</p>
</div>
<div class="paragraph">
<p>This is the primary purpose of the <em>wsprovide</em> tool, to generate
portable JAX-WS artifacts. Additionally, it can be used to "provide" the
abstract contract (WSDL file) for your service. This can be obtained by
invoking <em>wsprovide</em> using the "-w" option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ javac -d . -classpath jboss-jaxws.jar Echo.java
$ wsprovide -w echo.Echo
Generating WSDL:
EchoService.wsdl
Writing Classes:
echo/jaxws/Echo.class
echo/jaxws/EchoResponse.class</pre>
</div>
</div>
<div class="paragraph">
<p>Inspecting the WSDL reveals a service called <em>EchoService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;service name=<span class="string"><span class="delimiter">'</span><span class="content">EchoService</span><span class="delimiter">'</span></span>&gt;
 &lt;port binding=<span class="string"><span class="delimiter">'</span><span class="content">tns:EchoBinding</span><span class="delimiter">'</span></span> name=<span class="string"><span class="delimiter">'</span><span class="content">EchoPort</span><span class="delimiter">'</span></span>&gt;
  &lt;soap:address location=<span class="string"><span class="delimiter">'</span><span class="content">REPLACE_WITH_ACTUAL_URL</span><span class="delimiter">'</span></span>/&gt;
 &lt;/port&gt;
&lt;/service&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, this service defines one operation, " <em>echo</em>":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;portType name=<span class="string"><span class="delimiter">'</span><span class="content">Echo</span><span class="delimiter">'</span></span>&gt;
 &lt;operation name=<span class="string"><span class="delimiter">'</span><span class="content">echo</span><span class="delimiter">'</span></span> parameterOrder=<span class="string"><span class="delimiter">'</span><span class="content">echo</span><span class="delimiter">'</span></span>&gt;
  &lt;input message=<span class="string"><span class="delimiter">'</span><span class="content">tns:Echo_echo</span><span class="delimiter">'</span></span>/&gt;
  &lt;output message=<span class="string"><span class="delimiter">'</span><span class="content">tns:Echo_echoResponse</span><span class="delimiter">'</span></span>/&gt;
 &lt;/operation&gt;
&lt;/portType&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember that when deploying on JBossWS you do not need to run this
tool. You only need it for generating portable artifacts and/or the
abstract contract for your service.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s create a POJO endpoint for deployment on WildFly. A simple
<em>web.xml</em> needs to be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;web-app xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/j2ee</span><span class="delimiter">&quot;</span></span>
  xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd</span><span class="delimiter">&quot;</span></span>
  version=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.4</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span>
  &lt;servlet&gt;
    &lt;servlet-name&gt;Echo&lt;/servlet-name&gt;
    &lt;servlet-<span class="type">class</span>&gt;<span class="class">echo</span>.Echo&lt;/servlet-<span class="type">class</span>&gt;
  &lt;/<span class="class">servlet</span>&gt;
<span class="error"> </span>
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Echo&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Echo&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>web.xml</em> and the single class can now be used to create a war:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mkdir -p WEB-INF/classes
$ cp -rp echo WEB-INF/classes/
$ cp web.xml WEB-INF
$ jar cvf echo.war WEB-INF
added manifest
adding: WEB-INF/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/classes/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/classes/echo/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/classes/echo/Echo.class(in = 340) (out= 247)(deflated 27%)
adding: WEB-INF/web.xml(in = 576) (out= 271)(deflated 52%)</pre>
</div>
</div>
<div class="paragraph">
<p>The war can then be deployed to the JBoss Application Server.The war can
then be deployed to the JBoss Application Server; this will internally
invoke wsprovide, which will generate the WSDL. If deployment was
successful, and you are using the default settings, it should be
available in the server management console.</p>
</div>
<div class="paragraph">
<p>For a portable JAX-WS deployment, the wrapper classes generated earlier
could be added to the deployment.</p>
</div>
</div>
<div class="sect3">
<h4 id="top-down-using-wsconsume">25.1.2. Top-Down (Using wsconsume)</h4>
<div class="paragraph">
<p>The top-down development strategy begins with the abstract contract for
the service, which includes the WSDL file and zero or more schema files.
The <em>wsconsume</em> tool is then used to consume this contract, and produce
annotated Java classes (and optionally sources) that define it.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
wsconsume may have problems with symlinks on Unix systems
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the WSDL file from the bottom-up example, a new Java
implementation that adheres to this service can be generated. The "-k"
option is passed to <em>wsconsume</em> to preserve the Java source files that
are generated, instead of providing just classes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ wsconsume -k EchoService.wsdl
echo/Echo.java
echo/EchoResponse.java
echo/EchoService.java
echo/Echo_Type.java
echo/ObjectFactory.java
echo/package-info.java
echo/Echo.java
echo/EchoResponse.java
echo/EchoService.java
echo/Echo_Type.java
echo/ObjectFactory.java
echo/package-info.java</pre>
</div>
</div>
<div class="paragraph">
<p>The following table shows the purpose of each generated file:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Echo.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Endpoint Interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Echo_Type.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapper bean for request message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EchoResponse.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapper bean for response message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjectFactory.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAXB XML Registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">package-info.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holder for JAXB package annotations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EchoService.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used only by JAX-WS clients</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examining the Service Endpoint Interface reveals annotations that are
more explicit than in the class written by hand in the bottom-up
example, however, these evaluate to the same contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebService</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Echo</span><span class="delimiter">&quot;</span></span>, targetNamespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://echo/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">Echo</span> {
    <span class="annotation">@WebMethod</span>
    <span class="annotation">@WebResult</span>(targetNamespace = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@RequestWrapper</span>(localName = <span class="string"><span class="delimiter">&quot;</span><span class="content">echo</span><span class="delimiter">&quot;</span></span>, targetNamespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://echo/</span><span class="delimiter">&quot;</span></span>, className = <span class="string"><span class="delimiter">&quot;</span><span class="content">echo.Echo_Type</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@ResponseWrapper</span>(localName = <span class="string"><span class="delimiter">&quot;</span><span class="content">echoResponse</span><span class="delimiter">&quot;</span></span>, targetNamespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://echo/</span><span class="delimiter">&quot;</span></span>, className = <span class="string"><span class="delimiter">&quot;</span><span class="content">echo.EchoResponse</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> echo(
        <span class="annotation">@WebParam</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">arg0</span><span class="delimiter">&quot;</span></span>, targetNamespace = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
        <span class="predefined-type">String</span> arg0);
<span class="error"> </span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only missing piece (besides for packaging) is the implementation
class, which can now be written, using the above interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">echo</span>;
<span class="error"> </span>
<span class="annotation">@javax</span>.jws.WebService(endpointInterface=<span class="string"><span class="delimiter">&quot;</span><span class="content">echo.Echo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoImpl</span> <span class="directive">implements</span> Echo
{
   <span class="directive">public</span> <span class="predefined-type">String</span> echo(<span class="predefined-type">String</span> arg0)
   {
      <span class="keyword">return</span> arg0;
  <span class="error"> </span>}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-side">25.2. Client Side</h3>
<div class="paragraph">
<p>Before going to detail on the client-side it is important to understand
the decoupling concept that is central to Web Services. Web Services are
not the best fit for internal RPC, even though they can be used in this
way. There are much better technologies for this (CORBA, and RMI for
example). Web Services were designed specifically for interoperable
coarse-grained correspondence. There is no expectation or guarantee that
any party participating in a Web Service interaction will be at any
particular location, running on any particular OS, or written in any
particular programming language. So because of this, it is important to
clearly separate client and server implementations. The only thing they
should have in common is the abstract contract definition. If, for
whatever reason, your software does not adhere to this principal, then
you should not be using Web Services. For the above reasons, the
<strong><em>recommended methodology for developing a client is</em></strong> to follow <strong><em>the
top-down approach</em></strong> , even if the client is running on the same server.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s repeat the process of the top-down section, although using the
deployed WSDL, instead of the one generated offline by <em>wsprovide</em>. The
reason why we do this is just to get the right value for soap:address.
This value must be computed at deploy time, since it is based on
container configuration specifics. You could of course edit the WSDL
file yourself, although you need to ensure that the path is correct.</p>
</div>
<div class="paragraph">
<p>Offline version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;service name=<span class="string"><span class="delimiter">'</span><span class="content">EchoService</span><span class="delimiter">'</span></span>&gt;
  &lt;port binding=<span class="string"><span class="delimiter">'</span><span class="content">tns:EchoBinding</span><span class="delimiter">'</span></span> name=<span class="string"><span class="delimiter">'</span><span class="content">EchoPort</span><span class="delimiter">'</span></span>&gt;
   &lt;soap:address location=<span class="string"><span class="delimiter">'</span><span class="content">REPLACE_WITH_ACTUAL_URL</span><span class="delimiter">'</span></span>/&gt;
  &lt;/port&gt;
&lt;/service&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Online version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;service name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EchoService</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;port binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:EchoBinding</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EchoPort</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;soap:address location=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost.localdomain:8080/echo/Echo</span><span class="delimiter">&quot;</span></span>/&gt;
  &lt;/port&gt;
&lt;/service&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the online deployed version with <em>wsconsume</em>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ wsconsume -k http://localhost:8080/echo/Echo?wsdl
echo/Echo.java
echo/EchoResponse.java
echo/EchoService.java
echo/Echo_Type.java
echo/ObjectFactory.java
echo/package-info.java
echo/Echo.java
echo/EchoResponse.java
echo/EchoService.java
echo/Echo_Type.java
echo/ObjectFactory.java
echo/package-info.java</pre>
</div>
</div>
<div class="paragraph">
<p>The one class that was not examined in the top-down section, was
<code>EchoService.java</code>. Notice how it stores the location the WSDL was
obtained from.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServiceClient</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">EchoService</span><span class="delimiter">&quot;</span></span>, targetNamespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://echo/</span><span class="delimiter">&quot;</span></span>, wsdlLocation = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/echo/Echo?wsdl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoService</span> <span class="directive">extends</span> Service
{
    <span class="directive">private</span> <span class="directive">final</span> <span class="directive">static</span> <span class="predefined-type">URL</span> ECHOSERVICE_WSDL_LOCATION;
<span class="error"> </span>
    <span class="directive">static</span> {
        <span class="predefined-type">URL</span> url = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span>
        {
          <span class="error"> </span>url = <span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/echo/Echo?wsdl</span><span class="delimiter">&quot;</span></span>);
       <span class="error"> </span>}
        <span class="keyword">catch</span> (<span class="exception">MalformedURLException</span> e)
        {
          <span class="error"> </span>e.printStackTrace();
        }
        ECHOSERVICE_WSDL_LOCATION = url;
    }
<span class="error"> </span>
    <span class="directive">public</span> EchoService(<span class="predefined-type">URL</span> wsdlLocation, <span class="predefined-type">QName</span> serviceName)
    {
        <span class="error"> </span><span class="local-variable">super</span>(wsdlLocation, serviceName);
    }
<span class="error"> </span>
    <span class="directive">public</span> EchoService()
    {
         <span class="local-variable">super</span>(ECHOSERVICE_WSDL_LOCATION, <span class="keyword">new</span> <span class="predefined-type">QName</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://echo/</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EchoService</span><span class="delimiter">&quot;</span></span>));
    }
<span class="error"> </span>
    <span class="annotation">@WebEndpoint</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">EchoPort</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Echo getEchoPort()
    {
        <span class="error"> </span><span class="keyword">return</span> (Echo)<span class="local-variable">super</span>.getPort(<span class="keyword">new</span> <span class="predefined-type">QName</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://echo/</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EchoPort</span><span class="delimiter">&quot;</span></span>), Echo.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this generated class extends the main client entry point
in JAX-WS, <code>javax.xml.ws.Service</code>. While you can use <code>Service</code> directly,
this is far simpler since it provides the configuration info for you.
The only method we really care about is the <code>getEchoPort()</code> method,
which returns an instance of our Service Endpoint Interface. Any WS
operation can then be called by just invoking a method on the returned
interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It&#8217;s not recommended to refer to a remote WSDL URL in a production
application. This causes network I/O every time you instantiate the
Service Object. Instead, use the tool on a saved local copy, or use the
URL version of the constructor to provide a new WSDL location.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All that is left to do, is write and compile the client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">echo</span>.*;
<span class="error"> </span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoClient</span>
{
   <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span> args<span class="type">[]</span>)
   {
      <span class="keyword">if</span> (args.length != <span class="integer">1</span>)
      {
         <span class="error"> </span><span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">usage: EchoClient &lt;message&gt;</span><span class="delimiter">&quot;</span></span>);
         <span class="error"> </span><span class="predefined-type">System</span>.exit(<span class="integer">1</span>);
     <span class="error"> </span>}
<span class="error"> </span>
      EchoService service = <span class="keyword">new</span> EchoService();
      Echo echo = service.getEchoPort();
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server said: </span><span class="delimiter">&quot;</span></span> + echo.echo(args0));
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is easy to change the endpoint address of your operation at runtime,
setting the <em>ENDPOINT_ADDRESS_PROPERTY</em> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EchoService service = <span class="keyword">new</span> EchoService();
      Echo echo = service.getEchoPort();
<span class="error"> </span>
      <span class="comment">/* Set NEW Endpoint Location */</span>
      <span class="predefined-type">String</span> endpointURL = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://NEW_ENDPOINT_URL</span><span class="delimiter">&quot;</span></span>;
      BindingProvider bp = (BindingProvider)echo;
      bp.getRequestContext().put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY, endpointURL);
<span class="error"> </span>
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server said: </span><span class="delimiter">&quot;</span></span> + echo.echo(args0));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_user_guide">26. Advanced User Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="logging">26.1. Logging</h3>
<div class="paragraph">
<p>Logging of inbound and outbound messages is a common need. Different
approaches are available for achieving that:</p>
</div>
<div class="sect3">
<h4 id="jax-ws-handler-approach">26.1.1. JAX-WS Handler approach</h4>
<div class="paragraph">
<p>A portable way of performing logging is writing a simple JAX-WS handler
dumping the messages that are passed in it; the handler can be added to
the desired client/endpoints (programmatically / using <code>@HandlerChain</code>
JAX-WS annotation).</p>
</div>
<div class="paragraph">
<p>The <a href="#src-557254">predefined client and endpoint configuration</a>
mechanism allows user to add the logging handler to any client/endpoint
or to some of them only (in which case the <code>@EndpointConfig</code> annotation
/ JBossWS API is required though).</p>
</div>
</div>
<div class="sect3">
<h4 id="apache-cxf-approach">26.1.2. Apache CXF approach</h4>
<div class="paragraph">
<p>Apache CXF also comes with logging interceptors that can be easily used
to log messages to the console or configured client/server log files.
Those interceptors can be added to client, endpoint and buses in
multiple ways:</p>
</div>
<div class="sect4">
<h5 id="system-property">System property</h5>
<div class="paragraph">
<p>Setting the <code>org.apache.cxf.logging.enabled</code> system property to true
causes the logging interceptors to be added to any <code>Bus</code> instance being
created on the JVM.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
On WildFly, the system property is easily set by adding what follows to
the standalone / domain server configuration just after the extensions
section:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;system-properties&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.cxf.logging.enabled</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/system-properties&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="manual-interceptor-addition-and-logging-feature">Manual interceptor addition and logging feature</h5>
<div class="paragraph">
<p>Logging interceptors can be selectively added to endpoints using the
Apache CXF annotations <code>@org.apache.cxf.interceptor.InInterceptors</code> and
<code>@org.apache.cxf.interceptor.OutInterceptors</code>. The same is achieved on
client side by programmatically adding new instances of the logging
interceptors to the client or the bus.</p>
</div>
<div class="paragraph">
<p>Alternatively, Apache CXF also comes with a
<code>org.apache.cxf.feature.LoggingFeature</code> that can be used on clients and
endpoints (either annotating them with
<code>@org.apache.cxf.feature.Features</code> or directly with
<code>@org.apache.cxf.annotations.Logging</code>).</p>
</div>
<div class="paragraph">
<p>Please refer to the
<a href="http://cxf.apache.org/docs/debugging-and-logging.html#DebuggingandLogging-LoggingMessages">Apache
CXF documentation</a> for more details.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ws--support">26.2. WS-* support</h3>
<div class="paragraph">
<p>JBossWS includes most of the WS-* specification functionalities through
the integration with Apache CXF. In particular, the whole WS-Security
Policy framework is fully supported, enabling full contract driven
configuration of complex features like WS-Security.</p>
</div>
<div class="paragraph">
<p>In details information available further down in this documentation
book.</p>
</div>
</div>
<div class="sect2">
<h3 id="address-rewrite">26.3. Address rewrite</h3>
<div class="paragraph">
<p>JBossWS allows users to configure the <em>soap:address</em> attribute in the
wsdl contract of deployed services.</p>
</div>
<div class="sect3">
<h4 id="server-configuration-options">26.3.1. Server configuration options</h4>
<div class="paragraph">
<p>The configuration options are part of the
<a href="https://docs.jboss.org/author/display/WFLY8/Web+services+configuration">webservices
subsystem section</a> of the application server domain model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:webservices:1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:javaee</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:jaxwsconfig</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:jbossws-jaxws-config:4.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;wsdl-host&gt;</span>localhost<span class="tag">&lt;/wsdl-host&gt;</span>
  <span class="tag">&lt;modify-wsdl-address&gt;</span>true<span class="tag">&lt;/modify-wsdl-address&gt;</span>
<span class="comment">&lt;!--
  &lt;wsdl-port&gt;8080&lt;/wsdl-port&gt;
  &lt;wsdl-secure-port&gt;8443&lt;/wsdl-secure-port&gt;
--&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the content of <em>&lt;soap:address&gt;</em> in the wsdl is a valid URL, JBossWS
will not rewrite it unless <em>modify-wsdl-address</em> is true. If the content
of <em>&lt;soap:address&gt;</em> is not a valid URL instead, JBossWS will always
rewrite it using the attribute values given below. Please note that the
variable <em>$\{jboss.bind.address}</em> can be used to set the address which
the application is bound to at each startup.</p>
</div>
<div class="paragraph">
<p>The wsdl-secure-port and wsdl-port attributes are used to explicitly
define the ports to be used for rewriting the SOAP address. If these
attributes are not set, the ports will be identified by querying the
list of installed connectors. If multiple connectors are found the port
of the first connector is used.</p>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-rewrite">26.3.2. Dynamic rewrite</h4>
<div class="paragraph">
<p>When the application server is bound to multiple addresses or
non-trivial real-world network architectures cause request for different
external addresses to hit the same endpoint, a static rewrite of the
soap:address may not be enough. JBossWS allows for both the soap:address
in the wsdl and the wsdl address in the console to be rewritten with the
host use in the client request. This way, users always get the right
wsdl address assuming they&#8217;re connecting to an instance having the
endpoint they&#8217;re looking for. To trigger this behaviour, the
<em>jbossws.undefined.host</em> value has to be specified for the <em>wsdl-host</em>
element.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;wsdl-host&gt;jbossws.undefined.host&lt;/wsdl-host&gt;
&lt;modify-wsdl-address&gt;true&lt;/modify-wsdl-address&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Of course, when a confidential transport address is required, the
addresses are always rewritten using https protocol and the port
currently configured for the https/ssl connector.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-through-deployment-descriptor">26.4. Configuration through deployment descriptor</h3>
<div class="paragraph">
<p>The <code>jboss-webservices.xml</code> deployment descriptor can be used to provide
additional configuration for a given deployment. The expected location
of it is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/jboss-webservices.xml</code> for EJB webservice deployments</p>
</li>
<li>
<p><code>WEB-INF/jboss-webservices.xml</code> for POJO webservice deployments and
EJB webservice endpoints bundled in <code>war</code> archives</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The structure of file is the following (schemas are available
<a href="http://anonsvn.jboss.org/repos/jbossws/spi/trunk/src/main/resources/schema/">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;webservices&gt;
  &lt;context-root/&gt;?
  &lt;config-name/&gt;?
  &lt;config-file/&gt;?
  &lt;property&gt;*
    &lt;name/&gt;
    &lt;value/&gt;
  &lt;/property&gt;
  &lt;port-component&gt;*
    &lt;ejb-name/&gt;
    &lt;port-component-name/&gt;
    &lt;port-component-uri/&gt;?
    &lt;auth-method/&gt;?
    &lt;transport-guarantee/&gt;?
    &lt;secure-wsdl-access/&gt;?
  &lt;/port-component&gt;
  &lt;webservice-description&gt;*
    &lt;webservice-description-name/&gt;
    &lt;wsdl-publish-location/&gt;?
  &lt;/webservice-description&gt;
&lt;/webservices&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="context-root-element">26.4.1. context-root element</h4>
<div class="paragraph">
<p>Element <code>&lt;context-root&gt;</code> can be used to customize context root of
webservices deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;webservices&gt;
  &lt;context-root&gt;foo&lt;/context-root&gt;
&lt;/webservices&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config-name-and-config-file-elements">26.4.2. config-name and config-file elements</h4>
<div class="paragraph">
<p>Elements <code>&lt;config-name&gt;</code> and <code>&lt;config-file&gt;</code> can be used to associate
any endpoint provided in the deployment with a given
<a href="#src-557254">endpoint configuration</a>. Endpoint configuration are
either specified in the referenced config file or in the WildFly domain
model (webservices subsystem). For further details on the endpoint
configurations and their management in the domain model, please see the
related
<a href="https://docs.jboss.org/author/display/WFLY8/Web+services+configuration">documentation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;webservices&gt;
  &lt;config-name&gt;Standard WSSecurity Endpoint&lt;/config-name&gt;
  &lt;config-file&gt;META-INF/custom.xml&lt;/config-file&gt;
&lt;/webservices&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-element">26.4.3. property element</h4>
<div class="paragraph">
<p><code>&lt;property&gt;</code> elements can be used to setup simple property values to
configure the ws stack behavior. Allowed property names and values are
mentioned in the guide under related topics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;property&gt;
  &lt;name&gt;prop.name&lt;/name&gt;
  &lt;value&gt;prop.value&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="port-component-element">26.4.4. port-component element</h4>
<div class="paragraph">
<p>Element <code>&lt;port-component&gt;</code> can be used to customize EJB endpoint target
URI or to configure security related properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;webservices&gt;
  &lt;port-component&gt;
    &lt;ejb-name&gt;TestService&lt;/ejb-name&gt;
    &lt;port-component-name&gt;TestServicePort&lt;/port-component-name&gt;
    &lt;port-component-uri&gt;<span class="comment">/*&lt;/port-component-uri&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
    &lt;secure-wsdl-access&gt;true&lt;/secure-wsdl-access&gt;
  &lt;/port-component&gt;
&lt;/webservices&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webservice-description-element">26.4.5. webservice-description element</h4>
<div class="paragraph">
<p>Element <code>&lt;webservice-description&gt;</code> can be used to customize (override)
webservice WSDL publish location.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;webservices&gt;
  &lt;webservice-description&gt;
    &lt;webservice-description-name&gt;TestService&lt;/webservice-description-name&gt;
    &lt;wsdl-publish-location&gt;file:<span class="comment">///bar/foo.wsdl&lt;/wsdl-publish-location&gt;</span>
  &lt;/webservice-description&gt;
&lt;/webservices&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-validation-of-soap-messages">26.5. Schema validation of SOAP messages</h3>
<div class="paragraph">
<p>Apache CXF has a feature for validating incoming and outgoing SOAP
messages on both client and server side. The validation is performed
against the relevant schema in the endpoint wsdl contract (server side)
or the wsdl contract used for building up the service proxy (client
side).</p>
</div>
<div class="paragraph">
<p>Schema validation can be turned on programmatically on client side</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">((BindingProvider)proxy).getRequestContext().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">schema-validation-enabled</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using the <code>@org.apache.cxf.annotations.SchemaValidation</code> annotation
on server side</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.jws.WebService</span>;
<span class="keyword">import</span> <span class="include">org.apache.cxf.annotations.SchemaValidation</span>;
<span class="error"> </span>
<span class="annotation">@WebService</span>(...)
<span class="annotation">@SchemaValidation</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ValidatingHelloImpl</span> <span class="directive">implements</span> Hello {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, any endpoint and client running in-container can be
associated to a JBossWS <a href="#src-557254">predefined configuration</a>
having the <code>schema-validation-enabled</code> property set to <code>true</code> in the
referenced config file.</p>
</div>
<div class="paragraph">
<p>Finally, JBossWS also allows for server-wide (default) setup of schema
validation by using the <em>Standard-Endpoint-Config</em> and
<em>Standard-Client-Config</em> special configurations (which apply to any
client / endpoint unless a different configuration is specified for
them)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:webservices:1.2</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;endpoint-config name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Standard-Endpoint-Config</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">schema-validation-enabled</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/endpoint-config&gt;
    ...
    &lt;client-config name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Standard-Client-Config</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">schema-validation-enabled</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/client-config&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jaxb-introductions">26.6. JAXB Introductions</h3>
<div class="paragraph">
<p>As Kohsuke Kawaguchi wrote on
<a href="http://weblogs.java.net/blog/kohsuke/archive/2007/07/binding_3rd_par.html">his
blog</a>, one common complaint from the JAXB users is the lack of support
for binding 3rd party classes. The scenario is this: you are trying to
annotate your classes with JAXB annotations to make it XML bindable, but
some of the classes are coming from libraries and JDK, and thus you
cannot put necessary JAXB annotations on it.</p>
</div>
<div class="paragraph">
<p>To solve this JAXB has been designed to provide hooks for programmatic
introduction of annotations to the runtime.</p>
</div>
<div class="paragraph">
<p>This is currently leveraged by the JBoss JAXB Introductions project,
using which users can define annotations in XML and make JAXB see those
as if those were in the class files (perhaps coming from 3rd party
libraries).</p>
</div>
<div class="paragraph">
<p>Take a look at the <a href="http://community.jboss.org/docs/DOC-10075">JAXB
Introductions page</a> on the wiki and at the examples in the sources.</p>
</div>
</div>
<div class="sect2">
<h3 id="wsdl-system-properties-expansion">26.7. WSDL system properties expansion</h3>
<div class="paragraph">
<p>See <a href="#src-557254">Published WSDL customization</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jboss_modules_and_ws_applications">27. JBoss Modules and WS applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JBoss Web Services functionalities are provided by a given set of
modules / libraries installed on WildFly, which are organized into JBoss
Modules modules. In particular the <em>org.jboss.as.webservices.*</em> and
<em>org.jboss.ws.*</em> modules belong to the JBossWS - WildFly integration.
Users should not need to change anything in them.</p>
</div>
<div class="paragraph">
<p>While users are of course allowed to provide their own modules for their
custom needs, below is a brief collection of suggestions and hints
around modules and webservices development on WildFly.</p>
</div>
<div class="sect2">
<h3 id="setting-module-dependencies">27.1. Setting module dependencies</h3>
<div class="paragraph">
<p>On WildFly the user deployment classloader does not have any visibility
over JBoss internals; so for instance you can&#8217;t <em>directly</em> use JBossWS
<em>implementation</em> classes unless you explicitly set a dependency to the
corresponding module. As a consequence, users need to declare the module
dependencies they want to be added to their deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The JBoss Web Services APIs are always available by default whenever the
webservices subsystem is available on AS7. So users just use them, no
need for explicit dependencies declaration for those modules.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="using-manifest.mf">27.1.1. Using MANIFEST.MF</h4>
<div class="paragraph">
<p>The convenient method for configuring deployment dependencies is adding
them into the MANIFEST.MF file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client services export,foo.bar</pre>
</div>
</div>
<div class="paragraph">
<p>Here above <em>org.jboss.ws.cxf.jbossws-cxf-client</em> and <em>foo.bar</em> are the
modules you want to set dependencies to; <em>services</em> tells the modules
framework that you want to also import <em>META-INF/services/..</em>
declarations from the dependency, while <em>export</em> exports the classes
from the module to any other module that might be depending on the
module implicitly created for your deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using annotations on your endpoints / handlers such as the Apache
CXF ones (@InInterceptor, @GZIP, &#8230;&#8203;) remember to add the proper module
dependency in your manifest. Otherwise your annotations are not picked
up and added to the annotation index by WildFly, resulting in them being
completely and silently ignored.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="using-jaxb">Using JAXB</h5>
<div class="paragraph">
<p>In order for successfully directly using JAXB contexts, etc. in your
client or endpoint running in-container, you need to properly setup a
JAXB implementation; that is performed setting the following dependency:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Dependencies: com.sun.xml.bind services export</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-apache-cxf">Using Apache CXF</h5>
<div class="paragraph">
<p>In order for using Apache CXF APIs and implementation classes you need
to add a dependency to the <em>org.apache.cxf</em> (API) module and / or
<em>org.apache.cxf.impl</em> (implementation) module:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Dependencies: org.apache.cxf services</pre>
</div>
</div>
<div class="paragraph">
<p>However, please note that would not come with any JBossWS-CXF
customizations nor additional extensions. For this reason, and generally
speaking for simplifying user configuration, a client side aggregation
module is available with all the WS dependencies users might need.</p>
</div>
</div>
<div class="sect4">
<h5 id="client-side-ws-aggregation-module">Client side WS aggregation module</h5>
<div class="paragraph">
<p>Whenever you simply want to use all the JBoss Web Services
feature/functionalities, you can set a dependency to the convenient
client module.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Dependencies: org.jboss.ws.cxf.jbossws-cxf-client services</pre>
</div>
</div>
<div class="paragraph">
<p>Please note the <em>services</em> option above: that&#8217;s strictly required in
order for you to get the JBossWS-CXF version of classes that are
retrieved using the <em>Service API</em>, the <code>org.apache.cxf.Bus</code> for
instance.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Be careful as issues because of misconfiguration here can be quite hard
to track down, because the Apache CXF behaviour would be sensibly
different.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <em>services</em> option is almost always needed when declaring
dependencies on <em>org.jboss.ws.cxf.jbossws-cxf-client</em> and
<em>org.apache.cxf</em> modules. The reason for this is in it affecting the
loading of classes through the <em>Service API</em>, which is what is used to
wire most of the JBossWS components as well as all Apache CXF Bus
extensions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="annotation-scanning">Annotation scanning</h5>
<div class="paragraph">
<p>The application server uses an annotation index for detecting JAX-WS
endpoints in user deployments. When declaring WS endpoints whose class
belongs to a different module (for instance referring that in the
<code>web.xml</code> descriptor), be sure to have an <code>annotations</code> type dependency
in place. Without that, your endpoints would simply be ignored as they
won&#8217;t appear as annotated classes to the webservices subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Dependencies: org.foo annotations</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-jboss-deployment-descriptor.xml">27.1.2. Using jboss-deployment-descriptor.xml</h4>
<div class="paragraph">
<p>In some circumstances, the convenient approach of setting module
dependencies in MANIFEST.MF might not work. An example is the need for
importing/exporting specific resources from a given module dependency.
Users should hence add a jboss-deployment-structure.xml descriptor to
their deployment and set module dependencies in it.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scoped_ejb_client_contexts">28. Scoped EJB client contexts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview">28.1. Overview</h3>
<div class="paragraph">
<p>WildFly 11 introduced the EJB client API for managing remote EJB
invocations. The EJB client API works off EJBClientContext(s). An
EJBClientContext can potentially contain any number of EJB receivers. An
EJB receiver is a component which knows how to communicate with a server
which is capable of handling the EJB invocation. Typically EJB remote
applications can be classified into:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A remote client which runs as a standalone Java application</p>
</li>
<li>
<p>A remote client which runs within another WildFly 11 instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the kind of remote client, from an EJB client API point of
view, there can potentially be more than 1 EJBClientContext(s) within a
JVM.</p>
</div>
<div class="paragraph">
<p>In case of standalone applications, typically a single EJBClientContext
(backed by any number of EJB receivers) exists. However this isn&#8217;t
mandatory. Certain standalone applications can potentially have more
than one EJBClientContext(s) and a EJB client context selector will be
responsible for returning the appropriate context.</p>
</div>
<div class="paragraph">
<p>In case of remote clients which run within another WildFly 11 instance,
each deployed application will have a corresponding EJB client context.
Whenever that application invokes on another EJB, the corresponding EJB
client context will be used for finding the right EJB receiver and
letting it handle the invocation.</p>
</div>
</div>
<div class="sect2">
<h3 id="potential-shortcomings-of-a-single-ejb-client-context">28.2. Potential shortcomings of a single EJB client context</h3>
<div class="paragraph">
<p>In the Overview section we briefly looked at the different types of
remote clients. Let&#8217;s focus on the standalone remote clients (the ones
that don&#8217;t run within another WildFly 11 instance) for some of the next
sections. Like mentioned earlier, typically a remote standalone client
has just one EJB client context backed by any number of EJB receivers.
Consider this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span> {
<span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span> args<span class="type">[]</span>) {
<span class="error"> </span>
        <span class="directive">final</span> javax.naming.Context ctxOne = <span class="keyword">new</span> javax.naming.InitialContext();
        <span class="directive">final</span> MyBeanInterface beanOne = ctxOne.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);
        beanOne.doSomething();
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we have seen in this other chapter
<a href="https://docs.jboss.org/author/display/WFLY8/EJB+invocations+from+a+remote+client+using+JNDI">EJB
invocations from a remote client using JNDI</a> that the JNDI lookups are
(typically) backed by jboss-ejb-client.properties file which is used to
setup the EJB client context and the EJB receivers. Let&#8217;s assume we have
a jboss-ejb-client.properties with the relevant receivers
configurations. These configurations include the security credentials
that will be used to create a EJB receiver which connects to the AS7
server. Now when the above code is invoked, the EJB client API looks for
the EJB client context to pick a EJB receiver, to pass on the EJB
invocation request. Since we just have a single EJB client context, that
context is used by the above code to invoke the bean.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s consider a case where the user application wants to invoke on
the bean more than once, but wants to connect to the WildFly 11 server
using different security credentials. Let&#8217;s take a look at the following
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span> {
<span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span> args<span class="type">[]</span>) {
<span class="error"> </span>
        <span class="comment">// let's say we want to use &quot;foo&quot; security credential while connecting to the AS7 server for invoking on this bean instance</span>
        <span class="directive">final</span> javax.naming.Context ctxOne = <span class="keyword">new</span> javax.naming.InitialContext();
        <span class="directive">final</span> MyBeanInterface beanOne = ctxOne.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);
        beanOne.doSomething();
        ...
<span class="error"> </span>
        <span class="comment">// let's say we want to use &quot;bar&quot; security credential while connecting to the AS7 server for invoking on this bean instance</span>
        <span class="directive">final</span> javax.naming.Context ctxTwo = <span class="keyword">new</span> javax.naming.InitialContext();
        <span class="directive">final</span> MyBeanInterface beanTwo = ctxTwo.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);
        beanTwo.doSomething();
        ...
<span class="error"> </span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we have the same application, which wants to connect to the same
server instance for invoking the EJB(s) hosted on that server, but wants
to use two different credentials while connecting to the server.
Remember, the client application has a single EJB client context which
can have atmost 1 EJB recevier for each server instance. Which
effectively means that the above code will end up using just one
credential to connect to the server. So there was no easy way to have
the above code working.</p>
</div>
<div class="paragraph">
<p>That was one of the use cases which prompted the
<a href="https://issues.jboss.org/browse/EJBCLIENT-34" class="bare">https://issues.jboss.org/browse/EJBCLIENT-34</a> feature request. The
proposal was to introduce a way, where you can have more control over
the EJB client contexts and their association with JNDI contexts which
are typically used for EJB invocations.</p>
</div>
</div>
<div class="sect2">
<h3 id="scoped-ejb-client-contexts">28.3. Scoped EJB client contexts</h3>
<div class="paragraph">
<p>Developers familiar with earlier versions of JBoss AS would remember
that for invoking an EJB, you would typically create a JNDI context
passing it the PROVIDER_URL which would point to the target server. That
way any invocation done on EJB proxies looked up using that JNDI
context, would end up on that server. If we look back at the example
above, we&#8217;ll realize that, we are ultimately aiming for a similar
functionality through <a href="https://issues.jboss.org/browse/EJBCLIENT-34" class="bare">https://issues.jboss.org/browse/EJBCLIENT-34</a>. We
want the user applications to have more control over which EJB receiver
gets used for a specific invocation.</p>
</div>
<div class="paragraph">
<p>Before we introduced <a href="https://issues.jboss.org/browse/EJBCLIENT-34" class="bare">https://issues.jboss.org/browse/EJBCLIENT-34</a>
feature, the EJB client context was typically scoped to the client
application. As part of <a href="https://issues.jboss.org/browse/EJBCLIENT-34" class="bare">https://issues.jboss.org/browse/EJBCLIENT-34</a> we
now allow the EJB client contexts to be scoped with the JNDI contexts.
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span> {
<span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span> args<span class="type">[]</span>) {
<span class="error"> </span>
        <span class="comment">// let's say we want to use &quot;foo&quot; security credential while connecting to the AS7 server for invoking on this bean instance</span>
        <span class="directive">final</span> <span class="predefined-type">Properties</span> ejbClientContextPropsOne = getPropsForEJBClientContextOne():
        <span class="directive">final</span> javax.naming.Context ctxOne = <span class="keyword">new</span> javax.naming.InitialContext(ejbClientContextPropsOne);
        <span class="directive">final</span> MyBeanInterface beanOne = ctxOne.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);
        beanOne.doSomething();
        ...
        closeContext(ctxOne); <span class="comment">// read on the entire article to understand more about closing scoped EJB client contexts</span>
<span class="error"> </span>
       <span class="error"> </span><span class="comment">// let's say we want to use &quot;bar&quot; security credential while connecting to the AS7 server for invoking on this bean instance</span>
        <span class="directive">final</span> <span class="predefined-type">Properties</span> ejbClientContextPropsTwo = getPropsForEJBClientContextTwo():
        <span class="directive">final</span> javax.naming.Context ctxTwo = <span class="keyword">new</span> javax.naming.InitialContext(ejbClientContextPropsTwo);
        <span class="directive">final</span> MyBeanInterface beanTwo = ctxTwo.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);
        beanTwo.doSomething();
        ...
        closeContext(ctxTwo); <span class="comment">// read on the entire article to understand more about closing scoped EJB client contexts</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice any difference between this code and the earlier one? We now
create and pass EJB client context specific properties to the JNDI
context. So what do the EJB client context properties look like? The
properties are the same that you would pass through the
jboss-ejb-client.properties file, except for one additional property
which is required to scope the EJB client context to the JNDI context.
The name of the property is:</p>
</div>
<div class="paragraph">
<p><code>org.jboss.ejb.client.scoped.context</code></p>
</div>
<div class="paragraph">
<p>which is expected to have a value true. This property lets the EJB
client API know that it has to created a EJB client context (backed by
EJB receiver(s)) and that created context is then scoped/visible to only
that JNDI context which created it. Lookup and invocation on any EJB
proxies looked up using this JNDI context will only know of the EJB
client context associated with this JNDI context. This effectively means
that the other JNDI contexts which the application uses to lookup and
invoke on EJBs will <em>not</em> know about the other scoped EJB client
contexts at all.</p>
</div>
<div class="paragraph">
<p>JNDI contexts which aren&#8217;t scoped to a EJB client context (for example,
not passing the org.jboss.ejb.client.scoped.context property) will
fallback to the default behaviour of using the "current" EJB client
context which typically is the one tied to the entire application.</p>
</div>
<div class="paragraph">
<p>This scoping of the EJB client context helps the user applications to
have more control over which JNDI context "talks to" which server and
connects to that server in "what way". This gives the user applications
the flexibility that was associated with the JNP based JNDI invocations
prior to WildFly 11 versions.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>IMPORTANT:</strong> <strong>It is very important to remember that scoped EJB client
contexts which are scoped to the JNDI contexts are NOT fire and forget
kind of contexts. What that means is the application program which is
using these contexts is solely responsible for managing their lifecycle
and the application itself is responsible for closing the context at the
right moment. After closing the context the proxies which are bound to
this context are no longer valid and any invocation will throw an
Exception. Not closing the context will end in resource problems as the
underlying physical connection will stay open.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Read the rest of the sections in this article to understand more about
the lifecycle management of such scoped contexts.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="lifecycle-management-of-scoped-ejb-client-contexts">28.4. Lifecycle management of scoped EJB client contexts</h3>
<div class="paragraph">
<p>Like you saw in the previous sections, in case of scoped EJB client
contexts, the EJB client context is tied to the JNDI context. It&#8217;s very
important to understand how the lifecycle of the EJB client context
works in such cases. Especially since any EJB client context is almost
always backed by connections to the server. Not managing the EJB client
context lifecycle correctly can lead to connection leaks in some cases.</p>
</div>
<div class="paragraph">
<p>When you create a scoped EJB client context, the EJB client context
connects to the server(s) listed in the JNDI properties. An internal
implementation detail of this logic includes the ability of the EJB
client context to cache connections based on certain internal algorithm
it uses. The algorithm itself isn&#8217;t publicly documented (yet) since the
chances of it changing or even removal shouldn&#8217;t really affect the
client application and instead it&#8217;s supposed to be transparent to the
client application.</p>
</div>
<div class="paragraph">
<p>The connections thus created for a EJB client context are kept open as
long as the EJB client context is open. This allows the EJB client
context to be usable for EJB invocations. The connections associated
with the EJB client context are closed when the EJB client context
itself is closed.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The connections that were manually added by the application to the EJB
client context are <strong>not</strong> managed by the EJB client context. i.e. they
won&#8217;t be opened (obviously) nor closed by the EJB client API when the
EJB client context is closed.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="how-to-close-ejb-client-contexts">28.4.1. How to close EJB client contexts?</h4>
<div class="paragraph">
<p>The answer to that is simple. Use the close() method on the appropriate
EJB client context.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-close-scoped-ejb-client-contexts">28.4.2. How to close scoped EJB client contexts?</h4>
<div class="paragraph">
<p>The answer is the same, use the close() method on the EJB client
context. But the real question is how do you get the relevant scoped EJB
client context which is associated with a JNDI context. Before we get to
that, it&#8217;s important to understand how the ejb: JNDI namespace that&#8217;s
used for EJB lookups and how the JNDI context (typically the
InitialContext that you see in the client code) are related. The JNDI
API provided by Java language allows "URL context factory" to be
registered in the JNDI framework (see this for details
<a href="http://docs.oracle.com/javase/jndi/tutorial/provider/url/factory.html" class="bare">http://docs.oracle.com/javase/jndi/tutorial/provider/url/factory.html</a>).
Like that documentation states, the URL context factory can be used to
resolve URL strings during JNDI lookup. That&#8217;s what the ejb: prefix is
when you do a remote EJB lookup. The ejb: URL string is backed by a URL
context factory.</p>
</div>
<div class="paragraph">
<p>Internally, when a lookup happens for a ejb: URL string, a relevant
javax.naming.Context is created for that ejb: lookup. Let&#8217;s see some
code for better understanding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// JNDI context &quot;A&quot;</span>
<span class="predefined-type">Context</span> jndiCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(props);
<span class="comment">// Now let's lookup a EJB</span>
MyBean bean = jndiCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we first create a JNDI context and then use it to lookup an EJB. The
bean lookup using the ejb: JNDI name, although, is just one statement,
involves a few more things under the hood. What&#8217;s actually happening
when you lookup that string is that a separate javax.naming.Context gets
created for the ejb: URL string. This new javax.naming.Context is then
used to lookup the rest of the string in that JNDI name.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s break up that one line into multiple statements to understand
better:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Remember, the ejb: is backed by a URL context factory which returns a Context for the ejb: URL (that's why it's called a context factory)</span>
<span class="directive">final</span> <span class="predefined-type">Context</span> ejbNamingContext = (<span class="predefined-type">Context</span>) jndiCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Use the returned EJB naming context to lookup the rest of the JNDI string for EJB</span>
<span class="directive">final</span> MyBean bean = ejbNamingContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see above, we split up that single statement into a couple of
statements for explaining the details better. So as you can see when the
ejb: URL string is parsed in a JNDI name, it gets hold of a
javax.naming.Context instance. This instance is different from the one
which was used to do the lookup (jndiCtx in this example). This is an
important detail to understand (for reasons explained later). Now this
returned instance is used to lookup the rest of the JNDI string
("app/module/distinct/bean!interface"), which then returns the EJB
proxy. Irrespective of whether the lookup is done in a single statement
or multiple parts, the code works the same. i.e. an instance of
javax.naming.Context gets created for the ejb: URL string.</p>
</div>
<div class="paragraph">
<p>So why am I explaining all this when the section is titled
<code>"How to close scoped EJB client contexts"</code>? The reason is because
client applications dealing with scoped EJB client contexts which are
associated with a JNDI context would expect the following code to close
the associated EJB client context, but will be surprised that it won&#8217;t:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="comment">// mark it for scoped EJB client context</span>
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.scoped.context</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// add other properties</span>
props.put(....);
...
Context jndiCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(props);
<span class="keyword">try</span> {
      <span class="directive">final</span> MyBean bean = jndiCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>);
      bean.doSomething();
} <span class="keyword">finally</span> {
  jndiCtx.close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications expect that the call to jndiCtx.close() will effectively
close the EJB client context associated with the JNDI context. That
doesn&#8217;t happen because as explained previously, the javax.naming.Context
backing the ejb: URL string is a different instance than the one the
code is closing. The JNDI implementation in Java, only just closes the
context on which the close was called. As a result, the other
javax.naming.Context that backs the ejb: URL string is still not closed,
which effectively means that the scoped EJB client context is not closed
too which then ultimately means that the connection to the server(s) in
the EJB client context are not closed too.</p>
</div>
<div class="paragraph">
<p>So now let&#8217;s see how this can be done properly. We know that the ejb:
URL string lookup returns us a javax.naming.Context. All we have to do
is keep a reference to this instance and close it when we are done with
the EJB invocations. So here&#8217;s how it&#8217;s going to look:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="comment">// mark it for scoped EJB client context</span>
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.scoped.context</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// add other properties</span>
props.put(....);
...
Context jndiCtx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(props);
<span class="predefined-type">Context</span> ejbRootNamingContext = (<span class="predefined-type">Context</span>) jndiCtx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">try</span> {
    <span class="directive">final</span> MyBean bean = ejbRootNamingContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>); <span class="comment">// the rest of the EJB jndi string</span>
    bean.doSomething();
} <span class="keyword">finally</span> {
    <span class="keyword">try</span> {
        <span class="comment">// close the EJB naming JNDI context</span>
        ejbRootNamingContext.close();
    } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> t) {
        <span class="comment">// log and ignore</span>
    }
    <span class="keyword">try</span> {
        <span class="comment">// also close our other JNDI context since we are done with it too</span>
        jndiCtx.close();
    } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> t) {
        <span class="comment">// log and ignore</span>
    }
<span class="error"> </span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see, we changed the code to first do a lookup on just the "ejb:"
string to get hold of the EJB naming context and then used that
ejbRootNamingContext instance to lookup the rest of the EJB JNDI name to
get hold of the EJB proxy. Then when it was time to close the context,
we closed the ejbRootNamingContext (as well as the other JNDI context).
Closing the ejbRootNamingContext ensures that the scoped EJB client
context associated with that JNDI context is closed too. Effectively,
this closes the connection(s) to the server(s) within that EJB client
context.</p>
</div>
<div class="sect4">
<h5 id="can-that-code-be-simplified-a-bit">Can that code be simplified a bit?</h5>
<div class="paragraph">
<p>If you are using that JNDI context only for EJB invocations, then yes
you can get rid of some instances and code from the above code. You can
change that code to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="comment">// mark it for scoped EJB client context</span>
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.scoped.context</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// add other properties</span>
props.put(....);
...
Context ejbRootNamingContext = (<span class="predefined-type">Context</span>) <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(props).lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">try</span> {
    <span class="directive">final</span> MyBean bean = ejbRootNamingContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>); <span class="comment">// the rest of the EJB jndi string</span>
    bean.doSomething();
} <span class="keyword">finally</span> {
    <span class="keyword">try</span> {
        <span class="comment">// close the EJB naming JNDI context</span>
        ejbRootNamingContext.close();
    } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> t) {
        <span class="comment">// log and ignore</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we no longer hold a reference to 2 JNDI contexts and instead
just keep track of the ejbRootNamingContext which is actually the root
JNDI context for our "ejb:" URL string. Of course, this means that you
can only use this context for EJB lookups or any other EJB related JNDI
lookups. So it depends on your application and how it&#8217;s coded.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cant-the-scoped-ejb-client-context-be-automatically-closed-by-the-ejb-client-api-when-the-jndi-context-is-no-longer-in-scope-i.e.-on-gc">28.4.3. Can&#8217;t the scoped EJB client context be automatically closed by the</h4>
<div class="paragraph">
<p>EJB client API when the JNDI context is no longer in scope (i.e. on GC)?</p>
</div>
<div class="paragraph">
<p>That&#8217;s one of the common questions that gets asked. No, the EJB client
API can&#8217;t take that decision. i.e. it cannot automatically go ahead and
close the scoped EJB client context by itself when the associated JNDI
context is eligible for GC. The reason is simple as illustrated by the
following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> doEJBInvocation() {
    <span class="directive">final</span> MyBean bean = lookupEJB();
    bean.doSomething();
    bean.doSomeOtherThing();
    ... <span class="comment">// do some other work</span>
    bean.keepDoingSomething();
}
<span class="error"> </span>
MyBean lookupEJB() {
    <span class="directive">final</span> <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
    <span class="comment">// mark it for scoped EJB client context</span>
    props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.scoped.context</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);
    <span class="comment">// add other properties</span>
    props.put(....);
    ...
    Context ejbRootNamingContext = (<span class="predefined-type">Context</span>) <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(props).lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">final</span> MyBean bean = ejbRootNamingContext.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">app/module/distinct/bean!interface</span><span class="delimiter">&quot;</span></span>); <span class="comment">// rest of the EJB jndi string</span>
    <span class="keyword">return</span> bean;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the doEJBInvocation() method first calls a lookupEJB()
method which does a lookup of the bean using a JNDI context and then
returns the bean (proxy). The doEJBInvocation() then uses that returned
proxy and keeps doing the invocations on the bean. As you might have
noticed, the JNDI context that was used for lookup (i.e. the
ejbRootNamingContext) is eligible for GC. If the EJB client API had
closed the scoped EJB client context associated with that JNDI context,
when that JNDI context was garbage collected, then the subsequent EJB
invocations on the returned EJB (proxy) would start failing in
doEJBInvocation() since the EJB client context is no longer available.</p>
</div>
<div class="paragraph">
<p>That&#8217;s the reason why the EJB client API doesn&#8217;t automatically close the
EJB client context.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb_invocations_from_a_remote_client_using_jndi">29. EJB invocations from a remote client using JNDI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to invoke EJBs from a remote client by using
the JNDI API to first lookup the bean proxy and then invoke on that
proxy.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After you have read this article, do remember to take a look at
<a href="https://docs.jboss.org/author/display/WFLY8/Remote+EJB+invocations+via+JNDI+-+EJB+client+API+or+remote-naming+project">Remote
EJB invocations via JNDI - EJB client API or remote-naming project</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before getting into the details, we would like the users to know that we
have introduced a new EJB client API, which is a WildFly-specific API
and allows invocation on remote EJBs. This client API isn&#8217;t based on
JNDI. So remote clients need not rely on JNDI API to invoke on EJBs. A
separate document covering the EJB remote client API will be made
available. For now, you can refer to the javadocs of the EJB client
project at <a href="http://docs.jboss.org/ejbclient/" class="bare">http://docs.jboss.org/ejbclient/</a>. In this document, we&#8217;ll
just concentrate on the traditional JNDI based invocation on EJBs. So
let&#8217;s get started:</p>
</div>
<div class="sect2">
<h3 id="deploying-your-ejbs-on-the-server-side">29.1. Deploying your EJBs on the server side:</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Users who already have EJBs deployed on the server side can just skip to
the next section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a first step, you&#8217;ll have to deploy your application containing the
EJBs on the Wildfly server. If you want those EJBs to be remotely
invocable, then you&#8217;ll have to expose at least one remote view for that
bean. In this example, let&#8217;s consider a simple Calculator stateless bean
which exposes a RemoteCalculator remote business interface. We&#8217;ll also
have a simple stateful CounterBean which exposes a RemoteCounter remote
business interface. Here&#8217;s the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jboss.as.quickstarts.ejb.remote.stateless</span>;
<span class="error"> </span>
<span class="comment">/**
 * @author Jaikiran Pai
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">RemoteCalculator</span> {
<span class="error"> </span>
    <span class="type">int</span> add(<span class="type">int</span> a, <span class="type">int</span> b);
<span class="error"> </span>
    <span class="type">int</span> subtract(<span class="type">int</span> a, <span class="type">int</span> b);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jboss.as.quickstarts.ejb.remote.stateless</span>;
<span class="error"> </span>
<span class="keyword">import</span> <span class="include">javax.ejb.Remote</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Stateless</span>;
<span class="error"> </span>
<span class="comment">/**
 * @author Jaikiran Pai
 */</span>
<span class="annotation">@Stateless</span>
<span class="annotation">@Remote</span>(RemoteCalculator.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CalculatorBean</span> <span class="directive">implements</span> RemoteCalculator {
<span class="error"> </span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> add(<span class="type">int</span> a, <span class="type">int</span> b) {
        <span class="keyword">return</span> a + b;
    }
<span class="error"> </span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> subtract(<span class="type">int</span> a, <span class="type">int</span> b) {
        <span class="keyword">return</span> a - b;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jboss.as.quickstarts.ejb.remote.stateful</span>;
<span class="error"> </span>
<span class="comment">/**
 * @author Jaikiran Pai
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">RemoteCounter</span> {
<span class="error"> </span>
    <span class="type">void</span> increment();
<span class="error"> </span>
    <span class="type">void</span> decrement();
<span class="error"> </span>
    <span class="type">int</span> getCount();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jboss.as.quickstarts.ejb.remote.stateful</span>;
<span class="error"> </span>
<span class="keyword">import</span> <span class="include">javax.ejb.Remote</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Stateful</span>;
<span class="error"> </span>
<span class="comment">/**
 * @author Jaikiran Pai
 */</span>
<span class="annotation">@Stateful</span>
<span class="annotation">@Remote</span>(RemoteCounter.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CounterBean</span> <span class="directive">implements</span> RemoteCounter {
<span class="error"> </span>
    <span class="directive">private</span> <span class="type">int</span> count = <span class="integer">0</span>;
<span class="error"> </span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> increment() {
        <span class="local-variable">this</span>.count++;
    }
<span class="error"> </span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> decrement() {
        <span class="local-variable">this</span>.count--;
    }
<span class="error"> </span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getCount() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.count;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s package this in a jar (how you package it in a jar is out of scope
of this chapter) named "jboss-as-ejb-remote-app.jar" and deploy it to
the server. Make sure that your deployment has been processed
successfully and there aren&#8217;t any errors.</p>
</div>
</div>
<div class="sect2">
<h3 id="writing-a-remote-client-application-for-accessing-and-invoking-the-ejbs-deployed-on-the-server">29.2. Writing a remote client application for accessing and invoking the</h3>
<div class="paragraph">
<p>EJBs deployed on the server</p>
</div>
<div class="paragraph">
<p>The next step is to write an application which will invoke the EJBs that
you deployed on the server. In WildFly, you can either choose to use the
WildFly specific EJB client API to do the invocation or use JNDI to
lookup a proxy for your bean and invoke on that returned proxy. In this
chapter we will concentrate on the JNDI lookup and invocation and will
leave the EJB client API for a separate chapter.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s take a look at what the client code looks like for looking up
the JNDI proxy and invoking on it. Here&#8217;s the entire client code which
invokes on a stateless bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jboss.as.quickstarts.ejb.remote.client</span>;
<span class="error"> </span>
<span class="keyword">import</span> <span class="include">javax.naming.Context</span>;
<span class="keyword">import</span> <span class="include">javax.naming.InitialContext</span>;
<span class="keyword">import</span> <span class="include">javax.naming.NamingException</span>;
<span class="keyword">import</span> <span class="include">java.security.Security</span>;
<span class="keyword">import</span> <span class="include">java.util.Hashtable</span>;
<span class="error"> </span>
<span class="keyword">import</span> <span class="include">org.jboss.as.quickstarts.ejb.remote.stateful.CounterBean</span>;
<span class="keyword">import</span> <span class="include">org.jboss.as.quickstarts.ejb.remote.stateful.RemoteCounter</span>;
<span class="keyword">import</span> <span class="include">org.jboss.as.quickstarts.ejb.remote.stateless.CalculatorBean</span>;
<span class="keyword">import</span> <span class="include">org.jboss.as.quickstarts.ejb.remote.stateless.RemoteCalculator</span>;
<span class="keyword">import</span> <span class="include">org.jboss.sasl.JBossSaslProvider</span>;
<span class="error"> </span>
<span class="comment">/**
 * A sample program which acts a remote client for a EJB deployed on Wildfly 10 server.
 * This program shows how to lookup stateful and stateless beans via JNDI and then invoke on them
 *
 * @author Jaikiran Pai
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RemoteEJBClient</span> {
<span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// Invoke a stateless bean</span>
        invokeStatelessBean();
<span class="error"> </span>
        <span class="comment">// Invoke a stateful bean</span>
        invokeStatefulBean();
    }
<span class="error"> </span>
    <span class="comment">/**
     * Looks up a stateless bean and invokes on it
     *
     * @throws NamingException
     */</span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> invokeStatelessBean() <span class="directive">throws</span> <span class="exception">NamingException</span> {
        <span class="comment">// Let's lookup the remote stateless calculator</span>
        <span class="directive">final</span> RemoteCalculator statelessRemoteCalculator = lookupRemoteStatelessCalculator();
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Obtained a remote stateless calculator for invocation</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// invoke on the remote calculator</span>
        <span class="type">int</span> a = <span class="integer">204</span>;
        <span class="type">int</span> b = <span class="integer">340</span>;
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Adding </span><span class="delimiter">&quot;</span></span> + a + <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span> + b + <span class="string"><span class="delimiter">&quot;</span><span class="content"> via the remote stateless calculator deployed on the server</span><span class="delimiter">&quot;</span></span>);
        <span class="type">int</span> sum = statelessRemoteCalculator.add(a, b);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote calculator returned sum = </span><span class="delimiter">&quot;</span></span> + sum);
        <span class="keyword">if</span> (sum != a + b) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote stateless calculator returned an incorrect sum </span><span class="delimiter">&quot;</span></span> + sum + <span class="string"><span class="delimiter">&quot;</span><span class="content"> ,expected sum was </span><span class="delimiter">&quot;</span></span> + (a + b));
        }
        <span class="comment">// try one more invocation, this time for subtraction</span>
        <span class="type">int</span> num1 = <span class="integer">3434</span>;
        <span class="type">int</span> num2 = <span class="integer">2332</span>;
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Subtracting </span><span class="delimiter">&quot;</span></span> + num2 + <span class="string"><span class="delimiter">&quot;</span><span class="content"> from </span><span class="delimiter">&quot;</span></span> + num1 + <span class="string"><span class="delimiter">&quot;</span><span class="content"> via the remote stateless calculator deployed on the server</span><span class="delimiter">&quot;</span></span>);
        <span class="type">int</span> difference = statelessRemoteCalculator.subtract(num1, num2);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote calculator returned difference = </span><span class="delimiter">&quot;</span></span> + difference);
        <span class="keyword">if</span> (difference != num1 - num2) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote stateless calculator returned an incorrect difference </span><span class="delimiter">&quot;</span></span> + difference + <span class="string"><span class="delimiter">&quot;</span><span class="content"> ,expected difference was </span><span class="delimiter">&quot;</span></span> + (num1 - num2));
        }
    }
<span class="error"> </span>
    <span class="comment">/**
     * Looks up a stateful bean and invokes on it
     *
     * @throws NamingException
     */</span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> invokeStatefulBean() <span class="directive">throws</span> <span class="exception">NamingException</span> {
        <span class="comment">// Let's lookup the remote stateful counter</span>
        <span class="directive">final</span> RemoteCounter statefulRemoteCounter = lookupRemoteStatefulCounter();
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Obtained a remote stateful counter for invocation</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// invoke on the remote counter bean</span>
        <span class="directive">final</span> <span class="type">int</span> NUM_TIMES = <span class="integer">20</span>;
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Counter will now be incremented </span><span class="delimiter">&quot;</span></span> + NUM_TIMES + <span class="string"><span class="delimiter">&quot;</span><span class="content"> times</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; NUM_TIMES; i++) {
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Incrementing counter</span><span class="delimiter">&quot;</span></span>);
            statefulRemoteCounter.increment();
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Count after increment is </span><span class="delimiter">&quot;</span></span> + statefulRemoteCounter.getCount());
        }
        <span class="comment">// now decrementing</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Counter will now be decremented </span><span class="delimiter">&quot;</span></span> + NUM_TIMES + <span class="string"><span class="delimiter">&quot;</span><span class="content"> times</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (<span class="type">int</span> i = NUM_TIMES; i &gt; <span class="integer">0</span>; i--) {
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Decrementing counter</span><span class="delimiter">&quot;</span></span>);
            statefulRemoteCounter.decrement();
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Count after decrement is </span><span class="delimiter">&quot;</span></span> + statefulRemoteCounter.getCount());
        }
    }
<span class="error"> </span>
    <span class="comment">/**
     * Looks up and returns the proxy to remote stateless calculator bean
     *
     * @return
     * @throws NamingException
     */</span>
    <span class="directive">private</span> <span class="directive">static</span> RemoteCalculator lookupRemoteStatelessCalculator() <span class="directive">throws</span> <span class="exception">NamingException</span> {
        <span class="directive">final</span> <span class="predefined-type">Hashtable</span> jndiProperties = <span class="keyword">new</span> <span class="predefined-type">Hashtable</span>();
        jndiProperties.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
        <span class="directive">final</span> <span class="predefined-type">Context</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProperties);
        <span class="comment">// The app name is the application name of the deployed EJBs. This is typically the ear name</span>
        <span class="comment">// without the .ear suffix. However, the application name could be overridden in the application.xml of the</span>
        <span class="comment">// EJB deployment on the server.</span>
        <span class="comment">// Since we haven't deployed the application as a .ear, the app name for us will be an empty string</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> appName = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// This is the module name of the deployed EJBs on the server. This is typically the jar name of the</span>
        <span class="comment">// EJB deployment, without the .jar suffix, but can be overridden via the ejb-jar.xml</span>
        <span class="comment">// In this example, we have deployed the EJBs in a jboss-as-ejb-remote-app.jar, so the module name is</span>
        <span class="comment">// jboss-as-ejb-remote-app</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> moduleName = <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-as-ejb-remote-app</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// AS7 allows each deployment to have an (optional) distinct name. We haven't specified a distinct name for</span>
        <span class="comment">// our EJB deployment, so this is an empty string</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> distinctName = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// The EJB name which by default is the simple class name of the bean implementation class</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> beanName = CalculatorBean.class.getSimpleName();
        <span class="comment">// the remote view fully qualified class name</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> viewClassName = RemoteCalculator.class.getName();
        <span class="comment">// let's do the lookup</span>
        <span class="keyword">return</span> (RemoteCalculator) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span> + appName + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + moduleName + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + distinctName + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + beanName + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span> + viewClassName);
    }
<span class="error"> </span>
    <span class="comment">/**
     * Looks up and returns the proxy to remote stateful counter bean
     *
     * @return
     * @throws NamingException
     */</span>
    <span class="directive">private</span> <span class="directive">static</span> RemoteCounter lookupRemoteStatefulCounter() <span class="directive">throws</span> <span class="exception">NamingException</span> {
        <span class="directive">final</span> <span class="predefined-type">Hashtable</span> jndiProperties = <span class="keyword">new</span> <span class="predefined-type">Hashtable</span>();
        jndiProperties.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
        <span class="directive">final</span> <span class="predefined-type">Context</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProperties);
        <span class="comment">// The app name is the application name of the deployed EJBs. This is typically the ear name</span>
        <span class="comment">// without the .ear suffix. However, the application name could be overridden in the application.xml of the</span>
        <span class="comment">// EJB deployment on the server.</span>
        <span class="comment">// Since we haven't deployed the application as a .ear, the app name for us will be an empty string</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> appName = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// This is the module name of the deployed EJBs on the server. This is typically the jar name of the</span>
        <span class="comment">// EJB deployment, without the .jar suffix, but can be overridden via the ejb-jar.xml</span>
        <span class="comment">// In this example, we have deployed the EJBs in a jboss-as-ejb-remote-app.jar, so the module name is</span>
        <span class="comment">// jboss-as-ejb-remote-app</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> moduleName = <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-as-ejb-remote-app</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// AS7 allows each deployment to have an (optional) distinct name. We haven't specified a distinct name for</span>
        <span class="comment">// our EJB deployment, so this is an empty string</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> distinctName = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// The EJB name which by default is the simple class name of the bean implementation class</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> beanName = CounterBean.class.getSimpleName();
        <span class="comment">// the remote view fully qualified class name</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> viewClassName = RemoteCounter.class.getName();
        <span class="comment">// let's do the lookup (notice the ?stateful string as the last part of the jndi name for stateful bean lookup)</span>
        <span class="keyword">return</span> (RemoteCounter) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span> + appName + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + moduleName + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + distinctName + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + beanName + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span> + viewClassName + <span class="string"><span class="delimiter">&quot;</span><span class="content">?stateful</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The entire server side and client side code is hosted at the github repo
here
<a href="https://github.com/wildfly/quickstart/tree/master/ejb-remote">ejb-remote</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code has some comments which will help you understand each of those
lines. But we&#8217;ll explain here in more detail what the code does. As a
first step in the client code, we&#8217;ll do a lookup of the EJB using a JNDI
name. In AS7, for remote access to EJBs, you use the ejb: namespace with
the following syntax:</p>
</div>
<div class="paragraph">
<p><strong>For stateless beans:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ejb:&lt;app-name&gt;/&lt;module-name&gt;/&lt;distinct-name&gt;/&lt;bean-name&gt;!&lt;fully-qualified-classname-of-the-remote-<span class="type">interface</span>&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For stateful beans:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ejb:&lt;app-name&gt;/&lt;module-name&gt;/&lt;distinct-name&gt;/&lt;bean-name&gt;!&lt;fully-qualified-classname-of-the-remote-<span class="type">interface</span>&gt;?<span class="class">stateful</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ejb: namespace identifies it as a EJB lookup and is a constant (i.e.
doesn&#8217;t change) for doing EJB lookups. The rest of the parts in the jndi
name are as follows:</p>
</div>
<div class="paragraph">
<p><strong>app-name</strong> : This is the name of the .ear (without the .ear suffix) that
you have deployed on the server and contains your EJBs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java EE 6 allows you to override the application name, to a name of
your choice by setting it in the application.xml. If the deployment uses
uses such an override then the app-name used in the JNDI name should
match that name.</p>
</li>
<li>
<p>EJBs can also be deployed in a .war or a plain .jar (like we did in
step 1). In such cases where the deployment isn&#8217;t an .ear file, then the
app-name must be an empty string, while doing the lookup.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>module-name</strong> : This is the name of the .jar (without the .jar suffix)
that you have deployed on the server and the contains your EJBs. If the
EJBs are deployed in a .war then the module name is the .war name
(without the .war suffix).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java EE 6 allows you to override the module name, by setting it in the
ejb-jar.xml/web.xml of your deployment. If the deployment uses such an
override then the module-name used in the JNDI name should match that
name.</p>
</li>
<li>
<p>Module name part cannot be an empty string in the JNDI name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>distinct-name</strong> : This is a WildFly-specific name which can be
optionally assigned to the deployments that are deployed on the server.
More about the purpose and usage of this will be explained in a separate
chapter. If a deployment doesn&#8217;t use distinct-name then, use an empty
string in the JNDI name, for distinct-name</p>
</div>
<div class="paragraph">
<p><strong>bean-name</strong> : This is the name of the bean for which you are doing the
lookup. The bean name is typically the unqualified classname of the bean
implementation class, but can be overriden through either ejb-jar.xml or
via annotations. The bean name part cannot be an empty string in the
JNDI name.</p>
</div>
<div class="paragraph">
<p><strong>fully-qualified-classname-of-the-remote-interface</strong> : This is the fully
qualified class name of the interface for which you are doing the
lookup. The interface should be one of the remote interfaces exposed by
the bean on the server. The fully qualified class name part cannot be an
empty string in the JNDI name.</p>
</div>
<div class="paragraph">
<p>For stateful beans, the JNDI name expects an additional "?stateful" to
be appended after the fully qualified interface name part. This is
because for stateful beans, a new session gets created on JNDI lookup
and the EJB client API implementation doesn&#8217;t contact the server during
the JNDI lookup to know what kind of a bean the JNDI name represents
(we&#8217;ll come to this in a while). So the JNDI name itself is expected to
indicate that the client is looking up a stateful bean, so that an
appropriate session can be created.</p>
</div>
<div class="paragraph">
<p>Now that we know the syntax, let&#8217;s see our code and check what JNDI name
it uses. Since our stateless EJB named CalculatorBean is deployed in a
jboss-as-ejb-remote-app.jar (without any ear) and since we are looking
up the org.jboss.as.quickstarts.ejb.remote.stateless.RemoteCalculator
remote interface, our JNDI name will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ejb:/jboss-as-ejb-remote-app<span class="comment">//CalculatorBean!org.jboss.as.quickstarts.ejb.remote.stateless.RemoteCalculator</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s what the lookupRemoteStatelessCalculator() method in the above
client code uses.</p>
</div>
<div class="paragraph">
<p>For the stateful EJB named CounterBean which is deployed in hte same
jboss-as-ejb-remote-app.jar and which exposes the
org.jboss.as.quickstarts.ejb.remote.stateful.RemoteCounter, the JNDI
name will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ejb:/jboss-as-ejb-remote-app<span class="comment">//CounterBean!org.jboss.as.quickstarts.ejb.remote.stateful.RemoteCounter?stateful</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s what the lookupRemoteStatefulCounter() method in the above client
code uses.</p>
</div>
<div class="paragraph">
<p>Now that we know of the JNDI name, let&#8217;s take a look at the following
piece of code in the lookupRemoteStatelessCalculator():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Hashtable</span> jndiProperties = <span class="keyword">new</span> <span class="predefined-type">Hashtable</span>();
jndiProperties.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> <span class="predefined-type">Context</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProperties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we are creating a JNDI InitialContext object by passing it some
JNDI properties. The Context.URL_PKG_PREFIXES is set to
org.jboss.ejb.client.naming. This is necessary because we should let the
JNDI API know what handles the ejb: namespace that we use in our JNDI
names for lookup. The "org.jboss.ejb.client.naming" has a
URLContextFactory implementation which will be used by the JNDI APIs to
parse and return an object for ejb: namespace lookups. You can either
pass these properties to the constructor of the InitialContext class or
have a jndi.properites file in the classpath of the client application,
which (atleast) contains the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java.naming.factory.url.pkgs=org.jboss.ejb.client.naming</code></pre>
</div>
</div>
<div class="paragraph">
<p>So at this point, we have setup the InitialContext and also have the
JNDI name ready to do the lookup. You can now do the lookup and the
appropriate proxy which will be castable to the remote interface that
you used as the fully qualified class name in the JNDI name, will be
returned. Some of you might be wondering, how the JNDI implementation
knew which server address to look, for your deployed EJBs. The answer is
in AS7, the proxies returned via JNDI name lookup for ejb: namespace do
not connect to the server unless an invocation on those proxies is done.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s get to the point where we invoke on this returned proxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Let's lookup the remote stateless calculator</span>
        <span class="directive">final</span> RemoteCalculator statelessRemoteCalculator = lookupRemoteStatelessCalculator();
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Obtained a remote stateless calculator for invocation</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// invoke on the remote calculator</span>
        <span class="type">int</span> a = <span class="integer">204</span>;
        <span class="type">int</span> b = <span class="integer">340</span>;
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Adding </span><span class="delimiter">&quot;</span></span> + a + <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span> + b + <span class="string"><span class="delimiter">&quot;</span><span class="content"> via the remote stateless calculator deployed on the server</span><span class="delimiter">&quot;</span></span>);
        <span class="type">int</span> sum = statelessRemoteCalculator.add(a, b);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see here that the proxy returned after the lookup is used to
invoke the add(&#8230;&#8203;) method of the bean. It&#8217;s at this point that the JNDI
implementation (which is backed by the EJB client API) needs to know the
server details. So let&#8217;s now get to the important part of setting up the
EJB client context properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-ejb-client-context-properties">29.3. Setting up EJB client context properties</h3>
<div class="paragraph">
<p>A EJB client context is a context which contains contextual information
for carrying out remote invocations on EJBs. This is a WildFly-specific
API. The EJB client context can be associated with multiple EJB
receivers. Each EJB receiver is capable of handling invocations on
different EJBs. For example, an EJB receiver "Foo" might be able to
handle invocation on a bean identified by
app-A/module-A/distinctinctName-A/Bar!RemoteBar, whereas a EJB receiver
named "Blah" might be able to handle invocation on a bean identified by
app-B/module-B/distinctName-B/BeanB!RemoteBean. Each such EJB receiver
knows about what set of EJBs it can handle and each of the EJB receiver
knows which server target to use for handling the invocations on the
bean. For example, if you have a AS7 server at 10.20.30.40 IP address
which has its remoting port opened at 4447 and if that&#8217;s the server on
which you deployed that CalculatorBean, then you can setup a EJB
receiver which knows its target address is 10.20.30.40:4447. Such an EJB
receiver will be capable enough to communicate to the server via the
JBoss specific EJB remote client protocol (details of which will be
explained in-depth in a separate chapter).</p>
</div>
<div class="paragraph">
<p>Now that we know what a EJB client context is and what a EJB receiver
is, let&#8217;s see how we can setup a client context with 1 EJB receiver
which can connect to 10.20.30.40 IP address at port 4447. That EJB
client context will then be used (internally) by the JNDI implementation
to handle invocations on the bean proxy.</p>
</div>
<div class="paragraph">
<p>The client will have to place a jboss-ejb-client.properties file in the
classpath of the application. The jboss-ejb-client.properties can
contain the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">endpoint.name=client-endpoint
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=<span class="predefined-constant">false</span>
<span class="error"> </span>
remote.connections=<span class="keyword">default</span>
<span class="error"> </span>
remote.connection.default.host=<span class="float">10.20</span><span class="float">.30</span><span class="float">.40</span>
remote.connection.default.port = <span class="integer">8080</span>
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=<span class="predefined-constant">false</span>
<span class="error"> </span>
remote.connection.default.username=appuser
remote.connection.default.password=apppassword</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This file includes a reference to a default password. Be sure to change
this as soon as possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above properties file is just an example. The actual file that was
used for this sample program is available here for reference
<a href="https://github.com/wildfly/quickstart/blob/master/ejb-remote/client/src/main/resources/jboss-ejb-client.properties">jboss-ejb-client.properties</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We&#8217;ll see what each of it means.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First the endpoint.name property. We mentioned earlier that the EJB
receivers will communicate with the server for EJB invocations.
Internally, they use JBoss Remoting project to carry out the
communication. The endpoint.name property represents the name that will
be used to create the client side of the enpdoint. The endpoint.name
property is optional and if not specified in the
jboss-ejb-client.properties file, it will default to
"config-based-ejb-client-endpoint" name.</p>
</div>
<div class="paragraph">
<p>Next is the remote.connectionprovider.create.options.&lt;&#8230;&#8203;.&gt; properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The "remote.connectionprovider.create.options." property prefix can be
used to pass the options that will be used while create the connection
provider which will handle the "remote:" protocol. In this example we
use the "remote.connectionprovider.create.options." property prefix to
pass the "org.xnio.Options.SSL_ENABLED" property value as false. That
property will then be used during the connection provider creation.
Similarly other properties can be passed too, just append it to the
"remote.connectionprovider.create.options." prefix</p>
</div>
<div class="paragraph">
<p>Next we&#8217;ll see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connections=<span class="keyword">default</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is where you define the connections that you want to setup for
communication with the remote server. The "remote.connections" property
uses a comma separated value of connection "names". The connection names
are just logical and are used grouping together the connection
configuration properties later on in the properties file. The example
above sets up a single remote connection named "default". There can be
more than one connections that are configured. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connections=one, two</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we are listing 2 connections named "one" and "two". Ultimately,
each of the connections will map to a EJB receiver. So if you have 2
connections, that will setup 2 EJB receivers that will be added to the
EJB client context. Each of these connections will be configured with
the connection specific properties as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connection.default.host=<span class="float">10.20</span><span class="float">.30</span><span class="float">.40</span>
remote.connection.default.port = <span class="integer">8080</span>
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are using the "remote.connection.&lt;connection-name&gt;."
prefix for specifying the connection specific property. The connection
name here is "default" and we are setting the "host" property of that
connection to point to 10.20.30.40. Similarly we set the "port" for that
connection to 4447.</p>
</div>
<div class="paragraph">
<p>By default WildFly uses 8080 as the remoting port. The EJB client API
uses the http port, with the http-upgrade functionality, for
communicating with the server for remote invocations, so that&#8217;s the port
we use in our client programs (unless the server is configured for some
other http port)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connection.default.username=appuser
remote.connection.default.password=apppassword</code></pre>
</div>
</div>
<div class="paragraph">
<p>The given user/password must be set by using the command bin/add-user.sh
﻿(or.bat).<br>
The user and password must be set because the security-realm is enabled
for the subsystem remoting (see standalone*.xml or domain.xml) by
default.<br>
If you do not need the security for remoting you might remove the
attribute security-realm in the configuration.</p>
</div>
<div class="paragraph">
<p>security-realm is enabled by default.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We then use the "remote.connection.&lt;connection-name&gt;.connect.options."
property prefix to setup options that will be used during the connection
creation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of setting up multiple connections with different
properties for each of those:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=<span class="predefined-constant">false</span>
<span class="error"> </span>
remote.connections=one, two
<span class="error"> </span>
remote.connection.one.host=localhost
remote.connection.one.port=<span class="integer">6999</span>
remote.connection.one.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=<span class="predefined-constant">false</span>
<span class="error"> </span>
remote.connection.two.host=localhost
remote.connection.two.port=<span class="integer">7999</span>
remote.connection.two.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we setup 2 connections "one" and "two" which both point
to "localhost" as the "host" but different ports. Each of these
connections will internally be used to create the EJB receivers in the
EJB client context.</p>
</div>
<div class="paragraph">
<p>So that&#8217;s how the jboss-ejb-client.properties file can be setup and
placed in the classpath.</p>
</div>
<div id="section" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The EJB client code will by default look for jboss-ejb-client.properties
in the classpath. However, you can specify a different file of your
choice by setting the "jboss.ejb.client.properties.file.path" system
property which points to a properties file on your filesystem,
containing the client context configurations. An example for that would
be
"-Djboss.ejb.client.properties.file.path=/home/me/my-client/custom-jboss-ejb-client.properties"</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A jboss-client jar is shipped in the distribution. It&#8217;s available at
WILDFLY_HOME/bin/client/jboss-client.jar. Place this jar in the
classpath of your client application.</p>
</div>
<div class="paragraph">
<p>If you are using Maven to build the client application, then please
follow the instructions in the WILDFLY_HOME/bin/client/README.txt to add
this jar as a Maven dependency.</p>
</div>
</div>
<div class="sect2">
<h3 id="summary">29.4. Summary</h3>
<div class="paragraph">
<p>In the above examples, we saw what it takes to invoke a EJB from a
remote client. To summarize:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the server side you need to deploy EJBs which expose the remote
views.</p>
</li>
<li>
<p>On the client side you need a client program which:</p>
<div class="ulist">
<ul>
<li>
<p>Has a jboss-ejb-client.properties in its classpath to setup the
server connection information</p>
</li>
<li>
<p>Either has a jndi.properties to specify the
java.naming.factory.url.pkgs property or passes that as a property to
the InitialContext constructor</p>
</li>
<li>
<p>Setup the client classpath to include the jboss-client jar that&#8217;s
required for remote invocation of the EJBs. The location of the jar is
mentioned above. You&#8217;ll also need to have your application&#8217;s bean
interface jars and other jars that are required by your application, in
the client classpath</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb_invocations_from_a_remote_server_instance">30. EJB invocations from a remote server instance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The purpose of this chapter is to demonstrate how to lookup and invoke
on EJBs deployed on an WildFly server instance <strong>from another</strong> WildFly
server instance. This is different from invoking the EJBs
<a href="https://docs.jboss.org/author/display/AS71/EJB+invocations+from+a+remote+client+using+JNDI">from
a remote standalone client</a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s call the server, from which the invocation happens to the EJB, as
"Client Server" and the server on which the bean is deployed as the
"Destination Server".</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that this chapter deals with the case where the bean is deployed on
the "Destination Server" but <strong>not</strong> on the "Client Server".
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="application-packaging">30.1. Application packaging</h3>
<div class="paragraph">
<p>In this example, we&#8217;ll consider a EJB which is packaged in a myejb.jar
which is within a myapp.ear. Here&#8217;s how it would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myapp.ear
|
|---- myejb.jar
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|---- &lt;org.myapp.ejb.*&gt; <span class="comment">// EJB classes</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that packaging itself isn&#8217;t really important in the context of this
article. You can deploy the EJBs in any standard way (.ear, .war or
.jar).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="beans">30.2. Beans</h3>
<div class="paragraph">
<p>In our example, we&#8217;ll consider a simple stateless session bean which is
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.myapp.ejb</span>;
<span class="error"> </span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">Greeter</span> {
<span class="error"> </span><span class="error"> </span> <span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="predefined-type">String</span> greet(<span class="predefined-type">String</span> user);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.myapp.ejb</span>;
<span class="error"> </span>
<span class="keyword">import</span> <span class="include">javax.ejb.Remote</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Stateless</span>;
<span class="error"> </span>
<span class="annotation">@Stateless</span>
<span class="annotation">@Remote</span> (Greeter.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GreeterBean</span> <span class="directive">implements</span> Greeter {
<span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="directive">public</span> <span class="predefined-type">String</span> greet(<span class="predefined-type">String</span> user) {
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + user + <span class="string"><span class="delimiter">&quot;</span><span class="content">, have a pleasant day!</span><span class="delimiter">&quot;</span></span>;
<span class="error"> </span><span class="error"> </span><span class="error"> </span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security">30.3. Security</h3>
<div class="paragraph">
<p>WildFly 11 is secure by default. What this means is that no communication
can happen with an WildFly instance from a remote client (irrespective
of whether it is a standalone client or another server instance) without
passing the appropriate credentials. Remember that in this example, our
"client server" will be communicating with the "destination server". So
in order to allow this communication to happen successfully, we&#8217;ll have
to configure user credentials which we will be using during this
communication. So let&#8217;s start with the necessary configurations for
this.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-user-on-the-destination-server">30.4. Configuring a user on the "Destination Server"</h3>
<div class="paragraph">
<p>As a first step we&#8217;ll configure a user on the destination server who
will be allowed to access the destination server. We create the user
using the <code>add-user</code> script that&#8217;s available in the JBOSS_HOME/bin
folder. In this example, we&#8217;ll be configuring a <code>Application User</code> named
<code>ejb</code> and with a password <code>test</code> in the <code>ApplicationRealm</code>. Running the
<code>add-user</code> script is an interactive process and you will see
questions/output as follows:</p>
</div>
<div class="paragraph">
<p>add-user</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jpai<span class="annotation">@jpai</span>-laptop:bin<span class="error">$</span> ./add-user.sh
<span class="error"> </span>
What type of user <span class="keyword">do</span> you wish to add?
&amp;nbsp;a) Management User (mgmt-users.properties)
&amp;nbsp;b) Application User (application-users.properties)
(a): b
<span class="error"> </span>
Enter the details of the <span class="keyword">new</span> user to add.
Realm (ApplicationRealm) :
Username : ejb
Password :
Re-enter Password :
What roles <span class="keyword">do</span> you want <span class="local-variable">this</span> user to belong to? (Please enter a comma separated list, or leave blank <span class="keyword">for</span> none)<span class="error">\</span>[&amp;nbsp; <span class="error">\</span>]:
About to add user <span class="string"><span class="delimiter">'</span><span class="content">ejb</span><span class="delimiter">'</span></span> <span class="keyword">for</span> realm <span class="string"><span class="delimiter">'</span><span class="content">ApplicationRealm</span><span class="delimiter">'</span></span>
Is <span class="local-variable">this</span> correct yes/no? yes
Added user <span class="string"><span class="delimiter">'</span><span class="content">ejb</span><span class="delimiter">'</span></span> to file <span class="string"><span class="delimiter">'</span><span class="content">/jboss-as-7.1.1.Final/standalone/configuration/application-users.properties</span><span class="delimiter">'</span></span>
Added user <span class="string"><span class="delimiter">'</span><span class="content">ejb</span><span class="delimiter">'</span></span> to file <span class="string"><span class="delimiter">'</span><span class="content">/jboss-as-7.1.1.Final/domain/configuration/application-users.properties</span><span class="delimiter">'</span></span>
Added user <span class="string"><span class="delimiter">'</span><span class="content">ejb</span><span class="delimiter">'</span></span> with roles to file <span class="string"><span class="delimiter">'</span><span class="content">/jboss-as-7.1.1.Final/standalone/configuration/application-roles.properties</span><span class="delimiter">'</span></span>
Added user <span class="string"><span class="delimiter">'</span><span class="content">ejb</span><span class="delimiter">'</span></span> with roles to file <span class="string"><span class="delimiter">'</span><span class="content">/jboss-as-7.1.1.Final/domain/configuration/application-roles.properties</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the output above we have now configured a user on the
destination server who&#8217;ll be allowed to access this server. We&#8217;ll use
this user credentials later on in the client server for communicating
with this server. The important bits to remember are the user we have
created in this example is <code>ejb</code> and the password is <code>test.</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that you can use any username and password combination you want to.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You do <strong>not</strong> require the server to be started to add a user using the
add-user script.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="start-the-destination-server">30.5. Start the "Destination Server"</h3>
<div class="paragraph">
<p>As a next step towards running this example, we&#8217;ll start the
"Destination Server". In this example, we&#8217;ll use the standalone server
and use the <em>standalone-full.xml</em> configuration. The startup command
will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./standalone.sh -server-config=standalone-full.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that the server has started without any errors.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It&#8217;s very important to note that if you are starting both the server
instances on the same machine, then each of those server instances
<strong>must</strong> have a unique <code>jboss.node.name</code> system property. You can do that
by passing an appropriate value for <code>-Djboss.node.name</code> system property
to the startup script:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./standalone.sh -server-config=standalone-full.xml -Djboss.node.name=&lt;add appropriate value here&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-the-application">30.6. Deploying the application</h3>
<div class="paragraph">
<p>The application ( <em>myapp.ear</em> in our case) will be deployed to
"Destination Server". The process of deploying the application is out of
scope of this chapter. You can either use the Command Line Interface or
the Admin console or any IDE or manually copy it to
JBOSS_HOME/standalone/deployments folder (for standalone server). Just
ensure that the application has been deployed successfully.</p>
</div>
<div class="paragraph">
<p>So far, we have built a EJB application and deployed it on the
"Destination Server". Now let&#8217;s move to the "Client Server" which acts
as the client for the deployed EJBs on the "Destination Server".</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-client-server-to-point-to-the-ejb-remoting-connector-on-the-destination-server">30.7. Configuring the "Client Server" to point to the EJB remoting connector</h3>
<div class="paragraph">
<p>on the "Destination Server"</p>
</div>
<div class="paragraph">
<p>As a first step on the "Client Server", we need to let the server know
about the "Destination Server"'s EJB remoting connector, over which it
can communicate during the EJB invocations. To do that, we&#8217;ll have to
add a " <em>remote-outbound-connection</em>" to the remoting subsystem on the
"Client Server". The " <em>remote-outbound-connection</em>" configuration
indicates that a outbound connection will be created to a remote server
instance from that server. The " <em>remote-outbound-connection</em>" will be
backed by a " <em>outbound-socket-binding</em>" which will point to a remote
host and a remote port (of the "Destination Server"). So let&#8217;s see how
we create these configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="start-the-client-server">30.8. Start the "Client Server"</h3>
<div class="paragraph">
<p>In this example, we&#8217;ll start the "Client Server" on the same machine as
the "Destination Server". We have copied the entire server installation
to a different folder and while starting the "Client Server" we&#8217;ll use a
port-offset (of 100 in this example) to avoid port conflicts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./standalone.sh -server-config=standalone-full.xml -Djboss.socket.binding.port-offset=<span class="integer">100</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-a-security-realm-on-the-client-server">30.9. Create a security realm on the client server</h3>
<div class="paragraph">
<p>Remember that we need to communicate with a secure destination server.
In order to do that the client server has to pass the user credentials
to the destination server. Earlier we created a user on the destination
server who&#8217;ll be allowed to communicate with that server. Now on the
"client server" we&#8217;ll create a security-realm which will be used to pass
the user information.</p>
</div>
<div class="paragraph">
<p>In this example we&#8217;ll use a security realm which stores a Base64 encoded
password and then passes on that credentials when asked for. Earlier we
created a user named <code>ejb</code> and password <code>test</code>. So our first task here
would be to create the base64 encoded version of the password <code>test</code>.
You can use any utility which generates you a base64 version for a
string. I used <a href="http://www.base64encode.org/">this online site</a> which
generates the base64 encoded string. So for the <code>test</code> password, the
base64 encoded version is <code>dGVzdA==</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
While generating the base64 encoded string make sure that you don&#8217;t have
any trailing or leading spaces for the original password. That can lead
to incorrect encoded versions being generated.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
With new versions the add-user script will show the base64 password if
you type 'y' if you&#8217;ve been ask
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Is <span class="local-variable">this</span> <span class="keyword">new</span> user going to be used <span class="keyword">for</span> one AS process to connect to another AS process e.g. slave domain controller?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have generated that base64 encoded password, let&#8217;s use in
the in the security realm that we are going to configure on the "client
server". I&#8217;ll first shutdown the client server and edit the
standalone-full.xml file to add the following in the <code>&lt;management&gt;</code>
section</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a " <em>security-realm</em>" for the base64 encoded password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/core-service=management/security-realm=ejb-security-realm:add()
/core-service=management/security-realm=ejb-security-realm/server-identity=secret:add(value=dGVzdA==)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice that the CLI show the message <em>"process-state" &#8658;
"reload-required"</em>, so you have to restart the server before you can use
this change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>upon successful invocation of this command, the following configuration
will be created in the <em>management</em> section:</p>
</div>
<div class="paragraph">
<p>standalone-full.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;management&gt;
        &lt;security-realms&gt;
            ...
            &lt;security-realm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-security-realm</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;server-identities&gt;
                    &lt;secret value=<span class="string"><span class="delimiter">&quot;</span><span class="content">dGVzdA==</span><span class="delimiter">&quot;</span></span>/&gt;
                &lt;/server-identities&gt;
            &lt;/security-realm&gt;
        &lt;/security-realms&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see I have created a security realm named
"ejb-security-realm" (you can name it anything) with the base64 encoded
password. So that completes the security realm configuration for the
client server. Now let&#8217;s move on to the next step.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-a-outbound-socket-binding-on-the-client-server">30.10. Create a outbound-socket-binding on the "Client Server"</h3>
<div class="paragraph">
<p>Let&#8217;s first create a <em>outbound-socket-binding</em> which points the
"Destination Server"'s host and port. We&#8217;ll use the CLI to create this
configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=remote-ejb:add(host=localhost, port=<span class="integer">8080</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command will create a outbound-socket-binding named "
<em>remote-ejb</em>" (we can name it anything) which points to "localhost" as
the host and port 8080 as the destination port. Note that the host
information should match the host/IP of the "Destination Server" (in
this example we are running on the same machine so we use "localhost")
and the port information should match the http-remoting connector port
used by the EJB subsystem (by default it&#8217;s 8080). When this command is
run successfully, we&#8217;ll see that the standalone-full.xml (the file which
we used to start the server) was updated with the following
outbound-socket-binding in the socket-binding-group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;socket-binding-group name=<span class="string"><span class="delimiter">&quot;</span><span class="content">standard-sockets</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-<span class="type">interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span> <span class="class">port</span>-offset=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.socket.binding.port-offset:0}</span><span class="delimiter">&quot;</span></span>&gt;
        ...
        &lt;outbound-socket-binding name=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-ejb</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;remote-destination host=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span> port=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/outbound-socket-binding&gt;
    &lt;/socket-binding-group&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-a-remote-outbound-connection-which-uses-this-newly-created-outbound-socket-binding">30.11. Create a "remote-outbound-connection" which uses this newly created</h3>
<div class="paragraph">
<p>"outbound-socket-binding"</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a " <em>remote-outbound-connection</em>" which will use the
newly created outbound-socket-binding (pointing to the EJB remoting
connector of the "Destination Server"). We&#8217;ll continue to use the CLI to
create this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=remoting/remote-outbound-connection=remote-ejb-connection:add(outbound-socket-binding-ref=remote-ejb, protocol=http-remoting, security-realm=ejb-security-realm, username=ejb)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command creates a remote-outbound-connection, named "
<em>remote-ejb-connection</em>" (we can name it anything), in the remoting
subsystem and uses the previously created " <em>remote-ejb</em>"
outbound-socket-binding (notice the outbound-socket-binding-ref in that
command) with the http-remoting protocol. Furthermore, we also set the
security-realm attribute to point to the security-realm that we created
in the previous step. Also notice that we have set the username
attribute to use the user name who is allowed to communicate with the
destination server.</p>
</div>
<div class="paragraph">
<p>What this step does is, it creates a outbound connection, on the client
server, to the remote destination server and sets up the username to the
user who allowed to communicate with that destination server and also
sets up the security-realm to a pre-configured security-realm capable of
passing along the user credentials (in this case the password). This way
when a connection has to be established from the client server to the
destination server, the connection creation logic will have the
necessary security credentials to pass along and setup a successful
secured connection.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s run the following two operations to set some default
connection creation options for the outbound connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=remoting/remote-outbound-connection=remote-ejb-connection/property=SASL_POLICY_NOANONYMOUS:add(value=<span class="predefined-constant">false</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=remoting/remote-outbound-connection=remote-ejb-connection/property=SSL_ENABLED:add(value=<span class="predefined-constant">false</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ultimately, upon successful invocation of this command, the following
configuration will be created in the remoting subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:remoting:1.1</span><span class="delimiter">&quot;</span></span>&gt;
....
            &lt;outbound-connections&gt;
                &lt;remote-outbound-connection name=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-ejb-connection</span><span class="delimiter">&quot;</span></span> outbound-socket-binding-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-ejb</span><span class="delimiter">&quot;</span></span> protocol=<span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting</span><span class="delimiter">&quot;</span></span> security-realm=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb-security-realm</span><span class="delimiter">&quot;</span></span> username=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb</span><span class="delimiter">&quot;</span></span>&gt;
                    &lt;properties&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">SASL_POLICY_NOANONYMOUS</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSL_ENABLED</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> &lt;/properties&gt;
                &lt;/remote-outbound-connection&gt;
            &lt;/outbound-connections&gt;
        &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From a server configuration point of view, that&#8217;s all we need on the
"Client Server". Our next step is to deploy an application on the
"Client Server" which will invoke on the bean deployed on the
"Destination Server".</p>
</div>
</div>
<div class="sect2">
<h3 id="packaging-the-client-application-on-the-client-server">30.12. Packaging the client application on the "Client Server"</h3>
<div class="paragraph">
<p>Like on the "Destination Server", we&#8217;ll use .ear packaging for the
client application too. But like previously mentioned, that&#8217;s not
mandatory. You can even use a .war or .jar deployments. Here&#8217;s how our
client application packaging will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client-app.ear
|
|--- META-INF
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|--- jboss-ejb-client.xml
|
|--- web.war
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|--- WEB-INF/classes
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|
|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|<span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span>|---- &lt;org.myapp.FooServlet&gt; <span class="comment">// classes in the web app</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the client application we&#8217;ll use a servlet which invokes on the bean
deployed on the "Destination Server". We can even invoke the bean on the
"Destination Server" from a EJB on the "Client Server". The code remains
the same (JNDI lookup, followed by invocation on the proxy). The
important part to notice in this client application is the file
<em>jboss-ejb-client.xml</em> which is packaged in the META-INF folder of a top
level deployment (in this case our client-app.ear). This
<em>jboss-ejb-client.xml</em> contains the EJB client configurations which will
be used during the EJB invocations for finding the appropriate
destinations (also known as, EJB receivers). The contents of the
jboss-ejb-client.xml are explained next.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your application is deployed as a top level .war deployment, then the
jboss-ejb-client.xml is expected to be placed in .war/WEB-INF/ folder
(i.e. the same location where you place any web.xml file).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="contents-on-jboss-ejb-client.xml">30.13. Contents on jboss-ejb-client.xml</h3>
<div class="paragraph">
<p>The jboss-ejb-client.xml will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-ejb-client xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:ejb-client:1.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;client-context&gt;
        &lt;ejb-receivers&gt;
            &lt;remoting-ejb-receiver outbound-connection-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-ejb-connection</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/ejb-receivers&gt;
    &lt;/client-context&gt;
&lt;/jboss-ejb-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that we have configured the EJB client context (for this
application) to use a remoting-ejb-receiver which points to our earlier
created " <em>remote-outbound-connection</em>" named "
<em>remote-ejb-connection</em>". This links the EJB client context to use the "
<em>remote-ejb-connection</em>" which ultimately points to the EJB remoting
connector on the "Destination Server".</p>
</div>
</div>
<div class="sect2">
<h3 id="deploy-the-client-application">30.14. Deploy the client application</h3>
<div class="paragraph">
<p>Let&#8217;s deploy the client application on the "Client Server". The process
of deploying the application is out of scope, of this chapter. You can
use either the CLI or the admin console or a IDE or deploy manually to
JBOSS_HOME/standalone/deployments folder. Just ensure that the
application is deployed successfully.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-code-invoking-the-bean">30.15. Client code invoking the bean</h3>
<div class="paragraph">
<p>We mentioned that we&#8217;ll be using a servlet to invoke on the bean, but
the code to invoke the bean isn&#8217;t servlet specific and can be used in
other components (like EJB) too. So let&#8217;s see how it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.naming.Context</span>;
<span class="keyword">import</span> <span class="include">java.util.Hashtable</span>;
<span class="keyword">import</span> <span class="include">javax.naming.InitialContext</span>;
<span class="error"> </span>
...
public <span class="type">void</span> invokeOnBean() {
        <span class="keyword">try</span> {
            <span class="directive">final</span> <span class="predefined-type">Hashtable</span> props = <span class="keyword">new</span> <span class="predefined-type">Hashtable</span>();
            <span class="comment">// setup the ejb: namespace URL factory</span>
            props.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
            <span class="comment">// create the InitialContext</span>
            <span class="directive">final</span> <span class="predefined-type">Context</span> context = <span class="keyword">new</span> javax.naming.InitialContext(props);
<span class="error"> </span>
            <span class="comment">// Lookup the Greeter bean using the ejb: namespace syntax which is explained here https://docs.jboss.org/author/display/AS71/EJB+invocations+from+a+remote+client+using+JNDI</span>
            <span class="directive">final</span> Greeter bean = (Greeter) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">myapp</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">myejb</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">GreeterBean</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span> + org.myapp.ejb.Greeter.class.getName());
<span class="error"> </span>
   <span class="comment">// invoke on the bean</span>
   <span class="directive">final</span> <span class="predefined-type">String</span> greeting = bean.greet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tom</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span>
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received greeting: </span><span class="delimiter">&quot;</span></span> + greeting);
<span class="error"> </span>
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it! The above code will invoke on the bean deployed on the
"Destination Server" and return the result.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remote_ejb_invocations_via_jndi_ejb_client_api_or_remote_naming_project">31. Remote EJB invocations via JNDI - EJB client API or remote-naming project</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="purpose">31.1. Purpose</h3>
<div class="paragraph">
<p>WildFly provides EJB client API project as well as remote-naming project
for invoking on remote objects exposed via JNDI. This article explains
which approach to use when and what the differences and scope of each of
these projects is.</p>
</div>
</div>
<div class="sect2">
<h3 id="history">31.2. History</h3>
<div class="paragraph">
<p>Previous versions of JBoss AS (versions &lt; WildFly 11) used JNP project (
<a href="http://anonsvn.jboss.org/repos/jbossas/projects/naming/" class="bare">http://anonsvn.jboss.org/repos/jbossas/projects/naming/</a>) as the JNDI
naming implementation. Developers of client applications of previous
versions of JBoss AS will be familiar with the <code>jnp:// PROVIDER_URL</code> URL
they used to use in their applications for communicating with the JNDI
server on the JBoss server.</p>
</div>
<div class="paragraph">
<p>Starting WildFly 11, the JNP project is <em>not</em> used. Neither on the server
side nor on the client side. The client side of the JNP project has now
been replaced by jboss-remote-naming project (
<a href="https://github.com/jbossas/jboss-remote-naming" class="bare">https://github.com/jbossas/jboss-remote-naming</a>). There were various
reasons why the JNP client was replaced by jboss-remote-naming project.
One of them was the JNP project did not allow fine grained security
configurations while communicating with the JNDI server. The
jboss-remote-naming project is backed by the jboss-remoting project (
<a href="https://github.com/jboss-remoting/jboss-remoting" class="bare">https://github.com/jboss-remoting/jboss-remoting</a>) which allows much more
and better control over security.</p>
</div>
</div>
<div class="sect2">
<h3 id="overview">31.3. Overview</h3>
<div class="paragraph">
<p>Now that we know that for remote client JNDI communication with WildFly
8 requires jboss-remote-naming project, let&#8217;s quickly see what the code
looks like.</p>
</div>
<div class="sect3">
<h4 id="client-code-relying-on-jndi.properties-in-classpath">31.3.1. Client code relying on jndi.properties in classpath</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> doLookup() {
  <span class="comment">// Create an InitialContext using the javax.naming.* API</span>
  <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
  ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there&#8217;s not much here in terms of code. We first create
a InitialContext (
<a href="http://download.oracle.com/javase/6/docs/api/javax/naming/InitialContext.html" class="bare">http://download.oracle.com/javase/6/docs/api/javax/naming/InitialContext.html</a>)
which as per the API will look for a jndi.properties in the classpath of
the application. We&#8217;ll see what our jndi.properties looks like, later.
Once the InitialContext is created, we just use it to do a lookup on a
JNDI name which we know is bound on the server side. We&#8217;ll come back to
the details of this lookup string in a while.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now see what the jndi.properties in our client classpath looks
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java.naming.factory.initial=org.jboss.naming.remote.client.InitialContextFactory
java.naming.provider.url=http-remoting:<span class="comment">//localhost:8080</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Those 2 properties are important for jboss-remote-naming project to be
used for communicating with the WildFly server. The first property tells
the JNDI API which initial context factory to use. In this case we are
pointing it to the InitailContextFactory class supplied by the
jboss-remote-naming project. The other property is the PROVIDER_URL.
Developers familiar with previous JBoss AS versions would remember that
they used <code>jnp://localhost:1099</code> (just an example). In WildFly, the URI
protocol scheme for jboss-remote-naming project is <code>remote://</code>. The rest
of the PROVIDER_URL part is the server hostname or IP and the port on
which the remoting connector is exposed on the server side. By default
the http-remoting connector port in WildFly 11 is 8080. That&#8217;s what we
have used in our example. The hostname we have used is localhost but
that should point to the server IP or hostname where the server is
running.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
JNP client project in previous AS versions allowed a comma separated
list for PROVIDER_URL value, so that if one of the server isn&#8217;t
accessible then the JNDI API would use the next available server. The
jboss-remote-naming project has similar support starting 1.0.3.Final
version of that project (which is available in a WildFly release <strong>after</strong>
7.1.1.Final).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>WildFly 11 can use the PROVIDER_URL like:</p>
</div>
<div class="paragraph">
<p>java.naming.provider.url=http-remoting://server1:8080,http-remoting://server2:8080</p>
</div>
<div class="paragraph">
<p>So we saw how to setup the JNDI properties in the jndi.properties file.
The JNDI API also allows you to pass these properties to the constructor
of the InitialContext class (please check the javadoc of that class for
more details). Let&#8217;s quickly see what the code would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> doLookup() {
  <span class="predefined-type">Properties</span> jndiProps = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
  jndiProps.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.naming.remote.client.InitialContextFactory</span><span class="delimiter">&quot;</span></span>);
  jndiProps.put(<span class="predefined-type">Context</span>.PROVIDER_URL,<span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting://localhost:8080</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// create a context passing these properties</span>
  <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProps);
  <span class="comment">// lookup</span>
  ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it! You can see that the values that we pass to those properties
are the same as what we did via the jndi.properties. It&#8217;s upto the
client application to decide which approach they want to follow.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-remoting-naming-work">31.3.2. How does remoting naming work</h4>
<div class="paragraph">
<p>We have so far had an overview of how the client code looks like when
using the jboss-remote-naming (henceforth referred to as remote-naming -
too tired of typing jboss-remote-naming everytime
<span class="image"><img src="images/s/en_GB/7202/8bb4a7d7a43e6723fe7875221f32b3124c55e6e1/<em>/images/icons/emoticons/wink0.png" alt="images/s/en_GB/7202/8bb4a7d7a43e6723fe7875221f32b3124c55e6e1/</em>/images/icons/emoticons/wink0.png"></span>
) project. Let&#8217;s now have a brief look at how the remote-naming project
internally establishes the communication with the server and allows JNDI
operations from the client side.</p>
</div>
<div class="paragraph">
<p>Like previously mentioned, remote-naming internally uses jboss-remoting
project. When the client code creates an InitialContext backed by the
org.jboss.naming.remote.client.InitialContextFactory class, the
<code>org.jboss.naming.remote.client.InitialContextFactory</code> internally looks
for the PROVIDER_URL (and other) properties that are applicable for that
context ( <em>doesn&#8217;t</em> matter whether it comes from the jndi.properties
file or whether passed explicitly to the constructor of the
InitialContext). Once it identifies the server and port to connect to,
the remote-naming project internally sets up a connection using the
jboss-remoting APIs with the remoting connector which is exposed on that
port.</p>
</div>
<div class="paragraph">
<p>We previously mentioned that remote-naming, backed by jboss-remoting
project, has increased support for security configurations. Starting
WildFly 11, every service including the http remoting connector (which
listens by default on port 8080), is secured (see
<a href="https://community.jboss.org/wiki/AS710Beta1-SecurityEnabledByDefault" class="bare">https://community.jboss.org/wiki/AS710Beta1-SecurityEnabledByDefault</a> for
details). This means that when trying to do JNDI operations like a
lookup, the client has to pass appropriate user credentials. In our
examples so far we haven&#8217;t passed any username/pass or any other
credentials while creating the InitialContext. That was just to keep the
examples simple. But let&#8217;s now take the code a step further and see one
of the ways how we pass the user credentials. Let&#8217;s at the moment just
assume that the remoting connector on port 8080 is accessible to a user
named " `peter`" whose password is expected to be " `lois`".</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note: The server side configurations for the remoting connector to allow
"peter" to access the connector, is out of the scope of this
documentation. The WildFly 11 documentation already has chapters on how
to set that up.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> doLookup() {
  <span class="predefined-type">Properties</span> jndiProps = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
  jndiProps.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.naming.remote.client.InitialContextFactory</span><span class="delimiter">&quot;</span></span>);
  jndiProps.put(<span class="predefined-type">Context</span>.PROVIDER_URL,<span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting://localhost:8080</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// username</span>
  jndiProps.put(<span class="predefined-type">Context</span>.SECURITY_PRINCIPAL, <span class="string"><span class="delimiter">&quot;</span><span class="content">peter</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// password</span>
  jndiProps.put(<span class="predefined-type">Context</span>.SECURITY_CREDENTIALS, <span class="string"><span class="delimiter">&quot;</span><span class="content">lois</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// create a context passing these properties</span>
  <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProps);
  <span class="comment">// lookup</span>
  ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code is similar to our previous example, except that we now have
added 2 additional properties that are passed to the InitialContext
constructor. The first is
<a href="http://docs.oracle.com/javase/6/docs/api/javax/naming/Context.html#SECURITY_PRINCIPAL" class="bare">http://docs.oracle.com/javase/6/docs/api/javax/naming/Context.html#SECURITY_PRINCIPAL</a>
which passes the username (peter in this case) and the second is
<a href="http://docs.oracle.com/javase/6/docs/api/javax/naming/Context.html#SECURITY_CREDENTIALS" class="bare">http://docs.oracle.com/javase/6/docs/api/javax/naming/Context.html#SECURITY_CREDENTIALS</a>
which passes the password (lois in this case). Of course the same
properties can be configured in the jndi.properties file (read the
javadoc of the Context class for appropriate properties to be used in
the jndi.properties). This is one way of passing the security
credentials for JNDI communication with WildFly. There are some other
ways to do this too. But we won&#8217;t go into those details here for two
reasons. One, it&#8217;s outside the scope of this article and two (which is
kind of the real reason) I haven&#8217;t looked fully at the remote-naming
implementation details to see what other ways are allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="jndi-operations-allowed-using-remote-naming-project">31.3.3. JNDI operations allowed using remote-naming project</h4>
<div class="paragraph">
<p>So far we have mainly concentrated on how the naming context is created
and what it internally does when an instance is created. Let&#8217;s now take
this one step further and see what kind of operations are allowed for a
JNDI context backed by the remote-naming project.</p>
</div>
<div class="paragraph">
<p>The JNDI Context has various methods
<a href="http://docs.oracle.com/javase/6/docs/api/javax/naming/Context.html" class="bare">http://docs.oracle.com/javase/6/docs/api/javax/naming/Context.html</a> that
are exposed for JNDI operations. One important thing to note in case of
remote-naming project is that, the project&#8217;s scope is to allow a client
to communicate with the JNDI backend exposed by the server. As such, the
remote-naming project does <strong>not</strong> support many of the methods that are
exposed by the javax.naming.Context class. The remote-naming project
only supports the read-only kind of methods (like the lookup() method)
and does not support any write kind of methods (like the bind() method).
The client applications are expected to use the remote-naming project
mainly for lookups of JNDI objects. Neither WildFly 11 nor remote-naming
project allows writing/binding to the JNDI server from a remote
application.</p>
</div>
</div>
<div class="sect3">
<h4 id="pre-requisites-of-remotely-accessible-jndi-objects">31.3.4. Pre-requisites of remotely accessible JNDI objects</h4>
<div class="paragraph">
<p>On the server side, the JNDI can contain numerous objects that are bound
to it. However, <em>not</em> all of those are exposed remotely. The two
conditions that are to be satisfied by the objects bound to JNDI, to be
remotely accessible are:</p>
</div>
<div class="paragraph">
<p>1) Such objects should be bound under the <code>java:jboss/exported/</code>
namespace. For example, <code>java:jboss/exported/foo/bar</code><br>
2) Objects bound to the <code>java:jboss/exported/</code> namespace are expected to
be serializable. This allows the objects to be sent over the wire to the
remote clients</p>
</div>
<div class="paragraph">
<p>Both these conditions are important and are required for the objects to
be remotely accessible via JNDI.</p>
</div>
</div>
<div class="sect3">
<h4 id="jndi-lookup-strings-for-remote-clients-backed-by-the-remote-naming-project">31.3.5. JNDI lookup strings for remote clients backed by the remote-naming</h4>
<div class="paragraph">
<p>project</p>
</div>
<div class="paragraph">
<p>In our examples, so far, we have been consistently using " `foo/bar`" as
the JNDI name to lookup from a remote client using the remote-naming
project. There&#8217;s a bit more to understand about the JNDI name and how it
maps to the JNDI name that&#8217;s bound on the server side.</p>
</div>
<div class="paragraph">
<p>First of all, the JNDI names used while using the remote-naming project
are <strong>always</strong> relative to the java:jboss/exported/ namespace. So in our
examples, we are using " `foo/bar`" JNDI name for the lookup, that
actually is (internally) " `java:jboss/exported/foo/bar`". The
remote-naming project expects it to <strong>always</strong> be relative to the "
`java:jboss/exported/`" namespace. Once connected with the server side,
the remote-naming project will lookup for "foo/bar" JNDI name under the
" `java:jboss/exported/`" namespace of the server.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note: Since the JNDI name that you use on the client side is <strong>always</strong>
relative to java:jboss/exported namespace, you <strong>shouldn&#8217;t</strong> be prefixing
the java:jboss/exported/ string to the JNDI name. For example, if you
use the following JNDI name:
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ctx.lookup("java:jboss/exported/helloworld");</p>
</div>
<div class="paragraph">
<p>then remote-naming will translate it to</p>
</div>
<div class="paragraph">
<p>ctx.lookup("java:jboss/exported/java:jboss/exported/helloworld");</p>
</div>
<div class="paragraph">
<p>and as a result, will fail during lookup.</p>
</div>
<div class="paragraph">
<p>The remote-naming implementation perhaps should be smart enough to strip
off the java:jboss/exported/ namespace prefix if supplied. But let&#8217;s not
go into that here.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-remote-naming-project-implementation-transfer-the-jndi-objects-to-the-clients">31.3.6. How does remote-naming project implementation transfer the JNDI</h4>
<div class="paragraph">
<p>objects to the clients</p>
</div>
<div class="paragraph">
<p>When a lookup is done on a JNDI string, the remote-naming implementation
internally uses the connection to the remoting connector (which it has
established based on the properties that were passed to the
InitialContext) to communicate with the server. On the server side, the
implementation then looks for the JNDI name under the
<code>java:jboss/exported/</code> namespace. Assuming that the JNDI name is
available, under that namespace, the remote-naming implementation then
passes over the object bound at that address to the client. This is
where the requirement about the JNDI object being serializable comes
into picture. remote-naming project internally uses jboss-marshalling
project to marshal the JNDI object over to the client. On the client
side the remote-naming implementation then unmarshalles the object and
returns it to the client application.</p>
</div>
<div class="paragraph">
<p>So literally, each lookup backed by the remote-naming project entails a
server side communication/interaction and then marshalling/unmarshalling
of the object graph. This is very important to remember. We&#8217;ll come back
to this later, to see why this is important when it comes to using EJB
client API project for doing EJB lookups ( <a href="#src-557285">EJB
invocations from a remote client using JNDI</a>) as against using
remote-naming project for doing the same thing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="summary">31.4. Summary</h3>
<div class="paragraph">
<p>That pretty much covers whatever is important to know, in the
remote-naming project, for a typical client application. Don&#8217;t close the
browser yet though, since we haven&#8217;t yet come to the part of EJB
invocations from a remote client using the remote-naming project. In
fact, the motivation behind writing this article was to explain why
<em>not</em> to use remote-naming project (in most cases) for doing EJB
invocations against WildFly server.</p>
</div>
<div class="paragraph">
<p>Those of you who don&#8217;t have client applications doing remote EJB
invocations, can just skip the rest of this article if you aren&#8217;t
interested in those details.</p>
</div>
</div>
<div class="sect2">
<h3 id="remote-ejb-invocations-backed-by-the-remote-naming-project">31.5. Remote EJB invocations backed by the remote-naming project</h3>
<div class="paragraph">
<p>In previous sections of this article we saw that whatever is exposed in
the java:jboss/exported/ namespace is accessible remotely to the client
applications under the relative JNDI name. Some of you might already
have started thinking about exposing remote views of EJBs under that
namespace.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that WildFly server side already by default
exposes the remote views of a EJB under the <code>java:jboss/exported/</code>
namespace (although it isn&#8217;t logged in the server logs). So assuming
your server side application has the following stateless bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.myapp.ejb</span>;
<span class="error"> </span>
<span class="annotation">@Stateless</span>
<span class="annotation">@Remote</span>(Foo.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FooBean</span> <span class="directive">implements</span> Foo {
...
 public <span class="predefined-type">String</span> sayBar() {
     <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Baaaaaaaar</span><span class="delimiter">&quot;</span></span>;
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the " <code>Foo`" remote view is exposed under the
`java:jboss/exported/</code> namespace under the following JNDI name scheme
(which is similar to that mandated by EJB3.1 spec for <code>java:global/</code>
namespace):
<a href="/pages/createpage.action?spaceKey=WFLY&amp;title=app-name&amp;linkCreation=true&amp;fromPageId=557285">app-name</a></p>
</div>
<div class="paragraph">
<p><code>app-name/module-name/bean-name!bean-interface</code></p>
</div>
<div class="paragraph">
<p>where,</p>
</div>
<div class="paragraph">
<p><code>app-name</code> = the name of the .ear (without the .ear suffix) or the
application name configured via application.xml deployment descriptor.
If the application isn&#8217;t packaged in a .ear then there will be <strong>no</strong>
app-name part to the JNDI string.<br>
<code>module-name</code> = the name of the .jar or .war (without the .jar/.war
suffix) in which the bean is deployed or the module-name configured in
web.xml/ejb-jar.xml of the deployment. The module name is mandatory part
in the JNDI string.<br>
<code>bean-name</code> = the name of the bean which by default is the simple name
of the bean implementation class. Of course it can be overridden either
by using the "name" attribute of the bean definining annotation
(@Stateless(name="blah") in this case) or even the ejb-jar.xml
deployment descriptor.<br>
<code>bean-interface</code> = the fully qualified class name of the interface being
exposed by the bean.</p>
</div>
<div class="paragraph">
<p>So in our example above, let&#8217;s assume the bean is packaged in a
myejbmodule.jar which is within a myapp.ear. So the JNDI name for the
Foo remote view under the <code>java:jboss/exported/</code> namespace would be:</p>
</div>
<div class="paragraph">
<p><code>java:jboss/exported/myapp/myejbmodule/FooBean!org.myapp.ejb.Foo</code></p>
</div>
<div class="paragraph">
<p>That&#8217;s where WildFly will <strong>automatically</strong> expose the remote views of the
EJBs under the <code>java:jboss/exported/</code> namespace, <strong>in addition to</strong> the
java:global/ java:app/ java:module/ namespaces mandated by the EJB 3.1
spec.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that only the java:jboss/exported/ namespace is available to remote
clients.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So the next logical question would be, are these remote views of EJBs
accessible and invokable using the remote-naming project on the client
application. The answer is <em>yes</em>! Let&#8217;s quickly see the client code for
invoking our <code>FooBean</code>. Again, let&#8217;s just use " `peter`" and " `lois`"
as username/pass for connecting to the remoting connector.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> doBeanLookup() {
  ...
  Properties jndiProps = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
  jndiProps.put(<span class="predefined-type">Context</span>.INITIAL_CONTEXT_FACTORY, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.naming.remote.client.InitialContextFactory</span><span class="delimiter">&quot;</span></span>);
  jndiProps.put(<span class="predefined-type">Context</span>.PROVIDER_URL,<span class="string"><span class="delimiter">&quot;</span><span class="content">http-remoting://localhost:8080</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// username</span>
  jndiProps.put(<span class="predefined-type">Context</span>.SECURITY_PRINCIPAL, <span class="string"><span class="delimiter">&quot;</span><span class="content">peter</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// password</span>
  jndiProps.put(<span class="predefined-type">Context</span>.SECURITY_CREDENTIALS, <span class="string"><span class="delimiter">&quot;</span><span class="content">lois</span><span class="delimiter">&quot;</span></span>);
  <span class="comment">// This is an important property to set if you want to do EJB invocations via the remote-naming project</span>
  jndiProps.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.naming.client.ejb.context</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
  <span class="comment">// create a context passing these properties</span>
  <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProps);
  <span class="comment">// lookup the bean     Foo</span>
  beanRemoteInterface = (Foo) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">myapp/myejbmodule/FooBean!org.myapp.ejb.Foo</span><span class="delimiter">&quot;</span></span>);
  <span class="predefined-type">String</span> bar = beanRemoteInterface.sayBar();
  <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Remote Foo bean returned </span><span class="delimiter">&quot;</span></span> + bar);
<span class="error"> </span> ctx.close();
<span class="error"> </span><span class="error"> </span><span class="comment">// after this point the beanRemoteInterface is not longer valid!</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, most of the code is similar to what we have been seeing
so far for setting up a JNDI context backed by the remote-naming
project. The only parts that change are:</p>
</div>
<div class="paragraph">
<p>\1) An additional " `jboss.naming.client.ejb.context`" property that is
added to the properties passed to the InitialContext constructor.<br>
2) The JNDI name used for the lookup<br>
3) And subsequently the invocation on the bean interface returned by the
lookup.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see what the " <code>jboss.naming.client.ejb.context`" does. In
WildFly, remote access/invocations on EJBs is facilitated by the JBoss
specific EJB client API, which is a project on its own
<a href="https://github.com/jbossas/jboss-ejb-client" class="bare">https://github.com/jbossas/jboss-ejb-client</a>. So no matter, what
mechanism you use (remote-naming or core EJB client API), the
invocations are ultimately routed through the EJB client API project. In
this case too, the remote-naming internally uses EJB client API to
handle EJB invocations. From a EJB client API project perspective, for
successful communication with the server, the project expects a
`EJBClientContext</code> backed by (atleast one) <code>EJBReceiver</code>(s). The
<code>EJBReceiver</code> is responsible for handling the EJB invocations. One type
of a <code>EJBReceiver</code> is a <code>RemotingConnectionEJBReceiver</code> which internally
uses jboss-remoting project to communicate with the remote server to
handle the EJB invocations. Such a <code>EJBReceiver</code> expects a connection
backed by the jboss-remoting project. Of course to be able to connect to
the server, such a <code>EJBReceiver</code> would have to know the server address,
port, security credentials and other similar parameters. If you were
using the core EJB client API, then you would have configured all these
properties via the jboss-ejb-client.properties or via programatic API
usage as explained here <a href="#src-557285">EJB invocations from a remote
client using JNDI</a>. But in the example above, we are using remote-naming
project and are <em>not</em> directly interacting with the EJB client API
project.</p>
</div>
<div class="paragraph">
<p>If you look closely at what&#8217;s being passed, via the JNDI properties, to
the remote-naming project and if you remember the details that we
explained in a previous section about how the remote-naming project
establishes a connection to the remote server, you&#8217;ll realize that these
properties are indeed the same as what the
<code>RemotingConnectionEJBReceiver</code> would expect to be able to establish the
connection to the server. Now this is where the "
<code>jboss.naming.client.ejb.context`" property comes into picture. When
this is set to true and passed to the InitialContext creation (either
via jndi.properties or via the constructor of that class), the
remote-naming project internally will do whatever is necessary to setup
a `EJBClientContext</code>, containing a <code>RemotingConnectionEJBReceiver</code> which
is created using the <strong>same</strong> remoting connection that is created by and
being used by remote-naming project for its own JNDI communication
usage. So effectively, the InitialContext creation via the remote-naming
project has now internally triggered the creation of a
<code>EJBClientContext</code> containing a <code>EJBReceiver</code> capable of handling the
EJB invocations (remember, no remote EJB invocations are possible
without the presence of a <code>EJBClientContext</code> containing a <code>EJBReceiver</code>
which can handle the EJB).</p>
</div>
<div class="paragraph">
<p>So we now know the importance of the "
<code>jboss.naming.client.ejb.context`" property and its usage. Let&#8217;s move on
the next part in that code, the JNDI name. Notice that we have used the
JNDI name relative to the `java:jboss/exported/</code> namespace while doing
the lookup. And since we know that the Foo view is exposed on that JNDI
name, we cast the returned object back to the Foo interface. Remember
that we earlier explained how each lookup via remote-naming triggers a
server side communication and a marshalling/unmarshalling process. This
applies for EJB views too. In fact, the remote-naming project has no
clue (since that&#8217;s not in the scope of that project to know) whether
it&#8217;s an EJB or some random object.</p>
</div>
<div class="paragraph">
<p>Once the unmarshalled object is returned (which actually is a proxy to
the bean), the rest is straightforward, we just invoke on that returned
object. Now since the remote-naming implementation has done the
necessary setup for the EJBClientContext (due to the presence of "
<code>jboss.naming.client.ejb.context`" property), the invocation on that
proxy will internally use the `EJBClientContext</code> (the proxy is smart
enough to do that) to interact with the server and return back the
result. We won&#8217;t go into the details of how the EJB client API handles
the communication/invocation.</p>
</div>
<div class="paragraph">
<p><em>Long story short, using the remote-naming project for doing remote EJB
invocations against WildFly is possible!</em></p>
</div>
</div>
<div class="sect2">
<h3 id="why-use-the-ejb-client-api-approach-then">31.6. Why use the EJB client API approach then?</h3>
<div class="paragraph">
<p>I can guess that some of you might already question why/when would one
use the EJB client API style lookups as explained in the
<a href="#src-557285">EJB invocations from a remote client using JNDI</a>
article instead of just using (what appears to be a simpler)
remote-naming style lookups.</p>
</div>
<div class="paragraph">
<p>Before we answer that, let&#8217;s understand a bit about the EJB client
project. The EJB client project was implemented keeping in mind various
optimizations and features that would be possible for handling remote
invocations. One such optimization was to avoid doing unnecessary server
side communication(s) which would typically involve network calls,
marshalling/unmarshalling etc&#8230;&#8203; The easiest place where this
optimization can be applied, is to the EJB lookup. Consider the
following code (let&#8217;s ignore how the context is created):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo/bar</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>foo/bar</code> JNDI name could potentially point to <strong>any</strong> type of object
on the server side. The jndi name itself won&#8217;t have the type/semantic
information of the object bound to that name on the server side. If the
context was setup using the remote-naming project (like we have seen
earlier in our examples), then the only way for remote-naming to return
an object for that lookup operation is to communicate with the server
and marshal/unmarshal the object bound on the server side. And that&#8217;s
exactly what it does (remember, we explained this earlier).</p>
</div>
<div class="paragraph">
<p>The EJB client API project on the other hand optimizes this lookup. In
order to do so, it expects the client application to let it know that a
EJB is being looked up. It does this, by expecting the client
application to use the JNDI name of the format " <code>ejb:`" namespace and
also expecting the client application to setup the JNDI context by
passing the " `org.jboss.ejb.client.naming`" value for the
`Context.URL_PKG_PREFIXES</code> property.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Properties</span> jndiProperties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
jndiProperties.put(<span class="predefined-type">Context</span>.URL_PKG_PREFIXES, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.ejb.client.naming</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// create the context</span>
<span class="directive">final</span> <span class="predefined-type">Context</span> context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>(jndiProperties);
<span class="error"> </span>
<span class="comment">// lookup</span>
Foo beanProxy = context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:myapp/myejbmodule//FooBean!org.myapp.ejb.Foo</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> bar = beanProxy.sayBar();</code></pre>
</div>
</div>
<div class="paragraph">
<p>More details about such code can be found here <a href="#src-557285">EJB
invocations from a remote client using JNDI</a></p>
</div>
<div class="paragraph">
<p>When a client application looks up anything under the " `ejb:`"
namespace, it is a clear indication (for the EJB client API project) to
know that the client is looking up an EJB. That&#8217;s where it steps in to
do the necessary optimizations that might be applicable. So unlike, in
the case of remote-naming project (which has no clue about the semantics
of the object being looked up), the EJB client API project does <strong>not</strong>
trigger a server side communication or a marshal/unmarshal process when
you do lookup for a remote view of a stateless bean (it&#8217;s important to
note that we have specifically mentioned stateless bean here, we&#8217;ll come
to that later). Instead, the EJB client API just returns a
java.lang.reflect.Proxy instance of the remote view type that&#8217;s being
looked up. This not just saves a network call, marshalling/unmarshalling
step but it also means that you can create an EJB proxy even when the
server isn&#8217;t up yet. Later on, when the invocation on the proxy happens,
the EJB client API <em>does</em> communicate with the server to carry out the
invocation.</p>
</div>
<div class="sect3">
<h4 id="is-the-lookup-optimization-applicable-for-all-bean-types">31.6.1. Is the lookup optimization applicable for all bean types?</h4>
<div class="paragraph">
<p>In the previous section we (intentionally) mentioned that the lookup
optimization by the EJB client API project happens for stateless beans.
This kind of optimization is <strong>not</strong> possible for stateful beans because
in case of stateful beans, a lookup is expected to create a session for
that stateful bean and for session creation we do have to communicate
with the server since the server is responsible for creating that
session.</p>
</div>
<div class="paragraph">
<p>That&#8217;s exactly why the EJB client API project expects the JNDI name
lookup string for stateful beans to include the " `?stateful`" string at
the end of the JNDI name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb:myapp/myejbmodule//StatefulBean!org.myapp.ejb.Counter?stateful</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the use of `"?stateful`" in that JNDI name. See
<a href="#src-557285">EJB invocations from a remote client using JNDI</a> for
more details about such lookup.</p>
</div>
<div class="paragraph">
<p>The presence of " `?stateful`" in the JNDI name lookup string is a
directive to the EJB client API to let it know that a stateful bean is
being looked up and it&#8217;s necessary to communicate with the server and
create a session during that lookup.</p>
</div>
<div class="paragraph">
<p>So as you can see, we have managed to optimize certain operations by
using the EJB client API for EJB lookup/invocation as against using the
remote-naming project. There are other EJB client API implementation
details (and probably more might be added) which are superior when it is
used for remote EJB invocations in client applications as against
remote-naming project which doesn&#8217;t have the intelligence to carry out
such optimizations for EJB invocations. <em>That&#8217;s why the remote-naming
project</em> <strong><em>for remote EJB invocations</em></strong> <em>is considered "</em> <code>deprecated</code>
<em>"</em>. Note that if you want to use remote-naming for looking up and
invoking on non-EJB remote objects then you are free to do so. In fact,
that&#8217;s why that project has been provided. You can even use the
remote-naming project for EJB invocations (like we just saw), if you are
fine with <em>not</em> wanting the optimizations that the EJB client API can do
for you or if you have other restrictions that force you to use that
project.</p>
</div>
</div>
<div class="sect3">
<h4 id="restrictions-for-ejbs">31.6.2. Restrictions for EJB&#8217;s</h4>
<div class="paragraph">
<p>If the remote-naming is used there are some restrictions as there is no
full support of the ejb-client features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No loadbalancing, if the URL conatains multiple "remote://" servers
there is no loadbalancing, the first available server will be used and
only in case it is not longer available there will be a failover to the
next available one.</p>
</li>
<li>
<p>No cluster support. As a cluster needs to be defined in the
jboss-ejb-client.properties this feature can not be used and there is no
cluster node added</p>
</li>
<li>
<p>No client side interceptor. The EJBContext.getCurrent() can not be
used and it is not possible to add a client interceptor</p>
</li>
<li>
<p>No UserTransaction support</p>
</li>
<li>
<p>All proxies become invalid if .close() for the related Initalcontext
is invoked, or the InitialContext is not longer referenced and gets
garbage-collected. In this case the underlying EJBContext is destroyed
and the conections are closed.</p>
</li>
<li>
<p>It is not possible to use remote-naming if the client is an
application deployed on another JBoss instance</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_applications_migrated_to_wildfly">32. Example Applications - Migrated to WildFly</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="example-applications-migrated-from-previous-releases">32.1. Example Applications Migrated from Previous Releases</h3>
<div class="paragraph">
<p>The applications in this section were written for a previous version of
the server but have been modified to run on WildFly 11. Changes were made
to resolve issues that arose during deployment and runtime or to fix
problems with application behaviour. Each example below documents the
changes that were made to get the application to run successfully on
WildFly.</p>
</div>
<div class="sect3">
<h4 id="seam-2-dvd-store-example">32.1.1. Seam 2 DVD Store example</h4>
<div class="paragraph">
<p>For details on how to migrate this demo application, see
<a href="https://community.jboss.org/blogs/marek-novotny/2011/12/16/dvdstore-migration-for-jboss-as-710beta">Seam
2 DVD Store example on WildFly 11</a> on Marek Novotny&#8217;s Blog.</p>
</div>
</div>
<div class="sect3">
<h4 id="seam-2-booking-example">32.1.2. Seam 2 Booking example</h4>
<div class="paragraph">
<p>For details on how to migrate this demo application, see
<a href="http://community.jboss.org/blogs/marek-novotny/2011/07/29/seam-2-booking-example-on-jboss-as-7">Seam
2 Booking example on WildFly 11</a> on Marek Novotny&#8217;s Blog.</p>
</div>
</div>
<div class="sect3">
<h4 id="seam-2-booking---step-by-step-migration-of-binaries">32.1.3. Seam 2 Booking - step-by-step migration of binaries</h4>
<div class="paragraph">
<p>This document takes a somewhat different "brute force" approach. The
idea is to deploy the binaries to WildFly, then see what issues you hit
and learn how debug and resolve them. See <a href="Migrate_Seam_2_Booking_EAR_Binaries_-_Step_by_Step.adoc">Seam 2 Booking EAR Migration of Binaries - Step by Step</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jbpm-console-application">32.1.4. jBPM-Console application</h4>
<div class="paragraph">
<p>Kris Verlaenen migrated this application from AS 5 to WildFly 11. For
details about this migration, see <a href="http://kverlaen.blogspot.com/2011/07/jbpm5-on-as7-lightning.html">jBPM5 on WildFly</a> on his Kris&#8217;s Blog.</p>
</div>
</div>
<div class="sect3">
<h4 id="order-application-used-for-performance-testing">32.1.5. Order application used for performance testing</h4>
<div class="paragraph">
<p>Andy Miller migrated this application from AS 5 to WildFly. For details
about this migration, see <a href="Migrate_Order_Application_from_EAP5.1_to_WildFly.adoc">Order Application Migration from EAP5.1 to WildFly</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrate-example-application">32.1.6. Migrate example application</h4>
<div class="paragraph">
<p>A step by step work through of issues, and their solutions, that might
crop up when migrating applications to WildFly 11. See the following
<a href="https://github.com/danbev/migrate">github project</a> for details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-applications-based-on-ee6">32.2. Example Applications Based on EE6</h3>
<div class="paragraph">
<p>Applications in this section were designed and written specifically to
use the features and functions of EE6.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Quickstarts: A number of quickstart applications were written to
demonstrate Java EE 6 and a few additional technologies. They provide
small, specific, working examples that can be used as a reference for
your own project. For more information about the quickstarts, see
<a href="http://www.jboss.org/jdf/quickstarts/jboss-as-quickstart/guide/Introduction/">Get Started Developing Applications</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_porting_the_order_application_from_eap_5_1_to_wildfly_11">33. Porting the Order Application from EAP 5.1 to WildFly 11</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Andy Miller ported an example Order application that was used for
performance testing from EAP 5.1 to WildFly 11. These are the notes he
made during the migration process.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-application">33.1. Overview of the application</h3>
<div class="paragraph">
<p>The application is relatively simple. it contains three servlets, some
stateless session beans, a stateful session bean, and some entities.</p>
</div>
<div class="paragraph">
<p>In addition to application code changes, modifications were made to the
way the EAR was packaged. This is because WildFly removed support of
some proprietary features that were available in EAP 5.1.</p>
</div>
</div>
<div class="sect2">
<h3 id="summary-of-changes">33.2. Summary of changes</h3>
<div class="sect3">
<h4 id="code-changes">33.2.1. Code Changes</h4>
<div class="sect4">
<h5 id="modify-jndi-lookup-code">Modify JNDI lookup code</h5>
<div class="paragraph">
<p>Since this application was first written for EAP 4.2/4.3, which did not
support EJB reference injection, the servlets were using pre-EE 5
methods for looking up stateless and stateful session bean interfaces.
While migrating to WildFly, it seemed a good time to change the code to
use the @EJB annotation, although this was not a required change.</p>
</div>
<div class="paragraph">
<p>The real difference is in the lookup name. WildFly only supports the new
EE 6 portable JNDI names rather than the old EAR structure based names.
The JNDI lookup code changed as follows:</p>
</div>
<div class="paragraph">
<p>Example of code in the EAP 5.1 version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> {
    context = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
    distributionCenterManager = (DistributionCenterManager) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">OrderManagerApp/DistributionCenterManagerBean/local</span><span class="delimiter">&quot;</span></span>);
} <span class="keyword">catch</span>(<span class="exception">Exception</span> lookupError) {
    <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Couldn't find DistributionCenterManager bean</span><span class="delimiter">&quot;</span></span>, lookupError);
}
<span class="keyword">try</span> {
    customerManager = (CustomerManager) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">OrderManagerApp/CustomerManagerBean/local</span><span class="delimiter">&quot;</span></span>);
} <span class="keyword">catch</span>(<span class="exception">Exception</span> lookupError) {
    <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Couldn't find CustomerManager bean</span><span class="delimiter">&quot;</span></span>, lookupError);
}
<span class="error"> </span>
<span class="keyword">try</span> {
    productManager = (ProductManager) context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">OrderManagerApp/ProductManagerBean/local</span><span class="delimiter">&quot;</span></span>);
} <span class="keyword">catch</span>(<span class="exception">Exception</span> lookupError) {
    <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Couldn't find the ProductManager bean</span><span class="delimiter">&quot;</span></span>, lookupError);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of how this is now coded in WildFly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/OrderManagerEJB/DistributionCenterManagerBean!services.ejb.DistributionCenterManager</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> DistributionCenterManager distributionCenterManager;
<span class="error"> </span>
<span class="annotation">@EJB</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/OrderManagerEJB/CustomerManagerBean!services.ejb.CustomerManager</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> CustomerManager customerManager;
<span class="error"> </span>
<span class="annotation">@EJB</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/OrderManagerEJB/ProductManagerBean!services.ejb.ProductManager</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> ProductManager productManager;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the change to injection, which was supported in EAP
5.1.0, the lookup name changed from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">OrderManagerApp/DistributionCenterManagerBean/local</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java:app/OrderManagerEJB/DistributionCenterManagerBean!services.ejb.DistributionCenterManager</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the other beans were changed in a similar manner. They are now based
on the portable JNDI names described in EE 6.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modify-logging-code">33.2.2. Modify logging code</h4>
<div class="paragraph">
<p>The next major change was to logging within the application. The old
version was using the commons logging infrastructure and Log4J that is
bundled in the application server. Rather than bundling third-party
logging, the application was modified to use the new WildFly Logging
infrastructure.</p>
</div>
<div class="paragraph">
<p>The code changes themselves are rather trivial, as this example
illustrates:</p>
</div>
<div class="paragraph">
<p>Old JBoss Commons Logging/Log4J:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> Log log = LogFactory.getLog(CustomerManagerBean.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>New WildFly Logging</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(CustomerManagerBean.class.toString());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Old JBoss Commons Logging/Log4J:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span>(log.isTraceEnabled()) {
    log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">Just flushed </span><span class="delimiter">&quot;</span></span> + batchSize + <span class="string"><span class="delimiter">&quot;</span><span class="content"> rows to the database.</span><span class="delimiter">&quot;</span></span>);
    log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">Total rows flushed is </span><span class="delimiter">&quot;</span></span> + (i+<span class="integer">1</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>New WildFly Logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span>(logger.isLoggable(<span class="predefined-type">Level</span>.TRACE)) {
    logger.log(<span class="predefined-type">Level</span>.TRACE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Just flushed </span><span class="delimiter">&quot;</span></span> + batchSize + <span class="string"><span class="delimiter">&quot;</span><span class="content"> rows to the database.</span><span class="delimiter">&quot;</span></span>);
    logger.log(<span class="predefined-type">Level</span>.TRACE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Total rows flushed is </span><span class="delimiter">&quot;</span></span> + (i+<span class="integer">1</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the code changes made to use the new AS7 JBoss log
manager module, you must add this dependency to the <code>MANIFEST.MF</code> file
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Manifest</span>-Version: <span class="float">1.0</span>
Dependencies: org.jboss.logmanager</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modify-the-code-to-use-infinispan-for-2nd-level-cache">33.2.3. Modify the code to use Infinispan for 2nd level cache</h4>
<div class="paragraph">
<p>Jboss Cache has been replaced by Infinispan for 2nd level cache. This
requires modification of the <code>persistence.xml</code> file.</p>
</div>
<div class="paragraph">
<p>This is what the file looked like in EAP 5.1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;properties&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.cache.jbc2.JndiMultiplexedJBossCacheRegionFactory</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.jbc2.cachefactory</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:CacheManager</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_second_level_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_query_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_minimal_puts</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.jbc2.cfg.entity</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">mvcc-entity</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region_prefix</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">services</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how it was modified to use Infinispan for the same
configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;properties&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_second_level_cache</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_minimal_puts</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/properties&gt;
&lt;shared-cache-mode&gt;ENABLE_SELECTIVE&lt;/shared-cache-mode&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of the properties are removed since they will default to the
correct values for the second level cache. See
<a href="https://docs.jboss.org/author/display/AS71/JPA+Reference+Guide#JPAReferenceGuide-UsingtheInfinispansecondlevelcache">"Using
the Infinispan second level cache"</a> for more details.</p>
</div>
<div class="paragraph">
<p>That was the extent of the code changes required to migrate the
application to AS7.</p>
</div>
</div>
<div class="sect3">
<h4 id="ear-packaging-changes">33.2.4. EAR Packaging Changes</h4>
<div class="paragraph">
<p>Due to modular class loading changes, the structure of the existing EAR
failed to deploy successfully in WildFly.</p>
</div>
<div class="paragraph">
<p>The old structure of the EAR was as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> jar tf OrderManagerApp.ear
META-INF/MANIFEST.MF
META-INF/application.xml
OrderManagerWeb.war
OrderManagerEntities.jar
OrderManagerEJB.jar
META-INF/</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this structure, the entities and the <code>persistence.xml</code> were in one
jar file, <code>OrderManagerEntities.jar</code>, and the stateless and stateful
session beans were in another jar file, <code>OrderManagerEJB.jar</code>. This did
not work due to modular class loading changes in WildFly. There are a
couple of ways to resolve this issue:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the class path in the <code>MANIFEST.MF</code></p>
</li>
<li>
<p>Flatten the code and put all the beans in one JAR file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The second approach was selected because it simplified the EAR
structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> jar tf OrderManagerApp.ear
META-INF/application.xml
OrderManagerWeb.war
OrderManagerEJB.jar
META-INF/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since there is no longer an <code>OrderManagerEntities.jar</code> file, the
<code>applcation.xml</code> file was modified to remove the entry.</p>
</div>
<div class="paragraph">
<p>An entry was added to the <code>MANIFEST.MF</code> file in the
<code>OrderManagerWeb.war</code> to resolve another class loading issue resulting
from the modification to use EJB reference injection in the servlets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Manifest</span>-Version: <span class="float">1.0</span>
Dependencies: org.jboss.logmanager
<span class="predefined-type">Class</span>-Path: OrderManagerEJB.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Class-Path</code> entry tells the application to look in the
<code>OrderManagerEJB.jar</code> file for the injected beans.</p>
</div>
</div>
<div class="sect3">
<h4 id="summary">33.2.5. Summary</h4>
<div class="paragraph">
<p>Although the existing EAR structure could have worked with additional
modifications to the <code>MANIFEST.MF</code> file, this approach seemed more
appealing because it simplified the structure while maintaining the web
tier in its own WAR.</p>
</div>
<div class="paragraph">
<p>The source files for both versions is attached so you can view the
changes that were made to the application.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_seam_2_booking_application_migration_of_binaries_from_eap5_1_to">34. Seam 2 Booking Application - Migration of Binaries from EAP5.1 to</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This is a step-by-step how-to guide on porting the Seam Booking
application binaries from EAP5.1 to WildFly 11. Although there are better
approaches for migrating applications, the purpose of this document is
to show the types of issues you might encounter when migrating an
application and how to debug and resolve those issues.</p>
</div>
<div class="paragraph">
<p>For this example, the application EAR is deployed to the
JBOSS_HOME/standalone/deployments directory with no changes other than
extracting the archives so we can modify the XML files contained within
them.</p>
</div>
<div id="step-1-build-and-deploy-the-eap5.1-version-of-the-seam-booking-application" class="paragraph">
<p>== Step 1: Build and deploy the EAP5.1 version of the Seam Booking
application</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build the EAR</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    cd /EAP5_HOME/jboss-eap5<span class="float">.1</span>/seam/examples/booking
    ~/tools/apache-ant-<span class="float">1.8</span><span class="float">.2</span>/bin/ant explode</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the EAR to the JBOSS_HOME deployments directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    cp -r EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/examples/booking/exploded-archives/jboss-seam-booking.ear AS7_HOME/standalone/deployments/
    cp -r EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/examples/booking/exploded-archives/jboss-seam-booking.war AS7_HOME/standalone/deployments/jboss-seam.ear
    cp -r EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/examples/booking/exploded-archives/jboss-seam-booking.jar AS7_HOME/standalone/deployments/jboss-seam.ear</code></pre>
</div>
</div>
</li>
<li>
<p>Start the WildFly server and check the log. You will see:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    INFO [org.jboss.as.deployment] (DeploymentScanner-threads - <span class="integer">1</span>) Found jboss-seam-booking.ear in deployment directory. To trigger deployment create a file called jboss-seam-booking.ear.dodeploy</code></pre>
</div>
</div>
</li>
<li>
<p>Create an empty file with the name <code>jboss-seam-booking.ear.dodeploy</code>
and copy it into the deployments directory. In the log, you will now see
the following, indicating that it is deploying:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    INFO [org.jboss.as.server.deployment] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) Starting deployment of <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>
    INFO [org.jboss.as.server.deployment] (MSC service thread <span class="integer">1</span>-<span class="integer">3</span>) Starting deployment of <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span>
    INFO [org.jboss.as.server.deployment] (MSC service thread <span class="integer">1</span>-<span class="integer">6</span>) Starting deployment of <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam.jar</span><span class="delimiter">&quot;</span></span>
    INFO [org.jboss.as.server.deployment] (MSC service thread <span class="integer">1</span>-<span class="integer">2</span>) Starting deployment of <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>At this point, you will first encounter your first deployment error.
In the next section, we will step through each issue and how to debug
and resolve it.</p>
<div id="step-2-debug-and-resolve-deployment-errors-and-exceptions" class="paragraph">
<p>== Step 2: Debug and resolve deployment errors and exceptions</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="first-issue-java.lang.classnotfoundexception-javax.faces.facesexception" class="paragraph">
<p>=== First Issue: java.lang.ClassNotFoundException:
javax.faces.FacesException</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR <span class="error">\</span>[org.jboss.msc.service.fail<span class="error">\</span>] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) MSC00001: Failed to start service jboss.deployment.subunit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>.POST_MODULE:
org.jboss.msc.service.StartException in service jboss.deployment.subunit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>.POST_MODULE:
Failed to process phase POST_MODULE of subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>
    (.. additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: javax.faces.FacesException from <span class="error">\</span>[Module <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.jboss-seam-booking.ear:main</span><span class="delimiter">&quot;</span></span> from Service Module Loader<span class="error">\</span>]
    at org.jboss.modules.ModuleClassLoader.findClass(ModuleClassLoader.java:<span class="integer">191</span>)</code></pre>
</div>
</div>
<div id="what-it-means" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>The ClassNotFoundException indicates a missing dependency. In this case,
it can not find the class <code>javax.faces.FacesException</code> and you need to
explicitly add the dependency.</p>
</div>
<div id="how-to-resolve-it" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>Find the module name for that class in the <code>AS7_HOME/modules</code> directory
by looking for a path that matches the missing class. In this case, you
will find 2 modules that match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    javax/faces/api/main
    javax/faces/api/<span class="float">1.2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both modules have the same module name: "javax.faces.api" but one in the
main directory is for JSF 2.0 and the one located in the 1.2 directory
is for JSF 1.2. If there was only one module available, we could simply
create a <code>MANIFEST.MF</code> file and added the module dependency. But in this
case, we want to use the JSF 1.2 version and not the 2.0 version in
main, so we need to be able to specify one and exclude the other. To do
this, we create a <code>jboss-deployment-structure.xml</code> file in the EAR
<code>META-INF/</code> directory that contains the following data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/exclusions&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
In the "deployment" section, we add the dependency for the
<code>javax.faces.api</code> for the JSF 1.2 module. We also add the dependency for
the JSF 1.2 module in the sub-deployment section for the WAR and exclude
the module for JSF 2.0.</p>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy</code> file in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.classnotfoundexception-org.apache.commons.logging.log" class="paragraph">
<p>=== Next Issue: java.lang.ClassNotFoundException:
org.apache.commons.logging.Log</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.jboss.msc.service.fail] (MSC service thread <span class="integer">1</span>-<span class="integer">8</span>) MSC00001: Failed to start service jboss.deployment.unit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>.INSTALL:
org.jboss.msc.service.StartException in service jboss.deployment.unit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>.INSTALL:
Failed to process phase INSTALL of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span>
    (.. additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.logging.Log from [Module <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.jboss-seam-booking.ear.jboss-seam-booking.war:main</span><span class="delimiter">&quot;</span></span> from Service Module Loader]</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-1" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>The ClassNotFoundException indicates a missing dependency. In this case,
it can not find the class <code>org.apache.commons.logging.Log</code> and you need
to explicitly add the dependency.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-1" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>Find the module name for that class in the <code>JBOSS_HOME/modules/</code>
directory by looking for a path that matches the missing class. In this
case, you will find one module that matches the path
<code>org/apache/commons/logging/</code>. The module name is
"org.apache.commons.logging".</p>
</div>
<div class="paragraph">
<p>Modify the <code>jboss-deployment-structure.xml</code> to add the module dependency
to the deployment section of the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The <code>jboss-deployment-structure.xml</code> should now look like this:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/exclusions&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.classnotfoundexception-org.dom4j.documentexception" class="paragraph">
<p>=== Next Issue: java.lang.ClassNotFoundException:
org.dom4j.DocumentException</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.apache.catalina.core.ContainerBase.[jboss.web].[<span class="keyword">default</span>-host].[/seam-booking]] (MSC service thread <span class="integer">1</span>-<span class="integer">3</span>) <span class="exception">Exception</span> sending context initialized event to listener instance of <span class="type">class</span> <span class="class">org</span>.jboss.seam.servlet.SeamListener: java.lang.NoClassDefFoundError: org/dom4j/DocumentException
    (... additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.dom4j.DocumentException from [Module <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.jboss-seam-booking.ear.jboss-seam.jar:main</span><span class="delimiter">&quot;</span></span> from Service Module Loader]</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-2" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>Again, the ClassNotFoundException indicates a missing dependency. In
this case, it can not find the class <code>org.dom4j.DocumentException</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-2" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>Find the module name in the <code>JBOSS_HOME/modules/</code> directory by looking
for the <code>org/dom4j/DocumentException</code>. The module name is "org.dom4j".</p>
</div>
<div class="paragraph">
<p>Modify the <code>jboss-deployment-structure.xml</code> to add the module dependency
to the deployment section of the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.dom4j</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The <code>jboss-deployment-structure.xml</code> file should now look like this:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
           &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.dom4j</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
          &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/exclusions&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.classnotfoundexception-org.hibernate.validator.invalidvalue" class="paragraph">
<p>=== Next Issue: java.lang.ClassNotFoundException:
org.hibernate.validator.InvalidValue</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.apache.catalina.core.ContainerBase.[jboss.web].[<span class="keyword">default</span>-host].[/seam-booking]] (MSC service thread <span class="integer">1</span>-<span class="integer">6</span>) <span class="exception">Exception</span> sending context initialized event to listener instance of <span class="type">class</span> <span class="class">org</span>.jboss.seam.servlet.SeamListener: java.lang.RuntimeException: Could not create <span class="predefined-type">Component</span>: org.jboss.seam.international.statusMessages
    (... additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.hibernate.validator.InvalidValue from [Module <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.jboss-seam-booking.ear.jboss-seam.jar:main</span><span class="delimiter">&quot;</span></span> from Service Module Loader]</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-3" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>Again, the ClassNotFoundException indicates a missing dependency. In
this case, it can not find the class
<code>org.hibernate.validator.InvalidValue</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-3" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>There is a module "org.hibernate.validator", but the JAR does not
contain the <code>org.hibernate.validator.InvalidValue</code> class, so adding the
module dependency will not resolve this issue.</p>
</div>
<div class="paragraph">
<p>In this case, the JAR containing the class was part of the EAP 5.1
deployment. We will look for the JAR that contains the missing class in
the <code>EAP5_HOME/jboss-eap-5.1/seam/lib/</code> directory. To do this, open a
console and type the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cd EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/lib
grep <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate.validator.InvalidValue</span><span class="delimiter">'</span></span> <span class="error">`</span>find . -name <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span><span class="error">`</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The result shows:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Binary file ./hibernate-validator.jar matches
Binary file ./test/hibernate-all.jar matches</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
In this case, we need to copy the <code>hibernate-validator.jar</code> to the
<code>jboss-seam-booking.ear/lib/</code> directory:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cp EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/lib/hibernate-validator.jar jboss-seam-booking.ear/lib</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.instantiationexception-org.jboss.seam.jsf.seamapplicationfactory" class="paragraph">
<p>=== Next Issue: java.lang.InstantiationException:
org.jboss.seam.jsf.SeamApplicationFactory</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">INFO  [javax.enterprise.resource.webcontainer.jsf.config] (MSC service thread <span class="integer">1</span>-<span class="integer">7</span>) Unsanitized stacktrace from failed start...: com.sun.faces.config.ConfigurationException: Factory <span class="string"><span class="delimiter">'</span><span class="content">javax.faces.application.ApplicationFactory</span><span class="delimiter">'</span></span> was not configured properly.
 at com.sun.faces.config.processor.FactoryConfigProcessor.verifyFactoriesExist(FactoryConfigProcessor.java:<span class="integer">296</span>) [jsf-impl-<span class="float">2.0</span><span class="float">.4</span>-b09-jbossorg-<span class="integer">4</span>.jar:<span class="float">2.0</span><span class="float">.4</span>-b09-jbossorg-<span class="integer">4</span>]
 (... additional logs removed ...)
Caused by: javax.faces.FacesException: org.jboss.seam.jsf.SeamApplicationFactory
 at javax.faces.FactoryFinder.getImplGivenPreviousImpl(FactoryFinder.java:<span class="integer">606</span>) [jsf-api-<span class="float">1.2</span>_13.jar:<span class="float">1.2</span>_13-b01-FCS]
 (... additional logs removed ...)
 at com.sun.faces.config.processor.FactoryConfigProcessor.verifyFactoriesExist(FactoryConfigProcessor.java:<span class="integer">294</span>) [jsf-impl-<span class="float">2.0</span><span class="float">.4</span>-b09-jbossorg-<span class="integer">4</span>.jar:<span class="float">2.0</span><span class="float">.4</span>-b09-jbossorg-<span class="integer">4</span>]
 ... <span class="integer">11</span> more
Caused by: java.lang.InstantiationException: org.jboss.seam.jsf.SeamApplicationFactory
 at java.lang.Class.newInstance0(<span class="predefined-type">Class</span>.java:<span class="integer">340</span>) [:<span class="float">1.6</span><span class="float">.0</span>_25]
 at java.lang.Class.newInstance(<span class="predefined-type">Class</span>.java:<span class="integer">308</span>) [:<span class="float">1.6</span><span class="float">.0</span>_25]
 at javax.faces.FactoryFinder.getImplGivenPreviousImpl(FactoryFinder.java:<span class="integer">604</span>) [jsf-api-<span class="float">1.2</span>_13.jar:<span class="float">1.2</span>_13-b01-FCS]
 ... <span class="integer">16</span> more</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-4" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>The com.sun.faces.config.ConfigurationException and
java.lang.InstantiationException indicate a dependency issue. In this
case, it is not as obvious.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-4" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>We need to find the module that contains the com.sun.faces classes.
While there is no com.sun.faces module, there are are two
com.sun.jsf-impl modules. A quick check of the jsf-impl-1.2_13.jar in
the 1.2 directory shows it contains the com.sun.faces classes.</p>
</div>
<div class="paragraph">
<p>As we did with the javax.faces.FacesException ClassNotFoundException, we
want to use the JSF 1.2 version and not the JSF 2.0 version in main, so
we need to be able to specify one and exclude the other. We need to
modify the jboss-deployment-structure.xml to add the module dependency
to the deployment section of the file. We also need to add it to the WAR
subdeployment and exclude the JSF 2.0 module. The file should now look
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
              &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.dom4j</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/exclusions&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
              &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.classnotfoundexception-org.apache.commons.collections.arraystack" class="paragraph">
<p>=== Next Issue: java.lang.ClassNotFoundException:
org.apache.commons.collections.ArrayStack</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.apache.catalina.core.ContainerBase.[jboss.web].[<span class="keyword">default</span>-host].[/seam-booking]] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) <span class="exception">Exception</span> sending context initialized event to listener instance of <span class="type">class</span> <span class="class">com</span>.sun.faces.config.ConfigureListener: java.lang.RuntimeException: com.sun.faces.config.ConfigurationException: CONFIGURATION FAILED! org.apache.commons.collections.ArrayStack from [Module <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.jboss-seam-booking.ear:main</span><span class="delimiter">&quot;</span></span> from Service Module Loader]
    (... additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.collections.ArrayStack from [Module <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.jboss-seam-booking.ear:main</span><span class="delimiter">&quot;</span></span> from Service Module Loader]</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-5" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>Again, the ClassNotFoundException indicates a missing dependency. In
this case, it can not find the class
<code>org.apache.commons.collections.ArrayStack</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-5" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>Find the module name in the <code>JBOSS_HOME/modules/</code> directory by looking
for the <code>org/apache/commons/collections</code> path. The module name is
"org.apache.commons.collections".</p>
</div>
<div class="paragraph">
<p>Modify the <code>jboss-deployment-structure.xml</code> to add the module dependency
to the deployment section of the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.collections</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The <code>jboss-deployment-structure.xml</code> file should now look like this:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
              &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.dom4j</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.collections</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
   &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/exclusions&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
              &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-services-with-missingunavailable-dependencies" class="paragraph">
<p>=== Next Issue: Services with missing/unavailable dependencies</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.jboss.as.deployment] (DeploymentScanner-threads - <span class="integer">2</span>) {<span class="string"><span class="delimiter">&quot;</span><span class="content">Composite operation failed and was rolled back. Steps that failed:</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation step-2</span><span class="delimiter">&quot;</span></span> =&gt; {<span class="string"><span class="delimiter">&quot;</span><span class="content">Services with missing/unavailable dependencies</span><span class="delimiter">&quot;</span></span> =&gt; [<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.deployment.subunit.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="char">\&quot;</span><span class="content">.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.component.AuthenticatorAction.START missing [ jboss.naming.context.java.comp.jboss-seam-booking.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.AuthenticatorAction.</span><span class="char">\&quot;</span><span class="content">env/org.jboss.seam.example.booking.AuthenticatorAction/em</span><span class="char">\&quot;</span><span class="content"> ]</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.deployment.subunit.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="char">\&quot;</span><span class="content">.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.component.HotelSearchingAction.START missing [ jboss.naming.context.java.comp.jboss-seam-booking.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.HotelSearchingAction.</span><span class="char">\&quot;</span><span class="content">env/org.jboss.seam.example.booking.HotelSearchingAction/em</span><span class="char">\&quot;</span><span class="content"> ]</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">
&lt;... additional logs removed ...&gt;
</span><span class="delimiter">&quot;</span></span>jboss.deployment.subunit.<span class="error">\</span><span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="char">\&quot;</span><span class="content">.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.component.BookingListAction.START missing [ jboss.naming.context.java.comp.jboss-seam-booking.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.BookingListAction.</span><span class="char">\&quot;</span><span class="content">env/org.jboss.seam.example.booking.BookingListAction/em</span><span class="char">\&quot;</span><span class="content"> ]</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.persistenceunit.</span><span class="char">\&quot;</span><span class="content">jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase</span><span class="char">\&quot;</span><span class="content"> missing [ jboss.naming.context.java.bookingDatasource ]</span><span class="delimiter">&quot;</span></span>]}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-6" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>When you get a "Services with missing/unavailable dependencies" error,
look that the text within the brackets after "missing".</p>
</div>
<div class="paragraph">
<p>In this case you see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">missing [ jboss.naming.context.java.comp.jboss-seam-booking.<span class="error">\</span><span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="char">\&quot;</span><span class="content">.AuthenticatorAction.</span><span class="char">\&quot;</span><span class="content">env/org.jboss.seam.example.booking.AuthenticatorAction/em</span><span class="char">\&quot;</span><span class="content"> ]</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The "/em" indicates an Entity Manager and datasource issue.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-6" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>In WildFly 11, datasource configuration has changed and needs to be
defined in the <code>standalone/configuration/standalone.xml</code> file. Since
WildFly ships with an example database that is already defined in the
standalone.xml file, we will modify the <code>persistence.xml</code> file to use
that example database. Looking in the <code>standalone.xml</code> file, you can see
that the jndi-name for the example database is
"java:jboss/datasources/ExampleDS".</p>
</div>
<div class="paragraph">
<p>Modify the <code>jboss-seam-booking.jar/META-INF/persistence.xml</code> file to
comment the existing jta-data-source element and replace it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!-- &lt;jta-data-source&gt;java:/bookingDatasource&lt;/jta-data-source&gt; --&gt;
&lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.classnotfoundexception-org.hibernate.cache.hashtablecacheprovider" class="paragraph">
<p>=== Next Issue: java.lang.ClassNotFoundException:
org.hibernate.cache.HashtableCacheProvider</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.jboss.msc.service.fail] (MSC service thread <span class="integer">1</span>-<span class="integer">4</span>) MSC00001: Failed to start service jboss.persistenceunit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase</span><span class="delimiter">&quot;</span></span>: org.jboss.msc.service.StartException in service jboss.persistenceunit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase</span><span class="delimiter">&quot;</span></span>: Failed to start service
 at org.jboss.msc.service.ServiceControllerImpl<span class="error">$</span>StartTask.run(ServiceControllerImpl.java:<span class="integer">1786</span>)
 (... log messages removed ...)
Caused by: javax.persistence.PersistenceException: [PersistenceUnit: bookingDatabase] Unable to build EntityManagerFactory
 at org.hibernate.ejb.Ejb3Configuration.buildEntityManagerFactory(Ejb3Configuration.java:<span class="integer">903</span>)
 {... log messages removed ...)
Caused by: org.hibernate.HibernateException: could not instantiate RegionFactory [org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge]
 at org.hibernate.cfg.SettingsFactory.createRegionFactory(SettingsFactory.java:<span class="integer">355</span>)
 (... log messages removed ...)
Caused by: java.lang.reflect.InvocationTargetException
 at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native <span class="predefined-type">Method</span>) [:<span class="float">1.6</span><span class="float">.0</span>_25]
 (... log messages removed ...)
Caused by: org.hibernate.cache.CacheException: could not instantiate CacheProvider [org.hibernate.cache.HashtableCacheProvider]
 at org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge.&lt;init&gt;(RegionFactoryCacheProviderBridge.java:<span class="integer">68</span>)
 ... <span class="integer">20</span> more
Caused by: java.lang.ClassNotFoundException: org.hibernate.cache.HashtableCacheProvider from [Module <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:main</span><span class="delimiter">&quot;</span></span> from local module loader <span class="error">@</span><span class="integer">12</span>a3793 (roots: /home/sgilda/tools/jboss7/modules)]
 at org.jboss.modules.ModuleClassLoader.findClass(ModuleClassLoader.java:<span class="integer">191</span>)
 (... log messages removed ...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-7" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>The ClassNotFoundException indicates a missing dependency. In this case,
it can not find the class org.hibernate.cache.HashtableCacheProvider.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-7" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>There is no module for "org.hibernate.cache". In this case, the JAR
containing the class was part of the EAP 5.1 deployment. We will look
for the JAR that contains the missing class in the
<code>EAP5_HOME/jboss-eap-5.1/seam/lib/</code> directory.</p>
</div>
<div class="paragraph">
<p>To do this, open a console and type the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cd EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/lib
grep <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate.validator.InvalidValue</span><span class="delimiter">'</span></span> <span class="error">`</span>find . -name <span class="string"><span class="delimiter">'</span><span class="content">*.jar</span><span class="delimiter">'</span></span><span class="error">`</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The result shows:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Binary file ./hibernate-core.jar matches
Binary file ./test/hibernate-all.jar matches</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
In this case, we need to copy the <code>hibernate-core.jar</code> to the
<code>jboss-seam-booking.ear/lib/</code> directory:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cp EAP5_HOME/jboss-eap-<span class="float">5.1</span>/seam/lib/hibernate-core.jar jboss-seam-booking.ear/lib</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="next-issue-java.lang.classcastexception-org.hibernate.cache.hashtablecacheprovider" class="paragraph">
<p>=== Next Issue: java.lang.ClassCastException:
org.hibernate.cache.HashtableCacheProvider</p>
</div>
<div class="paragraph">
<p>When you deploy the application, the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR [org.jboss.msc.service.fail] (MSC service thread <span class="integer">1</span>-<span class="integer">2</span>) MSC00001: Failed to start service jboss.persistenceunit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase</span><span class="delimiter">&quot;</span></span>: org.jboss.msc.service.StartException in service jboss.persistenceunit.<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase</span><span class="delimiter">&quot;</span></span>: Failed to start service
 at org.jboss.msc.service.ServiceControllerImpl<span class="error">$</span>StartTask.run(ServiceControllerImpl.java:<span class="integer">1786</span>)
 (... log messages removed ...)
Caused by: javax.persistence.PersistenceException: [PersistenceUnit: bookingDatabase] Unable to build EntityManagerFactory
 at org.hibernate.ejb.Ejb3Configuration.buildEntityManagerFactory(Ejb3Configuration.java:<span class="integer">903</span>)
 (... log messages removed ...)
Caused by: org.hibernate.HibernateException: could not instantiate RegionFactory [org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge]
 at org.hibernate.cfg.SettingsFactory.createRegionFactory(SettingsFactory.java:<span class="integer">355</span>)
 (... log messages removed ...)
Caused by: java.lang.reflect.InvocationTargetException
 at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native <span class="predefined-type">Method</span>) [:<span class="float">1.6</span><span class="float">.0</span>_25]
 (... log messages removed ...)
Caused by: org.hibernate.cache.CacheException: could not instantiate CacheProvider [org.hibernate.cache.HashtableCacheProvider]
 at org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge.&lt;init&gt;(RegionFactoryCacheProviderBridge.java:<span class="integer">68</span>)
 ... <span class="integer">20</span> more
Caused by: java.lang.ClassCastException: org.hibernate.cache.HashtableCacheProvider cannot be cast to org.hibernate.cache.spi.CacheProvider
 at org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge.&lt;init&gt;(RegionFactoryCacheProviderBridge.java:<span class="integer">65</span>)
 ... <span class="integer">20</span> more</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="what-it-means-8" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>A ClassCastException can be a result of many problems. If you look at
this exception in the log, it appears the class
org.hibernate.cache.HashtableCacheProvider extends
org.hibernate.cache.spi.CacheProvider and is being loaded by a different
class loader than the class it extends. The
org.hibernate.cache.HashtableCacheProvider class is in in the
hibernate-core.jar and is being loaded by the application class loader.
The class it extends, org.hibernate.cache.spi.CacheProvider, is in the
org/hibernate/main/hibernate-core-4.0.0.Beta1.jar and is implicitly
loaded by that module.</p>
</div>
<div class="paragraph">
<p>This is not obvious, but due to changes in Hibernate 4, this problem is
caused by a backward compatibility issue due moving the
HashtableCacheProvider class into another package. This class was moved
from the org.hibernate.cache package to the org.hibernate.cache.internal
package. If you don&#8217;t remove the hibernate.cache.provider_class property
from the persistence.xml file, it will force the Seam application to
bundle the old Hibernate libraries, resulting in ClassCastExceptions, In
WildFly, you should move away from using HashtableCacheProvider and use
Infinispan instead.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="how-to-resolve-it-8" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>In WildFly, you need to comment out the hibernate.cache.provider_class
property in the <code>jboss-seam-booking.jar/META-INF persistence.xml</code> file
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!-- &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.provider_class</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.cache.HashtableCacheProvider</span><span class="delimiter">&quot;</span></span>/&gt; --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy file</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="no-more-issues-deployment-errors-should-be-resolved" class="paragraph">
<p>=== No more issues: Deployment errors should be resolved</p>
</div>
<div class="paragraph">
<p>At this point, the application should deploy without errors, but when
you access the URL " <a href="http://localhost:8080/seam-booking/"" class="bare">http://localhost:8080/seam-booking/"</a> in a browser
and attempt "Account Login", you will get a runtime error "The page
isn&#8217;t redirecting properly". In the next section, we will step through
each runtime issue and how to debug and resolve it.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="step-3-debug-and-resolve-runtime-errors-and-exceptions" class="paragraph">
<p>== Step 3: Debug and resolve runtime errors and exceptions</p>
</div>
<div id="first-issue-javax.naming.namenotfoundexception-name-jboss-seam-booking-not-found-in-context" class="paragraph">
<p>=== First Issue: javax.naming.NameNotFoundException: Name
'jboss-seam-booking' not found in context ''</p>
</div>
<div class="paragraph">
<p>The application deploys successfully, but when you access the URL "
<a href="http://localhost:8080/seam-booking/"" class="bare">http://localhost:8080/seam-booking/"</a> in a browser, you get "The page
isn&#8217;t redirecting properly" and the log contains the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SEVERE [org.jboss.seam.jsf.SeamPhaseListener] (http--<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>-<span class="integer">8080</span>-<span class="integer">1</span>) swallowing exception: java.lang.IllegalStateException: Could not start transaction
 at org.jboss.seam.jsf.SeamPhaseListener.begin(SeamPhaseListener.java:<span class="integer">598</span>) [jboss-seam.jar:]
 (... log messages removed ...)
Caused by: org.jboss.seam.InstantiationException: Could not instantiate Seam component: org.jboss.seam.transaction.synchronizations
 at org.jboss.seam.Component.newInstance(<span class="predefined-type">Component</span>.java:<span class="integer">2170</span>) [jboss-seam.jar:]
 (... log messages removed ...)
Caused by: javax.naming.NameNotFoundException: <span class="predefined-type">Name</span> <span class="string"><span class="delimiter">'</span><span class="content">jboss-seam-booking</span><span class="delimiter">'</span></span> not found in context <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
 at org.jboss.as.naming.util.NamingUtils.nameNotFoundException(NamingUtils.java:<span class="integer">109</span>)
 (... log messages removed ...)</code></pre>
</div>
</div>
<div id="what-it-means-9" class="paragraph">
<p>==== What it means:</p>
</div>
<div class="paragraph">
<p>A NameNotFoundException indications a JNDI naming issue. JNDI naming
rules have changed in WildFly and we need to modify the lookup names to
follow the new rules.</p>
</div>
<div id="how-to-resolve-it-9" class="paragraph">
<p>==== How to resolve it:</p>
</div>
<div class="paragraph">
<p>To debug this, look earlier in the server log trace to what JNDI binding
were used. Looking at the server log we see this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">138</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) JNDI bindings <span class="keyword">for</span> session bean named RegisterAction in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam-booking.jar/RegisterAction!org.jboss.seam.example.booking.Register
 java:app/jboss-seam-booking.jar/RegisterAction!org.jboss.seam.example.booking.Register
 java:module/RegisterAction!org.jboss.seam.example.booking.Register
 java:global/jboss-seam-booking/jboss-seam-booking.jar/RegisterAction
 java:app/jboss-seam-booking.jar/RegisterAction
 java:module/RegisterAction
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">138</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) JNDI bindings <span class="keyword">for</span> session bean named BookingListAction in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam-booking.jar/BookingListAction!org.jboss.seam.example.booking.BookingList
 java:app/jboss-seam-booking.jar/BookingListAction!org.jboss.seam.example.booking.BookingList
 java:module/BookingListAction!org.jboss.seam.example.booking.BookingList
 java:global/jboss-seam-booking/jboss-seam-booking.jar/BookingListAction
 java:app/jboss-seam-booking.jar/BookingListAction
 java:module/BookingListAction
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">138</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) JNDI bindings <span class="keyword">for</span> session bean named HotelBookingAction in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelBookingAction!org.jboss.seam.example.booking.HotelBooking
 java:app/jboss-seam-booking.jar/HotelBookingAction!org.jboss.seam.example.booking.HotelBooking
 java:module/HotelBookingAction!org.jboss.seam.example.booking.HotelBooking
 java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelBookingAction
 java:app/jboss-seam-booking.jar/HotelBookingAction
 java:module/HotelBookingAction
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">138</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) JNDI bindings <span class="keyword">for</span> session bean named AuthenticatorAction in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam-booking.jar/AuthenticatorAction!org.jboss.seam.example.booking.Authenticator
 java:app/jboss-seam-booking.jar/AuthenticatorAction!org.jboss.seam.example.booking.Authenticator
 java:module/AuthenticatorAction!org.jboss.seam.example.booking.Authenticator
 java:global/jboss-seam-booking/jboss-seam-booking.jar/AuthenticatorAction
 java:app/jboss-seam-booking.jar/AuthenticatorAction
 java:module/AuthenticatorAction
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">139</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) JNDI bindings <span class="keyword">for</span> session bean named ChangePasswordAction in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam-booking.jar/ChangePasswordAction!org.jboss.seam.example.booking.ChangePassword
 java:app/jboss-seam-booking.jar/ChangePasswordAction!org.jboss.seam.example.booking.ChangePassword
 java:module/ChangePasswordAction!org.jboss.seam.example.booking.ChangePassword
 java:global/jboss-seam-booking/jboss-seam-booking.jar/ChangePasswordAction
 java:app/jboss-seam-booking.jar/ChangePasswordAction
 java:module/ChangePasswordAction
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">139</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">1</span>) JNDI bindings <span class="keyword">for</span> session bean named HotelSearchingAction in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelSearchingAction!org.jboss.seam.example.booking.HotelSearching
 java:app/jboss-seam-booking.jar/HotelSearchingAction!org.jboss.seam.example.booking.HotelSearching
 java:module/HotelSearchingAction!org.jboss.seam.example.booking.HotelSearching
 java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelSearchingAction
 java:app/jboss-seam-booking.jar/HotelSearchingAction
 java:module/HotelSearchingAction
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">140</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">6</span>) JNDI bindings <span class="keyword">for</span> session bean named EjbSynchronizations in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam/EjbSynchronizations!org.jboss.seam.transaction.LocalEjbSynchronizations
 java:app/jboss-seam/EjbSynchronizations!org.jboss.seam.transaction.LocalEjbSynchronizations
 java:module/EjbSynchronizations!org.jboss.seam.transaction.LocalEjbSynchronizations
 java:global/jboss-seam-booking/jboss-seam/EjbSynchronizations
 java:app/jboss-seam/EjbSynchronizations
 java:module/EjbSynchronizations
<span class="error"> </span>
<span class="integer">15</span>:<span class="octal">01</span>:<span class="integer">16</span>,<span class="integer">140</span> INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread <span class="integer">1</span>-<span class="integer">6</span>) JNDI bindings <span class="keyword">for</span> session bean named TimerServiceDispatcher in deployment unit subdeployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam.jar</span><span class="delimiter">&quot;</span></span> of deployment <span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.ear</span><span class="delimiter">&quot;</span></span> are as follows:
<span class="error"> </span>
 java:global/jboss-seam-booking/jboss-seam/TimerServiceDispatcher!org.jboss.seam.async.LocalTimerServiceDispatcher
 java:app/jboss-seam/TimerServiceDispatcher!org.jboss.seam.async.LocalTimerServiceDispatcher
 java:module/TimerServiceDispatcher!org.jboss.seam.async.LocalTimerServiceDispatcher
 java:global/jboss-seam-booking/jboss-seam/TimerServiceDispatcher
 java:app/jboss-seam/TimerServiceDispatcher
 java:module/TimerServiceDispatcher</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to modify the WAR&#8217;s lib/components.xml file to use the new JNDI
bindings. In the log, note the EJB JNDI bindings all start with
"java:app/jboss-seam-booking.jar"</p>
</div>
<div class="paragraph">
<p>Replace the &lt;core:init&gt; element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!--     &lt;core:init jndi-pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking/#{ejbName}/local</span><span class="delimiter">&quot;</span></span> debug=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> distributable=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt; --&gt;
&lt;core:init jndi-pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam-booking.jar/#{ejbName}</span><span class="delimiter">&quot;</span></span> debug=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> distributable=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Next, we need to add the EjbSynchronizations and TimerServiceDispatcher
JNDI bindings. Add the following component elements to the file:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;component <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.seam.transaction.EjbSynchronizations</span><span class="delimiter">&quot;</span></span> <span class="class">jndi</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam/EjbSynchronizations</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;component <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.seam.async.TimerServiceDispatcher</span><span class="delimiter">&quot;</span></span> <span class="class">jndi</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam/TimerServiceDispatcher</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The components.xml file should now look like this:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;components xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.com/products/seam/components</span><span class="delimiter">&quot;</span></span>
            xmlns:core=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.com/products/seam/core</span><span class="delimiter">&quot;</span></span>
            xmlns:security=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.com/products/seam/security</span><span class="delimiter">&quot;</span></span>
            xmlns:transaction=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.com/products/seam/transaction</span><span class="delimiter">&quot;</span></span>
            xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
            xsi:schemaLocation=
                <span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.com/products/seam/core http://jboss.com/products/seam/core-2.2.xsd
                 http://jboss.com/products/seam/transaction http://jboss.com/products/seam/transaction-2.2.xsd
                 http://jboss.com/products/seam/security http://jboss.com/products/seam/security-2.2.xsd
                 http://jboss.com/products/seam/components http://jboss.com/products/seam/components-2.2.xsd</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span>
    &lt;!-- &lt;core:init jndi-pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking/#{ejbName}/local</span><span class="delimiter">&quot;</span></span> debug=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> distributable=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt; --&gt;
    &lt;core:init jndi-pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam-booking.jar/#{ejbName}</span><span class="delimiter">&quot;</span></span> debug=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> distributable=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span>
    &lt;core:manager conversation-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">120000</span><span class="delimiter">&quot;</span></span>
                  concurrent-request-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>
                  conversation-id-parameter=<span class="string"><span class="delimiter">&quot;</span><span class="content">cid</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span>
    &lt;transaction:ejb-transaction/&gt;
<span class="error"> </span>
    &lt;security:identity authenticate-method=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{authenticator.authenticate}</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span>
    &lt;component <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.seam.transaction.EjbSynchronizations</span><span class="delimiter">&quot;</span></span>
            <span class="class">jndi</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam/EjbSynchronizations</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;component <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.seam.async.TimerServiceDispatcher</span><span class="delimiter">&quot;</span></span>
            <span class="class">jndi</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam/TimerServiceDispatcher</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/components&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Redeploy the application by deleting the
<code>standalone/deployments/jboss-seam-booking.ear.failed</code> file and creating
a blank <code>jboss-seam-booking.ear.dodeploy</code> file in the same directory.</p>
</div>
<div class="paragraph">
<p>+
At this point, the application should deploy and run without error. When
you access the URL " <a href="http://localhost:8080/seam-booking/"" class="bare">http://localhost:8080/seam-booking/"</a> in a browser,
you will be able to login successfully.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="step-4-access-the-application" class="paragraph">
<p>== Step 4: Access the application</p>
</div>
<div class="paragraph">
<p>Access the URL " <a href="http://localhost:8080/seam-booking/"" class="bare">http://localhost:8080/seam-booking/"</a> in a browser and
login with demo/demo. You should the Booking welcome page.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div id="summary-of-changes" class="paragraph">
<p>== Summary of Changes</p>
</div>
<div class="paragraph">
<p>Although it would be much more efficient to determine dependencies in
advance and add the implicit dependencies in one step, this exercise
shows how problems appear in the log and provides some information on
how to debug and resolve them.</p>
</div>
<div class="paragraph">
<p>The following is a summary of changes made to the application when
migrating it to WildFly:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We created a <code>jboss-deployment-structure.xml</code> file in the EAR&#8217;s
<code>META-INF/</code> directory. We added "dependencies" and "exclusions" to
resolve ClassNotFoundExceptions. This file contains the following data:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.logging</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
           &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.dom4j</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.collections</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking.war</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/exclusions&gt;
     &lt;dependencies&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.faces.api</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.jsf-impl</span><span class="delimiter">&quot;</span></span> slot=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>We copied the following JARs from the
<code>EAP5_HOME/jboss-eap-5.1/seam/lib/</code> directory to the
<code>jboss-seam-booking.ear/lib/</code> directory to resolve
ClassNotFoundExceptions:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hibernate-core.jar
hibernate-validator.jar</code></pre>
</div>
</div>
</li>
<li>
<p>We modified the \{\{jboss-seam-booking.jar/META-INF/persistence.xml}
file as follows.</p>
</li>
</ul>
</div>
</li>
<li>
<p>First, we changed the jta-data-source element to use the Example
database that ships with AS7:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!-- &lt;jta-data-source&gt;java:/bookingDatasource&lt;/jta-data-source&gt; --&gt;
&lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Next, we commented out the hibernate.cache.provider_class property:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!-- &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.provider_class</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.cache.HashtableCacheProvider</span><span class="delimiter">&quot;</span></span>/&gt; --&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>We modified the WAR&#8217;s lib/components.xml file to use the new JNDI
bindings</p>
</li>
</ul>
</div>
</li>
<li>
<p>We replaced the &lt;core:init&gt; existing element as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!-- &lt;core:init jndi-pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss-seam-booking/#{ejbName}/local</span><span class="delimiter">&quot;</span></span> debug=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> distributable=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt; --&gt;
&lt;core:init jndi-pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam-booking.jar/#{ejbName}</span><span class="delimiter">&quot;</span></span> debug=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> distributable=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>We added component elements for the "EjbSynchronizations" and
"TimerServiceDispatcher" JNDI bindings</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> &lt;component <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.seam.transaction.EjbSynchronizations</span><span class="delimiter">&quot;</span></span> <span class="class">jndi</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam/EjbSynchronizations</span><span class="delimiter">&quot;</span></span>/&gt;
 &lt;component <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.seam.async.TimerServiceDispatcher</span><span class="delimiter">&quot;</span></span> <span class="class">jndi</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jboss-seam/TimerServiceDispatcher</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The unmodified EAR from EAP 5.1 (jboss-seam-booking-eap51.ear.tar.gz)
and the EAR as modified to run on AS7
(jboss-seam-booking-as7.ear.tar.gz) are attached to this document.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>= Spring applications development and migration guide</p>
</div>
<div class="paragraph">
<p>This document details the main points that need to be considered by
Spring developers that wish to develop new applications or to migrate
existing applications to be run into WildFly 11.</p>
</div>
<div id="dependencies-and-modularity" class="paragraph">
<p>== Dependencies and Modularity</p>
</div>
<div class="paragraph">
<p>WildFly 11 has a modular class loading strategy, different from previous
versions of JBoss AS, which enforces a better class loading isolation
between deployments and the application server itself. A detailed
description can be found in the documentation dedicated to
<a href="https://docs.jboss.org/author/display/AS7/Class+Loading+in+AS7">class
loading in WildFly 11</a>.</p>
</div>
<div class="paragraph">
<p>This reduces significantly the risk of running into a class loading
conflict and allows applications to package their own dependencies if
they choose to do so. This makes it easier for Spring applications that
package their own dependencies - such as logging frameworks or
persistence providers to run on WildFly 11.</p>
</div>
<div class="paragraph">
<p>At the same time, this does not mean that duplications and conflicts
cannot exist on the classpath. Some module dependencies are implicit,
depending on the type of deployment as shown
<a href="https://docs.jboss.org/author/display/AS7/Implicit+module+dependencies+for+deployments">here</a>.</p>
</div>
<div id="persistence-usage-guide" class="paragraph">
<p>== Persistence usage guide</p>
</div>
<div class="paragraph">
<p>Depending on the strategy being used, Spring applications can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>native Hibernate applications;</p>
</li>
<li>
<p>JPA-based applications;</p>
</li>
<li>
<p>native JDBC applications;</p>
</li>
</ul>
</div>
<div id="native-springhibernate-applications" class="paragraph">
<p>== Native Spring/Hibernate applications</p>
</div>
<div class="paragraph">
<p>Applications that use the Hibernate API directly with Spring (i.e.
through either one of LocalSessionFactoryBean or
AnnotationSessionFactoryBean) may use a version of Hibernate 3 packaged
inside the application. Hibernate 4 (which is provided through the
'org.hibernate' module of WildFly 11) is not supported by Spring 3.0 and
Spring 3.1 (and may be supported by Spring 3.2 as described in
<a href="https://jira.springsource.org/browse/SPR-8096">SPR-8096</a>), so adding this
module as a dependency is not a solution.</p>
</div>
<div id="jpa-based-applications" class="paragraph">
<p>== JPA-based applications</p>
</div>
<div class="paragraph">
<p>Spring applications using JPA may choose between:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using a server-deployed persistence unit;</p>
</li>
<li>
<p>using a Spring-managed persistence unit.</p>
</li>
</ul>
</div>
<div id="using-server-deployed-persistence-units" class="paragraph">
<p>=== Using server-deployed persistence units</p>
</div>
<div class="paragraph">
<p>Applications that use a server-deployed persistence unit must observe
the typical Java EE rules in what concerns dependency management, i.e.
the javax.persistence classes and persistence provider (Hibernate) are
contained in modules which are added automatically by the application
when the persistence unit is deployed.</p>
</div>
<div class="paragraph">
<p>In order to use the server-deployed persistence units from within
Spring, either the persistence context or the persistence unit need to
be registered in JNDI via web.xml as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;persistence-context-ref&gt;
    &lt;persistence-context-ref-name&gt;persistence/petclinic-em&lt;/persistence-unit-ref-name&gt;
    &lt;persistence-unit-name&gt;petclinic&lt;/persistence-unit-name&gt;
&lt;/persistence-context-ref&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;persistence-unit-ref&gt;
<span class="error"> </span> <span class="error"> </span> &lt;persistence-unit-ref-name&gt;persistence/petclinic-emf&lt;/persistence-unit-ref-name&gt;
<span class="error"> </span> <span class="error"> </span> &lt;persistence-unit-name&gt;petclinic&lt;/persistence-unit-name&gt;
&lt;/persistence-unit-ref&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When doing so, the persistence context or persistence unit are available
to be looked up in JNDI, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jee:jndi-lookup id=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManager</span><span class="delimiter">&quot;</span></span> jndi-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/persistence/petclinic-em</span><span class="delimiter">&quot;</span></span><span class="error"> </span>
            expected-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.EntityManager</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jee:jndi-lookup id=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> jndi-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/persistence/petclinic-emf</span><span class="delimiter">&quot;</span></span><span class="error"> </span>
            expected-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.EntityManagerFactory</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>JNDI binding</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JNDI binding via persistence.xml properties is not supported in WildFly
8.</p>
</div>
<div id="using-spring-managed-persistence-units" class="paragraph">
<p>=== Using Spring-managed persistence units</p>
</div>
<div class="paragraph">
<p>Spring applications running in WildFly 11 may also create persistence
units on their own, using the LocalContainerEntityManagerFactoryBean.
This is what these applications need to consider:</p>
</div>
<div id="placement-of-the-persistence-unit-definitions" class="paragraph">
<p>==== Placement of the persistence unit definitions</p>
</div>
<div class="paragraph">
<p>When the application server encounters a deployment that has a file
named META-INF/persistence.xml (or, for that matter,
WEB-INF/classes/META-INF/persistence.xml), it will attempt to create a
persistence unit based on what is provided in the file. In most cases,
such definition files are not compliant with the Java EE requirements,
mostly because required elements such as the datasource of the
persistence unit are supposed to be provided by the Spring context
definitions, which will fail the deployment of the persistence unit, and
consequently of the entire deployment.</p>
</div>
<div class="paragraph">
<p>Spring applications can easily avoid this type of conflict, by using a
feature of the LocalContainerEntityManagerFactoryBean which is designed
for this purpose. Persistence unit definition files can exist in other
locations than META-INF/persistence.xml and the location can be
indicated through the persistenceXmlLocation property of the factory
bean class.</p>
</div>
<div class="paragraph">
<p>Assuming that the persistence unit is in the
META-INF/jpa-persistence.xml, the corresponding definition can be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="delimiter">&quot;</span></span>&gt;<span class="error"> </span>
 <span class="error"> </span> <span class="error"> </span> <span class="error"> </span> &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistenceXmlLocation</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath*:META-INF/jpa-persistence.xml</span><span class="delimiter">&quot;</span></span>/&gt;<span class="error"> </span>
 <span class="error"> </span> <span class="error"> </span> <span class="error"> </span> &lt;!-- other definitions --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div id="managing-dependencies" class="paragraph">
<p>=== Managing dependencies</p>
</div>
<div class="paragraph">
<p>Since the LocalContainerEntityManagerFactoryBean and the corresponding
HibernateJpaVendorAdapter are based on Hibernate 3, it is required to
use that version with the application. Therefore, the Hibernate 3 jars
must be included in the deployment. At the same time, due the presence
of @PersistenceUnit or @PersistenceContext annotations on the
application classes, the application server will automatically add the
'org.hibernate' module as a dependency.</p>
</div>
<div class="paragraph">
<p>This can be avoided by instructing the server to exclude the module from
the deployment&#8217;s list of dependencies. In order to do so, include a
META-INF/jboss-deployment-structure.xml or, for web applications,
WEB-INF/jboss-deployment-structure.xml with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-deployment-structure xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:deployment-structure:1.0</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;deployment&gt;
    &lt;exclusions&gt;
       &lt;module name=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/exclusions&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>= How do I migrate my application from AS7 to WildFly</p>
</div>
<div id="about-this-document" class="paragraph">
<p>== About this Document</p>
</div>
<div class="paragraph">
<p>The purpose of this guide is to document changes that are needed to
successfully run and deploy AS 7 applications on WildFly. It provides
information on to resolve deployment and runtime problems and how to
prevent changes in application behavior. This is the first step in
moving to the new platform. Once the application is successfully
deployed and running on the new platform, plans can be made to upgrade
individual components to use the new functions and features of WildFly.</p>
</div>
<div id="overview-of-wildfly" class="paragraph">
<p>== Overview of WildFly</p>
</div>
<div class="paragraph">
<p>The list of WildFly new functionality is extensive, being the most
relevant, with respect to server and application migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java EE7 - WildFly is a certified implementation of Java EE7, meeting
both the Web and the Full profiles, and already includes support for the
latest iterations of CDI (1.2) and Web Sockets (1.1).</p>
</li>
<li>
<p>Undertow - A new cutting-edge web server in WildFly, designed for
maximum throughput and scalability, including environments with over a
million connections. And the latest web technologies, such as the new
HTTP/2 standard, are already onboard.</p>
</li>
<li>
<p>Apache ActiveMQ Artemis - WildFly&#8217;s new JMS broker. Based on an code
donation from HornetQ, this Apache subproject provides outstanding
performance based on a proven non-blocking architecture.</p>
</li>
<li>
<p>IronJacamar 1.2 - The latest IronJacamar provides a stable and feature
rich JCA &amp; Datasources support.</p>
</li>
<li>
<p>JBossWS 5 - The fifth generation of JBossWS, a major leap forward,
brings new features and performances improvements to WildFly Web
Services</p>
</li>
<li>
<p>RESTEasy 3 - WildFly includes the latest generation of RESTEasy, which
goes beyond the standard Java EE REST APIs (JAX-RS 2.0), by also
providing a number of useful extensions, such as JSON Web Encryption,
Jackson, Yaml, JSON-P, and Jettison.</p>
</li>
<li>
<p>OpenJDK ORB - WildFly switched the IIOP implementation from JacORB, to
a downstream branch of the OpenJDK Orb, leading to better
interoperability with the JVM ORB and the Java EE RI.</p>
</li>
<li>
<p>Feature Rich Clustering - Clustering support was heavily refactored in
WildFly, and includes several APIs for applications</p>
</li>
<li>
<p>Port Reduction - By utilising HTTP upgrade, WildFly has moved nearly
all of its protocols to be multiplexed over just two HTTP ports: a
management port (9990), and an application port (8080).</p>
</li>
<li>
<p>Enhanced Logging - The management API now supports the ability to list
and view the available log files on a server, or even define custom
formatters other than the default pattern formatter. Deployment&#8217;s
logging setup is also greatly enhanced.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The support for some technologies was removed, due to the high
maintenance cost, low community interest, and much better alternative
solutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMP EJB - JPA offers a much more performant and flexible API</p>
</li>
<li>
<p>JAX-RPC - JAX-WS offers a much more accurate and complete solution</p>
</li>
<li>
<p>JSR-88 - With very little adoption, the more complete deployment APIs
provided by vendors are preferred</p>
</li>
</ul>
</div>
<div id="server-migration" class="paragraph">
<p>== Server Migration</p>
</div>
<div class="paragraph">
<p>Migrating an AS7 server to WildFly consists of migrating custom
configuration files, and some persisted data that may exist.</p>
</div>
<div id="jacorb-subsystem" class="paragraph">
<p>=== JacORB Subsystem</p>
</div>
<div class="paragraph">
<p>WildFly ORB support is provided by the JDK itself, instead of relying on
JacORB. A subsystem configuration migration is required.</p>
</div>
<div id="jacorb-subsystem-configuration" class="paragraph">
<p>==== JacORB Subsystem Configuration</p>
</div>
<div class="paragraph">
<p>The extension&#8217;s module <strong>org.jboss.as.jacorb *is replaced by module
*org.wildfly.iiop-openjdk</strong>, while the subsystem configuration namespace
<strong>urn:jboss:domain:jacorb:2.0</strong> is replaced by
<strong>urn:jboss:domain:iiop-openjdk:1.0</strong>.</p>
</div>
<div class="paragraph">
<p>The XML configuration of the new subsystem accepts only a subset of the
legacy elements/attributes. Consider the following example of the JacORB
subsystem configuration, containing all valid elements and attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:jacorb:1.3</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;orb name=<span class="string"><span class="delimiter">&quot;</span><span class="content">JBoss</span><span class="delimiter">&quot;</span></span> print-version=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> use-imr=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> use-bom=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> <span class="error"> </span>cache-typecodes=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>cache-poa-names=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> giop-minor-version =<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> socket-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">jacorb</span><span class="delimiter">&quot;</span></span> ssl-socket-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">jacorb-ssl</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;connection retries=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> retry-interval=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span> client-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> server-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>max-server-connections=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span> max-managed-buf-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">24</span><span class="delimiter">&quot;</span></span> outbuf-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">2048</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>outbuf-cache-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;initializers security=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> transactions=<span class="string"><span class="delimiter">&quot;</span><span class="content">spec</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;/orb&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;poa monitoring=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> queue-wait=<span class="string"><span class="delimiter">&quot;</span><span class="content">on</span><span class="delimiter">&quot;</span></span> queue-min=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> queue-max=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;request-processors pool-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> max-threads=<span class="string"><span class="delimiter">&quot;</span><span class="content">32</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;/poa&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;naming root-context=<span class="string"><span class="delimiter">&quot;</span><span class="content">JBoss/Naming/root</span><span class="delimiter">&quot;</span></span> <span class="keyword">export</span>-corbaloc=<span class="string"><span class="delimiter">&quot;</span><span class="content">on</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;interop sun=<span class="string"><span class="delimiter">&quot;</span><span class="content">on</span><span class="delimiter">&quot;</span></span> comet=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> iona=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> chunk-custom-rmi-valuetypes=<span class="string"><span class="delimiter">&quot;</span><span class="content">on</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>lax-<span class="type">boolean</span>-encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> indirection-encoding-disable=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> strict-check-on-tc-creation=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;security support-ssl=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> add-component-via-interceptor=<span class="string"><span class="delimiter">&quot;</span><span class="content">on</span><span class="delimiter">&quot;</span></span> client-supports=<span class="string"><span class="delimiter">&quot;</span><span class="content">MutualAuth</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>client-requires=<span class="string"><span class="delimiter">&quot;</span><span class="content">None</span><span class="delimiter">&quot;</span></span> server-supports=<span class="string"><span class="delimiter">&quot;</span><span class="content">MutualAuth</span><span class="delimiter">&quot;</span></span> server-requires=<span class="string"><span class="delimiter">&quot;</span><span class="content">None</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;properties&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">some_property</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">some_value</span><span class="delimiter">&quot;</span></span>/&gt;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>&lt;/properties&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties that are not supported and have to be removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;orb/&gt;: client-timeout, max-managed-buf-size, max-server-connections,
outbuf-cache-timeout, outbuf-size, connection retries, retry-interval,
name,server-timeout</p>
</li>
<li>
<p>&lt;poa/&gt;: queue-min, queue-max, pool-size, max-threads</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On-off properties: have to either be removed or in off mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;orb/&gt;: cache-poa-names, cache-typecodes, print-version, use-bom,
use-imr</p>
</li>
<li>
<p>&lt;interop/&gt;: all except sun</p>
</li>
<li>
<p>&lt;poa/&gt;: monitoring, queue-wait</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In case the legacy subsystem configuration is available, such
configuration may be migrated to the new subsystem by invoking its
<code>migrate</code> operation, using the CLI management client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=jacorb:migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a <code>describe-migration</code> operation that returns a list of
all the management operations that are performed to migrate from the
legacy subsystem to the new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=jacorb:describe-migration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>migrate</code> and <code>describe-migration</code> will also display a list of
migration-warnings if there are some resource or attributes that can not
be migrated automatically. The following is a list of these warnings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties X cannot be emulated using OpenJDK ORB and are not
supported<br>
This warning means that mentioned properties are not supported and won&#8217;t
be included in the new subsystem configuration. As a result of that
admin must be aware that any behaviour implied by those properties would
be inexistent. Admin has to check whether subsystem is able to operate
correctly without that behaviour on the new server.Unsupported
properties: cache-poa-names, cache-typecodes,
chunk-custom-rmi-valuetypes, client-timeout, comet,
indirection-encoding-disable, iona, lax-boolean-encoding,
max-managed-buf-size, max-server-connections, max-threads,
outbuf-cache-timeout, outbuf-size, queue-max, queue-min, poa-monitoring,
print-version, retries, retry-interval, queue-wait, server-timeout,
strict-check-on-tc-creation, use-bom, use-imr.</p>
</li>
<li>
<p>The properties X use expressions. Configuration properties that are
used to resolve those expressions should be transformed manually to the
new iiop-openjdk subsystem format<br>
Admin has to transform all the configuration files to work correctly
with the jacorb subsystem. f.e. jacorb has a property giop-minor-version
whereas openjdk uses property giop-version. Let&#8217;s suppose we use '1'
minor version in jacorb and have it configured in standalone.conf file
as system variable: -Diiop-giop-minor-version=1. Admin is responsible
for changing this variable to 1.1 after the migration to make sure that
the new subsystem will work correctly.</p>
</li>
</ul>
</div>
<div id="jboss-web-subsystem" class="paragraph">
<p>=== JBoss Web Subsystem</p>
</div>
<div class="paragraph">
<p>JBoss Web is replaced by Undertow in WildFly, which means that the
legacy subsystem configuration should be migrated to WildFly&#8217;s Undertow
subsystem configuration.</p>
</div>
<div id="jboss-web-subsystem-configuration" class="paragraph">
<p>==== JBoss Web Subsystem Configuration</p>
</div>
<div class="paragraph">
<p>The extension&#8217;s module <strong>org.jboss.as.web *is replaced by module
*org.wildfly.extension.undertow</strong>, while the subsystem configuration
namespace <strong>urn:jboss:domain:web:</strong>* is replaced by
<strong>urn:jboss:domain:undertow:3.0</strong>.</p>
</div>
<div class="paragraph">
<p>The XML configuration of the new subsystem is relatively different.
Consider the following example of the JBoss Web subsystem configuration,
containing all valid elements and attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:web:2.2</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-virtual-server=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-host</span><span class="delimiter">&quot;</span></span> <span class="directive">native</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-session-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span> instance-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;configuration&gt;
        &lt;<span class="directive">static</span>-resources listings=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                          sendfile=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
                          file-encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span>
                          read-only=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                          webdav=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                          secret=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>
                          max-depth=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
                          disabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                /&gt;
        &lt;jsp-configuration development=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           disabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                           keep-generated=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           trim-spaces=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           tag-pooling=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           mapped-file=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           check-interval=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>
                           modification-test-interval=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
                           recompile-on-fail=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           smap=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           dump-smap=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           generate-strings-as-<span class="type">char</span>-arrays=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           error-on-use-bean-invalid-<span class="type">class</span>-<span class="class">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           scratch-dir=<span class="string"><span class="delimiter">&quot;</span><span class="content">/some/dir</span><span class="delimiter">&quot;</span></span>
                           source-vm=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.7</span><span class="delimiter">&quot;</span></span>
                           target-vm=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.7</span><span class="delimiter">&quot;</span></span>
                           java-encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">utf-8</span><span class="delimiter">&quot;</span></span>
                           x-powered-by=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           display-source-fragment=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;mime-mapping name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ogx</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/ogg</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;welcome-file&gt;titi&lt;/welcome-file&gt;
    &lt;/configuration&gt;
    &lt;connector name=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> scheme=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span>
               protocol=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span>
               socket-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span>
               enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
               enable-lookups=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               proxy-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">reverse-proxy</span><span class="delimiter">&quot;</span></span>
               max-post-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">2097153</span><span class="delimiter">&quot;</span></span>
               max-save-post-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span>
               redirect-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span>
               max-connections=<span class="string"><span class="delimiter">&quot;</span><span class="content">300</span><span class="delimiter">&quot;</span></span>
               secure=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               executor=<span class="string"><span class="delimiter">&quot;</span><span class="content">some-executor</span><span class="delimiter">&quot;</span></span>
            /&gt;
    &lt;connector name=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> scheme=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> protocol=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span> secure=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> socket-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;ssl certificate-key-file=<span class="string"><span class="delimiter">&quot;</span><span class="content">${file-base}/server.keystore</span><span class="delimiter">&quot;</span></span>
             ca-certificate-file=<span class="string"><span class="delimiter">&quot;</span><span class="content">${file-base}/jsse.keystore</span><span class="delimiter">&quot;</span></span>
             key-alias=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>
             password=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
             cipher-suite=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSL_RSA_WITH_3DES_EDE_CBC_SHA</span><span class="delimiter">&quot;</span></span>
             protocol=<span class="string"><span class="delimiter">&quot;</span><span class="content">SSLv3</span><span class="delimiter">&quot;</span></span>
             verify-client=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             verify-depth=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
             certificate-file=<span class="string"><span class="delimiter">&quot;</span><span class="content">certificate-file.ext</span><span class="delimiter">&quot;</span></span>
             ca-revocation-url=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://example.org/some/url</span><span class="delimiter">&quot;</span></span>
             ca-certificate-password=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
             keystore-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span>
             truststore-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">JKS</span><span class="delimiter">&quot;</span></span>
             session-cache-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span>
             session-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
             ssl-protocol=<span class="string"><span class="delimiter">&quot;</span><span class="content">RFC4279</span><span class="delimiter">&quot;</span></span>
                /&gt;
    &lt;/connector&gt;
    &lt;connector name=<span class="string"><span class="delimiter">&quot;</span><span class="content">http-vs</span><span class="delimiter">&quot;</span></span> scheme=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> protocol=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span> socket-binding=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> &gt;
        &lt;virtual-server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">vs1</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;virtual-server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">vs2</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/connector&gt;
    &lt;virtual-server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-host</span><span class="delimiter">&quot;</span></span> enable-welcome-root=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-web-module=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.war</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;alias name=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;alias name=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;access-log resolve-hosts=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> extended=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">extended</span><span class="delimiter">&quot;</span></span> prefix=<span class="string"><span class="delimiter">&quot;</span><span class="content">prefix</span><span class="delimiter">&quot;</span></span> rotate=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> &gt;
            &lt;directory relative-to=<span class="string"><span class="delimiter">&quot;</span><span class="content">jboss.server.base.dir</span><span class="delimiter">&quot;</span></span> path=<span class="string"><span class="delimiter">&quot;</span><span class="content">toto</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;/access-log&gt;
        &lt;rewrite name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myrewrite</span><span class="delimiter">&quot;</span></span> pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">^/helloworld(.*)</span><span class="delimiter">&quot;</span></span> substitution=<span class="string"><span class="delimiter">&quot;</span><span class="content">/helloworld/test.jsp</span><span class="delimiter">&quot;</span></span> flags=<span class="string"><span class="delimiter">&quot;</span><span class="content">L</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;rewrite name=<span class="string"><span class="delimiter">&quot;</span><span class="content">with-conditions</span><span class="delimiter">&quot;</span></span> pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">^/helloworld(.*)</span><span class="delimiter">&quot;</span></span> substitution=<span class="string"><span class="delimiter">&quot;</span><span class="content">/helloworld/test.jsp</span><span class="delimiter">&quot;</span></span> flags=<span class="string"><span class="delimiter">&quot;</span><span class="content">L</span><span class="delimiter">&quot;</span></span> &gt;
            &lt;condition name=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">off</span><span class="delimiter">&quot;</span></span> test=<span class="string"><span class="delimiter">&quot;</span><span class="content">%{HTTPS}</span><span class="delimiter">&quot;</span></span> flags=<span class="string"><span class="delimiter">&quot;</span><span class="content">NC</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;condition name=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> test=<span class="string"><span class="delimiter">&quot;</span><span class="content">%{USER}</span><span class="delimiter">&quot;</span></span> pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">toto</span><span class="delimiter">&quot;</span></span> flags=<span class="string"><span class="delimiter">&quot;</span><span class="content">NC</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;condition name=<span class="string"><span class="delimiter">&quot;</span><span class="content">no-flags</span><span class="delimiter">&quot;</span></span> test=<span class="string"><span class="delimiter">&quot;</span><span class="content">%{USER}</span><span class="delimiter">&quot;</span></span> pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">toto</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/rewrite&gt;
        &lt;sso reauthenticate=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> domain=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDomain</span><span class="delimiter">&quot;</span></span> cache-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myCache</span><span class="delimiter">&quot;</span></span>
             cache-container=<span class="string"><span class="delimiter">&quot;</span><span class="content">cache-container</span><span class="delimiter">&quot;</span></span> http-only=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/virtual-server&gt;
    &lt;virtual-server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">vs1</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;virtual-server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">vs2</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myvalve</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.some.module</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.some.class</span><span class="delimiter">&quot;</span></span> enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">param-name</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">some-value</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/valve&gt;
    &lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">accessLog</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.web</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.catalina.valves.AccessLogValve</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">prefix</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">myapp_access_log.</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">suffix</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">.log</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">rotatable</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileDateFormat</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">pattern</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">common</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">directory</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jboss.server.log.dir}</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">resolveHosts</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">conditionIf</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">log-enabled</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/valve&gt;
    &lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">request-dumper</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.web</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.catalina.valves.RequestDumperValve</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-addr</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.web</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.catalina.valves.RemoteAddrValve</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">allow</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1,127.0.0.2</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">deny</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.20</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/valve&gt;
    &lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">crawler</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.catalina.valves.CrawlerSessionManagerValve</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.web</span><span class="delimiter">&quot;</span></span> &gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionInactiveInterval</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">crawlerUserAgents</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">Google</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/valve&gt;
    &lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.catalina.valves.RemoteIpValve</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.web</span><span class="delimiter">&quot;</span></span> &gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">internalProxies</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">192</span><span class="content">\.</span><span class="content">168</span><span class="content">\.</span><span class="content">0</span><span class="content">\.</span><span class="content">10|192</span><span class="content">\.</span><span class="content">168</span><span class="content">\.</span><span class="content">0</span><span class="content">\.</span><span class="content">11</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">remoteIpHeader</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-forwarded-for</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxiesHeader</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-forwarded-by</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustedProxies</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy1|proxy2</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/valve&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>FIXME compare with Undertow, list unsupported features</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to do a migration of the legacy subsystem configuration,
and related persisted data. , by invoking the legacy&#8217;s subsystem&#8217;s
<code>migrate</code> operation, using the CLI management client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=web:migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a <code>describe-migration</code> operation that returns a list of
all the management operations that are performed to migrate from the
legacy subsystem to the new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=web:describe-migration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>migrate</code> and <code>describe-migration</code> will also display a list of
migration-warnings if there are some resource or attributes that can not
be migrated automatically. The following is a list of these warnings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Could not migrate resource X<br>
This warning means that mentioned resource configuration is not
supported and won&#8217;t be included in the new subsystem configuration. As a
result of that admin must be aware that any behaviour implied by those
resources would be inexistent. Admin has to check whether subsystem is
able to operate correctly without that behaviour on the new server.<br>
FIXME must document which are the resources that trigger this</p>
</li>
<li>
<p>Could not migrate attribute X from resource Y.<br>
This warning means that mentioned resource configuration property is not
supported and won&#8217;t be included in the new subsystem configuration. As a
result of that admin must be aware that any behaviour implied by those
properties would be inexistent. Admin has to check whether subsystem is
able to operate correctly without that behaviour on the new server.<br>
FIXME must document which are the properties that trigger this</p>
</li>
<li>
<p>Could not migrate SSL connector as no SSL config is defined</p>
</li>
<li>
<p>Could not migrate verify-client attribute %s to the Undertow
equivalent</p>
</li>
<li>
<p>Could not migrate verify-client expression %s</p>
</li>
<li>
<p>Could not migrate valve X<br>
This warning means that mentioned valve configuration is not supported
and won&#8217;t be included in the new subsystem configuration. As a result of
that admin must be aware that any behaviour implied by those resources
would be inexistent. Admin has to check whether subsystem is able to
operate correctly without that behaviour on the new server. This warning
may happen for :</p>
<div class="ulist">
<ul>
<li>
<p>org.apache.catalina.valves.RemoteAddrValve : must have at least one
allowed or denied value.</p>
</li>
<li>
<p>org.apache.catalina.valves.RemoteHostValve : must have at least one
allowed or denied value.</p>
</li>
<li>
<p>org.apache.catalina.authenticator.BasicAuthenticator</p>
</li>
<li>
<p>org.apache.catalina.authenticator.DigestAuthenticator</p>
</li>
<li>
<p>org.apache.catalina.authenticator.FormAuthenticator</p>
</li>
<li>
<p>org.apache.catalina.authenticator.SSLAuthenticator</p>
</li>
<li>
<p>org.apache.catalina.authenticator.SpnegoAuthenticator</p>
</li>
<li>
<p>custom valves</p>
</li>
</ul>
</div>
</li>
<li>
<p>Could not migrate attribute X from valve Y<br>
This warning means that mentioned valve configuration property is not
supported and won&#8217;t be included in the new subsystem configuration. As a
result of that admin must be aware that any behaviour implied by those
properties would be inexistent. Admin has to check whether subsystem is
able to operate correctly without that behaviour on the new server. This
warning may happen for :</p>
<div class="ulist">
<ul>
<li>
<p>org.apache.catalina.valves.AccessLogValve : if you use the following
parameters <em>resolveHosts</em>, <em>fileDateFormat</em>, <em>renameOnRotate</em>,
<em>encoding</em>, <em>locale</em>, <em>requestAttributesEnabled</em>, <em>buffered</em>.</p>
</li>
<li>
<p>org.apache.catalina.valves.ExtendedAccessLogValve : if you use the
following parameters <em>resolveHosts</em>, <em>fileDateFormat</em>, <em>renameOnRotate</em>,
<em>encoding</em>, <em>locale</em>, <em>requestAttributesEnabled</em>, <em>buffered</em>.</p>
</li>
<li>
<p>org.apache.catalina.valves.RemoteIpValve:</p>
<div class="ulist">
<ul>
<li>
<p>if <em>remoteIpHeader</em> is defined and isn&#8217;t set to "x-forwarded-for".</p>
</li>
<li>
<p>if <em>protocolHeader</em> is defined and isn&#8217;t set to "x-forwarded-proto".</p>
</li>
<li>
<p>if you use the following parameters <em>httpServerPort</em> and
<em>httpsServerPort</em> .</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, please note that Undertow doesn&#8217;t support JBoss Web <strong>valves</strong>, but
some of these may be migrated to Undertow handlers, and JBoss Web
subsystem&#8217;s <code>migrate</code> operation do that too.</p>
</div>
<div class="paragraph">
<p>Here is a list of those valves and their corresponding Undertow handler:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Valve</th>
<th class="tableblock halign-left valign-top">Handler</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.AccessLogValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.accesslog.AccessLogHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.ExtendedAccessLogValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.accesslog.AccessLogHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.RequestDumperValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.RequestDumpingHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.RewriteValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.SetAttributeHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.RemoteHostValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.AccessControlListHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.RemoteAddrValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.IPAddressAccessControlHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.RemoteIpValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.ProxyPeerAddressHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.StuckThreadDetectionValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.server.handlers.StuckThreadDetectionHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.catalina.valves.CrawlerSessionManagerValve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow.servlet.handlers.CrawlerSessionManagerHandler</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <strong>org.apache.catalina.valves.JDBCAccessLogValve</strong> can&#8217;t be
automatically migrated to <strong>io.undertow.server.handlers.JDBCLogHandler</strong>
as the expectations differ.<br>
The migration can be done manually thought :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create the driver module and add the driver to the list of available
drivers</p>
</li>
<li>
<p>create a datasource pointing to the database where the log entries
are going to be stored</p>
</li>
<li>
<p>add an <strong>expression-filter</strong> definition with the following expression:
"jdbc-access-log(datasource='datasource-jndi-name')</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;valve name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.web</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.catalina.valves.JDBCAccessLogValve</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverName</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionName</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionPassword</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/wildfly?zeroDateTimeBehavior=convertToNull</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;param param-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> param-value=<span class="string"><span class="delimiter">&quot;</span><span class="content">combined</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;/valve&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>should become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:datasources:1.2</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;datasources&gt;
        &lt;datasource jndi-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/datasources/accessLogDS</span><span class="delimiter">&quot;</span></span> pool-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccessLogDS</span><span class="delimiter">&quot;</span></span> enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> use-java-context=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;connection-url&gt;jdbc:mysql:<span class="comment">//localhost:3306/wildfly?zeroDateTimeBehavior=convertToNull&lt;/connection-url&gt;</span>
            &lt;driver&gt;mysql&lt;/driver&gt;
            &lt;security&gt;
               &lt;user-name&gt;root&lt;/user-name&gt;
               &lt;password&gt;password&lt;/password&gt;
            &lt;/security&gt;
        &lt;/datasource&gt;
...
        &lt;drivers&gt;
            &lt;driver name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mysql</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;driver-<span class="type">class</span>&gt;<span class="class">com</span>.mysql.jdbc.Driver&lt;/driver-<span class="type">class</span>&gt;
            &lt;/<span class="class">driver</span>&gt;
...
        &lt;/drivers&gt;
    &lt;/datasources&gt;
&lt;/subsystem&gt;
...
&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:undertow:3.1</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-virtual-host=<span class="string"><span class="delimiter">&quot;</span><span class="content">default-virtual-host</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-servlet-container=<span class="string"><span class="delimiter">&quot;</span><span class="content">myContainer</span><span class="delimiter">&quot;</span></span>
           <span class="keyword">default</span>-server=<span class="string"><span class="delimiter">&quot;</span><span class="content">some-server</span><span class="delimiter">&quot;</span></span> instance-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">some-id</span><span class="delimiter">&quot;</span></span> statistics-enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
...
    &lt;server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">some-server</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-host=<span class="string"><span class="delimiter">&quot;</span><span class="content">other-host</span><span class="delimiter">&quot;</span></span> servlet-container=<span class="string"><span class="delimiter">&quot;</span><span class="content">myContainer</span><span class="delimiter">&quot;</span></span>&gt;
...
        &lt;host name=<span class="string"><span class="delimiter">&quot;</span><span class="content">other-host</span><span class="delimiter">&quot;</span></span> alias=<span class="string"><span class="delimiter">&quot;</span><span class="content">www.mysite.com, ${prop.value:default-alias}</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>-web-module=<span class="string"><span class="delimiter">&quot;</span><span class="content">something.war</span><span class="delimiter">&quot;</span></span> disable-console-redirect=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;location name=<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> handler=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcome-content</span><span class="delimiter">&quot;</span></span> /&gt;
            &lt;filter-ref name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-access</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
...
    &lt;filters&gt;
        &lt;expression-filter name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-access</span><span class="delimiter">&quot;</span></span> expression=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc-access-log(datasource='java:jboss/datasources/accessLogDS')</span><span class="delimiter">&quot;</span></span> /&gt;
...
    &lt;/filters&gt;
<span class="error"> </span>
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Please note that any custom valve won&#8217;t be migrated at all and will just
be removed from the configuration.<br>
Also the authentication related valves are to be replaced by Undertow
authentication mechanisms, and this have to be done manually.</p>
</div>
<div class="paragraph">
<p>FIXME how this last "manual" replacement is done? Need whole process
documented and concrete example</p>
</div>
<div id="websockets" class="paragraph">
<p>==== WebSockets</p>
</div>
<div class="paragraph">
<p>In AS7, to use WebSockets, you had to configure the 'http' <strong>connector</strong>
in the <strong>web</strong> subsystem of the server configuration file to use the NIO2
protocol. The following is an example of the Management CLI command to
configure WebSockets in the previous releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=web/connector=http/:write-attribute(name=protocol,value=org.apache.coyote.http11.Http11NioProtocol)</code></pre>
</div>
</div>
<div class="paragraph">
<p>WebSockets are a requirement of the Java EE 7 specification and the
default configuration is included in WildFly. More complex WebSocket
configuration is done in the <strong>servlet-container</strong> of the <strong>undertow</strong>
subsystem of the server configuration file.</p>
</div>
<div class="paragraph">
<p>You no longer need to configure the server for default WebSocket
support.<br>
FIXME isn&#8217;t &lt;websockets /&gt; required for that?</p>
</div>
<div id="messaging-subsystem" class="paragraph">
<p>=== Messaging Subsystem</p>
</div>
<div class="paragraph">
<p>WildFly JMS support is provided by ActiveMQ Artemis, instead of HornetQ.
It&#8217;s possible to do a migration of the legacy subsystem configuration,
and related persisted data.</p>
</div>
<div id="messaging-subsystem-configuration" class="paragraph">
<p>==== Messaging Subsystem Configuration</p>
</div>
<div class="paragraph">
<p>The extension&#8217;s module <strong>org.jboss.as.messaging</strong> is replaced by module
<strong>org.wildfly.extension.messaging-activemq</strong>, while the subsystem
configuration namespace <strong>urn:jboss:domain:messaging:3.0</strong> is replaced by
<strong>urn:jboss:domain:messaging-activemq:1.0</strong>.</p>
</div>
<div id="management-model" class="paragraph">
<p>===== Management model</p>
</div>
<div class="paragraph">
<p>In most cases, an effort was made to keep resource and attribute names
as similar as possible to those used in previous releases. The following
table lists some of the changes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HornetQ name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ActiveMQ name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hornetq-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hornetq-serverType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serverType</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">discovery-group-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">discovery-group</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The management operations invoked on the new messaging-subsystem starts
with <code>/subsystem=messaging-activemq/server=X</code> while the legacy messaging
subsystem was at <code>/subsystem=messaging/hornetq-server=X</code>.</p>
</div>
<div class="paragraph">
<p>In case the legacy subsystem configuration is available, such
configuration may be migrated to the new subsystem by invoking its
<code>migrate</code> operation, using the CLI management client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=messaging:migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a <code>describe-migration</code> operation that returns a list of
all the management operations that are performed to migrate from the
legacy subsystem to the new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=messaging:describe-migration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>migrate</code> and <code>describe-migration</code> will also display a list of
migration-warnings if there are some resource or attributes that can not
be migrated automatically. The following is a list of these warnings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The migrate operation can not be performed: the server must be in
admin-only mode<br>
The <code>migrate</code> operation requires starting the server in admin-only mode,
which is done by adding parameter <code>--admin-only</code> to the server start
command, e.g.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">./standalone.sh --admin-only</code></pre>
</div>
</div>
</li>
<li>
<p>Can not migrate attribute local-bind-address from resource X. Use
instead the socket-attribute to configure this broadcast-group.</p>
</li>
<li>
<p>Can not migrate attribute local-bind-port from resource X. Use instead
the socket-binding attribute to configure this broadcast-group.</p>
</li>
<li>
<p>Can not migrate attribute group-address from resource X. Use instead
the socket-binding attribute to configure this broadcast-group.</p>
</li>
<li>
<p>Can not migrate attribute group-port from resource X. Use instead the
socket-binding attribute to configure this broadcast-group.<br>
Broadcast-group resources no longer accept local-bind-address,
local-bind-port, group-address, group-port attributes. It only accepts a
socket-binding. The warning notifies that resource X has an unsupported
attribute. The user will have to set the socket-binding attribute on the
resource and ensures it corresponds to a defined socket-binding
resource.</p>
</li>
<li>
<p>Classes providing the %s are discarded during the migration. To use
them in the new messaging-activemq subsystem, you will have to extend
the Artemis-based Interceptor.<br>
Messaging interceptors support is significantly different in WildFly 10,
any interceptors configured in the legacy subsystem are discarded during
migration. Please refer to the Messaging Interceptors section to learn
how to migrate legacy Messaging interceptors.</p>
</li>
<li>
<p>Can not migrate the HA configuration of X. Its shared-store and backup
attributes holds expressions and it is not possible to determine
unambiguously how to create the corresponding ha-policy for the
messaging-activemq&#8217;s server.<br>
If the hornetq-server X&#8217;s shared-store or backup attributes hold an
expression, such as ${xxx}, then it&#8217;s not possible to determine the
actual ha-policy of the migrated server. In that case, we discard it and
the user will have to add the correct ha-policy afterwards (ha-policy is
a single resource underneath the messaging-activemq&#8217;s server resource).</p>
</li>
<li>
<p>Can not migrate attribute local-bind-address from resource X. Use
instead the socket-binding attribute to configure this
discovery-group.Can not migrate attribute local-bind-port from resource</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Use instead the socket-binding attribute to configure this
discovery-group.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Can not migrate attribute group-address from resource X. Use instead
the socket-binding attribute to configure this discovery-group.</p>
</li>
<li>
<p>Can not migrate attribute group-port from resource X. Use instead the
socket-binding attribute to configure this discovery-group.<br>
discovery-group resources no longer accept local-bind-address,
local-bind-port, group-address, group-port attributes. It only accepts a
socket-binding. The warning notifies that resource X has an unsupported
attribute.<br>
The user will have to set the socket-binding attribute on the resource
and ensures it corresponds to a defined socket-binding resource.</p>
</li>
<li>
<p>Can not create a legacy-connection-factory based on connection-factory</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>It uses a HornetQ in-vm connector that is not compatible with Artemis
in-vm connector<br>
Legacy subsystem&#8217;s remote connection-factory resources are migrated into
legacy-connection-factory resources, to allow old EAP6 clients to
connect to EAP7. However a connection-factory using in-vm will not be
migrated, because a in-vm client will be based on EAP7, not EAP 6. In
other words, legacy-connection-factory are created only when the CF is
using remote connectors, and this warning notifies about in-vm
connection-factory X not migrated.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Can not migrate attribute X from resource Y. The attribute uses an
expression that can be resolved differently depending on system
properties. After migration, this attribute must be added back with an
actual value instead of the expression.<br>
This warning appears when the migration logic needs to know the concrete
value of attribute X during migration, but instead such value includes
an expression that&#8217;s can&#8217;t be resolved, so the actual value can not be
determined, and the attribute is discarded. It happens in several cases,
for instance:</p>
<div class="ulist">
<ul>
<li>
<p>cluster-connection forward-when-no-consumers. This boolean attribute
has been replaced by the message-load-balancing-type attribute (which is
an enum of OFF, STRICT, ON_DEMAND)</p>
</li>
<li>
<p>broadcast-group and discovery-group&#8217;s jgroups-stack and
jgroups-channel attributes. They reference other resources and we no
longer accept expressions for them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Can not migrate attribute X from resource Y. This attribute is not
supported by the new messaging-activemq subsystem.<br>
Some attributes are no longer supported in the new messaging-activemq
subsystem and are simply discarded:</p>
<div class="ulist">
<ul>
<li>
<p>hornetq-server&#8217;s failback-delay</p>
</li>
<li>
<p>http-connector&#8217;s use-nio attribute</p>
</li>
<li>
<p>http-acceptor&#8217;s use-nio attribute</p>
</li>
<li>
<p>remote-connector&#8217;s use-nio attribute</p>
</li>
<li>
<p>remote-acceptor&#8217;s use-nio attribute</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="xml-configuration" class="paragraph">
<p>===== XML Configuration</p>
</div>
<div class="paragraph">
<p>The XML configuration has changed significantly with the new
messaging-activemq subsystem to provide a XML scheme more consistent
with other WildFly subsystems.<br>
It is not advised to change the XML configuration of the legacy
messaging subsystem to conform to the new messaging-activemq subsystem.
Instead, invoke the legacy subsystem <code>migrate</code> operation. This operation
will write the XML configuration of the new <strong>messaging-activemq</strong>
subsystem as a part of its execution.</p>
</div>
<div id="messaging-interceptors" class="paragraph">
<p>===== Messaging Interceptors</p>
</div>
<div class="paragraph">
<p>Messaging Interceptors are significantly different in EAP 7, requiring
both code and configuration changes by the user. In concrete the
interceptor base Java class is now
<strong>org.apache.artemis.activemq.api.core.interceptor.Interceptor</strong>, and the
user interceptor implementation classes may now be loaded by any server
module. Note that prior to EAP 7 the interceptor classes could only be
installed by adding these to the HornetQ module, thus requiring the user
to change such module XML descriptor, its <strong>module.xml</strong>.<br>
With respect to the server XML configuration, the user must now specify
the module to load its interceptors in the new <strong>messaging-activemq</strong>
subsystem XML config, e.g:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;subsystem xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:messaging-activemq:1.0</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;server name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
       ...
        &lt;incoming-interceptors&gt;
            &lt;<span class="type">class</span> <span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.foo.incoming.myInterceptor</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.foo</span><span class="delimiter">&quot;</span></span> /&gt;
            &lt;<span class="type">class</span> <span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.bar.incoming.myOtherInterceptor</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.bar</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;/incoming-interceptors&gt;
        &lt;outgoing-interceptors&gt;
            &lt;<span class="type">class</span> <span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.foo.outgoing.myInterceptor</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.foo</span><span class="delimiter">&quot;</span></span> /&gt;
            &lt;<span class="type">class</span> <span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.bar.outgoing.myOtherInterceptor</span><span class="delimiter">&quot;</span></span> module=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.bar</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;/outgoing-interceptors&gt;
   &lt;/server&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div id="jms-destinations" class="paragraph">
<p>===== JMS Destinations</p>
</div>
<div class="paragraph">
<p>In previous releases, JMS destination queues were configured in the
&lt;jms-destinations&gt; element under the hornetq-server section of the
<strong>messaging</strong> subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jms-destinations&gt;
&lt;jms-queue name=<span class="string"><span class="delimiter">&quot;</span><span class="content">testQueue</span><span class="delimiter">&quot;</span></span>&gt;
&lt;entry name=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue/test</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;entry name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/exported/jms/queue/test</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/jms-queue&gt;
&lt;/jms-destinations&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In WildFly, the JMS destination queue is configured in the default
server of the messaging-activemq subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jms-queue name=<span class="string"><span class="delimiter">&quot;</span><span class="content">testQueue</span><span class="delimiter">&quot;</span></span> entries=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue/test java:jboss/exported/jms/queue/test</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div id="messaging-logging" class="paragraph">
<p>==== Messaging Logging</p>
</div>
<div class="paragraph">
<p>The prefix of messaging log messages in WildFly is <strong>WFLYMSGAMQ</strong>, instead
of <strong>WFLYMSG</strong>.</p>
</div>
<div id="messaging-data" class="paragraph">
<p>==== Messaging Data</p>
</div>
<div class="paragraph">
<p>The location of the messaging data has been changed in the new
messaging-activemq subsystem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>messagingbindings/ &#8594; activemq/bindings/</p>
</li>
<li>
<p>messagingjournal/ &#8594; activemq/journal/</p>
</li>
<li>
<p>messaginglargemessages/ &#8594; activemq/largemessages/</p>
</li>
<li>
<p>messagingpaging/ &#8594; activemq/paging/</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To migrate legacy messaging data, you will have to export the
directories used by the legacy messaging subsystem and import them into
the new subsystem&#8217;s server by using its <code>import-journal operation:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/subsystem=messaging-activemq/server=<span class="keyword">default</span>:<span class="keyword">import</span>-<span class="include">journal</span>(<span class="include">file</span>=&lt;<span class="include">path</span> <span class="include">to</span> <span class="include">XML</span> <span class="include">dump</span>&gt;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML dump is a XML file generated by HornetQ <code>XmlDataExporter</code> util
class.</p>
</div>
<div id="application-migration" class="paragraph">
<p>== Application Migration</p>
</div>
<div class="paragraph">
<p>Before you migrate your application, you should be aware that some
features that were available in previous releases are now deprecated or
missing.</p>
</div>
<div id="ejbs" class="paragraph">
<p>=== EJBs</p>
</div>
<div id="cmp-entity-ejbs" class="paragraph">
<p>==== CMP Entity EJBs</p>
</div>
<div class="paragraph">
<p>Container-Managed Persistence entity beans support is optional in Java
EE 7, and WildFly does not provide support for these.</p>
</div>
<div class="paragraph">
<p>CMP entity beans are defined in the <strong>ejb-jar.xml</strong> descriptor, in
concrete an entity bean is CMP only if the <strong>&lt;entity/&gt;</strong>'s child element
named <strong>persistence-type</strong> is included and has a value of <strong>Container</strong>. An
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;ejb-jar xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
         xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd</span><span class="delimiter">&quot;</span></span>
         version=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;enterprise-beans&gt;
        &lt;entity&gt;
            &lt;ejb-name&gt;SimpleBMP&lt;/ejb-name&gt;
            &lt;local-home&gt;org.jboss.as.test.integration.ejb.entity.bmp.BMPLocalHome&lt;/local-home&gt;
            &lt;local&gt;org.jboss.as.test.integration.ejb.entity.bmp.BMPLocalInterface&lt;/local&gt;
            &lt;ejb-<span class="type">class</span>&gt;<span class="class">org</span>.jboss.as.test.integration.ejb.entity.bmp.SimpleBMPBean&lt;/ejb-<span class="type">class</span>&gt;
            &lt;<span class="class">persistence</span>-type&gt;<span class="predefined-type">Container</span>&lt;/persistence-type&gt;
            &lt;prim-key-<span class="type">class</span>&gt;<span class="class">java</span>.lang.Integer&lt;/prim-key-<span class="type">class</span>&gt;
            &lt;<span class="class">reentrant</span>&gt;<span class="predefined-constant">true</span>&lt;/reentrant&gt;
        &lt;/entity&gt;
    &lt;/enterprise-beans&gt;
&lt;/ejb-jar&gt;<span class="error"> </span></code></pre>
</div>
</div>
<div class="paragraph">
<p>CMP entity beans should be replaced by JPA entities.</p>
</div>
<div id="ejb-client" class="paragraph">
<p>==== EJB Client</p>
</div>
<div id="default-remote-connection-port" class="paragraph">
<p>===== Default Remote Connection Port</p>
</div>
<div class="paragraph">
<p>The default remote connection port has changed from '4447' to '8080'.</p>
</div>
<div class="paragraph">
<p>In JBoss AS7, the <strong>jboss-ejb-client.properties</strong> file looked similar to
the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=<span class="predefined-constant">false</span>
remote.connections=<span class="keyword">default</span>
remote.connection.default.host=localhost
remote.connection.default.port=<span class="integer">4447</span>
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In WildFly, the properties file looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=<span class="predefined-constant">false</span>
remote.connections=<span class="keyword">default</span>
remote.connection.default.host=localhost
remote.connection.default.port=<span class="integer">8080</span>
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div id="default-connector" class="paragraph">
<p>===== Default Connector</p>
</div>
<div class="paragraph">
<p>In WildFly, the default connector has changed from "remoting" to
"http-remoting". This change impacts clients that use libraries from one
release of JBoss and to connect to server in a different release.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a client application uses the EJB client library from JBoss AS 7
and wants to connect to WildFly 10 server, the server must be configured
to expose a remoting connector on a port other than "8080". The client
must then connect using that newly configured connector.</p>
</li>
<li>
<p>A client application that uses the EJB client library from WildFly 10
and wants to connect to a JBoss AS 7 server must be aware that the
server instance does not use the http-remoting connector and instead
uses a remoting connector. This is achieved by defining a new
client-side connection property.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">remote.connection.default.protocol=remote</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>External applications using JNDI, to remotely lookup up EJBs in a
WildFly 10 server, may also need to be migrated, please refer to
<a href="#src-557205_HowdoImigratemyapplicationfromAS7toWildFly-RemoteJNDIClients">#Remote
JNDI Clients</a> section for further information.</p>
</div>
<div id="jms" class="paragraph">
<p>=== JMS</p>
</div>
<div id="proprietary-jms-resource-definitions" class="paragraph">
<p>==== Proprietary JMS Resource Definitions</p>
</div>
<div class="paragraph">
<p>The proprietary XML descriptors, previously used to setup JMS resources,
are deprecated in WildFly. Java EE 7 (section EE.5.18) standardised such
functionality.</p>
</div>
<div class="paragraph">
<p>The deprecated descriptors are files bundled in the application package,
which name ends with <strong>-jms.xml</strong>.<br>
Their namespace has been changed to
<strong>urn:jboss:messaging-activemq-deployment:1.0</strong>.</p>
</div>
<div id="external-jms-clients" class="paragraph">
<p>==== External JMS Clients</p>
</div>
<div class="paragraph">
<p>JMS Resources are remotely looked up using JNDI, and looking up
resources in a WildFly 10 server may require changes in the application
code, please refer to
<a href="#src-557205_HowdoImigratemyapplicationfromAS7toWildFly-RemoteJNDIClients">#Remote
JNDI Clients</a> section for further information.</p>
</div>
<div id="jpa-and-hibernate" class="paragraph">
<p>=== JPA (and Hibernate)</p>
</div>
<div id="applications-that-plan-to-use-hibernate-orm-5.0" class="paragraph">
<p>==== Applications That Plan to Use Hibernate ORM 5.0</p>
</div>
<div class="paragraph">
<p>WildFly ships with Hibernate ORM 5.0 and those libraries are implicitly
added to the application classpath when a persistence.xml is detected
during deployment. If your application uses JPA, it will default to
using the Hibernate ORM 5.0 libraries.</p>
</div>
<div class="paragraph">
<p>Hibernate ORM 5.0 introduces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redesigned metamodel - Complete replacement for the current
org.hibernate.mapping code</p>
</li>
<li>
<p>Query parser - Improved query parser based on Antlr 3/4</p>
</li>
<li>
<p>Multi-tenancy improvements - Discriminator-based multi-tenancy</p>
</li>
<li>
<p>Follow-on fetches - Two-phase loading via LoadPlans/EntityGraphs</p>
</li>
</ul>
</div>
<div id="applications-that-currently-use-hibernate-orm-4.0---4.3" class="paragraph">
<p>==== Applications that currently use Hibernate ORM 4.0 - 4.3</p>
</div>
<div class="paragraph">
<p>If your application needs second-level cache enabled, you should migrate
to Hibernate ORM 5.0, which is integrated with Infinispan 8.0.
Applications written with Hibernate ORM 4.x can still use Hibernate 4.x
if you define a custom JBoss module with Hibernate 4.x JARs and exclude
the Hibernate 5 classes from your application. It is recommended that
you migrate your application to use Hibernate 5.</p>
</div>
<div class="paragraph">
<p>For information about the changes implemented between Hibernate 4 and
Hibernate 5, see
<a href="https://github.com/hibernate/hibernate-orm/blob/master/migration-guide.adoc" class="bare">https://github.com/hibernate/hibernate-orm/blob/master/migration-guide.adoc</a></p>
</div>
<div id="applications-that-currently-use-hibernate-3" class="paragraph">
<p>==== Applications that currently use Hibernate 3</p>
</div>
<div class="paragraph">
<p>The integration classes that made it easier to use Hibernate 3 in AS 7
were removed from WildFly 10. If your application still uses Hibernate 3
libraries, it is strongly recommended that you migrate your application
to use Hibernate 5 as Hibernate 3 will no longer work in WildFly without
a lot of effort. If you can not migrate to Hibernate 5, you must define
a custom JBoss Module for the Hibernate 3 classes and exclude the
Hibernate 5 classes from your application.</p>
</div>
<div id="web-applications" class="paragraph">
<p>=== Web Applications</p>
</div>
<div id="jboss-web-valves" class="paragraph">
<p>==== JBoss Web Valves</p>
</div>
<div class="paragraph">
<p>Undertow does not support the JBoss Web Valve functionality. This can be
replaced by Undertow Handlers (see
<a href="http://undertow.io/undertow-docs/undertow-docs-1.3.0/index.html#undertow-handler-authors-guide" class="bare">http://undertow.io/undertow-docs/undertow-docs-1.3.0/index.html#undertow-handler-authors-guide</a>
for more).</p>
</div>
<div class="paragraph">
<p>List of valves that were provided with JBoss Web, together with a
corresponding Undertow handler, is provided above, in the section on the
JBoss Web subsystem.</p>
</div>
<div class="paragraph">
<p>JBoss Web Valves are specified in the proprietary <strong>jboss-web.xml</strong>
descriptor, through <strong>&lt;valve /&gt;</strong> element(s). These can be replaced using
the <strong>&lt;http-handler /&gt;</strong> element(s). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-web&gt;
    &lt;valve&gt;
        &lt;<span class="type">class</span>-<span class="class">name</span>&gt;org.apache.catalina.valves.RequestDumperValve&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
        &lt;module&gt;org.jboss.as.web&lt;/module&gt;
<span class="error"> </span>   &lt;/valve&gt;
&lt;/jboss-web&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be replaced by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jboss-web&gt;
    &lt;http-handler&gt;
        &lt;<span class="type">class</span>-<span class="class">name</span>&gt;io.undertow.server.handlers.RequestDumpingHandler&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
        &lt;module&gt;io.undertow.core&lt;/module&gt;
    &lt;/http-handler&gt;
&lt;/jboss-web&gt;</code></pre>
</div>
</div>
<div id="web-services" class="paragraph">
<p>=== Web Services</p>
</div>
<div id="cxf-spring-webservices" class="paragraph">
<p>==== CXF Spring Webservices</p>
</div>
<div class="paragraph">
<p>The setup of web service&#8217;s endpoints and clients, through a Spring XML
descriptor, driving a CXF bus creation, is no longer supported in
WildFly.</p>
</div>
<div class="paragraph">
<p>Any application containing a jbossws-cxf.xml must migrate all
functionality specified in such XML descriptor, mostly already supported
by the JAX-WS specification, included in Java EE 7. It is still possible
to rely on direct Apache CXF API usage, loosing the Java EE portability
of the application, for instance when specific Apache CXF
functionalities are needed. Please refer to the Apache CXF Integration
document for further information.</p>
</div>
<div id="jax-rpc" class="paragraph">
<p>==== JAX-RPC</p>
</div>
<div class="paragraph">
<p>JAX-RPC is an API for building Web services and clients that used remote
procedure calls (RPC) and XML, which was deprecated in Java EE 6, and is
no longer supported by WildFly.</p>
</div>
<div class="paragraph">
<p>JAX-RPC Web Services may be identified by the presence of the XML
descriptor named web services.xml, containing a
<strong>&lt;webservice-description/&gt;</strong> element that includes a child element named
<strong>&lt;jaxrpc-mapping-file/&gt;</strong>. An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;webservices xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/j2ee</span><span class="delimiter">&quot;</span></span>
    xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/j2ee http://www.ibm.com/webservices/xsd/j2ee_web_services_1_1.xsd</span><span class="delimiter">&quot;</span></span> version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;webservice-description&gt;
        &lt;webservice-description-name&gt;HelloService&lt;/webservice-description-name&gt;
        &lt;wsdl-file&gt;WEB-INF/wsdl/HelloService.wsdl&lt;/wsdl-file&gt;
        &lt;jaxrpc-mapping-file&gt;WEB-INF/mapping.xml&lt;/jaxrpc-mapping-file&gt;
        &lt;port-component&gt;
            &lt;port-component-name&gt;Hello&lt;/port-component-name&gt;
            &lt;wsdl-port&gt;HelloPort&lt;/wsdl-port&gt;
            &lt;service-endpoint-<span class="type">interface</span>&gt;<span class="class">org</span>.jboss.chap12.hello.Hello&lt;/service-endpoint-<span class="type">interface</span>&gt;
            &lt;<span class="class">service</span>-impl-bean&gt;
                &lt;servlet-link&gt;HelloWorldServlet&lt;/servlet-link&gt;
            &lt;/service-impl-bean&gt;
        &lt;/port-component&gt;
    &lt;/webservice-description&gt;
&lt;/webservices&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications using JAX-RPC should be migrated to use JAX-WS, the current
Java EE standard web service framework.</p>
</div>
<div id="jax-rs-2.0" class="paragraph">
<p>==== JAX-RS 2.0</p>
</div>
<div class="paragraph">
<p>JSR 339: JAX-RS 2.0: The Java API for RESTful Web Services specification
is located here: <a href="https://jcp.org/en/jsr/detail?id=339" class="bare">https://jcp.org/en/jsr/detail?id=339</a></p>
</div>
<div class="paragraph">
<p>Some changes to the <code>MessageBodyWriter</code> interface may represent a
backward incompatible change with respect to JAX-RS 1.X.</p>
</div>
<div class="paragraph">
<p>Be sure to define an @Produces or @Consumes for your endpoints. Failure
to do so may result in an error similar to the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.jboss.resteasy.core.NoMessageBodyWriterFoundFailure: Could not find MessageBodyWriter <span class="keyword">for</span> response object of type: &lt;OBJECT&gt; of media type: &lt;CONTENT_TYPE&gt;</code></pre>
</div>
</div>
<div id="rest-client-api" class="paragraph">
<p>==== REST Client API</p>
</div>
<div class="paragraph">
<p>Some REST Client API classes and methods are deprecated, for example:
org.jboss.resteasy.client.ClientRequest and
org.jboss.resteasy.client.ClientResponse. Instead, use
<a href="https://docs.jboss.org/resteasy/docs/3.0-rc-1/javadocs/index.html?org/jboss/resteasy/client/jaxrs/ResteasyClient.html">﻿org.jboss.resteasy.client.jaxrs.ResteasyClient</a>
and javax.ws.rs.core.Response. See the <code>resteasy-jaxrs-client
quickstart</code> for an example of an external JAX-RS RestEasy client that
interacts with a JAX-RS Web service.</p>
</div>
<div id="application-clustering" class="paragraph">
<p>=== Application Clustering</p>
</div>
<div id="ha-singleton" class="paragraph">
<p>==== HA Singleton</p>
</div>
<div class="paragraph">
<p>JBoss AS7 introduced singleton services - a mechanism for installing an
service such that it would only start on one node in the cluster at a
time, a HA Singleton. Such mechanism required usage of a private JBoss
EAP Clustering API, designed around the class
<strong>org.jboss.as.clustering.singleton.SingletonService</strong>, and was documented
in detail at
<a href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html/Development_Guide/Implement_an_HA_Singleton.html" class="bare">https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html/Development_Guide/Implement_an_HA_Singleton.html</a>
, and while not difficult to implement, the installation process
suffered from a couple shortcomings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Installing multiple singleton services within a single deployment
caused the deployer to hang.</p>
</li>
<li>
<p>Installing a singleton service required the user to specify several
private module dependencies in /META-INF/MANIFEST.MF</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WildFly 10 introduces a new public API for building such services, which
significantly simplifies the process, and solves the issues found in the
legacy solution. The JBoss EAP 7 Quickstart application named
<strong>cluster-ha-singleton</strong> examples a HA Singleton implementation using the
new API, and may be found at
<a href="https://github.com/jboss-developer/jboss-eap-quickstarts/tree/7.0.x-develop/cluster-ha-singleton" class="bare">https://github.com/jboss-developer/jboss-eap-quickstarts/tree/7.0.x-develop/cluster-ha-singleton</a>
.<br>
FIXME: community URLs instead</p>
</div>
<div id="stateful-session-ejb-clustering" class="paragraph">
<p>==== Stateful Session EJB Clustering</p>
</div>
<div class="paragraph">
<p>WildFly 10 no longer requires Stateful Session EJBs to use the
<strong>org.jboss.ejb3.annotation.Clustered</strong> annotation to enable clustering
behaviour. By default, if the server is started using an HA profile, the
state of your SFSBs will be replicated automatically. Disabling this
behaviour is achievable on a per-EJB basis, by annotating your bean
using <strong>@Stateful(passivationCapable=false)</strong>, which is new to the EJB 3.2
specification; or globally through the configuration of the EJB3
subsystem, in the server configuration.</p>
</div>
<div class="paragraph">
<p>Note that the <strong>@Clustered</strong> annotation, if used by an application, is
simply ignored, the application deployment will not fail.</p>
</div>
<div id="web-session-clustering" class="paragraph">
<p>==== Web Session Clustering</p>
</div>
<div class="paragraph">
<p>WildFly 10 introduces a new web session clustering implementation,
replacing the one found in AS7, which has been around for ages (since
JBoss AS 3.2!), and was tightly coupled to the legacy JBoss Web
subsystem source code. The most relevant changes in the new
implementation are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Introduction of a proper session manager SPI, and an Infinispan
implementation of it, decoupled from the web subsystem implementation</p>
</li>
<li>
<p>Sessions are implemented as a facade over one or more cache entries,
which means that the container&#8217;s session manager itself does not retain
a separate reference to each HttpSession</p>
</li>
<li>
<p>Pessimistic locking of cache entries effectively ensures that only a
single client on a single node ever accesses a given session at any
given time</p>
</li>
<li>
<p>Usage of cache entry grouping, instead of atomic maps, to ensure that
multiple cache entries belonging to the same session are co-located.</p>
</li>
<li>
<p>Session operations within a request only ever use a single
batch/transaction. This results in fewer RPCs per request.</p>
</li>
<li>
<p>Support for write-through cache stores, as well as passivation-only
cache stores.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With respect to applications, the new web session clustering
implementation deprecates/reinterprets much of the related
configuration, which is included in JBoss&#8217;s proprietary web application
XML descriptor, <strong>jboss-web.xml</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&lt;max-active-sessions/&gt;</strong><br>
Previously, session creation would fail if an additional session would
cause the number of active sessions to exceed the value specified by &lt;
<strong>max-active-sessions/&gt;</strong>.<br>
In the new implementation, <strong>&lt;max-active-sessions/&gt;</strong> is used to enable
session passivation. If session creation would cause the number of
active sessions to exceed <strong>&lt;max-active-sessions/&gt;</strong>, then the oldest
session known to the session manager will passivate to make room for the
new session.</p>
</li>
<li>
<p><strong>&lt;passivation-config/&gt;</strong><br>
This configuration element and its sub-elements are no longer used in
WildFly.</p>
</li>
<li>
<p><strong>&lt;use-session-passivation/&gt;</strong><br>
Previously, passivation was enabled via this attribute, yet in the new
implementation, passivation is enabled by specifying a non-negative
value for <strong>&lt;max-active-sessions/&gt;</strong>.</p>
</li>
<li>
<p><strong>&lt;passivation-min-idle-time/&gt;</strong><br>
Previously, sessions needed to be active for at least a specific amount
of time before becoming a candidate for passivation. This could cause
session creation to fail, even when passivation was enabled.<br>
The new implementation does not support this logic and thus avoids this
DoS vulnerability.</p>
</li>
<li>
<p><strong>&lt;passivation-max-idle-time/&gt;</strong><br>
Previously, a session would be passivated after it was idle for a
specific amount of time.<br>
The new implementation does not support eager passivation - only lazy
passivation. Sessions are only passivated when necessary to comply with
<strong>&lt;max-active-sessions/&gt;</strong>.</p>
</li>
<li>
<p><strong>&lt;replication-config/&gt;</strong><br>
The new implementation deprecates a number of sub-elements:</p>
</li>
<li>
<p><strong>&lt;replication-trigger/&gt;</strong><br>
Previously, session attributes could be treated as either mutable or
immutable depending on the values specified by <strong>&lt;replication-trigger/&gt;</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>SET treated all attributes as immutable, requiring a separate
HttpSession.setAttribute(&#8230;&#8203;) to indicate that the value changed.</p>
</li>
<li>
<p>SET_AND_GET treated all session attributes as mutable.</p>
</li>
<li>
<p>SET_AND_NON_PRIMITIVE_GET recognised a small set of types (i.e.
strings and boxed primitives) as immutable, and assumed that any other
attribute was mutable.<br>
The new implementation replaces this configuration option with a single,
robust strategy. Session attributes are assumed to be mutable unless one
of the following is true:</p>
</li>
<li>
<p>The value is a known immutable value:</p>
<div class="ulist">
<ul>
<li>
<p>null</p>
</li>
<li>
<p>java.util.Collections.EMPTY_LIST, EMPTY_MAP, EMPTY_SET</p>
</li>
</ul>
</div>
</li>
<li>
<p>The value type is or implements a known immutable type:</p>
<div class="ulist">
<ul>
<li>
<p>Boolean, Byte, Character, Double, Float, Integer, Long, Short</p>
</li>
<li>
<p>java.lang.Enum, StackTraceElement, String</p>
</li>
<li>
<p>java.io.File, java.nio.file.Path</p>
</li>
<li>
<p>java.math.BigDecimal, BigInteger, MathContext</p>
</li>
<li>
<p>java.net.InetAddress, InetSocketAddress, URI, URL</p>
</li>
<li>
<p>java.security.Permission</p>
</li>
<li>
<p>java.util.Currency, Locale, TimeZone, UUID</p>
</li>
</ul>
</div>
</li>
<li>
<p>The value type is annotated with
@org.wildfly.clustering.web.annotation.Immutable</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>&lt;use-jk/&gt;</strong><br>
Previously, the instance-id of the node handling a given request was
appended to the jsessionid (for use by load balancers such as mod_jk,
mod_proxy_balancer, mod_cluster, etc.) depending on the value specified
for <strong>&lt;use-jk/&gt;</strong>. In the new implementation, the instance-id, if defined,
is always appended to the jsessionid.</p>
</li>
<li>
<p><strong>&lt;max-unreplicated-interval/&gt;</strong><br>
Previously, this configuration option was an optimization that would
prevent the replicate of a session&#8217;s timestamp if no session attribute
was changed. While this sounds nice, in practice it doesn&#8217;t prevent any
RPCs, since session access requires cache transaction RPCs regardless of
whether any session attributes changed. In the new implementation, the
timestamp of a session is replicated on every request. This prevents
stale session meta data following failover.</p>
</li>
<li>
<p><strong>&lt;snapshot-mode/&gt;</strong><br>
Previously, one could configure <strong>&lt;snapshot-mode/&gt;</strong> as INSTANT or
INTERVAL. Infinispan&#8217;s replication queue renders this configuration
option obsolete.</p>
</li>
<li>
<p><strong>&lt;snapshot-interval/&gt;</strong><br>
Only relevant for <strong>&lt;snapshot-mode&gt;INTERVAL&lt;/snapshot-mode&gt;</strong>. See above.</p>
</li>
<li>
<p><strong>&lt;session-notification-policy/&gt;</strong><br>
Previously, the value defined by this attribute defined a policy for
triggering session events. In the new implementation, this behaviour is
spec-driven and not configurable.</p>
</li>
</ul>
</div>
<div id="other-specifications-and-frameworks" class="paragraph">
<p>=== Other Specifications and Frameworks</p>
</div>
<div id="remote-jndi-clients" class="paragraph">
<p>==== Remote JNDI Clients</p>
</div>
<div class="paragraph">
<p>WildFly 10&#8217;s default JNDI Provider URL has changed, which means that
external applications, using JNDI to lookup remote resources, for
instance an EJB or a JMS Queue, may need to change the value for the
JNDI <strong>InitialContext</strong> environment&#8217;s property named
<strong>java.naming.provider.url</strong>. The default URL scheme is now
<strong>http-remoting</strong>, and the default URL port is now <strong>8080</strong>.</p>
</div>
<div class="paragraph">
<p>As an example, considering the application server host is <strong>localhost</strong>,
then clients previously accessing JBoss AS7 would use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java.naming.factory.initial=org.jboss.naming.remote.client.InitialContextFactory
java.naming.provider.url=remote:<span class="comment">//localhost:4447</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>while clients now accessing WildFly should use instead</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java.naming.factory.initial=org.jboss.naming.remote.client.InitialContextFactory
java.naming.provider.url=http-remoting:<span class="comment">//localhost:8080</span></code></pre>
</div>
</div>
<div id="jsr-88" class="paragraph">
<p>==== JSR-88</p>
</div>
<div class="paragraph">
<p>The specification which aimed to standardise deployment tasks got very
little adoption, due to much more "feature rich" proprietary solutions
already included in every vendor application server. It was no surprise
that JSR-88 support was dropped from Java EE 7, and WildFly followed
that and dropped support too.</p>
</div>
<div class="paragraph">
<p>A JSR-88 deployment plan is identified by a XML descriptor named
<strong>deployment-plan.xml</strong>, bundled in a zip/jar archive.</p>
</div>
<div id="module-dependencies" class="paragraph">
<p>==== Module Dependencies</p>
</div>
<div class="paragraph">
<p>Applications defining dependencies to WildFly modules, through the
application&#8217;s package MANIFEST.MF or jboss-deployment-structure.xml, may
be referencing missing modules. When migrating an application, relying
on such functionality, the presence of the referenced modules should be
validated in advance.</p>
</div>
<div class="paragraph">
<p>= How do I migrate my application from WebLogic to WildFly</p>
</div>
<div class="paragraph">
<p>The purpose of this guide is to document the application changes that
are needed to successfully run and deploy WebLogic applications on
WildFly.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Feel free to add content in any way you prefer. You do not need to
follow the template below. This is a work in progress.</p>
</div>
<div id="introduction" class="paragraph">
<p>== Introduction</p>
</div>
<div id="about-this-guide" class="paragraph">
<p>=== About this Guide</p>
</div>
<div class="paragraph">
<p>The purpose of this document is to guide you through the planning
process and migration of fairly simple and standard Oracle WebLogic
applications to WildFly. O</p>
</div>
<div class="paragraph">
<p>= How do I migrate my application from WebSphere to WildFly</p>
</div>
<div class="paragraph">
<p>The purpose of this guide is to document the application changes that
are needed to successfully run and deploy WebLogic applications on
WildFly.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Feel free to add content in any way you prefer. You do not need to
follow the template below. This is a work in progress.</p>
</div>
<div id="introduction" class="paragraph">
<p>== Introduction</p>
</div>
<div id="about-this-guide" class="paragraph">
<p>=== About this Guide</p>
</div>
<div class="paragraph">
<p>The purpose of this document is to guide you through the planning
process and migration of fairly simple and standard Oracle WebLogic
applications to WildFly.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version {version}<br>
Last updated 2017-09-12 23:01:19 CEST
</div>
</div>
</body>
</html>